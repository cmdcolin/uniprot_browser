const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LaunchBreakendPanel-Bn3onEa6.js","./index-DPMJgfAS.js","./index-DHgBXOEh.css","./BaseCard-BxLlpstl.js","./VariantConsequenceDataGrid-DMDCPK8K.js","./DataGrid-BbeQwLC2.js","./index-BHGTJiUw.js","./utils-DSyQ0Yxy.js","./getThemeProps-D2Hd2SEb.js","./MenuItem-BZgCoK98.js","./dividerClasses-CRpWzjDJ.js","./Divider-BsNHrm83.js","./Badge-HDwRQZRU.js","./TableCell-CTZZHzq1.js"])))=>i.map(i=>d[i]);
import{a as f,H,I as V,J as U,j as o,K as Q,M as J,be as D,N as K,O as X,cR as L,aP as Y,f as k,T as _,C as E,u as P,d as Z,cS as ee,cp as te,c as oe,o as q,P as ne,bi as re,_ as M}from"./index-DPMJgfAS.js";import{F as se}from"./FeatureDetails-7RVrSh1y.js";import{B as A}from"./BaseCard-BxLlpstl.js";import{D as I}from"./DataGridFlexContainer-B8arD5BB.js";import{T as ie,a as le,t as R,D as W,b as O}from"./DataGrid-BbeQwLC2.js";import"./index-BHGTJiUw.js";import"./utils-DSyQ0Yxy.js";import"./getThemeProps-D2Hd2SEb.js";import"./MenuItem-BZgCoK98.js";import"./dividerClasses-CRpWzjDJ.js";import"./Divider-BsNHrm83.js";import"./Badge-HDwRQZRU.js";import"./TableCell-CTZZHzq1.js";function ae(e){return f.Children.toArray(e).filter(r=>f.isValidElement(r))}function de(e){return V("MuiToggleButtonGroup",e)}const d=H("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),ue=e=>{const{classes:r,orientation:t,fullWidth:n,disabled:a}=e,i={root:["root",t,n&&"fullWidth"],grouped:["grouped",`grouped${D(t)}`,a&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return K(i,de,r)},ce=Q("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:t}=e;return[{[`& .${d.grouped}`]:r.grouped},{[`& .${d.grouped}`]:r[`grouped${D(t.orientation)}`]},{[`& .${d.firstButton}`]:r.firstButton},{[`& .${d.lastButton}`]:r.lastButton},{[`& .${d.middleButton}`]:r.middleButton},r.root,t.orientation==="vertical"&&r.vertical,t.fullWidth&&r.fullWidth]}})(X(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${d.grouped}`]:{[`&.${d.selected} + .${d.grouped}.${d.selected}`]:{borderTop:0,marginTop:0}},[`& .${d.firstButton},& .${d.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${d.lastButton},& .${d.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${d.lastButton}.${R.disabled},& .${d.middleButton}.${R.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${d.grouped}`]:{[`&.${d.selected} + .${d.grouped}.${d.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${d.firstButton},& .${d.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${d.lastButton},& .${d.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${d.lastButton}.${R.disabled},& .${d.middleButton}.${R.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),pe=f.forwardRef(function(r,t){const n=U({props:r,name:"MuiToggleButtonGroup"}),{children:a,className:i,color:u="standard",disabled:l=!1,exclusive:s=!1,fullWidth:p=!1,onChange:c,orientation:m="horizontal",size:v="medium",value:h,...w}=n,T={...n,disabled:l,fullWidth:p,orientation:m,size:v},j=ue(T),B=f.useCallback((x,b)=>{if(!c)return;const $=h&&h.indexOf(b);let F;h&&$>=0?(F=h.slice(),F.splice($,1)):F=h?h.concat(b):[b],c(x,F)},[c,h]),S=f.useCallback((x,b)=>{c&&c(x,h===b?null:b)},[c,h]),N=f.useMemo(()=>({className:j.grouped,onChange:s?S:B,value:h,size:v,fullWidth:p,color:u,disabled:l}),[j.grouped,s,S,B,h,v,p,u,l]),g=ae(a),y=g.length,C=x=>{const b=x===0,$=x===y-1;return b&&$?"":b?j.firstButton:$?j.lastButton:j.middleButton};return o.jsx(ce,{role:"group",className:J(j.root,i),ref:t,ownerState:T,...w,children:o.jsx(ie.Provider,{value:N,children:g.map((x,b)=>o.jsx(le.Provider,{value:C(b),children:x},b))})})});function fe({value:e,ref:r}){const[t,n]=f.useState(!1);return L(r,e)!==e?o.jsxs("div",{children:[o.jsx("button",{onClick:()=>{n(!t)},children:t?"Show simplified ALT":"Show raw ALT"})," ",t?e:L(r,e)]}):e}function me({value:e}){const[r,t]=f.useState(!1),[n,a]=f.useState(!1),i=String(e);return i.length>100?o.jsxs(o.Fragment,{children:[o.jsx("button",{type:"button",onClick:()=>{Y(i),a(!0),setTimeout(()=>{a(!1)},700)},children:n?"Copied to clipboard":"Copy"}),o.jsx("button",{type:"button",onClick:()=>{t(u=>!u)},children:r?"Show less":"Show more"}),o.jsx("div",{children:r?i:`${i.slice(0,100)}...`})]}):o.jsx("div",{children:i})}function he({checked:e,disabled:r,label:t,onChange:n}){return o.jsx(k,{disabled:r,control:o.jsx(E,{checked:e,onChange:n}),label:o.jsx(_,{variant:"body2",children:t})})}function ge(e){return e.toPrecision(3)}function ve({rows:e}){const[r,t]=f.useState(!1),n={};if(r)for(const l of e){const s={},p=l.GT.split(/[/|]/);for(const m of p)s[m]=(s[m]||0)+1;const c=Object.entries(s).map(([m,v])=>`${m}:${v}`).join(";");n[c]||(n[c]={count:0,GT:c,genotype:l.genotype}),n[c].count++}else for(const l of e){const s=l.GT;n[s]||(n[s]={count:0,GT:l.GT,genotype:l.genotype}),n[s].count++}const a=Object.entries(n).map(([l,s])=>({id:l,...s,count:`${s.count} / ${e.length}`,frequency:`${ge(s.count/e.length*100)}%`})),u=(a[0]?Object.keys(a[0]):[]).map(l=>P.measureGridWidth(a.map(s=>`${s[l]}`)));return o.jsxs("div",{children:[o.jsx(k,{control:o.jsx(E,{checked:r}),label:o.jsx(_,{variant:"body2",children:"Use allele counts instead of exact GT"}),onChange:(l,s)=>{t(s)}}),o.jsx(I,{children:o.jsx(W,{rows:a,hideFooter:!0,rowHeight:25,columnHeaderHeight:35,columns:[{field:"GT",width:u[0]},{field:"count",width:u[1]},{field:"frequency",width:u[2]},{field:"genotype",width:u[3]}]})})]})}function xe({columns:e,filter:r,setFilter:t}){return o.jsxs(o.Fragment,{children:[o.jsx(_,{children:"These filters can use a plain text search or regex style query, e.g. in the genotype field, entering 1 will query for all genotypes that include the first alternate allele e.g. 0|1 or 1|1, entering [1-9]\\d* will find any non-zero allele e.g. 0|2 or 2/33"}),e.map(({field:n})=>o.jsx(Z,{placeholder:`Filter ${n}`,value:r[n]||"",onChange:a=>{t({...r,[n]:a.target.value})}},`filter-${n}`))]})}function be(e,r,t,n){const a=Object.entries(e).map(([s,p])=>{var c;const m=(c=p.GT)===null||c===void 0?void 0:c[0];return[s,{...p,...m?{GT:`${m}`,genotype:ee(`${m}`,r,t)}:{}}]});let i,u=[];const l=Object.keys(n);try{u=a.map(([s,p])=>({...Object.fromEntries(Object.entries(p).map(([c,m])=>[c,m])),sample:s,id:s})).filter(s=>l.length?l.every(p=>{const c=n[p];return c?new RegExp(c,"i").exec(s[p]):!0}):!0)}catch(s){console.error(s),i=s}return{rows:u,error:i}}function je(e){const{feature:r,descriptions:t={}}=e,[n,a]=f.useState({}),[i,u]=f.useState("all"),[l,s]=f.useState(!1),p=r.samples||{},c=r.ALT,m=r.REF,{rows:v,error:h}=be(p,m,c,n),w=new Set(["sample",...Object.keys(v[0]||{})]);w.delete("id");const T=[...w],j=T.map(g=>P.measureGridWidth(v.map(y=>y[g]))),B=T.map((g,y)=>{var C,x;return{field:g,description:(x=(C=t?.FORMAT)===null||C===void 0?void 0:C[g])===null||x===void 0?void 0:x.Description,width:j[y]}}),S=new Set(["sample","GT"]),N=new Set(["sample","GT","genotype"]);return v.length?o.jsxs(o.Fragment,{children:[o.jsx(A,{...e,title:"Genotype frequencies",children:o.jsx(te.ErrorBoundary,{FallbackComponent:oe.ErrorMessage,children:o.jsx(ve,{rows:v})})}),o.jsxs(A,{...e,title:"Samples",children:[h?o.jsx(_,{color:"error",children:`${h}`}):null,o.jsxs("div",{children:[o.jsx(he,{label:"Show filters",checked:l,onChange:g=>{s(g.target.checked)}}),o.jsxs(pe,{value:i,exclusive:!0,size:"small",onChange:(g,y)=>{y!==null&&u(y)},children:[o.jsx(O,{value:"all",children:"All"}),o.jsx(O,{value:"gtOnly",children:"GT only"}),o.jsx(O,{value:"genotypeOnly",children:"GT+resolved genotype"})]})]}),l?o.jsx(xe,{setFilter:a,columns:B,filter:n}):null,o.jsx(I,{children:o.jsx(W,{rows:v,hideFooter:v.length<100,columns:i==="gtOnly"?B.filter(g=>S.has(g.field)):i==="genotypeOnly"?B.filter(g=>N.has(g.field)):B,rowHeight:25,columnHeaderHeight:35,showToolbar:!0})})]})]}):null}const ye={CHROM:"chromosome: An identifier from the reference genome",POS:"position: The reference position, with the 1st base having position 1",ID:"identifier: Semi-colon separated list of unique identifiers where available",REF:"reference base(s): Each base must be one of A,C,G,T,N (case insensitive).",ALT:"alternate base(s): Comma-separated list of alternate non-reference alleles",QUAL:"quality: Phred-scaled quality score for the assertion made in ALT",FILTER:"filter status: PASS if this position has passed all filters, otherwise a semicolon-separated list of codes for filters that fail"},G=f.lazy(()=>M(()=>import("./LaunchBreakendPanel-Bn3onEa6.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)),z=f.lazy(()=>M(()=>import("./VariantConsequenceDataGrid-DMDCPK8K.js"),__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12,13]),import.meta.url));function Be({descriptions:e,feature:r}){var t,n,a,i,u;const l=(n=(t=e?.INFO)===null||t===void 0?void 0:t.ANN)===null||n===void 0?void 0:n.Description,s=((i=(a=l?.match(/.*Functional annotations:'(.*)'$/))===null||a===void 0?void 0:a[1])===null||i===void 0?void 0:i.split("|"))||[],p=((u=r.INFO)===null||u===void 0?void 0:u.ANN)||[];return o.jsx(z,{fields:s,data:p,title:"Variant ANN field"})}function Te({descriptions:e,feature:r}){var t,n,a,i,u;const l=(n=(t=e?.INFO)===null||t===void 0?void 0:t.CSQ)===null||n===void 0?void 0:n.Description,s=((i=(a=l?.match(/.*Format: (.*)/))===null||a===void 0?void 0:a[1])===null||i===void 0?void 0:i.split("|"))||[],p=((u=r.INFO)===null||u===void 0?void 0:u.CSQ)||[];return o.jsx(z,{fields:s,data:p,title:"Variant CSQ field"})}function Ce({model:e}){const{featureData:r}=e,t=JSON.parse(JSON.stringify(r)),{type:n=""}=t;return n==="breakend"?o.jsx(G,{feature:t,locStrings:t.ALT.map(a=>{var i;return((i=re(a))===null||i===void 0?void 0:i.MatePosition)||""}),model:e}):n==="translocation"?o.jsx(G,{feature:t,model:e,locStrings:[`${t.INFO.CHR2[0]}:${t.INFO.END}`]}):n==="paired_feature"?o.jsx(G,{feature:t,model:e,locStrings:[`${t.mate.refName}:${t.mate.start}`]}):n.includes("inversion")||n.includes("deletion")||n.includes("duplication")||n.includes("cnv")||n.includes("sv")?o.jsx(G,{feature:{uniqueId:"random",refName:t.refName,start:t.start,end:t.start+1,mate:{refName:t.refName,start:t.end,end:t.end+1}},model:e,locStrings:[`${t.refName}:${t.end}`]}):null}const $e=q(function(e){const{feat:r,model:t}=e,{descriptions:n}=t,{samples:a,...i}=r,{REF:u}=i;return o.jsxs(ne,{"data-testid":"variant-side-drawer",children:[o.jsx(se,{feature:i,descriptions:{...ye,...n},formatter:(l,s)=>s==="ALT"?o.jsx(fe,{value:`${l}`,ref:u}):o.jsx(me,{value:l}),...e}),o.jsxs(f.Suspense,{fallback:null,children:[o.jsx(Te,{feature:i,descriptions:n}),o.jsx(Be,{feature:i,descriptions:n}),o.jsx(Ce,{model:t})]}),o.jsx(je,{feature:r,...e,descriptions:n})]})}),Pe=q(function(e){const{model:r}=e,{featureData:t}=r,n=structuredClone(t);return n?o.jsx($e,{feat:n,...e}):o.jsx("div",{children:"No feature loaded, may not be available after page refresh because it was too large for localStorage"})});export{Pe as default};
//# sourceMappingURL=VariantFeatureWidget-CjtB8Lll.js.map
