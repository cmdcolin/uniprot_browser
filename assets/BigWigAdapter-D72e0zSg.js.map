{"version":3,"file":"BigWigAdapter-D72e0zSg.js","sources":["../../node_modules/@gmod/bbi/esm/bigwig.js","../../node_modules/@jbrowse/plugin-wiggle/esm/BigWigAdapter/BigWigAdapter.js"],"sourcesContent":["import { BBI } from \"./bbi.js\";\nimport { BlockView } from \"./block-view.js\";\nexport class BigWig extends BBI {\n    /**\n     * Retrieves a BlockView of a specific zoomLevel\n     *\n     * @param scale - number\n     *\n     * @param opts - An object containing basesPerSpan (e.g. pixels per basepair)\n     * or scale used to infer the zoomLevel to use\n     */\n    async getView(scale, opts) {\n        const { zoomLevels, refsByName, uncompressBufSize } = await this.getHeader(opts);\n        const basesPerPx = 1 / scale;\n        const maxLevel = zoomLevels.length - 1;\n        for (let i = maxLevel; i >= 0; i -= 1) {\n            const zh = zoomLevels[i];\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n            if (zh && zh.reductionLevel <= 2 * basesPerPx) {\n                return new BlockView(this.bbi, refsByName, zh.indexOffset, uncompressBufSize > 0, 'summary');\n            }\n        }\n        return this.getUnzoomedView(opts);\n    }\n}\n//# sourceMappingURL=bigwig.js.map","import { BigWig } from '@gmod/bbi';\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter';\nimport { updateStatus } from '@jbrowse/core/util';\nimport { openLocation } from '@jbrowse/core/util/io';\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs';\nimport { rectifyStats } from '@jbrowse/core/util/stats';\nclass BigWigAdapter extends BaseFeatureDataAdapter {\n    async setupPre(opts) {\n        const { statusCallback = () => { } } = opts || {};\n        const pluginManager = this.pluginManager;\n        const bigwig = new BigWig({\n            filehandle: openLocation(this.getConf('bigWigLocation'), pluginManager),\n        });\n        return {\n            bigwig,\n            header: await updateStatus('Downloading bigwig header', statusCallback, () => bigwig.getHeader(opts)),\n        };\n    }\n    async setup(opts) {\n        if (!this.setupP) {\n            this.setupP = this.setupPre(opts).catch((e) => {\n                this.setupP = undefined;\n                throw e;\n            });\n        }\n        return this.setupP;\n    }\n    async getRefNames(opts) {\n        const { header } = await this.setup(opts);\n        return Object.keys(header.refsByName);\n    }\n    async refIdToName(refId) {\n        var _a;\n        const { header } = await this.setup();\n        return (_a = header.refsByNumber[refId]) === null || _a === void 0 ? void 0 : _a.name;\n    }\n    async getGlobalStats(opts) {\n        const { header } = await this.setup(opts);\n        return rectifyStats(header.totalSummary);\n    }\n    getFeatures(region, opts = {}) {\n        const { refName, start, end } = region;\n        const { bpPerPx = 0, resolution = 1, stopToken, statusCallback = () => { }, } = opts;\n        return ObservableCreate(async (observer) => {\n            const source = this.getConf('source');\n            const resolutionMultiplier = this.getConf('resolutionMultiplier');\n            const { bigwig } = await this.setup(opts);\n            const feats = await updateStatus('Downloading bigwig data', statusCallback, () => bigwig.getFeatures(refName, start, end, {\n                ...opts,\n                basesPerSpan: (bpPerPx / resolution) * resolutionMultiplier,\n            }));\n            for (const data of feats) {\n                if (source) {\n                    data.source = source;\n                }\n                const uniqueId = `${source}:${region.refName}:${data.start}-${data.end}`;\n                data.refName = refName;\n                data.uniqueId = uniqueId;\n                observer.next({\n                    get: (str) => data[str],\n                    id: () => uniqueId,\n                    toJSON: () => data,\n                });\n            }\n            observer.complete();\n        }, stopToken);\n    }\n    async getMultiRegionFeatureDensityStats(_regions) {\n        return {\n            featureDensity: 0,\n        };\n    }\n}\nBigWigAdapter.capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n];\nexport default BigWigAdapter;\n"],"names":["BigWig","BBI","scale","opts","zoomLevels","refsByName","uncompressBufSize","basesPerPx","maxLevel","zh","BlockView","BigWigAdapter","BaseFeatureDataAdapter","statusCallback","pluginManager","bigwig","openLocation","updateStatus","e","header","refId","_a","rectifyStats","region","refName","start","end","bpPerPx","resolution","stopToken","ObservableCreate","observer","source","resolutionMultiplier","feats","data","uniqueId","str","_regions"],"mappings":"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","x_google_ignoreList":[0,1]}