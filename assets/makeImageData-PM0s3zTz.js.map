{"version":3,"file":"makeImageData-PM0s3zTz.js","sources":["../../node_modules/d3-scale/src/sequential.js","../../node_modules/@jbrowse/plugin-hic/esm/HicRenderer/viridis.js","../../node_modules/@jbrowse/plugin-hic/esm/HicRenderer/makeImageData.js"],"sourcesContent":["import {interpolate, interpolateRound} from \"d3-interpolate\";\nimport {identity} from \"./continuous.js\";\nimport {initInterpolator} from \"./init.js\";\nimport {linearish} from \"./linear.js\";\nimport {loggish} from \"./log.js\";\nimport {symlogish} from \"./symlog.js\";\nimport {powish} from \"./pow.js\";\n\nfunction transformer() {\n  var x0 = 0,\n      x1 = 1,\n      t0,\n      t1,\n      k10,\n      transform,\n      interpolator = identity,\n      clamp = false,\n      unknown;\n\n  function scale(x) {\n    return x == null || isNaN(x = +x) ? unknown : interpolator(k10 === 0 ? 0.5 : (x = (transform(x) - t0) * k10, clamp ? Math.max(0, Math.min(1, x)) : x));\n  }\n\n  scale.domain = function(_) {\n    return arguments.length ? ([x0, x1] = _, t0 = transform(x0 = +x0), t1 = transform(x1 = +x1), k10 = t0 === t1 ? 0 : 1 / (t1 - t0), scale) : [x0, x1];\n  };\n\n  scale.clamp = function(_) {\n    return arguments.length ? (clamp = !!_, scale) : clamp;\n  };\n\n  scale.interpolator = function(_) {\n    return arguments.length ? (interpolator = _, scale) : interpolator;\n  };\n\n  function range(interpolate) {\n    return function(_) {\n      var r0, r1;\n      return arguments.length ? ([r0, r1] = _, interpolator = interpolate(r0, r1), scale) : [interpolator(0), interpolator(1)];\n    };\n  }\n\n  scale.range = range(interpolate);\n\n  scale.rangeRound = range(interpolateRound);\n\n  scale.unknown = function(_) {\n    return arguments.length ? (unknown = _, scale) : unknown;\n  };\n\n  return function(t) {\n    transform = t, t0 = t(x0), t1 = t(x1), k10 = t0 === t1 ? 0 : 1 / (t1 - t0);\n    return scale;\n  };\n}\n\nexport function copy(source, target) {\n  return target\n      .domain(source.domain())\n      .interpolator(source.interpolator())\n      .clamp(source.clamp())\n      .unknown(source.unknown());\n}\n\nexport default function sequential() {\n  var scale = linearish(transformer()(identity));\n\n  scale.copy = function() {\n    return copy(scale, sequential());\n  };\n\n  return initInterpolator.apply(scale, arguments);\n}\n\nexport function sequentialLog() {\n  var scale = loggish(transformer()).domain([1, 10]);\n\n  scale.copy = function() {\n    return copy(scale, sequentialLog()).base(scale.base());\n  };\n\n  return initInterpolator.apply(scale, arguments);\n}\n\nexport function sequentialSymlog() {\n  var scale = symlogish(transformer());\n\n  scale.copy = function() {\n    return copy(scale, sequentialSymlog()).constant(scale.constant());\n  };\n\n  return initInterpolator.apply(scale, arguments);\n}\n\nexport function sequentialPow() {\n  var scale = powish(transformer());\n\n  scale.copy = function() {\n    return copy(scale, sequentialPow()).exponent(scale.exponent());\n  };\n\n  return initInterpolator.apply(scale, arguments);\n}\n\nexport function sequentialSqrt() {\n  return sequentialPow.apply(null, arguments).exponent(0.5);\n}\n","function colors(specifier) {\n    const n = (specifier.length / 6) | 0;\n    const colors = new Array(n);\n    let i = 0;\n    while (i < n) {\n        colors[i] = `#${specifier.slice(i * 6, ++i * 6)}`;\n    }\n    return colors;\n}\nfunction ramp(range) {\n    const n = range.length;\n    return function (t) {\n        return range[Math.max(0, Math.min(n - 1, Math.floor(t * n)))];\n    };\n}\nexport default ramp(colors('44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725'));\n","import { readConfObject } from '@jbrowse/core/configuration';\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache';\nimport { forEachWithStopTokenCheck } from '@jbrowse/core/util';\nimport { colord } from '@jbrowse/core/util/colord';\nimport { checkStopToken } from '@jbrowse/core/util/stopToken';\nimport { interpolateRgbBasis } from '@mui/x-charts-vendor/d3-interpolate';\nimport { scaleSequential, scaleSequentialLog, } from '@mui/x-charts-vendor/d3-scale';\nimport interpolateViridis from './viridis';\nexport async function makeImageData(ctx, props) {\n    const { features, config, bpPerPx, stopToken, resolution, sessionId, adapterConfig, useLogScale, colorScheme, regions, pluginManager, yScalar, } = props;\n    const { statusCallback = () => { } } = props;\n    statusCallback('Drawing Hi-C matrix');\n    const region = regions[0];\n    const { dataAdapter } = await getAdapter(pluginManager, sessionId, adapterConfig);\n    const res = await dataAdapter.getResolution(bpPerPx / resolution);\n    const width = (region.end - region.start) / bpPerPx;\n    const w = res / (bpPerPx * Math.sqrt(2));\n    const baseColor = colord(readConfObject(config, 'baseColor'));\n    const offset = Math.floor(region.start / res);\n    if (features.length) {\n        let maxScore = 0;\n        let minBin = 0;\n        let maxBin = 0;\n        checkStopToken(stopToken);\n        for (const { bin1, bin2, counts } of features) {\n            maxScore = Math.max(counts, maxScore);\n            minBin = Math.min(Math.min(bin1, bin2), minBin);\n            maxBin = Math.max(Math.max(bin1, bin2), maxBin);\n        }\n        checkStopToken(stopToken);\n        const colorSchemes = {\n            juicebox: ['rgba(0,0,0,0)', 'red'],\n            fall: interpolateRgbBasis([\n                'rgb(255, 255, 255)',\n                'rgb(255, 255, 204)',\n                'rgb(255, 237, 160)',\n                'rgb(254, 217, 118)',\n                'rgb(254, 178, 76)',\n                'rgb(253, 141, 60)',\n                'rgb(252, 78, 42)',\n                'rgb(227, 26, 28)',\n                'rgb(189, 0, 38)',\n                'rgb(128, 0, 38)',\n                'rgb(0, 0, 0)',\n            ]),\n            viridis: interpolateViridis,\n        };\n        const m = useLogScale ? maxScore : maxScore / 20;\n        const x1 = colorSchemes[colorScheme] || colorSchemes.juicebox;\n        const scale = useLogScale\n            ? scaleSequentialLog(x1).domain([1, m])\n            : scaleSequential(x1).domain([0, m]);\n        if (yScalar) {\n            ctx.scale(1, yScalar);\n        }\n        ctx.save();\n        if (region.reversed === true) {\n            ctx.scale(-1, 1);\n            ctx.translate(-width, 0);\n        }\n        ctx.rotate(-Math.PI / 4);\n        forEachWithStopTokenCheck(features, stopToken, ({ bin1, bin2, counts }) => {\n            ctx.fillStyle = readConfObject(config, 'color', {\n                count: counts,\n                maxScore,\n                baseColor,\n                scale,\n                useLogScale,\n            });\n            ctx.fillRect((bin1 - offset) * w, (bin2 - offset) * w, w, w);\n        });\n        ctx.restore();\n    }\n    return undefined;\n}\n"],"names":["transformer","x0","x1","t0","t1","k10","transform","interpolator","identity","clamp","unknown","scale","x","_","range","interpolate","r0","r1","interpolateRound","t","copy","source","target","sequential","linearish","initInterpolator","sequentialLog","loggish","colors","specifier","i","ramp","interpolateViridis","makeImageData","ctx","props","features","config","bpPerPx","stopToken","resolution","sessionId","adapterConfig","useLogScale","colorScheme","regions","pluginManager","yScalar","statusCallback","region","dataAdapter","getAdapter","res","width","w","baseColor","colord","readConfObject","offset","maxScore","checkStopToken","bin1","bin2","counts","colorSchemes","interpolateRgbBasis","m","scaleSequentialLog","scaleSequential","forEachWithStopTokenCheck"],"mappings":"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","x_google_ignoreList":[0,1,2]}