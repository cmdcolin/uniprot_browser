{"version":3,"file":"ShareBookmarksDialog-BO5AJ7Lt.js","sources":["../../node_modules/@jbrowse/plugin-grid-bookmark/esm/GridBookmarkWidget/components/dialogs/ShareBookmarksDialog.js"],"sourcesContent":["import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useEffect, useState } from 'react';\nimport { Dialog, ErrorMessage } from '@jbrowse/core/ui';\nimport { getSession, isSessionWithShareURL } from '@jbrowse/core/util';\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\nimport { Alert, Button, DialogActions, DialogContent, DialogContentText, TextField, Typography, } from '@mui/material';\nimport copy from 'copy-to-clipboard';\nimport { observer } from 'mobx-react';\nimport { getSnapshot } from 'mobx-state-tree';\nimport { makeStyles } from 'tss-react/mui';\nimport { shareSessionToDynamo } from '../../sessionSharing';\nconst useStyles = makeStyles()(() => ({\n    flexItem: {\n        margin: 5,\n    },\n    content: {\n        display: 'flex',\n        flexFlow: 'column',\n        gap: '5px',\n    },\n}));\nconst ShareBookmarksDialog = observer(function ({ onClose, model, }) {\n    const { classes } = useStyles();\n    const [url, setUrl] = useState('');\n    const [error, setError] = useState();\n    const [loading, setLoading] = useState(true);\n    const session = getSession(model);\n    const { selectedBookmarks } = model;\n    const shareAll = selectedBookmarks.length === 0;\n    const bookmarksToShare = selectedBookmarks.length === 0\n        ? model.allBookmarksModel\n        : model.sharedBookmarksModel;\n    useEffect(() => {\n        ;\n        (async () => {\n            try {\n                if (!isSessionWithShareURL(session)) {\n                    throw new Error('No shareURL configured');\n                }\n                setLoading(true);\n                const snap = getSnapshot(bookmarksToShare);\n                const locationUrl = new URL(window.location.href);\n                const result = await shareSessionToDynamo(snap, session.shareURL, locationUrl.href);\n                const params = new URLSearchParams(locationUrl.search);\n                params.set('bookmarks', `share-${result.json.sessionId}`);\n                params.set('password', result.password);\n                locationUrl.search = params.toString();\n                setUrl(locationUrl.href);\n                setLoading(false);\n            }\n            catch (e) {\n                setError(e);\n            }\n            finally {\n                setLoading(false);\n            }\n        })();\n    }, [bookmarksToShare, session]);\n    return (_jsxs(Dialog, { open: true, onClose: onClose, title: \"Share bookmarks\", children: [_jsxs(DialogContent, { className: classes.content, children: [_jsx(Alert, { severity: \"info\", children: shareAll ? (_jsxs(_Fragment, { children: [_jsx(\"span\", { children: \"All bookmarks will be shared.\" }), _jsx(\"br\", {}), _jsx(\"span\", { children: \"Use the checkboxes to select individual bookmarks to share.\" })] })) : ('Only selected bookmarks will be shared.') }), _jsx(DialogContentText, { children: \"Copy the URL below to share your bookmarks.\" }), error ? (_jsx(ErrorMessage, { error: error })) : loading ? (_jsx(Typography, { children: \"Generating short URL...\" })) : (_jsx(TextField, { label: \"URL\", value: url, slotProps: {\n                            input: {\n                                readOnly: true,\n                            },\n                        }, variant: \"filled\", fullWidth: true, onClick: event => {\n                            const target = event.target;\n                            target.select();\n                        } })), _jsx(DialogContentText, { children: \"The URL should be pasted into the \\\"Import from share link\\\" field in the \\\"Import\\\" form found in the \\\"Bookmarked regions\\\" drawer.\" })] }), _jsx(DialogActions, { children: _jsx(Button, { className: classes.flexItem, \"data-testid\": \"dialogShare\", variant: \"contained\", color: \"primary\", disabled: loading, startIcon: _jsx(ContentCopyIcon, {}), onClick: async () => {\n                        copy(url);\n                        session.notify('Copied to clipboard', 'success');\n                        onClose();\n                    }, children: \"Copy share link\" }) })] }));\n});\nexport default ShareBookmarksDialog;\n"],"names":["useStyles","makeStyles","ShareBookmarksDialog","observer","onClose","model","classes","url","setUrl","useState","error","setError","loading","setLoading","session","getSession","selectedBookmarks","shareAll","bookmarksToShare","useEffect","isSessionWithShareURL","snap","getSnapshot","locationUrl","result","shareSessionToDynamo","params","_jsxs","Dialog","DialogContent","_jsx","Alert","_Fragment","DialogContentText","ErrorMessage","Typography","TextField","event","DialogActions","Button","ContentCopyIcon","copy"],"mappings":"wnBAWA,MAAMA,EAAYC,EAAU,EAAG,KAAO,CAClC,SAAU,CACN,OAAQ,CACX,EACD,QAAS,CACL,QAAS,OACT,SAAU,SACV,IAAK,KACR,CACL,EAAE,EACIC,EAAuBC,EAAS,SAAU,CAAE,QAAAC,EAAS,MAAAC,CAAK,EAAK,CACjE,KAAM,CAAE,QAAAC,CAAS,EAAGN,EAAW,EACzB,CAACO,EAAKC,CAAM,EAAIC,EAAAA,SAAS,EAAE,EAC3B,CAACC,EAAOC,CAAQ,EAAIF,WAAU,EAC9B,CAACG,EAASC,CAAU,EAAIJ,EAAAA,SAAS,EAAI,EACrCK,EAAUC,EAAU,WAACV,CAAK,EAC1B,CAAE,kBAAAW,CAAiB,EAAKX,EACxBY,EAAWD,EAAkB,SAAW,EACxCE,EAAmBF,EAAkB,SAAW,EAChDX,EAAM,kBACNA,EAAM,qBACZc,OAAAA,EAAAA,UAAU,IAAM,EAEX,SAAY,CACT,GAAI,CACA,GAAI,CAACC,EAAAA,sBAAsBN,CAAO,EAC9B,MAAM,IAAI,MAAM,wBAAwB,EAE5CD,EAAW,EAAI,EACf,MAAMQ,EAAOC,EAAYJ,CAAgB,EACnCK,EAAc,IAAI,IAAI,OAAO,SAAS,IAAI,EAC1CC,EAAS,MAAMC,EAAqBJ,EAAMP,EAAQ,SAAUS,EAAY,IAAI,EAC5EG,EAAS,IAAI,gBAAgBH,EAAY,MAAM,EACrDG,EAAO,IAAI,YAAa,SAASF,EAAO,KAAK,SAAS,EAAE,EACxDE,EAAO,IAAI,WAAYF,EAAO,QAAQ,EACtCD,EAAY,OAASG,EAAO,SAAU,EACtClB,EAAOe,EAAY,IAAI,EACvBV,EAAW,EAAK,CAChC,OACmB,EAAG,CACNF,EAAS,CAAC,CAC1B,QACoB,CACJE,EAAW,EAAK,CAChC,CACA,GAAY,CACZ,EAAO,CAACK,EAAkBJ,CAAO,CAAC,EACtBa,EAAAA,KAAMC,EAAAA,OAAQ,CAAE,KAAM,GAAM,QAASxB,EAAS,MAAO,kBAAmB,SAAU,CAACuB,EAAAA,KAAME,EAAe,CAAE,UAAWvB,EAAQ,QAAS,SAAU,CAACwB,EAAI,IAACC,EAAO,CAAE,SAAU,OAAQ,SAAUd,EAAYU,EAAK,KAACK,WAAW,CAAE,SAAU,CAACF,EAAAA,IAAK,OAAQ,CAAE,SAAU,gCAAiC,EAAGA,EAAI,IAAC,KAAM,CAAA,CAAE,EAAGA,EAAI,IAAC,OAAQ,CAAE,SAAU,6DAA6D,CAAE,CAAC,CAAG,CAAA,EAAM,yCAA4C,CAAA,EAAGA,EAAAA,IAAKG,EAAmB,CAAE,SAAU,8CAA+C,EAAGvB,EAASoB,MAAKI,EAAAA,aAAc,CAAE,MAAOxB,CAAK,CAAE,EAAKE,EAAWkB,EAAAA,IAAKK,EAAY,CAAE,SAAU,yBAA2B,CAAA,EAAML,EAAAA,IAAKM,EAAW,CAAE,MAAO,MAAO,MAAO7B,EAAK,UAAW,CAC1rB,MAAO,CACH,SAAU,EACb,CAC7B,EAA2B,QAAS,SAAU,UAAW,GAAM,QAAS8B,GAAS,CACtCA,EAAM,OACd,OAAQ,CAC3C,CAA2B,CAAA,EAAIP,EAAI,IAACG,EAAmB,CAAE,SAAU,iIAAyI,CAAA,CAAC,CAAC,CAAE,EAAGH,EAAI,IAACQ,EAAe,CAAE,SAAUR,EAAAA,IAAKS,EAAQ,CAAE,UAAWjC,EAAQ,SAAU,cAAe,cAAe,QAAS,YAAa,MAAO,UAAW,SAAUM,EAAS,UAAWkB,EAAI,IAACU,EAAiB,CAAE,CAAA,EAAG,QAAS,SAAY,CAC3ZC,EAAKlC,CAAG,EACRO,EAAQ,OAAO,sBAAuB,SAAS,EAC/CV,EAAS,CACZ,EAAE,SAAU,iBAAiB,CAAE,CAAG,CAAA,CAAC,CAAC,CAAE,CAC3D,CAAC","x_google_ignoreList":[0]}