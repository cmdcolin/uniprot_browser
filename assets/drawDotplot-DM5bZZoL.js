import{y as p,h as H,c as ce,aE as O,a5 as fe}from"./index-DPMJgfAS.js";const{parseCigar:ie}=fe,T="fell outside of range due to CIGAR string",K="(less than min coordinate of feature)",L="(greater than max coordinate of feature)",j=1;function le(t,M,$,P=1){t.beginPath(),t.arc(M,$,P/2,0,2*Math.PI),t.fill()}async function ge(t,M){var $,P;const{config:l,views:D,height:C,drawCigar:V,theme:Z}=M,I=p.readConfObject(l,"color"),ee=p.readConfObject(l,"posColor"),te=p.readConfObject(l,"negColor"),k=p.readConfObject(l,"colorBy"),E=p.readConfObject(l,"lineWidth"),S=p.readConfObject(l,"thresholds"),se=p.readConfObject(l,"thresholdsPalette"),oe=l.color.isCallback,b=D[0],y=D[1],x=($=b.dynamicBlocks.contentBlocks[0])===null||$===void 0?void 0:$.offsetPx,Q=(P=y.dynamicBlocks.contentBlocks[0])===null||P===void 0?void 0:P.offsetPx,d=[];t.lineWidth=E;const{bpPerPx:R}=b,{bpPerPx:A}=y;function ne(e,a,c,s){const f=s.get("strand")||1;if(f===-1&&([c,a]=[a,c]),e<a-j){let o=s.get("start"),r=s.get("end");const n=s.get("refName");return f===-1&&([r,o]=[o,r]),d.push({message:`feature at (X ${n}:${o}-${r}) ${T} ${K}`,effect:"clipped the feature"}),a}if(e>c+j){const o=s.get("strand")||1,r=o===1?s.get("start"):s.get("end"),n=o===1?s.get("end"):s.get("start"),v=s.get("refName");return d.push({message:`feature at (X ${v}:${r}-${n}) ${T} ${L}`,effect:"clipped the feature"}),c}return e}function ae(e,a,c,s){if(e<a-j){const f=s.get("mate"),{refName:o,start:r,end:n}=f;return d.push({message:`feature at (Y ${o}:${r}-${n}) ${T} ${K}`,effect:"clipped the feature"}),a}if(e>c+j){const f=s.get("mate"),{refName:o,start:r,end:n}=f;return d.push({message:`feature at (Y ${o}:${r}-${n}) ${T} ${L}`,effect:"clipped the feature"}),c}return e}const G={...H(b),staticBlocks:b.staticBlocks,width:b.width},_={...H(y),staticBlocks:y.staticBlocks,width:y.width},re=ce.createJBrowseTheme(Z);for(const e of b.features||[]){const a=e.get("strand")||1,c=a===1?e.get("start"):e.get("end"),s=a===1?e.get("end"):e.get("start"),f=e.get("refName"),o=e.get("mate"),r=o.refName;let n="black";if(k==="identity"){const u=e.get("identity");for(let g=0;g<S.length;g++)if(u>+S[g]){n=se[g]||"black";break}}else k==="meanQueryIdentity"?n=`hsl(${e.get("meanScore")*200},100%,40%)`:k==="mappingQuality"?n=`hsl(${e.get("mappingQual")},100%,40%)`:k==="strand"?n=a===-1?te:ee:k==="default"&&(n=oe?p.readConfObject(l,"color",{feature:e}):I==="#f0f"?re.palette.text.primary:I);t.fillStyle=n,t.strokeStyle=n;const v=O.bpToPx({self:G,refName:f,coord:c}),W=O.bpToPx({self:G,refName:f,coord:s}),F=O.bpToPx({self:_,refName:r,coord:o.start}),J=O.bpToPx({self:_,refName:r,coord:o.end});if(v!==void 0&&W!==void 0&&F!==void 0&&J!==void 0){const u=v.offsetPx-x,g=W.offsetPx-x,w=F.offsetPx-Q,X=J.offsetPx-Q;if(Math.abs(u-g)<=4&&Math.abs(w-X)<=4)le(t,u,C-w,E);else{let i=u,h=w;const U=e.get("CIGAR");if(V&&U){const Y=ie(U);t.beginPath(),t.moveTo(i,C-h);let q=i,z=i;for(let B=0;B<Y.length;B+=2){const N=+Y[B],m=Y[B+1];m==="M"||m==="="||m==="X"?(i+=N/R*a,h+=N/A):m==="D"||m==="N"?i+=N/R*a:m==="I"&&(h+=N/A),i=ne(i,u,g,e),h=ae(h,w,X,e),(Math.abs(i-q)>.5||Math.abs(h-z)>.5)&&(t.lineTo(i,C-h),q=i,z=h)}t.stroke()}else t.beginPath(),t.moveTo(u,C-w),t.lineTo(g,C-X),t.stroke()}}else d.length<=5&&(v===void 0||W===void 0?d.push({message:`feature at (X ${f}:${c}-${s}) not plotted, fell outside of range`,effect:"feature not rendered"}):d.push({message:`feature at (Y ${r}:${o.start}-${o.end}) not plotted, fell outside of range`,effect:"feature not rendered"}))}return{warnings:d}}export{ge as drawDotplot};
//# sourceMappingURL=drawDotplot-DM5bZZoL.js.map
