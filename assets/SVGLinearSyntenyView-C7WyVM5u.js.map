{"version":3,"file":"SVGLinearSyntenyView-C7WyVM5u.js","sources":["../../node_modules/@jbrowse/plugin-linear-comparative-view/esm/LinearSyntenyView/svgcomponents/SVGBackground.js","../../node_modules/@jbrowse/plugin-linear-comparative-view/esm/LinearSyntenyView/svgcomponents/SVGLinearGenomeView.js","../../node_modules/@jbrowse/plugin-linear-comparative-view/esm/LinearSyntenyView/svgcomponents/SVGLinearSyntenyView.js"],"sourcesContent":["import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { stripAlpha } from '@jbrowse/core/util';\nimport { useTheme } from '@mui/material';\nexport default function SVGBackground({ width, height, shift, }) {\n    const theme = useTheme();\n    return (_jsx(\"rect\", { width: width + shift * 2, height: height, fill: stripAlpha(theme.palette.background.default) }));\n}\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { getFillProps } from '@jbrowse/core/util';\nimport { SVGRuler, SVGTracks } from '@jbrowse/plugin-linear-genome-view';\nimport { useTheme } from '@mui/material';\nexport default function SVGLinearGenomeView({ trackLabelOffset, fontSize, textHeight, trackLabels, view, displayResults, rulerHeight, shift, }) {\n    const theme = useTheme();\n    return (_jsxs(\"g\", { transform: `translate(${shift} ${fontSize})`, children: [_jsxs(\"g\", { transform: `translate(${trackLabelOffset})`, children: [_jsx(\"text\", { x: 0, fontSize: fontSize, ...getFillProps(theme.palette.text.primary), children: view.assemblyNames.join(', ') }), _jsx(SVGRuler, { model: displayResults.view, fontSize: fontSize })] }), _jsx(\"g\", { transform: `translate(0 ${rulerHeight + fontSize})`, children: _jsx(SVGTracks, { textHeight: textHeight, trackLabels: trackLabels, fontSize: fontSize, model: displayResults.view, displayResults: displayResults.data, trackLabelOffset: trackLabelOffset }) })] }));\n}\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { createJBrowseTheme } from '@jbrowse/core/ui';\nimport { ReactRendering, getSerializedSvg, getSession, max, measureText, renderToAbstractCanvas, renderToStaticMarkup, sum, } from '@jbrowse/core/util';\nimport { getTrackName } from '@jbrowse/core/util/tracks';\nimport { totalHeight } from '@jbrowse/plugin-linear-genome-view';\nimport { ThemeProvider } from '@mui/material';\nimport { when } from 'mobx';\nimport SVGBackground from './SVGBackground';\nimport SVGLinearGenomeView from './SVGLinearGenomeView';\nimport { drawRef } from '../../LinearSyntenyDisplay/drawSynteny';\nexport async function renderToSvg(model, opts) {\n    var _a;\n    await when(() => model.initialized);\n    const { textHeight = 18, rulerHeight = 30, fontSize = 13, trackLabels = 'offset', Wrapper = ({ children }) => children, themeName = 'default', } = opts;\n    const session = getSession(model);\n    const themeVar = (_a = session.allThemes) === null || _a === void 0 ? void 0 : _a.call(session)[themeName];\n    const { width, views, levels } = model;\n    const shift = 50;\n    const offset = rulerHeight;\n    const heights = views.map(v => totalHeight(v.tracks, textHeight, trackLabels) + offset);\n    const totalHeightSvg = sum(heights) + sum(levels.map(l => l.height)) + 100;\n    const displayResults = await Promise.all(views.map(async (view) => ({\n        view,\n        data: await Promise.all(view.tracks.map(async (track) => {\n            const d = track.displays[0];\n            await when(() => (d.ready !== undefined ? d.ready : true));\n            return {\n                track,\n                result: await d.renderSvg({ ...opts, theme: themeVar }),\n            };\n        })),\n    })));\n    const renderings = await Promise.all(levels.map(async (level) => await Promise.all(level.tracks.map(async (track) => {\n        const d = track.displays[0];\n        await when(() => (d.ready !== undefined ? d.ready : true));\n        const r = await renderToAbstractCanvas(width, level.height, { exportSVG: opts }, ctx => {\n            drawRef(d, ctx);\n            return undefined;\n        });\n        if ('imageData' in r) {\n            throw new Error('found a canvas in svg export, probably a bug');\n        }\n        else if ('canvasRecordedData' in r) {\n            return {\n                html: await getSerializedSvg({\n                    ...r,\n                    width,\n                    height: level.height,\n                }),\n            };\n        }\n        else {\n            return r;\n        }\n    }))));\n    const trackLabelMaxLen = max(views.flatMap(view => view.tracks.map(track => measureText(getTrackName(track.configuration, session), fontSize))), 0) + 40;\n    const trackLabelOffset = trackLabels === 'left' ? trackLabelMaxLen : 0;\n    const w = width + trackLabelOffset;\n    const theme = createJBrowseTheme(themeVar);\n    const RenderList = [\n        _jsx(SVGLinearGenomeView, { rulerHeight: rulerHeight, trackLabelOffset: trackLabelOffset, shift: shift, textHeight: textHeight, trackLabels: trackLabels, displayResults: displayResults[0], view: views[0], fontSize: fontSize }, views[0].id),\n    ];\n    let currOffset = heights[0] + fontSize + rulerHeight;\n    for (let i = 1; i < views.length; i++) {\n        const view = views[i];\n        const level = levels[i - 1];\n        const rendering = renderings[i - 1];\n        const height = heights[i];\n        const levelHeight = level.height || 0;\n        RenderList.push(_jsxs(\"g\", { transform: `translate(0 ${currOffset})`, children: [levelHeight ? (_jsx(\"defs\", { children: _jsx(\"clipPath\", { id: `synclip-${i}`, children: _jsx(\"rect\", { x: 0, y: 0, width: width, height: levelHeight }) }) })) : null, _jsx(\"g\", { transform: `translate(${shift + trackLabelOffset} ${fontSize})`, clipPath: `url(#synclip-${i})`, children: rendering === null || rendering === void 0 ? void 0 : rendering.map((r, i) => (_jsx(ReactRendering, { rendering: r }, i))) }), _jsx(\"g\", { transform: `translate(0 ${levelHeight})`, children: _jsx(SVGLinearGenomeView, { rulerHeight: rulerHeight, shift: shift, trackLabelOffset: trackLabelOffset, textHeight: textHeight, trackLabels: trackLabels, displayResults: displayResults[i], view: view, fontSize: fontSize }, view.id) })] }, view.id));\n        currOffset += height + fontSize + rulerHeight + levelHeight;\n    }\n    return renderToStaticMarkup(_jsx(ThemeProvider, { theme: theme, children: _jsx(Wrapper, { children: _jsxs(\"svg\", { width: width, height: totalHeightSvg, xmlns: \"http://www.w3.org/2000/svg\", xmlnsXlink: \"http://www.w3.org/1999/xlink\", viewBox: [0, 0, w + shift * 2, totalHeightSvg].toString(), children: [_jsx(SVGBackground, { width: w, height: totalHeightSvg, shift: shift }), RenderList] }) }) }));\n}\n"],"names":["SVGBackground","width","height","shift","theme","useTheme","_jsx","stripAlpha","SVGLinearGenomeView","trackLabelOffset","fontSize","textHeight","trackLabels","view","displayResults","rulerHeight","_jsxs","getFillProps","SVGRuler","SVGTracks","renderToSvg","model","opts","_a","when","Wrapper","children","themeName","session","getSession","themeVar","views","levels","offset","heights","v","totalHeight","totalHeightSvg","sum","l","track","d","renderings","level","r","renderToAbstractCanvas","ctx","drawRef","getSerializedSvg","trackLabelMaxLen","max","measureText","getTrackName","w","createJBrowseTheme","RenderList","currOffset","i","rendering","levelHeight","ReactRendering","renderToStaticMarkup","ThemeProvider"],"mappings":"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","x_google_ignoreList":[0,1,2]}