{"version":3,"file":"afterAttach-DuYrhA_0.js","sources":["../../node_modules/@jbrowse/plugin-linear-comparative-view/esm/LinearSyntenyDisplay/afterAttach.js"],"sourcesContent":["import { getContainingView, getSession } from '@jbrowse/core/util';\nimport { bpToPx } from '@jbrowse/core/util/Base1DUtils';\nimport { MismatchParser } from '@jbrowse/plugin-alignments';\nimport { autorun, reaction } from 'mobx';\nimport { addDisposer, getSnapshot } from 'mobx-state-tree';\nimport { drawMouseoverSynteny, drawRef } from './drawSynteny';\nexport function doAfterAttach(self) {\n    addDisposer(self, autorun(() => {\n        var _a, _b;\n        const view = getContainingView(self);\n        if (!view.initialized ||\n            !view.views.every(a => a.displayedRegions.length > 0 && a.initialized)) {\n            return;\n        }\n        const ctx1 = (_a = self.mainCanvas) === null || _a === void 0 ? void 0 : _a.getContext('2d');\n        const ctx3 = (_b = self.cigarClickMapCanvas) === null || _b === void 0 ? void 0 : _b.getContext('2d');\n        if (!ctx1 || !ctx3) {\n            return;\n        }\n        const height = self.height;\n        const width = view.width;\n        ctx1.clearRect(0, 0, width, height);\n        ctx3.clearRect(0, 0, width, height);\n        drawRef(self, ctx1, ctx3);\n    }));\n    addDisposer(self, autorun(() => {\n        const view = getContainingView(self);\n        if (!view.initialized ||\n            !view.views.every(a => a.displayedRegions.length > 0 && a.initialized)) {\n            return;\n        }\n        drawMouseoverSynteny(self);\n    }));\n    addDisposer(self, reaction(() => {\n        const view = getContainingView(self);\n        return {\n            bpPerPx: view.views.map(v => v.bpPerPx),\n            displayedRegions: JSON.stringify(view.views.map(v => v.displayedRegions)),\n            features: self.features,\n            initialized: view.initialized &&\n                view.views.every(a => a.displayedRegions.length > 0 && a.initialized),\n        };\n    }, ({ initialized }) => {\n        if (!initialized) {\n            return;\n        }\n        const { level } = self;\n        const { assemblyManager } = getSession(self);\n        const view = getContainingView(self);\n        const viewSnaps = view.views.map(view => ({\n            ...getSnapshot(view),\n            width: view.width,\n            staticBlocks: view.staticBlocks,\n            interRegionPaddingWidth: view.interRegionPaddingWidth,\n            minimumBlockWidth: view.minimumBlockWidth,\n        }));\n        const map = [];\n        const feats = self.features || [];\n        for (const f of feats) {\n            const mate = f.get('mate');\n            let f1s = f.get('start');\n            let f1e = f.get('end');\n            const f2s = mate.start;\n            const f2e = mate.end;\n            if (f.get('strand') === -1) {\n                ;\n                [f1e, f1s] = [f1s, f1e];\n            }\n            const a1 = assemblyManager.get(f.get('assemblyName'));\n            const a2 = assemblyManager.get(mate.assemblyName);\n            const r1 = f.get('refName');\n            const r2 = mate.refName;\n            const ref1 = (a1 === null || a1 === void 0 ? void 0 : a1.getCanonicalRefName(r1)) || r1;\n            const ref2 = (a2 === null || a2 === void 0 ? void 0 : a2.getCanonicalRefName(r2)) || r2;\n            const v1 = viewSnaps[level];\n            const v2 = viewSnaps[level + 1];\n            const p11 = bpToPx({ self: v1, refName: ref1, coord: f1s });\n            const p12 = bpToPx({ self: v1, refName: ref1, coord: f1e });\n            const p21 = bpToPx({ self: v2, refName: ref2, coord: f2s });\n            const p22 = bpToPx({ self: v2, refName: ref2, coord: f2e });\n            if (p11 === undefined ||\n                p12 === undefined ||\n                p21 === undefined ||\n                p22 === undefined) {\n                continue;\n            }\n            const cigar = f.get('CIGAR');\n            map.push({\n                p11,\n                p12,\n                p21,\n                p22,\n                f,\n                cigar: MismatchParser.parseCigar(cigar),\n            });\n        }\n        self.setFeatPositions(map);\n    }, { fireImmediately: true }));\n}\n"],"names":["doAfterAttach","self","addDisposer","autorun","_a","_b","view","getContainingView","a","ctx1","ctx3","height","width","drawRef","drawMouseoverSynteny","reaction","v","initialized","level","assemblyManager","getSession","viewSnaps","getSnapshot","map","feats","f","mate","f1s","f1e","f2s","f2e","a1","a2","r1","r2","ref1","ref2","v1","v2","p11","bpToPx","p12","p21","p22","cigar","MismatchParser.parseCigar"],"mappings":"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","x_google_ignoreList":[0]}