import{a1 as G,j as e,u as s,z as L,t as A,c as D,b4 as C}from"./index-DPMJgfAS.js";import{S as F,a as J,t as W}from"./util-SLDihjMb.js";import{d as X}from"./drawSynteny-BTkU0Zz6.js";function _({width:l,height:a,shift:c}){const h=G();return e.jsx("rect",{width:l+c*2,height:a,fill:s.stripAlpha(h.palette.background.default)})}function V({trackLabelOffset:l,fontSize:a,textHeight:c,trackLabels:h,view:d,displayResults:r,rulerHeight:m,shift:w}){const j=G();return e.jsxs("g",{transform:`translate(${w} ${a})`,children:[e.jsxs("g",{transform:`translate(${l})`,children:[e.jsx("text",{x:0,fontSize:a,...s.getFillProps(j.palette.text.primary),children:d.assemblyNames.join(", ")}),e.jsx(F,{model:r.view,fontSize:a})]}),e.jsx("g",{transform:`translate(0 ${m+a})`,children:e.jsx(J,{textHeight:c,trackLabels:h,fontSize:a,model:r.view,displayResults:r.data,trackLabelOffset:l})})]})}async function Q(l,a){var c;await L(()=>l.initialized);const{textHeight:h=18,rulerHeight:d=30,fontSize:r=13,trackLabels:m="offset",Wrapper:w=({children:t})=>t,themeName:j="default"}=a,v=s.getSession(l),H=(c=v.allThemes)===null||c===void 0?void 0:c.call(v)[j],{width:f,views:g,levels:k}=l,u=50,z=d,y=g.map(t=>W(t.tracks,h,m)+z),S=s.sum(y)+s.sum(k.map(t=>t.height))+100,T=await Promise.all(g.map(async t=>({view:t,data:await Promise.all(t.tracks.map(async i=>{const n=i.displays[0];return await L(()=>n.ready!==void 0?n.ready:!0),{track:i,result:await n.renderSvg({...a,theme:H})}}))}))),E=await Promise.all(k.map(async t=>await Promise.all(t.tracks.map(async i=>{const n=i.displays[0];await L(()=>n.ready!==void 0?n.ready:!0);const o=await s.renderToAbstractCanvas(f,t.height,{exportSVG:a},b=>{X(n,b)});if("imageData"in o)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in o?{html:await s.getSerializedSvg({...o,width:f,height:t.height})}:o})))),O=s.max(g.flatMap(t=>t.tracks.map(i=>s.measureText(A.getTrackName(i.configuration,v),r))),0)+40,x=m==="left"?O:0,$=f+x,B=D.createJBrowseTheme(H),R=[e.jsx(V,{rulerHeight:d,trackLabelOffset:x,shift:u,textHeight:h,trackLabels:m,displayResults:T[0],view:g[0],fontSize:r},g[0].id)];let P=y[0]+r+d;for(let t=1;t<g.length;t++){const i=g[t],n=k[t-1],o=E[t-1],b=y[t],p=n.height||0;R.push(e.jsxs("g",{transform:`translate(0 ${P})`,children:[p?e.jsx("defs",{children:e.jsx("clipPath",{id:`synclip-${t}`,children:e.jsx("rect",{x:0,y:0,width:f,height:p})})}):null,e.jsx("g",{transform:`translate(${u+x} ${r})`,clipPath:`url(#synclip-${t})`,children:o?.map((M,N)=>e.jsx(s.ReactRendering,{rendering:M},N))}),e.jsx("g",{transform:`translate(0 ${p})`,children:e.jsx(V,{rulerHeight:d,shift:u,trackLabelOffset:x,textHeight:h,trackLabels:m,displayResults:T[t],view:i,fontSize:r},i.id)})]},i.id)),P+=b+r+d+p}return s.renderToStaticMarkup(e.jsx(C,{theme:B,children:e.jsx(w,{children:e.jsxs("svg",{width:f,height:S,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,$+u*2,S].toString(),children:[e.jsx(_,{width:$,height:S,shift:u}),R]})})}))}export{Q as renderToSvg};
//# sourceMappingURL=SVGLinearSyntenyView-HYyCC4ly.js.map
