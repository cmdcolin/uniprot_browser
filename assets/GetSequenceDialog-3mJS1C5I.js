import{u as F,y as L,o as O,m as T,a as c,j as e,c as j,D,d as I,F as _,f as R,C as A,T as G,e as M,B as v,aR as B,aQ as P,aN as W,bs as z}from"./index-B3kPj2Rj.js";var f={},k;function Q(){if(k)return f;k=1,Object.defineProperty(f,"__esModule",{value:!0}),f.formatFastaLines=s,f.formatSeqFasta=a;function s(r){return r.replaceAll(/(.{1,80})/g,`$1
`).trimEnd()}function a(r){return r.map(o=>`>${o.header}
${s(o.seq)}`).join(`
`)}return f}var H=Q();async function J(s,a){const r=F.getSession(s),{leftOffset:o,rightOffset:m}=s;if(!o||!m)throw new Error("no offsets on model to use for range");if(new Set(a.map(b=>b.assemblyName)).size>1)throw new Error("not able to fetch sequences from multiple assemblies currently");const{rpcManager:x,assemblyManager:i}=r,g=o.assemblyName||m.assemblyName||"",p=i.get(g);if(!p)throw new Error(`assembly ${g} not found`);const h=L.getConf(p,["sequence","adapter"]),l="getSequence";return x.call(l,"CoreGetFeatures",{adapterConfig:h,regions:a,sessionId:l})}const K=T()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},ml:{marginLeft:10}}),V=O(function({model:s,handleClose:a}){const{classes:r}=K(),[o,m]=c.useState(),[d,x]=c.useState(),[i,g]=c.useState(!1),[p,h]=c.useState(!1),[l,b]=c.useState(!1),{leftOffset:w,rightOffset:E}=s,y=d===void 0;c.useEffect(()=>{const n=new AbortController;return(async()=>{try{const t=s.getSelectedRegions(w,E);if(t.length===0)throw new Error("Selected region is out of bounds");x(await J(s,t))}catch(t){console.error(t),m(t)}})(),()=>{n.abort()}},[s,w,E]);const u=d?H.formatSeqFasta(d.map(n=>{let t=n.get("seq");const $=n.get("refName"),C=n.get("start")+1,q=n.get("end"),N=`${$}:${C}-${q}`;if(t?.length!==q-C+1)throw new Error(`${N} returned ${t.length.toLocaleString()} bases, but should have returned ${(q-C).toLocaleString()}`);return i&&(t=F.reverse(t)),l&&(t=F.complement(t)),{header:N+(i?"-rev":"")+(l?"-comp":""),seq:t}})):"",S=u?u.length>1e6:!1;return e.jsxs(j.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{a(),s.setOffsets()},title:"Reference sequence",children:[e.jsxs(D,{children:[o?e.jsx(j.ErrorMessage,{error:o}):y?e.jsx(j.LoadingEllipses,{message:"Retrieving sequences"}):null,e.jsx(I,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:S,className:r.dialogContent,fullWidth:!0,value:S?"Reference sequence too large to display, use the download FASTA button":u,slotProps:{input:{readOnly:!0,classes:{input:r.textAreaFont}}}}),e.jsxs(_,{children:[e.jsx(R,{control:e.jsx(A,{value:i,onChange:n=>{g(n.target.checked)}}),label:"Reverse sequence"}),e.jsx(R,{control:e.jsx(A,{value:l,onChange:n=>{b(n.target.checked)}}),label:"Complement sequence"})]}),e.jsx(G,{style:{margin:10},children:'Note: Check both boxes for the "reverse complement"'})]}),e.jsxs(M,{children:[e.jsx(v,{onClick:()=>{P(u),h(!0),setTimeout(()=>{h(!1)},500)},disabled:y||!!o||S,color:"primary",startIcon:e.jsx(B,{}),children:p?"Copied":"Copy to clipboard"}),e.jsx(v,{onClick:()=>{z.saveAs(new Blob([u||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:y||!!o,color:"primary",startIcon:e.jsx(W,{}),children:"Download FASTA"}),e.jsx(v,{onClick:a,variant:"contained",children:"Close"})]})]})});export{V as default};
//# sourceMappingURL=GetSequenceDialog-3mJS1C5I.js.map
