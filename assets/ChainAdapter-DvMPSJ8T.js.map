{"version":3,"file":"ChainAdapter-DvMPSJ8T.js","sources":["../../node_modules/@jbrowse/plugin-comparative-adapters/esm/ChainAdapter/util.js","../../node_modules/@jbrowse/plugin-comparative-adapters/esm/ChainAdapter/ChainAdapter.js"],"sourcesContent":["import { parseLineByLine } from '@jbrowse/core/util/parseLineByLine';\nfunction generate_record(qname, qstart, qend, qstrand, tname, tstart, tend, cigar, numMatches) {\n    return {\n        qname,\n        qstart,\n        qend,\n        tname,\n        tstart,\n        tend,\n        strand: qstrand === '-' ? -1 : 1,\n        extra: {\n            numMatches,\n            blockLen: Math.max(qend - qstart, tend - tstart),\n            mappingQual: 0,\n            cg: cigar,\n        },\n    };\n}\nexport function paf_chain2paf(buffer, opts) {\n    const { statusCallback = () => { } } = opts || {};\n    let t_name = '';\n    let t_start = 0;\n    let t_end = 0;\n    let q_name = '';\n    let q_size = '';\n    let q_strand = '';\n    let q_start = 0;\n    let q_end = 0;\n    let num_matches = 0;\n    let cigar = '';\n    const records = [];\n    parseLineByLine(buffer, line => {\n        if (!line || line.startsWith('#')) {\n            return true;\n        }\n        const l_vec = line.split(/[ \\t]+/);\n        if (l_vec[0] === 'chain') {\n            if (cigar) {\n                records.push(generate_record(q_name, q_start, q_end, q_strand, t_name, t_start, t_end, cigar, num_matches));\n            }\n            t_name = l_vec[2];\n            t_start = +l_vec[5];\n            t_end = +l_vec[6];\n            q_name = l_vec[7];\n            q_size = l_vec[8];\n            q_strand = l_vec[9];\n            q_start = +l_vec[10];\n            q_end = +l_vec[11];\n            if (q_strand === '-') {\n                const tmp = q_start;\n                q_start = +q_size - q_end;\n                q_end = +q_size - tmp;\n            }\n            num_matches = 0;\n            cigar = '';\n        }\n        else {\n            const size_ungapped_alignment = +l_vec[0] || 0;\n            const diff_in_target = l_vec.length > 1 ? +l_vec[1] : 0;\n            const diff_in_query = l_vec.length > 2 ? +l_vec[2] : 0;\n            if (size_ungapped_alignment !== 0) {\n                num_matches += +size_ungapped_alignment;\n                cigar += `${size_ungapped_alignment}M`;\n            }\n            if (diff_in_query !== 0) {\n                cigar += `${diff_in_query}I`;\n            }\n            if (diff_in_target !== 0) {\n                cigar += `${diff_in_target}D`;\n            }\n        }\n        return true;\n    }, opts === null || opts === void 0 ? void 0 : opts.statusCallback);\n    if (cigar) {\n        generate_record(q_name, q_start, q_end, q_strand, t_name, t_start, t_end, cigar, num_matches);\n    }\n    statusCallback('');\n    return records;\n}\n","import { fetchAndMaybeUnzip } from '@jbrowse/core/util';\nimport { openLocation } from '@jbrowse/core/util/io';\nimport { paf_chain2paf } from './util';\nimport PAFAdapter from '../PAFAdapter/PAFAdapter';\nexport default class ChainAdapter extends PAFAdapter {\n    async setupPre(opts) {\n        return paf_chain2paf(await fetchAndMaybeUnzip(openLocation(this.getConf('chainLocation'), this.pluginManager), opts), opts);\n    }\n}\n"],"names":["generate_record","qname","qstart","qend","qstrand","tname","tstart","tend","cigar","numMatches","paf_chain2paf","buffer","opts","statusCallback","t_name","t_start","t_end","q_name","q_size","q_strand","q_start","q_end","num_matches","records","parseLineByLine","line","l_vec","tmp","size_ungapped_alignment","diff_in_target","diff_in_query","ChainAdapter","PAFAdapter","fetchAndMaybeUnzip","openLocation"],"mappings":"wPACA,SAASA,EAAgBC,EAAOC,EAAQC,EAAMC,EAASC,EAAOC,EAAQC,EAAMC,EAAOC,EAAY,CAC3F,MAAO,CACH,MAAAR,EACA,OAAAC,EACA,KAAAC,EACA,MAAAE,EACA,OAAAC,EACA,KAAAC,EACA,OAAQH,IAAY,IAAM,GAAK,EAC/B,MAAO,CACH,WAAAK,EACA,SAAU,KAAK,IAAIN,EAAOD,EAAQK,EAAOD,CAAM,EAC/C,YAAa,EACb,GAAIE,CAChB,CACA,CACA,CACO,SAASE,EAAcC,EAAQC,EAAM,CACxC,KAAM,CAAE,eAAAC,EAAiB,IAAM,CAAE,CAAC,EAAKD,GAAQ,CAAA,EAC/C,IAAIE,EAAS,GACTC,EAAU,EACVC,EAAQ,EACRC,EAAS,GACTC,EAAS,GACTC,EAAW,GACXC,EAAU,EACVC,EAAQ,EACRC,EAAc,EACdd,EAAQ,GACZ,MAAMe,EAAU,CAAA,EAChBC,OAAAA,EAAAA,gBAAgBb,EAAQc,GAAQ,CAC5B,GAAI,CAACA,GAAQA,EAAK,WAAW,GAAG,EAC5B,MAAO,GAEX,MAAMC,EAAQD,EAAK,MAAM,QAAQ,EACjC,GAAIC,EAAM,CAAC,IAAM,QAAS,CAYtB,GAXIlB,GACAe,EAAQ,KAAKvB,EAAgBiB,EAAQG,EAASC,EAAOF,EAAUL,EAAQC,EAASC,EAAOR,EAAOc,CAAW,CAAC,EAE9GR,EAASY,EAAM,CAAC,EAChBX,EAAU,CAACW,EAAM,CAAC,EAClBV,EAAQ,CAACU,EAAM,CAAC,EAChBT,EAASS,EAAM,CAAC,EAChBR,EAASQ,EAAM,CAAC,EAChBP,EAAWO,EAAM,CAAC,EAClBN,EAAU,CAACM,EAAM,EAAE,EACnBL,EAAQ,CAACK,EAAM,EAAE,EACbP,IAAa,IAAK,CAClB,MAAMQ,EAAMP,EACZA,EAAU,CAACF,EAASG,EACpBA,EAAQ,CAACH,EAASS,CACtB,CACAL,EAAc,EACdd,EAAQ,EACZ,KACK,CACD,MAAMoB,EAA0B,CAACF,EAAM,CAAC,GAAK,EACvCG,EAAiBH,EAAM,OAAS,EAAI,CAACA,EAAM,CAAC,EAAI,EAChDI,EAAgBJ,EAAM,OAAS,EAAI,CAACA,EAAM,CAAC,EAAI,EACjDE,IAA4B,IAC5BN,GAAe,CAACM,EAChBpB,GAAS,GAAGoB,CAAuB,KAEnCE,IAAkB,IAClBtB,GAAS,GAAGsB,CAAa,KAEzBD,IAAmB,IACnBrB,GAAS,GAAGqB,CAAc,IAElC,CACA,MAAO,EACX,EAA+CjB,GAAK,cAAc,EAIlEC,EAAe,EAAE,EACVU,CACX,CC1Ee,MAAMQ,UAAqBC,CAAW,CACjD,MAAM,SAASpB,EAAM,CACjB,OAAOF,EAAc,MAAMuB,EAAAA,mBAAmBC,EAAAA,aAAa,KAAK,QAAQ,eAAe,EAAG,KAAK,aAAa,EAAGtB,CAAI,EAAGA,CAAI,CAC9H,CACJ","x_google_ignoreList":[0,1]}