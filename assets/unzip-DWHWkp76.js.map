{"version":3,"file":"unzip-DWHWkp76.js","sources":["../../node_modules/@gmod/bgzf-filehandle/esm/util.js","../../node_modules/@gmod/bgzf-filehandle/esm/unzip.js"],"sourcesContent":["export function sum(array) {\n    let sum = 0;\n    for (const entry of array) {\n        sum += entry.length;\n    }\n    return sum;\n}\nexport function concatUint8Array(args) {\n    const mergedArray = new Uint8Array(sum(args));\n    let offset = 0;\n    for (const entry of args) {\n        mergedArray.set(entry, offset);\n        offset += entry.length;\n    }\n    return mergedArray;\n}\n//# sourceMappingURL=util.js.map","import pkg from 'pako';\nimport { concatUint8Array } from \"./util.js\";\n//@ts-ignore\nconst { Z_SYNC_FLUSH, Inflate } = pkg;\n// Generate cache key from block position and data hash\nfunction generateCacheKey(blockPosition, inputData) {\n    // Simple hash of first 32 bytes for cache key uniqueness\n    const hashData = inputData.subarray(0, Math.min(32, inputData.length));\n    let hash = 0;\n    const len = hashData.length;\n    for (let i = 0; i < len; i++) {\n        hash = ((hash << 5) - hash + hashData[i]) & 0xffffffff;\n    }\n    return `${blockPosition}_${hash}`;\n}\n// browserify-zlib, which is the zlib shim used by default in webpacked code,\n// does not properly uncompress bgzf chunks that contain more than one bgzf\n// block, so export an unzip function that uses pako directly if we are running\n// in a browser.\nexport async function unzip(inputData) {\n    try {\n        let strm;\n        let pos = 0;\n        let inflator;\n        const blocks = [];\n        do {\n            const remainingInput = inputData.subarray(pos);\n            inflator = new Inflate();\n            ({ strm } = inflator);\n            inflator.push(remainingInput, Z_SYNC_FLUSH);\n            if (inflator.err) {\n                throw new Error(inflator.msg);\n            }\n            pos += strm.next_in;\n            blocks.push(inflator.result);\n        } while (strm.avail_in);\n        return concatUint8Array(blocks);\n    }\n    catch (e) {\n        // return a slightly more informative error message\n        if (/incorrect header check/.exec(`${e}`)) {\n            throw new Error('problem decompressing block: incorrect gzip header check');\n        }\n        throw e;\n    }\n}\n// keeps track of the position of compressed blocks in terms of file offsets,\n// and a decompressed equivalent\n//\n// also slices (0,minv.dataPosition) and (maxv.dataPosition,end) off\nexport async function unzipChunkSlice(inputData, chunk, blockCache) {\n    try {\n        let strm;\n        const { minv, maxv } = chunk;\n        let cpos = minv.blockPosition;\n        let dpos = minv.dataPosition;\n        const chunks = [];\n        const cpositions = [];\n        const dpositions = [];\n        let i = 0;\n        let wasFromCache = false;\n        do {\n            const remainingInput = inputData.subarray(cpos - minv.blockPosition);\n            const cacheKey = generateCacheKey(cpos, remainingInput);\n            let buffer;\n            let nextIn;\n            // Check cache first\n            const cached = blockCache?.get(cacheKey);\n            if (cached) {\n                buffer = cached.buffer;\n                nextIn = cached.nextIn;\n                wasFromCache = true;\n            }\n            else {\n                // Not in cache, decompress and store\n                const inflator = new Inflate();\n                ({ strm } = inflator);\n                inflator.push(remainingInput, Z_SYNC_FLUSH);\n                if (inflator.err) {\n                    throw new Error(inflator.msg);\n                }\n                buffer = inflator.result;\n                nextIn = strm.next_in;\n                wasFromCache = false;\n                // Cache the decompressed block\n                blockCache?.set(cacheKey, { buffer, nextIn });\n            }\n            chunks.push(buffer);\n            let len = buffer.length;\n            cpositions.push(cpos);\n            dpositions.push(dpos);\n            if (chunks.length === 1 && minv.dataPosition) {\n                // this is the first chunk, trim it\n                chunks[0] = chunks[0].subarray(minv.dataPosition);\n                len = chunks[0].length;\n            }\n            const origCpos = cpos;\n            cpos += nextIn;\n            dpos += len;\n            if (origCpos >= maxv.blockPosition) {\n                // this is the last chunk, trim it and stop decompressing. note if it is\n                // the same block is minv it subtracts that already trimmed part of the\n                // slice length\n                chunks[i] = chunks[i].subarray(0, maxv.blockPosition === minv.blockPosition\n                    ? maxv.dataPosition - minv.dataPosition + 1\n                    : maxv.dataPosition + 1);\n                cpositions.push(cpos);\n                dpositions.push(dpos);\n                break;\n            }\n            i++;\n        } while (wasFromCache\n            ? cpos < inputData.length + minv.blockPosition\n            : strm.avail_in);\n        return {\n            buffer: concatUint8Array(chunks),\n            cpositions,\n            dpositions,\n        };\n    }\n    catch (e) {\n        // return a slightly more informative error message\n        if (/incorrect header check/.exec(`${e}`)) {\n            throw new Error('problem decompressing block: incorrect gzip header check');\n        }\n        throw e;\n    }\n}\n//# sourceMappingURL=unzip.js.map"],"names":["sum","array","entry","concatUint8Array","args","mergedArray","offset","Z_SYNC_FLUSH","Inflate","pkg","generateCacheKey","blockPosition","inputData","hashData","hash","len","i","unzip","strm","pos","inflator","blocks","remainingInput","unzipChunkSlice","chunk","blockCache","minv","maxv","cpos","dpos","chunks","cpositions","dpositions","wasFromCache","cacheKey","buffer","nextIn","cached","origCpos","e"],"mappings":"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","x_google_ignoreList":[0,1]}