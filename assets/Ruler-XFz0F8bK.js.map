{"version":3,"file":"Ruler-XFz0F8bK.js","sources":["../../node_modules/@jbrowse/plugin-circular-view/esm/CircularView/components/Ruler.js"],"sourcesContent":["import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { assembleLocString, getFillProps, getSession, getStrokeProps, polarToCartesian, radToDeg, } from '@jbrowse/core/util';\nimport { makeContrasting } from '@jbrowse/core/util/color';\nimport { useTheme } from '@mui/material/styles';\nimport { observer } from 'mobx-react';\nimport { makeStyles } from 'tss-react/mui';\nconst useStyles = makeStyles()({\n    rulerLabel: {\n        fontSize: '0.8rem',\n        fontWeight: 500,\n        lineHeight: 1.6,\n        letterSpacing: '0.0075em',\n    },\n});\nfunction sliceArcPath(slice, radiusPx, startBase, endBase) {\n    if (slice.flipped) {\n        ;\n        [startBase, endBase] = [endBase, startBase];\n    }\n    const startXY = slice.bpToXY(startBase, radiusPx);\n    const endXY = slice.bpToXY(endBase, radiusPx);\n    const largeArc = Math.abs(endBase - startBase) / slice.bpPerRadian > Math.PI ? '1' : '0';\n    const sweepFlag = '1';\n    return [\n        'M',\n        ...startXY,\n        'A',\n        radiusPx,\n        radiusPx,\n        '0',\n        largeArc,\n        sweepFlag,\n        ...endXY,\n    ].join(' ');\n}\nconst ElisionRulerArc = observer(function ({ model, slice, region, }) {\n    const theme = useTheme();\n    const { radiusPx: modelRadiusPx } = model;\n    const radiusPx = modelRadiusPx + 1;\n    const { endRadians, startRadians } = slice;\n    const startXY = polarToCartesian(radiusPx, startRadians);\n    const endXY = polarToCartesian(radiusPx, endRadians);\n    const widthPx = (endRadians - startRadians) * radiusPx;\n    const largeArc = endRadians - startRadians > Math.PI ? '1' : '0';\n    const centerRadians = (endRadians + startRadians) / 2;\n    const regionCount = `[${Number(region.regions.length).toLocaleString()}]`;\n    return (_jsxs(_Fragment, { children: [_jsx(RulerLabel, { text: regionCount, view: model, maxWidthPx: widthPx, radians: centerRadians, radiusPx: radiusPx, title: `${regionCount} more regions`, color: theme.palette.text.primary }), _jsx(\"path\", { d: [\n                    'M',\n                    ...startXY,\n                    'A',\n                    radiusPx,\n                    radiusPx,\n                    '0',\n                    largeArc,\n                    '1',\n                    ...endXY,\n                ].join(' '), ...getStrokeProps(theme.palette.text.secondary), strokeWidth: 2, strokeDasharray: \"2,2\", fill: \"none\" })] }));\n});\nconst RulerLabel = observer(function ({ view, text, maxWidthPx, radians, radiusPx, title, color, }) {\n    const { classes } = useStyles();\n    const textXY = polarToCartesian(radiusPx + 5, radians);\n    if (!text) {\n        return null;\n    }\n    if (text.length * 6.5 < maxWidthPx) {\n        return (_jsxs(\"text\", { x: 0, y: 0, className: classes.rulerLabel, textAnchor: \"middle\", dominantBaseline: \"baseline\", transform: `translate(${textXY}) rotate(${radToDeg(radians) + 90})`, ...getFillProps(color), children: [text, _jsx(\"title\", { children: title || text })] }));\n    }\n    if (maxWidthPx > 4) {\n        const overallRotation = radToDeg(radians + view.offsetRadians - Math.PI / 2);\n        if (overallRotation >= 180) {\n            return (_jsxs(\"text\", { x: 0, y: 0, className: classes.rulerLabel, textAnchor: \"start\", dominantBaseline: \"middle\", transform: `translate(${textXY}) rotate(${radToDeg(radians)})`, fill: color, children: [text, _jsx(\"title\", { children: title || text })] }));\n        }\n        return (_jsxs(\"text\", { x: 0, y: 0, className: classes.rulerLabel, textAnchor: \"end\", dominantBaseline: \"middle\", transform: `translate(${textXY}) rotate(${radToDeg(radians) + 180})`, fill: color, children: [text, _jsx(\"title\", { children: title || text })] }));\n    }\n    return null;\n});\nconst RegionRulerArc = observer(function ({ model, slice, region, }) {\n    const theme = useTheme();\n    const { radiusPx } = model;\n    const { endRadians, startRadians } = slice;\n    const centerRadians = (endRadians + startRadians) / 2;\n    const widthPx = (endRadians - startRadians) * radiusPx;\n    const session = getSession(model);\n    const assembly = session.assemblyManager.get(region.assemblyName);\n    let color = assembly ? assembly.getRefNameColor(region.refName) : undefined;\n    if (color) {\n        try {\n            color = makeContrasting(color, theme.palette.background.paper);\n        }\n        catch (error) {\n            color = theme.palette.text.primary;\n        }\n    }\n    else {\n        color = theme.palette.text.primary;\n    }\n    return (_jsxs(_Fragment, { children: [_jsx(RulerLabel, { text: region.refName, view: model, maxWidthPx: widthPx, radians: centerRadians, radiusPx: radiusPx, color: color }), _jsx(\"path\", { d: sliceArcPath(slice, radiusPx + 1, region.start, region.end), stroke: color, strokeWidth: 2, fill: \"none\" })] }));\n});\nconst Ruler = observer(function ({ model, slice, }) {\n    return slice.region.elided ? (_jsx(ElisionRulerArc, { model: model, region: slice.region, slice: slice }, assembleLocString(slice.region.regions[0]))) : (_jsx(RegionRulerArc, { region: slice.region, model: model, slice: slice }, assembleLocString(slice.region)));\n});\nexport default Ruler;\n"],"names":["useStyles","makeStyles","sliceArcPath","slice","radiusPx","startBase","endBase","startXY","endXY","largeArc","ElisionRulerArc","observer","model","region","theme","useTheme","modelRadiusPx","endRadians","startRadians","polarToCartesian","widthPx","centerRadians","regionCount","_jsxs","_Fragment","_jsx","RulerLabel","getStrokeProps","view","text","maxWidthPx","radians","title","color","classes","textXY","radToDeg","getFillProps","RegionRulerArc","assembly","getSession","makeContrasting","Ruler","assembleLocString"],"mappings":"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","x_google_ignoreList":[0]}