import{W as v,X as k,u as r,aF as T,h as V,aE as m,aG as A}from"./index-DPMJgfAS.js";import{d as E,a as M}from"./drawSynteny-BTkU0Zz6.js";function G(e){v(e,k(()=>{var n,i;const a=r.getContainingView(e);if(!a.initialized||!a.views.every(t=>t.displayedRegions.length>0&&t.initialized))return;const d=(n=e.mainCanvas)===null||n===void 0?void 0:n.getContext("2d"),o=(i=e.cigarClickMapCanvas)===null||i===void 0?void 0:i.getContext("2d");if(!d||!o)return;const s=e.height,c=a.width;d.clearRect(0,0,c,s),o.clearRect(0,0,c,s),E(e,d,o)})),v(e,k(()=>{const n=r.getContainingView(e);!n.initialized||!n.views.every(i=>i.displayedRegions.length>0&&i.initialized)||M(e)})),v(e,T(()=>{const n=r.getContainingView(e);return{bpPerPx:n.views.map(i=>i.bpPerPx),displayedRegions:JSON.stringify(n.views.map(i=>i.displayedRegions)),features:e.features,initialized:n.initialized&&n.views.every(i=>i.displayedRegions.length>0&&i.initialized)}},({initialized:n})=>{if(!n)return;const{level:i}=e,{assemblyManager:a}=r.getSession(e),o=r.getContainingView(e).views.map(t=>({...V(t),width:t.width,staticBlocks:t.staticBlocks,interRegionPaddingWidth:t.interRegionPaddingWidth,minimumBlockWidth:t.minimumBlockWidth})),s=[],c=e.features||[];for(const t of c){const g=t.get("mate");let l=t.get("start"),p=t.get("end");const B=g.start,S=g.end;t.get("strand")===-1&&([p,l]=[l,p]);const u=a.get(t.get("assemblyName")),f=a.get(g.assemblyName),h=t.get("refName"),w=g.refName,y=u?.getCanonicalRefName(h)||h,x=f?.getCanonicalRefName(w)||w,C=o[i],R=o[i+1],N=m.bpToPx({self:C,refName:y,coord:l}),P=m.bpToPx({self:C,refName:y,coord:p}),b=m.bpToPx({self:R,refName:x,coord:B}),z=m.bpToPx({self:R,refName:x,coord:S});if(N===void 0||P===void 0||b===void 0||z===void 0)continue;const W=t.get("CIGAR");s.push({p11:N,p12:P,p21:b,p22:z,f:t,cigar:A(W)})}e.setFeatPositions(s)},{fireImmediately:!0}))}export{G as doAfterAttach};
//# sourceMappingURL=afterAttach-mllsiiFc.js.map
