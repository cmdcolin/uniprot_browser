import{c as St}from"./crc32-BNi2TJ31.js";import{R as Dt,Q as Rt}from"./remoteFile-DJNFoLH1.js";import{r as _t}from"./___vite-browser-external_commonjs-proxy-B5K5dNuQ.js";import{L as bt}from"./browser-DdKr-yeI.js";import{a as kt}from"./index-BzItsYpE.js";import{U as Nt,cW as pe,ah as Se,af as Ft,ag as Mt,u as H,$ as qt,cX as Lt,cY as vt}from"./index-B3kPj2Rj.js";import{B as Pt}from"./index-CWy9Wmpn.js";import{Q as Ut}from"./QuickLRU-C4m-IIJL.js";import{r as Ot}from"./rxjs-bJg6jVuh.js";const _={CRAM_FLAG_PRESERVE_QUAL_SCORES:1,CRAM_FLAG_DETACHED:2,CRAM_FLAG_MATE_DOWNSTREAM:4,CRAM_FLAG_NO_SEQ:8,BAM_FPAIRED:1,BAM_FPROPER_PAIR:2,BAM_FUNMAP:4,BAM_FMUNMAP:8,BAM_FREVERSE:16,BAM_FMREVERSE:32,BAM_FREAD1:64,BAM_FREAD2:128,BAM_FSECONDARY:256,BAM_FQCFAIL:512,BAM_FDUP:1024,BAM_FSUPPLEMENTARY:2048};function Ht(r,e){if(!r.lengthOnRef&&!r.readLength||r.isUnknownBases())return null;const t=r.alignmentStart-e.start;if(!r.readFeatures)return e.seq.slice(t,t+(r.lengthOnRef||0)).toUpperCase();let A="",n=t,i=0;for(;A.length<r.readLength;)if(i<r.readFeatures.length){const o=r.readFeatures[i];if(o.code==="Q"||o.code==="q")i+=1;else if(o.pos===A.length+1)if(i+=1,o.code==="b"){const s=o.data;A+=s,n+=s.length}else o.code==="B"?(A+=o.data[0],n+=1):o.code==="X"?(A+=o.sub,n+=1):o.code==="I"?A+=o.data:o.code==="D"?n+=o.data:o.code==="i"?A+=o.data:o.code==="N"?n+=o.data:o.code==="S"?A+=o.data:o.code==="P"||o.code;else if(i<r.readFeatures.length){const s=e.seq.slice(n,n+o.pos-A.length-1);A+=s,n+=s.length}}else{const o=e.seq.slice(n,n+r.readLength-A.length);A+=o,n+=o.length}return A.toUpperCase()}const Tt={a:0,A:0,c:1,C:1,g:2,G:2,t:3,T:3,n:4,N:4};function Gt(r,e,t,A){const n=A.refPos-e.start,i=e.seq.charAt(n);i&&(A.ref=i);let o=Tt[i];o===void 0&&(o=4);const g=t.substitutionMatrix[o][A.data];g&&(A.sub=g)}const Jt=[[1,"Paired"],[2,"ProperlyPaired"],[4,"SegmentUnmapped"],[8,"MateUnmapped"],[16,"ReverseComplemented"],[32,"MateReverseComplemented"],[64,"Read1"],[128,"Read2"],[256,"Secondary"],[512,"FailedQc"],[1024,"Duplicate"],[2048,"Supplementary"]],Yt=[[1,"PreservingQualityScores"],[2,"Detached"],[4,"WithMateDownstream"],[8,"DecodeSequenceAsStar"]],Kt=[[1,"OnNegativeStrand"],[2,"Unmapped"]];function ye(r){const e={};for(const[t,A]of r)e[`is${A}`]=n=>!!(n&t),e[`set${A}`]=n=>n|t;return e}const Ce=ye(Jt),V=ye(Yt),De=ye(Kt);class zt{constructor({flags:e,cramFlags:t,readLength:A,mappingQuality:n,lengthOnRef:i,qualityScores:o,mateRecordNumber:s,readBases:g,readFeatures:c,mateToUse:a,readGroupId:C,readName:d,sequenceId:I,uniqueId:u,templateSize:h,alignmentStart:l,tags:f}){this.flags=e,this.cramFlags=t,this.readLength=A,this.mappingQuality=n,this.lengthOnRef=i,this.qualityScores=o,g&&(this.readBases=g),this.readGroupId=C,this.readName=d,this.sequenceId=I,this.uniqueId=u,this.templateSize=h,this.alignmentStart=l,this.tags=f,c&&(this.readFeatures=c),a&&(this.mate={flags:a.mateFlags,readName:a.mateReadName,sequenceId:a.mateSequenceId,alignmentStart:a.mateAlignmentStart}),s&&(this.mateRecordNumber=s)}isPaired(){return!!(this.flags&_.BAM_FPAIRED)}isProperlyPaired(){return!!(this.flags&_.BAM_FPROPER_PAIR)}isSegmentUnmapped(){return!!(this.flags&_.BAM_FUNMAP)}isMateUnmapped(){return!!(this.flags&_.BAM_FMUNMAP)}isReverseComplemented(){return!!(this.flags&_.BAM_FREVERSE)}isMateReverseComplemented(){return!!(this.flags&_.BAM_FMREVERSE)}isRead1(){return!!(this.flags&_.BAM_FREAD1)}isRead2(){return!!(this.flags&_.BAM_FREAD2)}isSecondary(){return!!(this.flags&_.BAM_FSECONDARY)}isFailedQc(){return!!(this.flags&_.BAM_FQCFAIL)}isDuplicate(){return!!(this.flags&_.BAM_FDUP)}isSupplementary(){return!!(this.flags&_.BAM_FSUPPLEMENTARY)}isDetached(){return!!(this.cramFlags&_.CRAM_FLAG_DETACHED)}hasMateDownStream(){return!!(this.cramFlags&_.CRAM_FLAG_MATE_DOWNSTREAM)}isPreservingQualityScores(){return!!(this.cramFlags&_.CRAM_FLAG_PRESERVE_QUAL_SCORES)}isUnknownBases(){return!!(this.cramFlags&_.CRAM_FLAG_NO_SEQ)}getReadBases(){if(!this.readBases&&this._refRegion){const e=Ht(this,this._refRegion);e&&(this.readBases=e)}return this.readBases}getPairOrientation(){if(!this.isSegmentUnmapped()&&this.isPaired()&&!this.isMateUnmapped()&&this.mate&&this.sequenceId===this.mate.sequenceId){const e=this.isReverseComplemented()?"R":"F",t=this.isMateReverseComplemented()?"R":"F";let A=" ",n=" ";this.isRead1()?(A="1",n="2"):this.isRead2()&&(A="2",n="1");const i=[];let o=this.templateLength||this.templateSize;if(o===void 0)throw new Error("One of templateSize and templateLength must be set");return this.alignmentStart>this.mate.alignmentStart&&o>0&&(o=-o),o>0?(i[0]=e,i[1]=A,i[2]=t,i[3]=n):(i[2]=e,i[3]=A,i[0]=t,i[1]=n),i.join("")}return null}addReferenceSequence(e,t){this.readFeatures&&this.readFeatures.forEach(A=>{A.code==="X"&&Gt(this,e,t,A)}),!this.readBases&&e.start<=this.alignmentStart&&e.end>=this.alignmentStart+(this.lengthOnRef||this.readLength)-1&&(this._refRegion=e)}toJSON(){const e={};return Object.keys(this).forEach(t=>{t.startsWith("_")||(e[t]=this[t])}),e.readBases=this.getReadBases(),e}}var Ae={exports:{}};/*!
 * Based on xzwasm (c) Steve Sanderson. License: MIT - https://github.com/SteveSanderson/xzwasm
 * Contains xz-embedded by Lasse Collin and Igor Pavlov. License: Public domain - https://tukaani.org/xz/embedded.html
 * and walloc (c) 2020 Igalia, S.L. License: MIT - https://github.com/wingo/walloc
 */var Vt=Ae.exports,Re;function $t(){return Re||(Re=1,function(r,e){(function(A,n){r.exports=n(_t)})(Vt,t=>(()=>{var A=[,s=>{s.exports="data:application/wasm;base64,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ACABQX9qIgENAAsgAkJ/hSECCyACC8oQAgx/An4CQAJAIAAoAiRFDQAgACgCACECDAELQQAhAiAAQQA6ACggAEIANwMAIABCADcDGCAAQcgAakEAQeQAEIaAgIAAGiAAQawBakEMNgIACyAAIAEoAgQiAzYCECAAQeAAaiEEIABByABqIQUgAEG2AWohBiAAQbABaiEHIABBqAFqIQggASgCECEJAkACQAJAAkADQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQCACDgoBAgAEBQYHCAkKDwsgASgCACEKIAAoAqgBIQIgACgCrAEhCyABKAIEIQwgASgCCCENDAILIAcgACgCqAEiDGogASgCACABKAIEIgJqIAEoAgggAmsiAiAAKAKsASAMayIMIAIgDEkbIgIQh4CAgAAaIAEgASgCBCACajYCBEEAIQwgAEEAIAAoAqgBIAJqIgIgAiAAKAKsASILRhs2AqgBIAIgC0cNESAAQQE2AgACQCAHQaiIgIAAQQYQhICAgABFDQBBBSEMDBILIAZBAkEAEI2AgIAAIAAoALgBRw0QQQYhDCAGLQAADREgACAALQC3ASICNgIgIAJBBEsNEUEBIAJ0QRNxRQ0RCyABKAIEIgwgASgCCCINRg0OAkAgASgCACIKIAxqLQAAIgsNACAAIAw2AhAgASAMQQFqNgIEQQYhAgwMC0EAIQIgAEEANgKoASAAQQI2AgAgACALQQJ0QQRqIgs2AqwBIAAgCzYCQAsgByACaiAKIAxqIA0gDGsiDCALIAJrIgIgDCACSRsiAhCHgICAABogASABKAIEIAJqNgIEQQAhDCAAQQAgACgCqAEgAmoiAiACIAAoAqwBIgtGGzYCqAEgAiALRw0PIAAgAkF8aiICNgKsAUEHIQwgByACQQAQjYCAgAAgByAAKAKsASICaigAAEcNDyAAQQI2AqgBIAAtALEBIgtBP3ENDAJAAkAgC0HAAHFFDQAgACAHIAggAhCRgICAAEEBRw0RIAAgACkDCDcDMCAAKAKsASECIAAtALEBIQsMAQsgAEJ/NwMwC0J/IQ4CQCALwEF/Sg0AIAAgByAIIAIQkYCAgABBAUcNECAAKAKsASECIAApAwghDgsgACAONwM4IAIgACgCqAEiC2tBAkkNDyAAIAtBAWoiCjYCqAEgCCALakEI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AA8LIAEgA0EBaiIFNgIEAkAgASgCACADai0AACAAKQMYIAAoAgQiA62Ip0H/AXFGDQBBBw8LIAAgA0EIaiIGNgIEIAUhAyAGIAJJDQALIABBADYCBCAAQgA3AxhBAQtvAQF/QQchAQJAIABBugFqLwAAQdm0AUcNACAAQbQBakEGQQAQjYCAgAAgAEGwAWooAABHDQAgAEGAAWopAwBCAoggADUAtAFSDQAgAEG4AWotAAANAEEBQQcgACgCICAAQbkBai0AAEYbIQELIAELwAIBA38CQAJAAkAgACgCJA0AIABBADoAKCAAQQA2AgBBASECDAELAkAgACgCAEEKRw0AQQAhAwwCC0ECIQMMAQtBASEDCwJAAkADQAJAAkACQAJAIAMOAwABAwMLIAEoAgQiAyABKAIIIgRGDQQgASgCACEFAkADQCAFIANqLQAADQEgASADQQFqIgM2AgQgACAAKAIEQQFqQQNxNgIEIAQgA0YNBgwACwsCQCAAKAIERQ0AQQcPCyAAKAIkRQ0BIABBADoAKCAAQQA2AgBBASEDDAMLIABCADcDGCAAQQA2AgQgAEHIAGpBAEHkABCGgICAABogAEGsAWpBDDYCAAtBAiEDDAELIAAgARCQgICAACIDQQFHDQIgAEEKNgIAQQAhAwwACwsCQCACDQBBAA8LQQdBASAAKAIEGyEDCyADC3UBAX8CQEG4CRCAgICAACICRQ0AIAIgADYCJCACIAAgARCbgICAACIANgKwCQJAIABFDQAgAkEAOgAoIAJCADcDACACQgA3AxggAkHIAGpBAEHkABCGgICAABogAkGsAWpBDDYCACACDwsgAhCCgICAAAtBAAseAAJAIABFDQAgACgCsAkQnYCAgAAgABCCgICAAAsL3RABCn8gAEHo3QFqIQIgAEHUAGohAyAAQRxqIgRBCGohBQJAAkADQCAAKAJAIQYCQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAgASgCBCIHIAEoAghJDQAgBkEHRg0BDBELIAYOCQECAwQFBgcACQ4LIAAoAkwhBgwHC0EBIQYgASAHQQFqNgIEIAEoAgAgB2otAAAiB0UNCAJAAkAgB0HfAUsNACAHQQFHDQELIABBgAI7AVACQCAAKAI8DQAgACABKAIMIAEoAhAiBmo2AhggACABKAIUIAZr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"},s=>{s.exports=t}],n={};function i(s){var g=n[s];if(g!==void 0)return g.exports;var c=n[s]={exports:{}};return A[s](c,c.exports,i),c.exports}i.d=(s,g)=>{for(var c in g)i.o(g,c)&&!i.o(s,c)&&Object.defineProperty(s,c,{enumerable:!0,get:g[c]})},i.o=(s,g)=>Object.prototype.hasOwnProperty.call(s,g),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var o={};return(()=>{i.r(o),i.d(o,{XzReadableStream:()=>I});var s=i(1);const g=globalThis.ReadableStream||i(2).ReadableStream,c=0,a=1;class C{constructor(h){this.exports=h.exports,this.memory=this.exports.memory,this.ptr=this.exports.create_context(),this._refresh(),this.bufSize=this.mem32[0],this.inStart=this.mem32[1]-this.ptr,this.inEnd=this.inStart+this.bufSize,this.outStart=this.mem32[4]-this.ptr}supplyInput(h){this._refresh(),this.mem8.subarray(this.inStart,this.inEnd).set(h,0),this.exports.supply_input(this.ptr,h.byteLength),this._refresh()}getNextOutput(){const h=this.exports.get_next_output(this.ptr);if(this._refresh(),h!==c&&h!==a)throw new Error(`get_next_output failed with error code ${h}`);return{outChunk:this.mem8.slice(this.outStart,this.outStart+this.mem32[5]),finished:h===a}}needsMoreInput(){return this.mem32[2]===this.mem32[3]}outputBufferIsFull(){return this.mem32[5]===this.bufSize}resetOutputBuffer(){this.outPos=this.mem32[5]=0}dispose(){this.exports.destroy_context(this.ptr),this.exports=null}_refresh(){this.memory.buffer!==this.mem8?.buffer&&(this.mem8=new Uint8Array(this.memory.buffer,this.ptr),this.mem32=new Uint32Array(this.memory.buffer,this.ptr))}}class d{constructor(){this.locked=!1,this.waitQueue=[]}async acquire(){if(!this.locked){this.locked=!0;return}return new Promise(h=>{this.waitQueue.push(h)})}release(){this.waitQueue.length>0?this.waitQueue.shift()():this.locked=!1}}class I extends g{static _moduleInstancePromise;static _moduleInstance;static _contextMutex=new d;static async _getModuleInstance(){const h=s.replace("data:application/wasm;base64,",""),l=Uint8Array.from(atob(h),w=>w.charCodeAt(0)).buffer,f={},B=await WebAssembly.instantiate(l,f);I._moduleInstance=B.instance}constructor(h){let l,f=null;const B=h.getReader();super({async start(w){await I._contextMutex.acquire();try{I._moduleInstance||await(I._moduleInstancePromise||(I._moduleInstancePromise=I._getModuleInstance())),l=new C(I._moduleInstance)}catch(p){throw I._contextMutex.release(),p}},async pull(w){try{if(l.needsMoreInput()){if(f===null||f.byteLength===0){const{done:R,value:k}=await B.read();R||(f=k)}const m=Math.min(l.bufSize,f.byteLength);l.supplyInput(f.subarray(0,m)),f=f.subarray(m)}const p=l.getNextOutput();w.enqueue(p.outChunk),l.resetOutputBuffer(),p.finished&&(l.dispose(),I._contextMutex.release(),w.close())}catch(p){throw l&&l.dispose(),I._contextMutex.release(),p}},cancel(){try{return l&&l.dispose(),B.cancel()}finally{I._contextMutex.release()}}})}}})(),o})())}(Ae)),Ae.exports}var Wt=$t();class nt extends Error{}class P extends Error{}class D extends nt{}class Xt extends nt{}const _e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],rt=new Array(256);for(let r=0;r<256;r++)rt[r]=`${_e[r>>>4&15]}${_e[r&15]}`;function jt(r){let e="";for(let t=0,A=r.length;t<A;t++)e+=rt[r[t]];return e}const be=[0,1,3,7,15,31,63,127,255];class Zt{constructor(e){this.stream=e,this.bitOffset=0,this.curByte=0,this.hasByte=!1}_ensureByte(){this.hasByte||(this.curByte=this.stream.readByte(),this.hasByte=!0)}read(e){let t=0;for(;e>0;){this._ensureByte();const A=8-this.bitOffset;if(e>=A)t<<=A,t|=be[A]&this.curByte,this.hasByte=!1,this.bitOffset=0,e-=A;else{t<<=e;const n=A-e;t|=(this.curByte&be[e]<<n)>>n,this.bitOffset+=e,e=0}}return t}seek(e){const t=e%8,A=(e-t)/8;this.bitOffset=t,this.stream.seek(A),this.hasByte=!1}pi(){const e=new Uint8Array(6);for(let t=0;t<e.length;t++)e[t]=this.read(8);return jt(e)}}const ke=new Uint32Array([0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]);class eA{constructor(){this.crc=4294967295}getCRC(){return~this.crc>>>0}updateCRC(e){this.crc=this.crc<<8^ke[(this.crc>>>24^e)&255]}updateCRCRun(e,t){for(;t-- >0;)this.crc=this.crc<<8^ke[(this.crc>>>24^e)&255]}}class it{readByte(){throw new Error("abstract method readByte() not implemented")}read(e,t,A){let n=0;for(;n<A;){const i=this.readByte();if(i<0)return n===0?-1:n;e[t++]=i,n++}return n}writeByte(e){throw new Error("abstract method readByte() not implemented")}seek(e){throw new Error("abstract method seek() not implemented")}write(e,t,A){let n;for(n=0;n<A;n++)this.writeByte(e[t++]);return A}flush(){}}const ee=20,Ne=258,Fe=0,tA=1,AA=2,nA=6,rA=50,iA="314159265359",sA="177245385090",Me=function(r,e){const t=r[e];for(let A=e;A>0;A--)r[A]=r[A-1];return r[0]=t,t},b={LAST_BLOCK:-1,NOT_BZIP_DATA:-2,UNEXPECTED_INPUT_EOF:-3,UNEXPECTED_OUTPUT_EOF:-4,DATA_ERROR:-5,OUT_OF_MEMORY:-6,OBSOLETE_INPUT:-7},U={};U[b.LAST_BLOCK]="Bad file checksum";U[b.NOT_BZIP_DATA]="Not bzip data";U[b.UNEXPECTED_INPUT_EOF]="Unexpected input EOF";U[b.UNEXPECTED_OUTPUT_EOF]="Unexpected output EOF";U[b.DATA_ERROR]="Data error";U[b.OUT_OF_MEMORY]="Out of memory";U[b.OBSOLETE_INPUT]="Obsolete (pre 0.9.5) bzip format not supported.";const N=function(r,e){let t=U[r]||"unknown error";e&&(t+=": "+e);const A=new TypeError(t);throw A.errorCode=r,A};class oA{constructor(e,t){this.writePos=this.writeCurrent=this.writeCount=0,this._start_bunzip(e,t)}_init_block(){return this._get_next_block()?(this.blockCRC=new eA,!0):(this.writeCount=-1,!1)}_start_bunzip(e,t){const A=new Uint8Array(4);(e.read(A,0,4)!==4||String.fromCharCode(A[0],A[1],A[2])!=="BZh")&&N(b.NOT_BZIP_DATA,"bad magic");const n=A[3]-48;(n<1||n>9)&&N(b.NOT_BZIP_DATA,"level out of range"),this.reader=new Zt(e),this.dbufSize=1e5*n,this.nextoutput=0,this.outputStream=t,this.streamCRC=0}_get_next_block(){let e,t,A;const n=this.reader,i=n.pi();if(i===sA)return!1;i!==iA&&N(b.NOT_BZIP_DATA),this.targetBlockCRC=n.read(32)>>>0,this.streamCRC=(this.targetBlockCRC^(this.streamCRC<<1|this.streamCRC>>>31))>>>0,n.read(1)&&N(b.OBSOLETE_INPUT);const o=n.read(24);o>this.dbufSize&&N(b.DATA_ERROR,"initial position out of bounds");let s=n.read(16),g=new Uint8Array(256),c=0;for(e=0;e<16;e++)if(s&1<<15-e){const y=e*16;for(A=n.read(16),t=0;t<16;t++)A&1<<15-t&&(g[c++]=y+t)}const a=n.read(3);(a<AA||a>nA)&&N(b.DATA_ERROR);const C=n.read(15);C===0&&N(b.DATA_ERROR);const d=new Uint8Array(256);for(e=0;e<a;e++)d[e]=e;const I=new Uint8Array(C);for(e=0;e<C;e++){for(t=0;n.read(1);t++)t>=a&&N(b.DATA_ERROR);I[e]=Me(d,t)}let u=c+2,h=[],l;for(t=0;t<a;t++){const y=new Uint8Array(u),x=new Uint16Array(ee+1);for(s=n.read(5),e=0;e<u;e++){for(;(s<1||s>ee)&&N(b.DATA_ERROR),!!n.read(1);)n.read(1)?s--:s++;y[e]=s}var f,B;for(f=B=y[0],e=1;e<u;e++)y[e]>B?B=y[e]:y[e]<f&&(f=y[e]);l={},h.push(l),l.permute=new Uint16Array(Ne),l.limit=new Uint32Array(ee+2),l.base=new Uint32Array(ee+1),l.minLen=f,l.maxLen=B;let M=0;for(e=f;e<=B;e++)for(x[e]=l.limit[e]=0,s=0;s<u;s++)y[s]===e&&(l.permute[M++]=s);for(e=0;e<u;e++)x[y[e]]++;for(M=s=0,e=f;e<B;e++)M+=x[e],l.limit[e]=M-1,M<<=1,s+=x[e],l.base[e+1]=M-s;l.limit[B+1]=Number.MAX_VALUE,l.limit[B]=M+x[B]-1,l.base[f]=0}const w=new Uint32Array(256);for(e=0;e<256;e++)d[e]=e;let p=0,m=0,R=0,k;const F=this.dbuf=new Uint32Array(this.dbufSize);for(u=0;;){for(u--||(u=rA-1,R>=C&&N(b.DATA_ERROR),l=h[I[R++]]),e=l.minLen,t=n.read(e);e>l.maxLen&&N(b.DATA_ERROR),!(t<=l.limit[e]);e++)t=t<<1|n.read(1);t-=l.base[e],(t<0||t>=Ne)&&N(b.DATA_ERROR);const y=l.permute[t];if(y===Fe||y===tA){p||(p=1,s=0),s+=y===Fe?p:2*p,p<<=1;continue}if(p)for(p=0,m+s>this.dbufSize&&N(b.DATA_ERROR),k=g[d[0]],w[k]+=s;s--;)F[m++]=k;if(y>c)break;m>=this.dbufSize&&N(b.DATA_ERROR),e=y-1,k=Me(d,e),k=g[k],w[k]++,F[m++]=k}for((o<0||o>=m)&&N(b.DATA_ERROR),t=0,e=0;e<256;e++)A=t+w[e],w[e]=t,t=A;for(e=0;e<m;e++)k=F[e]&255,F[w[k]]|=e<<8,w[k]++;let O=0,v=0,K=0;return m&&(O=F[o],v=O&255,O>>=8,K=-1),this.writePos=O,this.writeCurrent=v,this.writeCount=m,this.writeRun=K,!0}_read_bunzip(e,t){let A,n,i;if(this.writeCount<0)return 0;let o=this.dbuf,s=this.writePos,g=this.writeCurrent,c=this.writeCount;this.outputsize;let a=this.writeRun;for(;c;){for(c--,n=g,s=o[s],g=s&255,s>>=8,a++===3?(A=g,i=n,g=-1):(A=1,i=g),this.blockCRC.updateCRCRun(i,A);A--;)this.outputStream.writeByte(i),this.nextoutput++;g!=n&&(a=0)}return this.writeCount=c,this.blockCRC.getCRC()!==this.targetBlockCRC&&N(b.DATA_ERROR,"Bad block CRC (got "+this.blockCRC.getCRC().toString(16)+" expected "+this.targetBlockCRC.toString(16)+")"),this.nextoutput}}const aA=function(r){if("readByte"in r)return r;const e=new it;return e.pos=0,e.readByte=function(){return r[this.pos++]},e.seek=function(t){this.pos=t},e.eof=function(){return this.pos>=r.length},e},cA=function(r){const e=new it;return e.buffer=new Uint8Array(16384),e.pos=0,e.writeByte=function(t){if(this.pos>=this.buffer.length){const A=new Uint8Array(this.buffer.length*2);A.set(this.buffer),this.buffer=A}this.buffer[this.pos++]=t},e.getBuffer=function(){if(this.pos!==this.buffer.length){const t=new Uint8Array(this.pos);t.set(this.buffer.slice(0,this.pos)),this.buffer=t}return this.buffer},e._coerced=!0,e};function st(r,e,t){const A=aA(r),n=cA(),i=new oA(A,n);for(;!("eof"in A&&A.eof());)if(i._init_block())i._read_bunzip();else{const o=i.reader.read(32)>>>0;o!==i.streamCRC&&N(b.DATA_ERROR,"Bad stream CRC (got "+i.streamCRC.toString(16)+" expected "+o.toString(16)+")");break}if("getBuffer"in n)return n.getBuffer()}class ${constructor(e){this.low=0,this.range=4294967295,this.code=0,this.FFnum=0,this.carry=0,this.cache=0}RangeStartDecode(e){for(let t=0;t<5;t++)this.code=(this.code<<8)+e.ReadByte();this.code&=4294967295,this.code>>>=0}RangeGetFrequency(e){return this.range=Math.floor(this.range/e),Math.floor(this.code/this.range)}RangeDecode(e,t,A,n){for(this.code-=t*this.range,this.range*=A;this.range<1<<24;)this.range*=256,this.code=this.code*256+e.ReadByte()}RangeShiftLow(e){if(this.low<4278190080|this.carry){for(e.WriteByte(this.cache+this.carry);this.FFnum;)e.WriteByte(this.carry-1),this.FFnum--;this.cache=this.low>>>24,this.carry=0}else this.FFnum++;this.low<<=8,this.low>>>=0}RangeEncode(e,t,A,n){const i=this.low;for(this.range=Math.floor(this.range/n),this.low+=t*this.range,this.low>>>=0,this.range*=A,this.low<i&&(this.carry!=0&&console.log("ERROR: Multiple carry"),this.carry=1);this.range<1<<24;)this.range*=256,this.RangeShiftLow(e)}RangeFinishEncode(e){for(let t=0;t<5;t++)this.RangeShiftLow(e)}}const qe=65519,te=16;class L{constructor(e=256){this.total_freq=e,this.max_sym=e-1,this.S=[],this.F=[];for(let t=0;t<=this.max_sym;t++)this.S[t]=t,this.F[t]=1}ModelDecode(e,t){const A=t.RangeGetFrequency(this.total_freq);let n=0,i=0;for(;n+this.F[i]<=A;)n+=this.F[i++];t.RangeDecode(e,n,this.F[i],this.total_freq),this.F[i]+=te,this.total_freq+=te,this.total_freq>qe&&this.ModelRenormalise();const o=this.S[i];if(i>0&&this.F[i]>this.F[i-1]){let s=this.F[i];this.F[i]=this.F[i-1],this.F[i-1]=s,s=this.S[i],this.S[i]=this.S[i-1],this.S[i-1]=s}return o}ModelRenormalise(){this.total_freq=0;for(let e=0;e<=this.max_sym;e++)this.F[e]-=Math.floor(this.F[e]/2),this.total_freq+=this.F[e]}ModelEncode(e,t,o){let n=0;for(var i=0;this.S[i]!=o;i++)n+=this.F[i];t.RangeEncode(e,n,this.F[i],this.total_freq),this.F[i]+=te,this.total_freq+=te,this.total_freq>qe&&this.ModelRenormalise();var o=this.S[i];if(i>0&&this.F[i]>this.F[i-1]){let s=this.F[i];this.F[i]=this.F[i-1],this.F[i-1]=s,s=this.S[i],this.S[i]=this.S[i-1],this.S[i-1]=s}}}class q{constructor(e,t=0,A=0){A!==0?(this.buf=new Uint8Array(A),this.length=A):(this.buf=e,this.length=e.length),this.dataView=new DataView(this.buf.buffer),this.pos=t}EOF(){return this.pos>=this.length}ReadData(e){const t=this.buf.slice(this.pos,this.pos+e);return this.pos+=e,t}ReadByte(){const e=this.buf[this.pos];return this.pos++,e}ReadChar(){const e=this.buf[this.pos];return this.pos++,String.fromCharCode(e)}ReadUint16(){let e=this.ReadByte();return e|=this.ReadByte()<<8,e}ReadUint32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}ReadString(){let e="",t;do t=this.buf[this.pos++],t&&(e+=String.fromCharCode(t));while(t);return e}ReadUint7(){let e=0,t;do t=this.ReadByte(),e=e<<7|t&127;while(t&128);return e}ReadITF8(){let e=this.buf[this.pos];return this.pos++,e>=240?(e=(e&15)<<28,e+=(this.buf[this.pos+0]<<20)+(this.buf[this.pos+1]<<12)+(this.buf[this.pos+2]<<4)+(this.buf[this.pos+3]>>4),this.pos+=4):e>=224?(e=(e&15)<<24,e+=(this.buf[this.pos+0]<<16)+(this.buf[this.pos+1]<<8)+(this.buf[this.pos+2]<<0),this.pos+=3):e>=192?(e=(e&31)<<16,e+=(this.buf[this.pos+0]<<8)+(this.buf[this.pos+1]<<0),this.pos+=2):e>=128&&(e=(e&63)<<8,e+=this.buf[this.pos],this.pos++),e}}const gA=1,dA=4,CA=8,IA=16,lA=32,hA=64,Le=128;class ot{decode(e){return this.stream=new q(e),this.decodeStream(this.stream)}decodeStream(e,t=0){const A=this.stream.ReadByte();A&IA||(t=this.stream.ReadUint7());let n=t;const i=A&gA;if(A&CA)return this.decodeStripe(this.stream,t);if(A&Le){var o;[o,n]=this.decodePackMeta(this.stream)}if(A&lA)var s=this.decodeCat(this.stream,n);else if(A&dA)var s=this.decodeExt(this.stream,n);else if(A&hA)var s=i?this.decodeRLE1(this.stream,n):this.decodeRLE0(this.stream,n);else var s=i?this.decode1(this.stream,n):this.decode0(this.stream,n);return A&Le&&(s=this.decodePack(s,o,t)),s}decode0(e,t){const A=new Uint8Array(t);let n=e.ReadByte();n==0&&(n=256);const i=new L(n),o=new $(e);o.RangeStartDecode(e);for(let s=0;s<t;s++)A[s]=i.ModelDecode(e,o);return A}decode1(e,t){const A=new Uint8Array(t);let n=e.ReadByte();n==0&&(n=256);const i=new Array(n);for(var o=0;o<n;o++)i[o]=new L(n);const s=new $(e);s.RangeStartDecode(e);let g=0;for(var o=0;o<t;o++)A[o]=i[g].ModelDecode(e,s),g=A[o];return A}decodeExt(e,t){return st(e.buf.slice(e.pos))}decodeRLE0(e,t){const A=new Uint8Array(t);let n=e.ReadByte();n==0&&(n=256);const i=new L(n),o=new Array(258);for(var g=0;g<=257;g++)o[g]=new L(4);const s=new $(e);s.RangeStartDecode(e);for(var g=0;g<t;){A[g]=i.ModelDecode(e,s);let c=o[A[g]].ModelDecode(e,s),a=c,C=256;for(;c==3;)c=o[C].ModelDecode(e,s),C=257,a+=c;for(let d=1;d<=a;d++)A[g+d]=A[g];g+=a+1}return A}decodeRLE1(e,t){const A=new Uint8Array(t);let n=e.ReadByte();n==0&&(n=256);const i=new Array(n);for(var c=0;c<n;c++)i[c]=new L(n);const o=new Array(258);for(var c=0;c<=257;c++)o[c]=new L(4);const s=new $(e);s.RangeStartDecode(e);let g=0;for(var c=0;c<t;){A[c]=i[g].ModelDecode(e,s),g=A[c];let a=o[A[c]].ModelDecode(e,s),C=a,d=256;for(;a==3;)a=o[d].ModelDecode(e,s),d=257,C+=a;for(let I=1;I<=C;I++)A[c+I]=A[c];c+=C+1}return A}decodePackMeta(e){this.nsym=e.ReadByte();const t=new Array(this.nsym);for(let n=0;n<this.nsym;n++)t[n]=e.ReadByte();const A=e.ReadUint7();return[t,A]}decodePack(e,t,A){const n=new Uint8Array(A);if(this.nsym<=1)for(var i=0;i<A;i++)n[i]=t[0];else if(this.nsym<=2)for(var i=0,o=0;i<A;i++){if(i%8==0)var s=e[o++];n[i]=t[s&1],s>>=1}else if(this.nsym<=4)for(var i=0,o=0;i<A;i++){if(i%4==0)var s=e[o++];n[i]=t[s&3],s>>=2}else if(this.nsym<=16)for(var i=0,o=0;i<A;i++){if(i%2==0)var s=e[o++];n[i]=t[s&15],s>>=4}else return e;return n}packMeta(e){const t=new q("",0,1024),A=new Array(256);for(var n=0;n<e.length;n++)A[e[n]]=1;for(var i=0,n=0;n<256;n++)A[n]&&(A[n]=++i);t.WriteByte(i);for(var n=0;n<256;n++)A[n]&&(t.WriteByte(n),A[n]--);return[t,A,i]}decodeStripe(e,t){const A=e.ReadByte(),n=new Array(A),i=new Array(A);for(var o=0;o<A;o++)n[o]=e.ReadUint7();const s=new Array(A);for(var o=0;o<A;o++)i[o]=Math.floor(t/A)+(t%A>o),s[o]=this.decodeStream(e,i[o]);const g=new Uint8Array(t);for(var o=0;o<A;o++)for(let a=0;a<i[o];a++)g[a*A+o]=s[o][a];return g}decodeCat(e,t){const A=new Uint8Array(t);for(let n=0;n<t;n++)A[n]=e.ReadByte();return A}}function ne(r,e,t){let A=0,n=0,i=-1;const o=new Array(1024);for(;n<t;){const c=r.ReadByte();if(o[A++]=c,n+=c,c==i){let a=r.ReadByte();for(n+=c*a;a--;)o[A++]=c}i=c}let s=0;for(A=0,n=0;n<t;){let c=0;do{var g=o[A++];c+=g}while(g==255);for(;c--;)e[n++]=s;s++}}const at=2,fA=4,uA=8,ve=16,Pe=32,Ue=64,Oe=128,BA=1,QA=2,EA=4;function mA(r,e,t){let A=r.context;return e.qctx=(e.qctx<<r.qshift)+r.qtab[t],A+=(e.qctx&(1<<r.qbits)-1)<<r.qloc,r.do_pos&&(A+=r.ptab[Math.min(e.p,1023)]<<r.ploc),r.do_delta&&(A+=r.dtab[Math.min(e.delta,255)]<<r.dloc,e.delta+=e.prevq!=t?1:0,e.prevq=t),r.do_sel&&(A+=e.s<<r.sloc),e.p--,A&65535}function wA(r){const e={};e.context=r.ReadUint16(),e.pflags=r.ReadByte(),e.do_dedup=e.pflags&at,e.fixed_len=e.pflags&fA,e.do_sel=e.pflags&uA,e.do_qmap=e.pflags&ve,e.do_pos=e.pflags&Pe,e.do_delta=e.pflags&Ue,e.do_qtab=e.pflags&Oe,e.max_sym=r.ReadByte();let t=r.ReadByte();if(e.qbits=t>>4,e.qshift=t&15,t=r.ReadByte(),e.qloc=t>>4,e.sloc=t&15,t=r.ReadByte(),e.ploc=t>>4,e.dloc=t&15,e.qmap=new Array(256),e.pflags&ve)for(var A=0;A<e.max_sym;A++)e.qmap[A]=r.ReadByte();else for(var A=0;A<256;A++)e.qmap[A]=A;if(e.qtab=new Array(1024),e.qbits>0&&e.pflags&Oe)ne(r,e.qtab,256);else for(var A=0;A<256;A++)e.qtab[A]=A;return e.ptab=new Array(1024),e.pflags&Pe&&ne(r,e.ptab,1024),e.dtab=new Array(256),e.pflags&Ue&&ne(r,e.dtab,256),e}function pA(r){const e={max_sym:0};if(r.ReadByte()!=5){console.error("Invalid FQZComp version number");return}const A=r.ReadByte(),n=A&BA?r.ReadByte():1;let i=A.nparam>1?A.nparam-1:0;const o=new Array(256);if(A&QA)i=r.ReadByte(),ne(r,o,256);else{for(var s=0;s<n;s++)o[s]=s;for(;s<256;s++)o[s]=n-1}e.do_rev=A&EA,e.stab=o,e.max_sel=i,e.params=new Array(e.nparam);for(let g=0;g<n;g++)e.params[g]=wA(r),e.max_sym<e.params[g].max_sym&&(e.max_sym=e.params[g].max_sym);return e}function yA(r){const e={};e.qual=new Array(65536);for(var t=0;t<65536;t++)e.qual[t]=new L(r.max_sym+1);e.len=new Array(4);for(var t=0;t<4;t++)e.len[t]=new L(256);return e.rev=new L(2),e.dup=new L(2),r.max_sel>0&&(e.sel=new L(r.max_sel+1)),e}function xA(r,e,t,A,n,i){n.s=t.max_sel>0?A.sel.ModelDecode(r,e):0,n.x=t.stab[n.s];const o=t.params[n.x];if(o.fixed_len>=0){var s=A.len[0].ModelDecode(r,e);s|=A.len[1].ModelDecode(r,e)<<8,s|=A.len[2].ModelDecode(r,e)<<16,s|=A.len[3].ModelDecode(r,e)<<24,o.fixed_len>0&&(o.fixed_len=-s)}else s=-o.fixed_len;n.len=s,t.do_rev&&(i[n.rec]=A.rev.ModelDecode(r,e)),n.is_dup=0,o.pflags&at&&A.dup.ModelDecode(r,e)&&(n.is_dup=1),n.p=s,n.delta=0,n.qctx=0,n.prevq=0,n.rec++}function SA(r,e){const t=r.ReadUint7(),A=pA(r);if(!A)return;var n=A.params;const i=new Array(e.length),o=yA(A),s=new $(r);s.RangeStartDecode(r);const g=new Uint8Array(t),c={qctx:0,prevq:0,delta:0,p:0,s:0,x:0,len:0,is_dup:0,rec:0};let a=0;for(;a<t;){if(c.p==0){if(xA(r,s,A,o,c,i),c.is_dup>0&&o.dup.ModelDecode(r,s)){for(let u=0;u<len;u++)g[a+u]=g[a+u-c.len];a+=c.len,c.p=0;continue}e.push(c.len);var n=A.params[c.x],C=n.context}const d=o.qual[C].ModelDecode(r,s);g[a++]=n.qmap[d],C=mA(n,c,d)}return A.do_rev&&DA(g,t,i,e),g}function DA(r,e,t,A){let n=0,i=0;for(;i<e;){if(t[n]){let o=0,s=A[n]-1;for(;o<s;){const g=r[i+o];r[i+o]=r[i+s],r[i+s]=g,o++,s--}}i+=A[n++]}}function RA(r,e){const t=new q(r);return SA(t,e)}function Be(r,e){return r&(1<<e)-1}function _A(r,e){let t=0;for(;e>=r[t+1];)t++;return t}function ct(r,e){const t=1<<e,A=new Array(t);let n=0;for(let i=0;i<t;i++){for(;i>=r[n+1];)n++;A[i]=n}return A}function Qe(r,e,t,A){return t*(r>>A)+(r&(1<<A)-1)-e}function Ee(r,e){return e<32768&&(e=(e<<16)+r.ReadUint16()),e}function bA(r,e){const t=r.ReadUint7(),A=r.ReadUint7();if(t&1)var n=r.ReadData((t-1)/2);else{const s=r.ReadUint7();var n=r.ReadData(s);n=xe(new q(n),t/2,e)}var n=new q(n);const i=new Array(256);let o=n.ReadByte();o==0&&(o=256);for(let s=0;s<o;s++)i[n.ReadByte()]=1;return[i,n,A]}function kA(r,e,t,A){new q(r);const n=new Uint8Array(A);let i=0;for(let o=0;i<A;o++){const s=r[o];if(e[s]){const g=t.ReadUint7();for(let c=0;c<=g;c++)n[i++]=s}else n[i++]=s}return n}function NA(r){const e=r.ReadByte(),t=new Array(e);for(let n=0;n<e;n++)t[n]=r.ReadByte();const A=r.ReadUint7();return[t,e,A]}function FA(r,e,t,A){const n=new Uint8Array(A);let i=0;if(t<=1)for(var o=0;o<A;o++)n[o]=e[0];else if(t<=2)for(o=0;o<A;o++){if(o%8==0)var s=r[i++];n[o]=e[s&1],s>>=1}else if(t<=4)for(o=0;o<A;o++){if(o%4==0)var s=r[i++];n[o]=e[s&3],s>>=2}else if(t<=16)for(o=0;o<A;o++){if(o%2==0)var s=r[i++];n[o]=e[s&15],s>>=4}return n}function MA(r,e){const t=r.ReadByte(),A=new Array(t),n=new Array(t);for(var i=0;i<t;i++)A[i]=r.ReadUint7();const o=new Array(t);for(var i=0;i<t;i++)n[i]=Math.floor(e/t)+(e%t>i),o[i]=dt(r,n[i]);const s=new Uint8Array(e);for(var i=0;i<t;i++)for(let c=0;c<n[i];c++)s[c*t+i]=o[i][c];return s}function gt(r){const e=new q(r);return dt(e,0)}function dt(r,e){const t=r.ReadByte(),A=t&1,n=t&4,i=t&8,o=t&16,s=t&32,g=t&64,c=t&128,a=n?32:4;if(o||(e=r.ReadUint7()),i)return MA(r,e);if(c)var C=e,[d,I,e]=NA(r);if(g)var u=e,[h,l,e]=bA(r,a);if(s)var f=r.ReadData(e);else if(A==0)var f=xe(r,e,a);else var f=vA(r,e,a);return g&&(f=kA(f,h,l,u)),c&&(f=FA(f,d,I,C)),f}function Ct(r){const e=new Array(256);for(let i=0;i<256;i++)e[i]=0;let t=0,A=r.ReadByte(),n=A;do e[A]=1,t>0?(t--,A++):(A=r.ReadByte(),A==n+1&&(t=r.ReadByte())),n=A;while(A!=0);return e}function qA(r,e,t){for(var A=0;A<256;A++)e[A]=0;const n=Ct(r);for(var A=0;A<256;A++)n[A]>0&&(e[A]=r.ReadUint7());It(e,12),t[0]=0;for(var A=0;A<=255;A++)t[A+1]=t[A]+e[A]}function xe(r,e,t){const A=new Array(256),n=new Array(256);qA(r,A,n);const i=ct(n,12),o=new Array(t);for(var s=0;s<t;s++)o[s]=r.ReadUint32();const g=new Uint8Array(e);for(var s=0;s<e;s++){const a=s&t-1,C=Be(o[a],12),d=i[C];g[s]=d,o[a]=Qe(o[a],n[d],A[d],12),o[a]=Ee(r,o[a])}return g}function It(r,e){let t=0;for(var A=0;A<256;A++)t+=r[A];if(t==0||t==1<<e)return;let n=0;for(;t<1<<e;)t*=2,n++;for(var A=0;A<256;A++)r[A]<<=n}function LA(r,e,t,A){for(var n=0;n<256;n++){e[n]=new Array(256),t[n]=new Array(256);for(var i=0;i<256;i++)e[n][i]=0}const o=Ct(r);for(var n=0;n<256;n++){if(!o[n])continue;let g=0;for(var i=0;i<256;i++)o[i]&&(g>0?g--:(e[n][i]=r.ReadUint7(),e[n][i]==0&&(g=r.ReadByte())));It(e[n],A),t[n][0]=0;for(var i=0;i<256;i++)t[n][i+1]=t[n][i]+e[n][i]}}function vA(r,e,t){var A=r.ReadByte();const n=A>>4;var i=r;if(A&1){const f=r.ReadUint7(),B=r.ReadUint7();var A=new q(r.ReadData(B)),i=new q(xe(A,f,4))}const o=new Array(256),s=new Array(256);LA(i,o,s,n);const g=new Array(256);for(var c=0;c<256;c++)g[c]=ct(s[c],n);const a=new Array(t),C=new Array(t);for(var d=0;d<t;d++)a[d]=r.ReadUint32(),C[d]=0;const I=new Uint8Array(e),u=Math.floor(e/t);for(var c=0;c<u;c++)for(var d=0;d<t;d++){var h=Be(a[d],n),l=g[C[d]][h];I[c+d*u]=l,a[d]=Qe(a[d],s[C[d]][l],o[C[d]][l],n),a[d]=Ee(r,a[d]),C[d]=l}for(c=t*c;c<e;){var h=Be(a[t-1],n),l=_A(s[C[t-1]],h);I[c++]=l,a[t-1]=Qe(a[t-1],s[C[t-1]][l],o[C[t-1]][l],n),a[t-1]=Ee(r,a[t-1]),C[t-1]=l}return I}function PA(r){let e=0;for(const t of r)e+=t.length;return e}function UA(r){const e=new Uint8Array(PA(r));let t=0;for(const A of r)e.set(A,t),t+=A.length;return e}const OA=new ot,re=0,He=1,Te=2,Ge=3,HA=4,TA=5,Je=7,Ye=8,Ke=9,lt=10,GA=12;function JA(r,e,t,A){let n=-1;const i=new Array(256);for(;!r.EOF();){const o=r.ReadByte(),s=o&128,g=o&64,c=o&63;if(s&&(n++,i[n]=new Array(13)),c!=re&&s){const a=new Array(A-1).fill(lt);i[n][re]=new q(UA([new Uint8Array(c),a]))}if(g){const a=r.ReadByte(),C=r.ReadByte();i[n][c]=new q(i[a][C].buf)}else{const a=r.ReadUint7(),C=r.ReadData(a);i[n][c]=t?OA.decode(C):gt(C),i[n][c]=new q(i[n][c])}}return i}function ze(r,e){let t=r+"";for(;t.length<e;)t="0"+t;return t}function YA(r,e,t,A){let n=r[0][re].ReadByte();const i=r[0][n].ReadUint32(),o=A-i;if(n==TA)return e[A]=e[o],t[A]=t[o],e[A];let s=1;e[A]="",t[A]=new Array(256);do{switch(n=r[s][re].ReadByte(),n){case Te:t[A][s]=r[s][Te].ReadChar();break;case He:t[A][s]=r[s][He].ReadString();break;case Je:t[A][s]=r[s][Je].ReadUint32();break;case Ge:var g=r[s][Ge].ReadUint32(),c=r[s][HA].ReadByte();t[A][s]=ze(g,c);break;case Ye:t[A][s]=(t[o][s]>>0)+r[s][Ye].ReadByte();break;case Ke:var g=(t[o][s]>>0)+r[s][Ke].ReadByte(),c=t[o][s].length;t[A][s]=ze(g,c);break;case lt:t[A][s]=t[o][s];break;default:t[A][s]="";break}e[A]+=t[A][s++]}while(n!=GA);return e[A]}function KA(A,e,t){var A=new q(A);A.ReadUint32();const n=A.ReadUint32(),i=A.ReadByte(),o=JA(A,e,i,n),s=new Array(n),g=new Array(n);let c="";for(let a=0;a<n;a++)c+=YA(o,s,g,a)+t;return c}function zA(r){return gt(r)}function VA(r){return new ot().decode(r)}function $A(r){return RA(r,[])}function WA(r){const e=KA(r,0,"\0");return Uint8Array.from(Array.from(e).map(t=>t.charCodeAt(0)))}function ht(r,e,t){if(t)return t;if(r)return new Dt(r);if(e)return new bt(e);throw new Error("no url, path, or filehandle provided, cannot open")}const S=12,X=1<<S,ie=1<<23;class ft{constructor(){this.F=void 0,this.C=void 0}}class XA{constructor(){this.fc=new Array(256);for(let e=0;e<this.fc.length;e+=1)this.fc[e]=new ft;this.R=null}}class jA{constructor(){this.start=void 0,this.freq=void 0}}function ZA(r,e,t){if(!(e<=65536))throw new D("assertion failed: start <= 1<<16");if(!(t<=65536-e))throw new D("assertion failed: freq <= 1<<16");r.start=e,r.freq=t}function ut(r,e,t,A){const n=(1<<A)-1;return t*(r>>A)+(r&n)-e}function en(r,e,t){return ut(r,e.start,e.freq,t)}function tn(r,e){return r&(1<<e)-1}function An(r,e,t,A,n){const i=(1<<n)-1;if(r=A*(r>>n)+(r&i)-t,r<ie)do{const o=255&e.get();r=r<<8|o}while(r<ie);return r}function nn(r,e,t,A){return An(r,e,t.start,t.freq,A)}function rn(r,e){if(r<ie)do r=r<<8|255&e.get();while(r<ie);return r}const E={FC:ft,AriDecoder:XA,DecodingSymbol:jA,symbolInit:ZA,advanceStep:ut,advanceSymbolStep:en,get:tn,advanceSymbol:nn,renormalize:rn};function sn(r,e,t,A){let n=r.getInt(),i=r.getInt(),o=r.getInt(),s=r.getInt();const g=A.remaining(),c=g&-4;for(let C=0;C<c;C+=4){const d=e.R[E.get(n,S)],I=e.R[E.get(i,S)],u=e.R[E.get(o,S)],h=e.R[E.get(s,S)];A.putAt(C,d),A.putAt(C+1,I),A.putAt(C+2,u),A.putAt(C+3,h),n=E.advanceSymbolStep(n,t[255&d],S),i=E.advanceSymbolStep(i,t[255&I],S),o=E.advanceSymbolStep(o,t[255&u],S),s=E.advanceSymbolStep(s,t[255&h],S),n=E.renormalize(n,r),i=E.renormalize(i,r),o=E.renormalize(o,r),s=E.renormalize(s,r)}A.setPosition(c);let a;switch(g&3){case 0:break;case 1:a=e.R[E.get(n,S)],E.advanceSymbol(n,r,t[255&a],S),A.put(a);break;case 2:a=e.R[E.get(n,S)],E.advanceSymbol(n,r,t[255&a],S),A.put(a),a=e.R[E.get(i,S)],E.advanceSymbol(i,r,t[255&a],S),A.put(a);break;case 3:a=e.R[E.get(n,S)],E.advanceSymbol(n,r,t[255&a],S),A.put(a),a=e.R[E.get(i,S)],E.advanceSymbol(i,r,t[255&a],S),A.put(a),a=e.R[E.get(o,S)],E.advanceSymbol(o,r,t[255&a],S),A.put(a);break;default:throw new D("invalid output size encountered during rANS decoding")}A.setPosition(0)}function on(r,e,t,A){const n=e.remaining();let i=r.getInt(),o=r.getInt(),s=r.getInt(),g=r.getInt();const c=n>>2;let a=0,C=c,d=2*c,I=3*c,u=0,h=0,l=0,f=0;for(;a<c;a+=1,C+=1,d+=1,I+=1){const B=255&t[u].R[E.get(i,S)],w=255&t[h].R[E.get(o,S)],p=255&t[l].R[E.get(s,S)],m=255&t[f].R[E.get(g,S)];e.putAt(a,B),e.putAt(C,w),e.putAt(d,p),e.putAt(I,m),i=E.advanceSymbolStep(i,A[u][B],S),o=E.advanceSymbolStep(o,A[h][w],S),s=E.advanceSymbolStep(s,A[l][p],S),g=E.advanceSymbolStep(g,A[f][m],S),i=E.renormalize(i,r),o=E.renormalize(o,r),s=E.renormalize(s,r),g=E.renormalize(g,r),u=B,h=w,l=p,f=m}for(;I<n;I+=1){const B=255&t[f].R[E.get(g,S)];e.putAt(I,B),g=E.advanceSymbol(g,r,A[f][B],S),f=B}}function Bt(r){if(!r)throw new D("assertion failed")}function an(r,e,t){let A=0,n=0,i=r.get()&255;do e.fc[i]==null&&(e.fc[i]=new E.FC),e.fc[i].F=r.get()&255,e.fc[i].F>=128&&(e.fc[i].F&=-129,e.fc[i].F=(e.fc[i].F&127)<<8|r.get()&255),e.fc[i].C=n,E.symbolInit(t[i],e.fc[i].C,e.fc[i].F),e.R||(e.R=new Array(X)),e.R.fill(i,n,n+e.fc[i].F),n+=e.fc[i].F,A===0&&i+1===(255&r.getByteAt(r.position()))?(i=r.get()&255,A=r.get()&255):A!==0?(A-=1,i+=1):i=r.get()&255;while(i!==0);Bt(n<X)}function cn(r,e,t){let A=0,n=255&r.get();do{let i=0,o=0,s=255&r.get();e[n]==null&&(e[n]=new E.AriDecoder);do e[n].fc[s]==null&&(e[n].fc[s]=new E.FC),e[n].fc[s].F=255&r.get(),e[n].fc[s].F>=128&&(e[n].fc[s].F&=-129,e[n].fc[s].F=(e[n].fc[s].F&127)<<8|255&r.get()),e[n].fc[s].C=o,e[n].fc[s].F===0&&(e[n].fc[s].F=X),t[n][s]==null&&(t[n][s]=new E.RansDecSymbol),E.symbolInit(t[n][s],e[n].fc[s].C,e[n].fc[s].F),e[n].R==null&&(e[n].R=new Array(X)),e[n].R.fill(s,o,o+e[n].fc[s].F),o+=e[n].fc[s].F,Bt(o<=X),i===0&&s+1===(255&r.getByteAt(r.position()))?(s=255&r.get(),i=255&r.get()):i!==0?(i-=1,s+=1):s=255&r.get();while(s!==0);A===0&&n+1===(255&r.getByteAt(r.position()))?(n=255&r.get(),A=255&r.get()):A!==0?(A-=1,n+=1):n=255&r.get()}while(n!==0)}const gn=4;function dn(r,e){const t=new E.AriDecoder,A=new Array(256);for(let n=0;n<A.length;n+=1)A[n]=new E.DecodingSymbol;return an(r,t,A),sn(r,t,A,e),e}function Cn(r,e){const t=new Array(256);for(let n=0;n<t.length;n+=1)t[n]=new E.AriDecoder;const A=new Array(256);for(let n=0;n<A.length;n+=1){A[n]=new Array(256);for(let i=0;i<A[n].length;i+=1)A[n][i]=new E.DecodingSymbol}return cn(r,t,A),on(r,e,t,A),e}class Ve{constructor(e,t=0){this._buffer=e,this._dataView=new DataView(e.buffer),this._position=t,this.length=e.length}get(){const e=this._buffer[this._position];return this._position+=1,e}getByte(){return this.get()}getByteAt(e){return this._buffer[e]}position(){return this._position}put(e){return this._buffer[this._position]=e,this._position+=1,e}putAt(e,t){return this._buffer[e]=t,t}setPosition(e){return this._position=e,e}getInt(){const e=this._dataView.getInt32(this._position,!0);return this._position+=4,e}remaining(){return this._buffer.length-this._position}}function In(r,e,t=0){if(r.length===0)return e.fill(0),e;const A=new Ve(r,t),n=A.get();if(n!==0&&n!==1)throw new D(`Invalid rANS order ${n}`);if(A.getInt()!==A.remaining()-gn)throw new D("Incorrect input length.");const o=A.getInt(),s=new Ve(e||new Uint8Array(o));if(s.length<o)throw new D(`Output buffer too small to fit ${o} bytes.`);switch(n){case 0:return dn(A,s);case 1:return Cn(A,s);default:throw new D(`Invalid rANS order: ${n}`)}}function ln(r){const e=r.split(/\r?\n/),t=[];for(const A of e){const[n,...i]=A.split(/\t/);n&&t.push({tag:n.slice(1),data:i.map(o=>{const s=o.indexOf(":");return s!==-1?{tag:o.slice(0,s),value:o.slice(s+1)}:{tag:o,value:""}})})}return t}function Qt(r){return kt.inflate(r)}class ae extends Error{}function G(r,e,t){let A=0;if(e.bytePosition+(7-e.bitPosition+t)/8>r.length)throw new ae("read error during decoding. the file seems to be truncated.");for(let n=t;n;n--)A<<=1,A|=r[e.bytePosition]>>e.bitPosition&1,e.bitPosition-=1,e.bitPosition<0&&(e.bytePosition+=1),e.bitPosition&=7;return A}var Ie={exports:{}},le={exports:{}},$e;function hn(){return $e||($e=1,function(){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,A){return t<<A|t>>>32-A},rotr:function(t,A){return t<<32-A|t>>>A},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var A=0;A<t.length;A++)t[A]=e.endian(t[A]);return t},randomBytes:function(t){for(var A=[];t>0;t--)A.push(Math.floor(Math.random()*256));return A},bytesToWords:function(t){for(var A=[],n=0,i=0;n<t.length;n++,i+=8)A[i>>>5]|=t[n]<<24-i%32;return A},wordsToBytes:function(t){for(var A=[],n=0;n<t.length*32;n+=8)A.push(t[n>>>5]>>>24-n%32&255);return A},bytesToHex:function(t){for(var A=[],n=0;n<t.length;n++)A.push((t[n]>>>4).toString(16)),A.push((t[n]&15).toString(16));return A.join("")},hexToBytes:function(t){for(var A=[],n=0;n<t.length;n+=2)A.push(parseInt(t.substr(n,2),16));return A},bytesToBase64:function(t){for(var A=[],n=0;n<t.length;n+=3)for(var i=t[n]<<16|t[n+1]<<8|t[n+2],o=0;o<4;o++)n*8+o*6<=t.length*8?A.push(r.charAt(i>>>6*(3-o)&63)):A.push("=");return A.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var A=[],n=0,i=0;n<t.length;i=++n%4)i!=0&&A.push((r.indexOf(t.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<i*2|r.indexOf(t.charAt(n))>>>6-i*2);return A}};le.exports=e}()),le.exports}var he,We;function Xe(){if(We)return he;We=1;var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],A=0;A<e.length;A++)t.push(e.charCodeAt(A)&255);return t},bytesToString:function(e){for(var t=[],A=0;A<e.length;A++)t.push(String.fromCharCode(e[A]));return t.join("")}}};return he=r,he}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var fe,je;function fn(){if(je)return fe;je=1,fe=function(t){return t!=null&&(r(t)||e(t)||!!t._isBuffer)};function r(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function e(t){return typeof t.readFloatLE=="function"&&typeof t.slice=="function"&&r(t.slice(0,0))}return fe}var Ze;function un(){return Ze||(Ze=1,function(){var r=hn(),e=Xe().utf8,t=fn(),A=Xe().bin,n=function(i,o){i.constructor==String?o&&o.encoding==="binary"?i=A.stringToBytes(i):i=e.stringToBytes(i):t(i)?i=Array.prototype.slice.call(i,0):!Array.isArray(i)&&i.constructor!==Uint8Array&&(i=i.toString());for(var s=r.bytesToWords(i),g=i.length*8,c=1732584193,a=-271733879,C=-1732584194,d=271733878,I=0;I<s.length;I++)s[I]=(s[I]<<8|s[I]>>>24)&16711935|(s[I]<<24|s[I]>>>8)&4278255360;s[g>>>5]|=128<<g%32,s[(g+64>>>9<<4)+14]=g;for(var u=n._ff,h=n._gg,l=n._hh,f=n._ii,I=0;I<s.length;I+=16){var B=c,w=a,p=C,m=d;c=u(c,a,C,d,s[I+0],7,-680876936),d=u(d,c,a,C,s[I+1],12,-389564586),C=u(C,d,c,a,s[I+2],17,606105819),a=u(a,C,d,c,s[I+3],22,-1044525330),c=u(c,a,C,d,s[I+4],7,-176418897),d=u(d,c,a,C,s[I+5],12,1200080426),C=u(C,d,c,a,s[I+6],17,-1473231341),a=u(a,C,d,c,s[I+7],22,-45705983),c=u(c,a,C,d,s[I+8],7,1770035416),d=u(d,c,a,C,s[I+9],12,-1958414417),C=u(C,d,c,a,s[I+10],17,-42063),a=u(a,C,d,c,s[I+11],22,-1990404162),c=u(c,a,C,d,s[I+12],7,1804603682),d=u(d,c,a,C,s[I+13],12,-40341101),C=u(C,d,c,a,s[I+14],17,-1502002290),a=u(a,C,d,c,s[I+15],22,1236535329),c=h(c,a,C,d,s[I+1],5,-165796510),d=h(d,c,a,C,s[I+6],9,-1069501632),C=h(C,d,c,a,s[I+11],14,643717713),a=h(a,C,d,c,s[I+0],20,-373897302),c=h(c,a,C,d,s[I+5],5,-701558691),d=h(d,c,a,C,s[I+10],9,38016083),C=h(C,d,c,a,s[I+15],14,-660478335),a=h(a,C,d,c,s[I+4],20,-405537848),c=h(c,a,C,d,s[I+9],5,568446438),d=h(d,c,a,C,s[I+14],9,-1019803690),C=h(C,d,c,a,s[I+3],14,-187363961),a=h(a,C,d,c,s[I+8],20,1163531501),c=h(c,a,C,d,s[I+13],5,-1444681467),d=h(d,c,a,C,s[I+2],9,-51403784),C=h(C,d,c,a,s[I+7],14,1735328473),a=h(a,C,d,c,s[I+12],20,-1926607734),c=l(c,a,C,d,s[I+5],4,-378558),d=l(d,c,a,C,s[I+8],11,-2022574463),C=l(C,d,c,a,s[I+11],16,1839030562),a=l(a,C,d,c,s[I+14],23,-35309556),c=l(c,a,C,d,s[I+1],4,-1530992060),d=l(d,c,a,C,s[I+4],11,1272893353),C=l(C,d,c,a,s[I+7],16,-155497632),a=l(a,C,d,c,s[I+10],23,-1094730640),c=l(c,a,C,d,s[I+13],4,681279174),d=l(d,c,a,C,s[I+0],11,-358537222),C=l(C,d,c,a,s[I+3],16,-722521979),a=l(a,C,d,c,s[I+6],23,76029189),c=l(c,a,C,d,s[I+9],4,-640364487),d=l(d,c,a,C,s[I+12],11,-421815835),C=l(C,d,c,a,s[I+15],16,530742520),a=l(a,C,d,c,s[I+2],23,-995338651),c=f(c,a,C,d,s[I+0],6,-198630844),d=f(d,c,a,C,s[I+7],10,1126891415),C=f(C,d,c,a,s[I+14],15,-1416354905),a=f(a,C,d,c,s[I+5],21,-57434055),c=f(c,a,C,d,s[I+12],6,1700485571),d=f(d,c,a,C,s[I+3],10,-1894986606),C=f(C,d,c,a,s[I+10],15,-1051523),a=f(a,C,d,c,s[I+1],21,-2054922799),c=f(c,a,C,d,s[I+8],6,1873313359),d=f(d,c,a,C,s[I+15],10,-30611744),C=f(C,d,c,a,s[I+6],15,-1560198380),a=f(a,C,d,c,s[I+13],21,1309151649),c=f(c,a,C,d,s[I+4],6,-145523070),d=f(d,c,a,C,s[I+11],10,-1120210379),C=f(C,d,c,a,s[I+2],15,718787259),a=f(a,C,d,c,s[I+9],21,-343485551),c=c+B>>>0,a=a+w>>>0,C=C+p>>>0,d=d+m>>>0}return r.endian([c,a,C,d])};n._ff=function(i,o,s,g,c,a,C){var d=i+(o&s|~o&g)+(c>>>0)+C;return(d<<a|d>>>32-a)+o},n._gg=function(i,o,s,g,c,a,C){var d=i+(o&g|s&~g)+(c>>>0)+C;return(d<<a|d>>>32-a)+o},n._hh=function(i,o,s,g,c,a,C){var d=i+(o^s^g)+(c>>>0)+C;return(d<<a|d>>>32-a)+o},n._ii=function(i,o,s,g,c,a,C){var d=i+(s^(o|~g))+(c>>>0)+C;return(d<<a|d>>>32-a)+o},n._blocksize=16,n._digestsize=16,Ie.exports=function(i,o){if(i==null)throw new Error("Illegal argument "+i);var s=r.wordsToBytes(n(i,o));return o&&o.asBytes?s:o&&o.asString?A.bytesToString(s):r.bytesToHex(s)}}()),Ie.exports}var Bn=un();const Qn=Nt(Bn),et=65536,z=et*et,En=1<<24,mn=En*z;function wn(r){return r&-128?r&-16384?r&-2097152?r&-268435456?5:4:3:2:1}function Q(r,e){let t=e;const A=r[t];let n;return A<128?(n=A,t+=1):A<192?(n=(A&63)<<8|r[t+1],t+=2):A<224?(n=(A&31)<<16|r[t+1]<<8|r[t+2],t+=3):A<240?(n=(A&15)<<24|r[t+1]<<16|r[t+2]<<8|r[t+3],t+=4):(n=(A&15)<<28|r[t+1]<<20|r[t+2]<<12|r[t+3]<<4|r[t+4]&15,t+=5),[n,t-e]}function se(r,e){let t=e;const A=r[t];let n;return A<128?(n=A,t+=1):A<192?(n=(A<<8|r[t+1])&16383,t+=2):A<224?(n=(A&63)<<16|r[t+1]<<8|r[t+2],t+=3):A<240?(n=(A&31)<<24|r[t+1]<<16|r[t+2]<<8|r[t+3],t+=4):A<248?(n=(r[t]&15)*z+(r[t+1]<<24|r[t+2]<<16|r[t+3]<<8|r[t+4]),t+=5):A<252?(n=((r[t]&7)<<8|r[t+1])*z+(r[t+2]<<24|r[t+3]<<16|r[t+4]<<8|r[t+5]),t+=6):A<254?(n=((r[t]&3)<<16|r[t+1]<<8|r[t+2])*z+(r[t+3]<<24|r[t+4]<<16|r[t+5]<<8|r[t+6]),t+=7):A<255?(n=(r[t+1]<<24|r[t+2]<<16|r[t+3]<<8|r[t+4])*z+(r[t+5]<<24|r[t+6]<<16|r[t+7]<<8|r[t+8]),t+=8):(n=r[t+1]*mn+(r[t+2]<<24|r[t+3]<<16|r[t+4]<<8|r[t+5])*z+(r[t+6]<<24|r[t+7]<<16|r[t+8]<<8|r[t+9]),t+=9),[n,t-e]}function J(r,e,t=0,A=0){const{offset:n,value:i}=e(r,t);return{...i,_endPosition:n+A,_size:n-t}}function ce(r,e){const t=r.prototype[e],A=`_memo_${e}`;r.prototype[e]=function(){if(!(A in this)){const i=t.call(this);this[A]=i,Promise.resolve(i).catch(()=>{delete this[A]})}return this[A]}}function pn(r){return Qn(r.toUpperCase().replaceAll(/[^\u0021-\u007e]/g,""))}function Et(){return{parser:(r,e=0)=>{const t=new DataView(r.buffer,r.byteOffset,r.length),A=new TextDecoder("utf8");let n=0;const i=A.decode(r.subarray(n,n+4));n+=4;const o=t.getUint8(n);n+=1;const s=t.getUint8(n);n+=1;const g=A.decode(r.subarray(n,n+20)).replaceAll("\0","");return n+=20,{value:{magic:i,majorVersion:o,minorVersion:s,fileId:g},offset:n}},maxLength:26}}function yn(){return{parser:(e,t=0)=>{const A=e,n=new DataView(A.buffer,A.byteOffset,A.length);let i=0;const o=n.getUint8(i),s=["raw","gzip","bzip2","lzma","rans","rans4x16","arith","fqzcomp","tok3"][o];if(!s)throw new Error(`compression method number ${o} not implemented`);i+=1;const g=n.getUint8(i),c=["FILE_HEADER","COMPRESSION_HEADER","MAPPED_SLICE_HEADER","UNMAPPED_SLICE_HEADER","EXTERNAL_DATA","CORE_DATA"][g];if(!c)throw new Error(`invalid block content type id ${g}`);i+=1;const[a,C]=Q(e,i);i+=C;const[d,I]=Q(e,i);i+=I;const[u,h]=Q(e,i);return i+=h,{offset:i,value:{uncompressedSize:u,compressedSize:d,contentId:a,contentType:c,compressionMethod:s}}},maxLength:17}}function xn(){return{parser:(r,e)=>{const t=r,n=new DataView(t.buffer,t.byteOffset,t.length).getUint32(e,!0);return e+=4,{offset:e,value:{crc32:n}}},maxLength:4}}function tt(r,e,t){const n=new TextDecoder("utf8").decode(r.subarray(e,t)),i=[];for(let o=0;o<n.length;o+=3)i.push(n.slice(o,o+3));return i}function Sn(){return{parser:(r,e)=>{const[t,A]=Q(r,e);e+=A;const n=r.subarray(e,e+t);e+=t;const i=[];let o=0,s=0;for(;s<n.length;s++)n[s]||(i.push(tt(n,o,s)),o=s+1);return s>o&&i.push(tt(n,o,s)),{value:{size:t,ents:i},offset:e}}}}function Dn(){return{parser:(r,e)=>{const t=r,A=new DataView(t.buffer,t.byteOffset,t.length),[n,i]=Q(r,e);e+=i;const[o,s]=Q(r,e);e+=s;const g=[];for(let c=0;c<o;c++){const a=String.fromCharCode(r[e])+String.fromCharCode(r[e+1]);if(e+=2,a==="MI"||a==="UI"||a==="PI"||a==="RN"||a==="AP"||a==="RR")g.push({key:a,value:!!A.getUint8(e)}),e+=1;else if(a==="SM")g.push({key:a,value:[A.getUint8(e),A.getUint8(e+1),A.getUint8(e+2),A.getUint8(e+3),A.getUint8(e+4)]}),e+=5;else if(a==="TD"){const{offset:C,value:d}=Sn().parser(r,e);g.push({key:a,value:d.ents}),e=C}else throw new Error(`unknown key ${a}`)}return{value:{mapSize:n,mapCount:o,ents:g},offset:e}}}}function ue(r){const e={};for(const{key:t,value:A}of r.ents)e[t]&&console.warn(`duplicate key ${t} in map`),e[t]=A;return e}function W(r){return typeof r.refSeqId=="number"}function Rn(r){let e=0;return e+=5,e+=9,e+=10,e+=16,{parser:(A,n)=>{const[i,o]=Q(A,n);n+=o;let s=0;if(r>=3){const[u,h]=se(A,n);n+=h,s=u}else if(r===2){const[u,h]=Q(A,n);n+=h,s=u}else console.warn("recordCounter=0");const[g,c]=Q(A,n);n+=c;const[a,C]=Q(A,n);n+=C;const d=[];for(let u=0;u<a;u++){const[h,l]=Q(A,n);n+=l,d.push(h)}let I;return r>=2&&(I=[...A.subarray(n,n+16)],n+=16),{value:{recordCounter:s,md5:I,contentIds:d,numContentIds:a,numBlocks:g,numRecords:i},offset:n}},maxLength:A=>e+A*5}}function _n(r){let e=0;return e+=20,e+=9,e+=15,e+=16,{parser:(t,A)=>{const[n,i]=Q(t,A);A+=i;const[o,s]=Q(t,A);A+=s;const[g,c]=Q(t,A);A+=c;const[a,C]=Q(t,A);A+=C;let d=0;if(r>=3){const[m,R]=se(t,A);A+=R,d=m}else if(r===2){const[m,R]=Q(t,A);A+=R,d=m}else console.warn("majorVersion is <2, recordCounter set to 0");const[I,u]=Q(t,A);A+=u;const[h,l]=Q(t,A);A+=l;const f=[];for(let m=0;m<h;m++){const[R,k]=Q(t,A);A+=k,f.push(R)}const[B,w]=Q(t,A);A+=w;let p;return r>=2&&(p=[...t.subarray(A,A+16)],A+=16),{value:{md5:p,numBlocks:I,numRecords:a,numContentIds:h,refSeqSpan:g,refSeqId:n,refSeqStart:o,recordCounter:d,refBaseBlockId:B,contentIds:f},offset:A}},maxLength:t=>e+t*5}}function bn(){return{parser:(r,e)=>j(r,e)}}function j(r,e){const t=r,A=new DataView(t.buffer,t.byteOffset,t.length),[n,i]=Q(r,e);e+=i;const[o,s]=Q(r,e);e+=s;const g={};if(n!==0)if(n===1){const[c,a]=Q(r,e);g.blockContentId=c,e+=a}else if(n===2){const[c,a]=Q(r,e);g.offset=c,e+=a;const[C,d]=Q(r,e);g.M=C,e+=d}else if(n===3){const c=Q(r,e),a=c[0];e+=c[1];const C=[];for(let h=0;h<a;h++){const l=Q(r,e);C.push(l[0]),e+=l[1]}g.symbols=C;const d=Q(r,e),I=c[0];g.numLengths=I,g.numCodes=a,g.numLengths=I,e+=d[1];const u=[];for(let h=0;h<I;h++){const l=Q(r,e);e+=l[1],u.push(l[0])}g.bitLengths=u}else if(n===4){const{value:c,offset:a}=j(r,e);g.lengthsEncoding=c,e=a;const{value:C,offset:d}=j(r,e);g.valuesEncoding=C,e=d}else if(n===5){g.stopByte=A.getUint8(e),e+=1;const[c,a]=Q(r,e);g.blockContentId=c,e+=a}else if(n===6){const[c,a]=Q(r,e);g.offset=c,e+=a;const[C,d]=Q(r,e);g.length=C,e+=d}else if(n===7){const[c,a]=Q(r,e);g.offset=c,e+=a;const[C,d]=Q(r,e);g.K=C,e+=d}else if(n===8){const[c,a]=Q(r,e);g.offset=c,e+=a;const[C,d]=Q(r,e);g.log2m=C,e+=d}else if(n===9){const[c,a]=Q(r,e);g.offset=c,e+=a}else throw new Error(`unknown codecId ${n}`);return{value:{codecId:n,parametersBytes:o,parameters:g},offset:e}}function mt(){return{parser:(r,e)=>{const[t,A]=Q(r,e);e+=A;const[n,i]=Q(r,e);e+=i;const o=[];for(let s=0;s<n;s++){const g=String.fromCharCode(r[e])+String.fromCharCode(r[e+1]);e+=2;const{value:c,offset:a}=j(r,e);e=a,o.push({key:g,value:c})}return{value:{mapSize:t,ents:o,mapCount:n},offset:e}}}}function wt(){return{parser:(r,e)=>{const[t,A]=Q(r,e);e+=A;const[n,i]=Q(r,e);e+=i;const o=[];for(let s=0;s<n;s++){const[g,c]=Q(r,e);e+=c;const a=String.fromCharCode(g>>16&255)+String.fromCharCode(g>>8&255)+String.fromCharCode(g&255),{value:C,offset:d}=j(r,e);e=d,o.push({key:a,value:C})}return{value:{mapSize:t,ents:o,mapCount:n},offset:e}}}}function kn(){return{parser:(r,e)=>{const{value:t,offset:A}=Dn().parser(r,e);e=A;const{value:n,offset:i}=mt().parser(r,e);e=i;const{value:o,offset:s}=wt().parser(r,e);return e=s,{value:{dataSeriesEncoding:ue(n),preservation:ue(t),tagEncoding:ue(o)},offset:e}}}}function Nn(r){let e=4;return e+=20,e+=9,e+=9,e+=10,{maxLength:e,parser:(t,A)=>{const n=t,o=new DataView(n.buffer,n.byteOffset,n.length).getInt32(A,!0);A+=4;const[s,g]=Q(t,A);A+=g;const[c,a]=Q(t,A);A+=a;const[C,d]=Q(t,A);A+=d;const[I,u]=Q(t,A);A+=u;let h=0;if(r>=3){const[m,R]=se(t,A);h=m,A+=R}else if(r===2){const[m,R]=Q(t,A);h=m,A+=R}else console.warn("setting recordCounter=0");let l;if(r>1){const[m,R]=se(t,A);l=m,A+=R}const[f,B]=Q(t,A);A+=B;const[w,p]=Q(t,A);return A+=p,{value:{length:o,refSeqId:s,refSeqStart:c,alignmentSpan:C,numBlocks:f,numLandmarks:w,numBases:l,recordCounter:h,numRecords:I},offset:A}}}}function Fn(r){return{parser:(e,t)=>{const A=e,n=new DataView(A.buffer,A.byteOffset,A.length),[i,o]=Q(e,t);t+=o;const s=[];for(let c=0;c<i;c++){const[a,C]=Q(e,t);t+=C,s.push(a)}let g;return r>=3&&(g=n.getUint32(t,!0),t+=4),{value:{...g===void 0?{}:{crc32:g},numLandmarks:i,landmarks:s},offset:t}},maxLength:e=>5+5*e+4}}function T(r){return{cramFileDefinition:Et(),cramBlockHeader:yn(),cramBlockCrc32:xn(),cramDataSeriesEncodingMap:mt(),cramTagEncodingMap:wt(),cramCompressionHeader:kn(),cramEncoding:bn(),cramUnmappedSliceHeader:Rn(r),cramMappedSliceHeader:_n(r),cramContainerHeader1:Nn(r),cramContainerHeader2:Fn(r)}}function oe(r){let e="";for(let t=0;t<r.length&&r[t]!==0;t++)e+=String.fromCharCode(r[t]);return e}function Mn(r){const e=String.fromCharCode(r[0]),n=new DataView(r.buffer).getUint32(1,!0),i=new Array(n);if(r=r.slice(5),e==="c"){const o=new Int8Array(r.buffer);for(let s=0;s<n;s++)i[s]=o[s]}else if(e==="C"){const o=new Uint8Array(r.buffer);for(let s=0;s<n;s++)i[s]=o[s]}else if(e==="s"){const o=new Int16Array(r.buffer);for(let s=0;s<n;s++)i[s]=o[s]}else if(e==="S"){const o=new Uint16Array(r.buffer);for(let s=0;s<n;s++)i[s]=o[s]}else if(e==="i"){const o=new Int32Array(r.buffer);for(let s=0;s<n;s++)i[s]=o[s]}else if(e==="I"){const o=new Uint32Array(r.buffer);for(let s=0;s<n;s++)i[s]=o[s]}else if(e==="f"){const o=new Float32Array(r.buffer);for(let s=0;s<n;s++)i[s]=o[s]}else throw new Error(`unknown type: ${e}`);return i}function qn(r,e){if(r==="Z")return oe(e);if(r==="A")return String.fromCharCode(e[0]);if(r==="I")return new Uint32Array(e.buffer)[0];if(r==="i")return new Int32Array(e.buffer)[0];if(r==="s")return new Int16Array(e.buffer)[0];if(r==="S")return new Uint16Array(e.buffer)[0];if(r==="c")return new Int8Array(e.buffer)[0];if(r==="C")return e[0];if(r==="f")return new Float32Array(e.buffer)[0];if(r==="H")return Number.parseInt(oe(e).replace(/^0x/,""),16);if(r==="B")return Mn(e);throw new D(`Unrecognized tag type ${r}`)}function Ln(r,e,t,A,n){let i=0,o=r-1;const s=new Array(e);function g([c,a]){const C=t(a);if(c==="character")return String.fromCharCode(C);if(c==="string"){let d="";for(let I=0;I<C.byteLength;I++)d+=String.fromCharCode(C[I]);return d}else if(c==="numArray")return Array.from(C);return C}for(let c=0;c<e;c++){const a=String.fromCharCode(t("FC")),C=t("FP"),d={B:["character","BA"],S:["string",n>1?"SC":"IN"],X:["number","BS"],D:["number","DL"],I:["string","IN"],i:["character","BA"],b:["string","BB"],q:["numArray","QQ"],Q:["number","QS"],H:["number","HC"],P:["number","PD"],N:["number","RS"]}[a];if(!d)throw new D(`invalid read feature code "${a}"`);let I=g(d);const u={B:["number","QS"]}[a];u&&(I=[I,g(u)]),i+=C;const h=i;o+=C;const l=o;a==="D"||a==="N"?o+=I:a==="I"||a==="S"?o-=I.length:a==="i"&&(o-=1),s[c]={code:a,pos:h,refPos:l,data:I}}return s}function vn(r,e,t,A,n,i,o,s,g){let c=e("BF");const a=e("CF");if(!W(A.parsedContent))throw new Error("slice header not mapped");const C=s>1&&A.parsedContent.refSeqId===-2?e("RI"):A.parsedContent.refSeqId,d=e("RL");let I=e("AP");t.APdelta&&(I=I+o.lastAlignmentStart),o.lastAlignmentStart=I;const u=e("RG");let h;t.readNamesIncluded&&(h=oe(e("RN")));let l,f,B;if(V.isDetached(a)){const y=e("MF");let x;t.readNamesIncluded||(x=oe(e("RN")),h=x);const M=e("NS"),de=e("NP");(y||M>-1)&&(l={mateFlags:y,mateSequenceId:M,mateAlignmentStart:de,mateReadName:x}),f=e("TS"),De.isUnmapped(y)&&(c=Ce.setMateUnmapped(c)),De.isOnNegativeStrand(y)&&(c=Ce.setMateReverseComplemented(c))}else V.isWithMateDownstream(a)&&(B=e("NF")+g+1);const w=e("TL");if(w<0)throw new D("invalid TL index");const p={},m=t.getTagNames(w),R=m.length;for(let y=0;y<R;y++){const x=m[y],M=x.slice(0,2),de=x.slice(2,3),Z=t.getCodecForTag(x).decode(r,n,i,o);p[M]=Z===void 0?void 0:typeof Z=="number"?Z:qn(de,Z)}let k,F,O,v,K;if(Ce.isSegmentUnmapped(c))if(V.isDecodeSequenceAsStar(a))K=null,v=null;else{const y=new Array(d);for(let x=0;x<y.length;x++)y[x]=e("BA");if(K=String.fromCharCode(...y),V.isPreservingQualityScores(a)){v=new Array(d);for(let x=0;x<y.length;x++)v[x]=e("QS")}}else{const y=e("FN");if(y&&(k=Ln(I,y,e,t,s)),F=d,k)for(const{code:x,data:M}of k)x==="D"||x==="N"?F+=M:x==="I"||x==="S"?F=F-M.length:x==="i"&&(F=F-1);if(Number.isNaN(F)&&(console.warn(`${h||`${C}:${I}`} record has invalid read features`),F=d),O=e("MQ"),V.isPreservingQualityScores(a)){v=new Array(d);for(let x=0;x<v.length;x++)v[x]=e("QS")}}return{readLength:d,sequenceId:C,cramFlags:a,flags:c,alignmentStart:I,readGroupId:u,readName:h,mateToUse:l,templateSize:f,mateRecordNumber:B,readFeatures:k,lengthOnRef:F,mappingQuality:O,qualityScores:v,readBases:K,tags:p}}function Pn(r,e,t){function A(g){const c=[g];if(g.mateRecordNumber!==void 0&&g.mateRecordNumber>=0){const a=r[g.mateRecordNumber];if(!a)throw new D("intra-slice mate record not found, this file seems malformed");c.push(...A(a))}return c}const n=A(t),i=n.map(g=>g.alignmentStart),o=n.map(g=>g.alignmentStart+g.readLength-1),s=Math.max(...o)-Math.min(...i)+1;s>=0&&n.forEach(g=>{if(g.templateLength!==void 0)throw new D("mate pair group has some members that have template lengths already, this file seems malformed");g.templateLength=s})}function Un(r,e){const t=Math.min(r.alignmentStart,e.alignmentStart),n=Math.max(r.alignmentStart+r.readLength-1,e.alignmentStart+e.readLength-1)-t+1;r.templateLength=n,e.templateLength=n}function On(r,e,t,A){const n=!!(A.mate||A.mateRecordNumber!==void 0&&A.mateRecordNumber!==e);t.readName||(t.readName=String(t.uniqueId),A.readName=t.readName),t.mate={sequenceId:A.sequenceId,alignmentStart:A.alignmentStart,uniqueId:A.uniqueId},A.readName&&(t.mate.readName=A.readName),!A.mate&&A.mateRecordNumber===void 0&&(A.mate={sequenceId:t.sequenceId,alignmentStart:t.alignmentStart,uniqueId:t.uniqueId},t.readName&&(A.mate.readName=t.readName)),t.flags|=_.BAM_FPAIRED,A.flags&_.BAM_FUNMAP&&(t.flags|=_.BAM_FMUNMAP),t.flags&_.BAM_FUNMAP&&(A.flags|=_.BAM_FMUNMAP),A.flags&_.BAM_FREVERSE&&(t.flags|=_.BAM_FMREVERSE),t.flags&_.BAM_FREVERSE&&(A.flags|=_.BAM_FMREVERSE),t.templateLength===void 0&&(n?Pn(r,e,t):Un(t,A)),t.mateRecordNumber=void 0}class pt{constructor(e,t,A){this.container=e,this.containerPosition=t,this.sliceSize=A,this.file=e.file}async getHeader(){const{majorVersion:e}=await this.file.getDefinition(),t=T(e),A=await this.container.getHeader(),n=await this.file.readBlock(A._endPosition+this.containerPosition);if(n.contentType==="MAPPED_SLICE_HEADER"){const i=J(n.content,t.cramMappedSliceHeader.parser,0,A._endPosition);return{...n,parsedContent:i}}else if(n.contentType==="UNMAPPED_SLICE_HEADER"){const i=J(n.content,t.cramUnmappedSliceHeader.parser,0,A._endPosition);return{...n,parsedContent:i}}else throw new D(`error reading slice header block, invalid content type ${n.contentType}`)}async getBlocks(){const e=await this.getHeader();let t=e._endPosition;const A=new Array(e.parsedContent.numBlocks);for(let n=0;n<A.length;n++){const i=await this.file.readBlock(t);A[n]=i,t=A[n]._endPosition}return A}async getCoreDataBlock(){return(await this.getBlocks())[0]}async _getBlocksContentIdIndex(){const e=await this.getBlocks(),t={};return e.forEach(A=>{A.contentType==="EXTERNAL_DATA"&&(t[A.contentId]=A)}),t}async getBlockByContentId(e){return(await this._getBlocksContentIdIndex())[e]}async getReferenceRegion(){const e=new TextDecoder("utf8"),t=(await this.getHeader()).parsedContent;if(!W(t))throw new Error("slice header not mapped");if(t.refSeqId<0)return;const A=await this.container.getCompressionScheme();if(A===void 0)throw new Error("compression scheme undefined");if(t.refBaseBlockId>=0){const n=await this.getBlockByContentId(t.refBaseBlockId);if(!n)throw new D("embedded reference specified, but reference block does not exist");return{seq:e.decode(n.data),start:t.refSeqStart,end:t.refSeqStart+t.refSeqSpan-1,span:t.refSeqSpan}}if(A.referenceRequired||this.file.fetchReferenceSequenceCallback){if(!this.file.fetchReferenceSequenceCallback)throw new Error("reference sequence not embedded, and seqFetch callback not provided, cannot fetch reference sequence");const n=await this.file.fetchReferenceSequenceCallback(t.refSeqId,t.refSeqStart,t.refSeqStart+t.refSeqSpan-1);if(n.length!==t.refSeqSpan)throw new Xt("seqFetch callback returned a reference sequence of the wrong length");return{seq:n,start:t.refSeqStart,end:t.refSeqStart+t.refSeqSpan-1,span:t.refSeqSpan}}}getAllRecords(){return this.getRecords(()=>!0)}async _fetchRecords(){const{majorVersion:e}=await this.file.getDefinition(),t=await this.container.getCompressionScheme();if(t===void 0)throw new Error("compression scheme undefined");const A=await this.getHeader(),n=await this._getBlocksContentIdIndex();if(e>1&&this.file.options.checkSequenceMD5&&W(A.parsedContent)&&A.parsedContent.refSeqId>=0&&A.parsedContent.md5?.join("")!=="0000000000000000"){const c=await this.getReferenceRegion();if(c){const{seq:a,start:C,end:d}=c,I=pn(a),u=A.parsedContent.md5?.map(h=>(h<16?"0":"")+h.toString(16)).join("");if(I!==u)throw new D(`MD5 checksum reference mismatch for ref ${A.parsedContent.refSeqId} pos ${C}..${d}. recorded MD5: ${u}, calculated MD5: ${I}`)}}const i=await this.getCoreDataBlock(),o={lastAlignmentStart:W(A.parsedContent)?A.parsedContent.refSeqStart:0,coreBlock:{bitPosition:7,bytePosition:0},externalBlocks:{map:new Map,getCursor(c){let a=this.map.get(c);return a===void 0&&(a={bitPosition:7,bytePosition:0},this.map.set(c,a)),a}}},s=c=>{const a=t.getCodecForDataSeries(c);if(!a)throw new D(`no codec defined for ${c} data series`);return a.decode(this,i,n,o)},g=new Array(A.parsedContent.numRecords);for(let c=0;c<g.length;c+=1)try{const a=vn(this,s,t,A,i,n,o,e,c);g[c]=new zt({...a,uniqueId:A.contentPosition+A.parsedContent.recordCounter+c+1})}catch(a){if(a instanceof ae){console.warn("read attempted beyond end of buffer, file seems truncated.");break}else throw a}for(let c=0;c<g.length;c+=1){const a=g[c];if(a){const{mateRecordNumber:C}=a;C!==void 0&&C>=0&&g[C]&&On(g,c,a,g[C])}}return g}async getRecords(e){const t=this.container.filePosition+this.containerPosition;let A=this.file.featureCache.get(t.toString());A||(A=this._fetchRecords(),this.file.featureCache.set(t.toString(),A));const i=(await A).filter(e);if(i.length&&this.file.fetchReferenceSequenceCallback){const o=await this.getHeader();if(W(o.parsedContent)&&(o.parsedContent.refSeqId>=0||o.parsedContent.refSeqId===-2)){const s=o.parsedContent.refSeqId>=0?o.parsedContent.refSeqId:void 0,g=await this.container.getCompressionScheme();if(g===void 0)throw new Error("compression scheme undefined");const c={};for(const a of i){const C=s!==void 0?s:a.sequenceId;let d=c[C];d||(d={id:C,start:a.alignmentStart,end:Number.NEGATIVE_INFINITY,seq:null},c[C]=d);const I=a.alignmentStart+(a.lengthOnRef||a.readLength)-1;I>d.end&&(d.end=I),a.alignmentStart<d.start&&(d.start=a.alignmentStart)}await Promise.all(Object.values(c).map(async a=>{a.id!==-1&&a.start<=a.end&&this.file.fetchReferenceSequenceCallback&&(a.seq=await this.file.fetchReferenceSequenceCallback(a.id,a.start,a.end))}));for(const a of i){const C=s!==void 0?s:a.sequenceId,d=c[C];if(d?.seq){const I=d.seq;a.addReferenceSequence({...d,seq:I},g)}}}}return i}}"getHeader getBlocks _getBlocksContentIdIndex".split(" ").forEach(r=>{ce(pt,r)});class Y{constructor(e,t){this.parameters=e,this.dataType=t}}class Hn extends Y{constructor(e,t){if(super(e,t),this.dataType!=="int")throw new P(`${this.dataType} decoding not yet implemented by BETA codec`)}decode(e,t,A,n){return G(t.content,n.coreBlock,this.parameters.length)-this.parameters.offset}}let yt=class extends Y{constructor(e,t,A){super(e,t),this.instantiateCodec=A}decode(e,t,A,n){const o=this._getLengthCodec().decode(e,t,A,n)||0,s=this._getDataCodec(),g=new Uint8Array(o);for(let c=0;c<o;c+=1)g[c]=s.decode(e,t,A,n)||0;return g}_getLengthCodec(){const e=this.parameters.lengthsEncoding;return this.instantiateCodec(e,"int")}_getDataCodec(){const e=this.parameters.valuesEncoding;return this.instantiateCodec(e,"byte")}};"_getLengthCodec _getDataCodec".split(" ").forEach(r=>{ce(yt,r)});class Tn extends Y{decode(e,t,A,n){const{blockContentId:i}=this.parameters,o=A[i];if(!o)throw new D(`no block found with content ID ${i}`);const s=n.externalBlocks.getCursor(i);return this._decodeByteArray(o,s)}_decodeByteArray(e,t){const A=e.content,{stopByte:n}=this.parameters,i=t.bytePosition;let o=t.bytePosition;for(;A[o]!==n&&o<A.length;){if(o===A.length)throw new ae("byteArrayStop reading beyond length of data buffer?");o=o+1}return t.bytePosition=o+1,A.subarray(i,o)}}class Gn extends Y{constructor(e,t){if(super(e,t),this.dataType==="int")this._decodeData=this._decodeInt;else if(this.dataType==="byte")this._decodeData=this._decodeByte;else throw new P(`${this.dataType} decoding not yet implemented by EXTERNAL codec`)}decode(e,t,A,n){const{blockContentId:i}=this.parameters,o=A[i];return o?this._decodeData(o,n.externalBlocks.getCursor(i)):void 0}_decodeInt(e,t){const[A,n]=Q(e.content,t.bytePosition);return t.bytePosition=t.bytePosition+n,A}_decodeByte(e,t){if(t.bytePosition>=e.content.length)throw new ae("attempted to read beyond end of block. this file seems truncated.");return e.content[t.bytePosition++]}}class Jn extends Y{constructor(e,t){if(super(e,t),this.dataType!=="int")throw new P(`${this.dataType} decoding not yet implemented by GAMMA codec`)}decode(e,t,A,n){let i=1;for(;G(t.content,n.coreBlock,1)===0;)i=i+1;return(G(t.content,n.coreBlock,i-1)|1<<i-1)-this.parameters.offset}}function Yn(r){let e=r-(r>>1)&1431655765;return e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}class Kn extends Y{constructor(e,t){if(super(e,t),this.codes={},this.codeBook={},this.sortedCodes=[],this.sortedValuesByBitCode=[],this.sortedBitCodes=[],this.sortedBitLengthsByBitCode=[],this.bitCodeToValue=[],!["byte","int"].includes(this.dataType))throw new TypeError(`${this.dataType} decoding not yet implemented by HUFFMAN_INT codec`);this.buildCodeBook(),this.buildCodes(),this.buildCaches(),this.sortedCodes[0].bitLength===0&&(this._decode=this._decodeZeroLengthCode)}buildCodeBook(){let e=new Array(this.parameters.numCodes);for(let t=0;t<this.parameters.numCodes;t++)e[t]={symbol:this.parameters.symbols[t],bitLength:this.parameters.bitLengths[t]};e=e.sort((t,A)=>t.bitLength-A.bitLength||t.symbol-A.symbol),this.codeBook={},e.forEach(t=>{this.codeBook[t.bitLength]||(this.codeBook[t.bitLength]=[]),this.codeBook[t.bitLength].push(t.symbol)})}buildCodes(){this.codes={};let e=0,t=-1;Object.entries(this.codeBook).forEach(([A,n])=>{const i=Number.parseInt(A,10);n.forEach(o=>{const s={bitLength:i,value:o,bitCode:0};t=t+1;const g=i-e;if(t=t<<g,s.bitCode=t,e=e+g,Yn(t)>i)throw new D("Symbol out of range");this.codes[o]=s})})}buildCaches(){this.sortedCodes=Object.values(this.codes).sort((t,A)=>t.bitLength-A.bitLength||t.bitCode-A.bitCode),this.sortedValuesByBitCode=this.sortedCodes.map(t=>t.value),this.sortedBitCodes=this.sortedCodes.map(t=>t.bitCode),this.sortedBitLengthsByBitCode=this.sortedCodes.map(t=>t.bitLength);const e=Math.max(...this.sortedBitCodes);this.bitCodeToValue=new Array(e+1).fill(-1);for(let t=0;t<this.sortedBitCodes.length;t+=1)this.bitCodeToValue[this.sortedCodes[t].bitCode]=t}decode(e,t,A,n){return this._decode(e,t,n.coreBlock)}_decodeZeroLengthCode(){return this.sortedCodes[0].value}_decode(e,t,A){const n=t.content;let i=0,o=0;for(let s=0;s<this.sortedCodes.length;s+=1){const g=this.sortedCodes[s].bitLength;o<<=g-i,o|=G(n,A,g-i),i=g;{const c=this.bitCodeToValue[o];if(c>-1&&this.sortedBitLengthsByBitCode[c]===g)return this.sortedValuesByBitCode[c];for(let a=s;this.sortedCodes[a+1].bitLength===g&&a<this.sortedCodes.length;a+=1)s+=1}}throw new D("Huffman symbol not found.")}}class zn extends Y{constructor(e,t){if(super(e,t),this.dataType!=="int")throw new P(`${this.dataType} decoding not yet implemented by SUBEXP codec`)}decode(e,t,A,n){let i=0;for(;G(t.content,n.coreBlock,1);)i=i+1;let o,s;if(i===0)o=this.parameters.K,s=G(t.content,n.coreBlock,o);else{o=i+this.parameters.K-1;const g=G(t.content,n.coreBlock,o);s=1<<o|g}return s-this.parameters.offset}}const Vn={1:Gn,3:Kn,4:yt,5:Tn,6:Hn,7:zn,9:Jn};function $n(r){return Vn[r]}function me(r,e){const t=$n(e==="ignore"?0:r.codecId);if(!t)throw new P(`no codec implemented for codec ID ${r.codecId}`);return new t(r.parameters,e,me)}const Wn={BF:"int",CF:"int",RI:"int",RL:"int",AP:"int",RG:"int",MF:"int",NS:"int",NP:"int",TS:"int",NF:"int",TC:"byte",TN:"int",FN:"int",FC:"byte",FP:"int",BS:"byte",IN:"byteArray",SC:"byteArray",DL:"int",BA:"byte",BB:"byteArray",RS:"int",PD:"int",HC:"int",MQ:"int",RN:"byteArray",QS:"byte",QQ:"byteArray",TL:"int"};function Xn(r){const e=new Array(5);for(let t=0;t<5;t+=1)e[t]=new Array(4);return e[0][r[0]>>6&3]="C",e[0][r[0]>>4&3]="G",e[0][r[0]>>2&3]="T",e[0][r[0]>>0&3]="N",e[1][r[1]>>6&3]="A",e[1][r[1]>>4&3]="G",e[1][r[1]>>2&3]="T",e[1][r[1]>>0&3]="N",e[2][r[2]>>6&3]="A",e[2][r[2]>>4&3]="C",e[2][r[2]>>2&3]="T",e[2][r[2]>>0&3]="N",e[3][r[3]>>6&3]="A",e[3][r[3]>>4&3]="C",e[3][r[3]>>2&3]="G",e[3][r[3]>>0&3]="N",e[4][r[4]>>6&3]="A",e[4][r[4]>>4&3]="C",e[4][r[4]>>2&3]="G",e[4][r[4]>>0&3]="T",e}class jn{constructor(e){this.dataSeriesCodecCache={},this.tagCodecCache={},this.tagEncoding={},this.readNamesIncluded=e.preservation.RN,this.APdelta=e.preservation.AP,this.referenceRequired=!!e.preservation.RR,this.tagIdsDictionary=e.preservation.TD,this.substitutionMatrix=Xn(e.preservation.SM),this.dataSeriesEncoding=e.dataSeriesEncoding,this.tagEncoding=e.tagEncoding}getCodecForTag(e){const t=this.tagCodecCache[e];if(t)return t;{const A=this.tagEncoding[e];if(!A)throw new Error("Error, no tag encoding");const n=me(A,"byteArray");return this.tagCodecCache[e]=n,n}}getTagNames(e){return this.tagIdsDictionary[e]}getCodecForDataSeries(e){let t=this.dataSeriesCodecCache[e];if(t===void 0){const A=this.dataSeriesEncoding[e];if(A){const n=Wn[e];if(!n)throw new D(`data series name ${e} not defined in file compression header`);t=me(A,n),this.dataSeriesCodecCache[e]=t}}return t}toJSON(){const e={};return Object.keys(this).forEach(t=>{t.endsWith("Cache")||(e[t]=this[t])}),e}}class xt{constructor(e,t){this.file=e,this.filePosition=t}getHeader(){return this._readContainerHeader(this.filePosition)}async getCompressionHeaderBlock(){if(!(await this.getHeader()).numRecords)return null;const{majorVersion:t}=await this.file.getDefinition(),A=T(t),n=await this.getFirstBlock();if(n.contentType!=="COMPRESSION_HEADER")throw new D(`invalid content type ${n.contentType} in compression header block`);const i=J(n.content,A.cramCompressionHeader.parser,0,n.contentPosition);return{...n,parsedContent:i}}async getFirstBlock(){const e=await this.getHeader();return this.file.readBlock(e._endPosition)}async getCompressionScheme(){const e=await this.getCompressionHeaderBlock();if(e)return new jn(e.parsedContent)}getSlice(e,t){return new pt(this,e,t)}async _readContainerHeader(e){const{majorVersion:t}=await this.file.getDefinition(),A=T(t),{cramContainerHeader1:n,cramContainerHeader2:i}=A,o=await this.file.read(n.maxLength,e),s=J(o,n.parser),g=wn(s.numLandmarks),c=await this.file.read(i.maxLength(s.numLandmarks),e+s._size-g),a=J(c,i.parser);return this.file.validateChecksums&&a.crc32!==void 0&&await this.file.checkCrc32(e,s._size+a._size-g-4,a.crc32,`container header beginning at position ${e}`),{...s,...a,_size:s._size+a._size-g,_endPosition:s._size+a._size-g+e}}}"getHeader getCompressionHeaderBlock getCompressionScheme".split(" ").forEach(r=>{ce(xt,r)});function Zn(r){return new ReadableStream({start(e){e.enqueue(r),e.close()}})}function er(){const r=new Uint32Array([287454020]),e=new Uint8Array(r.buffer);return e[0]===68?0:e[0]===17?1:2}class we{constructor(e){if(this.file=ht(e.url,e.path,e.filehandle),this.validateChecksums=!0,this.fetchReferenceSequenceCallback=e.seqFetch,this.options={checkSequenceMD5:e.checkSequenceMD5,cacheSize:e.cacheSize??2e4},this.featureCache=new Rt({maxSize:this.options.cacheSize}),er()>0)throw new Error("Detected big-endian machine, may be unable to run")}read(e,t){return this.file.read(e,t)}async getDefinition(){const{maxLength:e,parser:t}=Et(),A=await this.file.read(e,0),n=t(A).value;if(n.majorVersion!==2&&n.majorVersion!==3)throw new P(`CRAM version ${n.majorVersion} not supported`);return n}async getSamHeader(){const e=await this.getContainerById(0);if(!e)throw new D("file contains no containers");const A=(await e.getFirstBlock()).content,i=new DataView(A.buffer).getInt32(0,!0),o=4,g=new TextDecoder("utf8").decode(A.subarray(o,o+i));return this.header=g,ln(g)}async getHeaderText(){return await this.getSamHeader(),this.header}async getContainerById(e){const{majorVersion:t}=await this.getDefinition();let n=T(t).cramFileDefinition.maxLength,i;for(let o=0;o<=e;o++){i=this.getContainerAtPosition(n);const s=await i.getHeader();if(o===0){n=s._endPosition;for(let g=0;g<s.numBlocks;g++)n=(await this.readBlock(n))._endPosition}else n+=s._size+s.length}return i}async checkCrc32(e,t,A,n){const i=await this.file.read(t,e),o=St(i)>>>0;if(o!==A)throw new D(`crc mismatch in ${n}: recorded CRC32 = ${A}, but calculated CRC32 = ${o}`)}async containerCount(){const{majorVersion:e}=await this.getDefinition(),t=T(e);let A=0,n=t.cramFileDefinition.maxLength;try{for(;;){const i=await this.getContainerAtPosition(n).getHeader();if(A===0){n=i._endPosition;for(let o=0;o<i.numBlocks;o++)n=(await this.readBlock(n))._endPosition}else n+=i._size+i.length;A+=1}}catch{A--}return A}getContainerAtPosition(e){return new xt(this,e)}async readBlockHeader(e){const{majorVersion:t}=await this.getDefinition(),A=T(t),{cramBlockHeader:n}=A,i=await this.file.read(n.maxLength,e);return J(i,n.parser,0,e)}async _parseSection(e,t,A=e.maxLength,n){const i=n??await this.file.read(A,t),o=J(i,e.parser,0,t);if(o._size!==A)throw new D(`section read error: requested size ${A} does not equal parsed size ${o._size}`);return o}async _uncompressPre(e,t,A){if(e==="gzip")return Qt(t);if(e==="bzip2")return st(t);if(e==="lzma"){const n=new Response(new Wt.XzReadableStream(Zn(t)));return new Uint8Array(await n.arrayBuffer())}else if(e==="rans"){const n=new Uint8Array(A);return In(t,n),n}else{if(e==="rans4x16")return zA(t);if(e==="arith")return VA(t);if(e==="fqzcomp")return $A(t);if(e==="tok3")return WA(t);throw new P(`${e} decompression not yet implemented`)}}async _uncompress(e,t,A){const n=await this._uncompressPre(e,t,A);if(n.length!==A){const i=new Uint8Array(A);return i.set(n,0),i}return n}async readBlock(e){const{majorVersion:t}=await this.getDefinition(),A=T(t),n=await this.readBlockHeader(e),i=n._endPosition,o=await this.file.read(n.compressedSize,i),s=n.compressionMethod!=="raw"?await this._uncompress(n.compressionMethod,o,n.uncompressedSize):o,g={...n,_endPosition:i,contentPosition:i,content:s};if(t>=3){const c=await this._parseSection(A.cramBlockCrc32,i+n.compressedSize);g.crc32=c.crc32,this.validateChecksums&&await this.checkCrc32(e,n._size+n.compressedSize,c.crc32,"block data"),g._endPosition=c._endPosition,g._size=g.compressedSize+A.cramBlockCrc32.maxLength}else g._endPosition=i+g.compressedSize,g._size=g.compressedSize;return g}}"getDefinition getSectionParsers getSamHeader".split(" ").forEach(r=>{ce(we,r)});const tr=21578050;function At(r,e){const[t,A,n,i,o,s]=e,g=t;r[g]||(r[g]=[]),r[g].push({start:A,span:n,containerStart:i,sliceStart:o,sliceBytes:s})}function Ar(r){return r[0]===31&&r[1]===139?Qt(r):r}class nr{constructor(e){this.filehandle=ht(e.url,e.path,e.filehandle)}async parseIndex(){const e={},t=Ar(await this.filehandle.readFile()),A=new DataView(t.buffer);if(t.length>4&&A.getUint32(0,!0)===tr)throw new D("invalid .crai index file. note: file appears to be a .bai index. this is technically legal but please open a github issue if you need support");let n=[],i="";for(const o of t)if(o>=48&&o<=57||!i&&o===45)i+=String.fromCharCode(o);else if(o===9)n.push(Number.parseInt(i,10)),i="";else if(o===10)n.push(Number.parseInt(i,10)),i="",At(e,n),n=[];else if(o!==13&&o!==32)throw new D("invalid .crai index file");return i&&n.push(Number.parseInt(i,10)),n.length===6&&At(e,n),Object.entries(e).forEach(([o,s])=>{const g=s;e[o]=g.sort((c,a)=>c.start-a.start||c.span-a.span)}),e}getIndex(){return this.parseIndexP||(this.parseIndexP=this.parseIndex().catch(e=>{throw this.parseIndexP=void 0,e})),this.parseIndexP}async hasDataForReferenceSequence(e){return!!(await this.getIndex())[e]}async getEntriesForRange(e,t,A){const n=(await this.getIndex())[e];if(!n)return[];const i=s=>{const g=s.start,c=s.start+s.span;return g>A?-1:c<=t?1:0},o=[];for(const s of n)i(s)===0&&o.push(s);return o}}class rr{constructor(e){if(this.cram=e.cram??new we({url:e.cramUrl,path:e.cramPath,filehandle:e.cramFilehandle,seqFetch:e.seqFetch,checkSequenceMD5:e.checkSequenceMD5,cacheSize:e.cacheSize}),!(this.cram instanceof we))throw new Error("invalid arguments: no cramfile");this.index=e.index}async getRecordsForRange(e,t,A,n={}){if(n.viewAsPairs=n.viewAsPairs||!1,n.pairAcrossChr=n.pairAcrossChr||!1,n.maxInsertSize=n.maxInsertSize||2e5,typeof e=="string")throw new P("string sequence names not yet supported");const i=e,o=await this.index.getEntriesForRange(i,t,A),s=await Promise.all(o.map(c=>this.getRecordsInSlice(c,a=>a.sequenceId===e&&a.alignmentStart<=A&&a.lengthOnRef!==void 0&&a.alignmentStart+a.lengthOnRef-1>=t)));let g=Array.prototype.concat(...s);if(n.viewAsPairs){const c={},a={};for(const f of g){const B=f.readName;if(B===void 0)throw new Error("readName undefined");const w=f.uniqueId;c[B]||(c[B]=0),c[B]+=1,a[w]=1}const C={};Object.entries(c).forEach(([f,B])=>{B===1&&(C[f]=!0)});const d=[];for(const f of g){const B=f.readName;if(B===void 0)throw new Error("readName undefined");if(C[B]&&f.mate&&(f.mate.sequenceId===i||n.pairAcrossChr)&&Math.abs(f.alignmentStart-f.mate.alignmentStart)<n.maxInsertSize){const w=this.index.getEntriesForRange(f.mate.sequenceId,f.mate.alignmentStart,f.mate.alignmentStart+1);d.push(w)}}const I=await Promise.all(d);let u=[];for(const f of I)u.push(...f);u=u.sort((f,B)=>f.toString().localeCompare(B.toString())).filter((f,B,w)=>!B||f.toString()!==w[B-1].toString());const h=[];for(const f of u){let B=this.cram.featureCache.get(f.toString());B||(B=this.getRecordsInSlice(f,()=>!0),this.cram.featureCache.set(f.toString(),B));const w=B.then(p=>{const m=[];for(const R of p){if(R.readName===void 0)throw new Error("readName undefined");C[R.readName]&&!a[R.uniqueId]&&m.push(R)}return m});h.push(w)}const l=await Promise.all(h);if(l.length){const f=l.reduce((B,w)=>B.concat(w));g=g.concat(f)}}return g}getRecordsInSlice({containerStart:e,sliceStart:t,sliceBytes:A},n){return this.cram.getContainerAtPosition(e).getSlice(t,A).getRecords(n)}hasDataForReferenceSequence(e){return this.index.hasDataForReferenceSequence(e)}}function ir(r,e,t){if(!r)return[];const A=new Array(r.length);let n=0,i=0,o=0,s=0,g=e;for(const{refPos:c,code:a,pos:C,data:d,sub:I,ref:u}of r)if(s=o-g,g=o,s&&i>0&&(A[n++]={start:o,type:"insertion",base:`${i}`,length:0},i=0),o=c-1-e,a==="X")A[n++]={start:o,length:1,base:I,qual:t?.[C-1],altbase:u?.toUpperCase(),type:"mismatch"};else if(a==="I")A[n++]={start:o,type:"insertion",base:`${d.length}`,length:0};else if(a==="N")A[n++]={type:"skip",length:d,start:o,base:"N"};else if(a==="S"){const h=d.length;A[n++]={start:o,type:"softclip",base:`S${h}`,cliplen:h,length:1}}else if(a!=="P")if(a==="H"){const h=d;A[n++]={start:o,type:"hardclip",base:`H${h}`,cliplen:h,length:1}}else a==="D"?A[n++]={type:"deletion",length:d,start:o,base:"*"}:a==="b"||a==="q"||a==="B"||a==="i"&&i++;return s&&i>0&&(A[n++]={start:o,type:"insertion",base:`${i}`,length:0},i=0),A.slice(0,n)}function sr(r,e,t,A){let n="",i="",o="M",s=0;if(!A)return"";const g=A.seq,c=A.start;let a=e,C=0,d=0;if(r!==void 0)for(const{code:I,refPos:u,sub:h,data:l}of r)if(C=u-a,n+=g.slice(a-c,u-c),a=u,d>0&&C&&(i+=`${d}I`,d=0),s&&o!=="M"&&(i+=`${s}${o}`,s=0),C&&(o="M",s+=C),I==="b"){const f=l.split(","),B=String.fromCharCode(...f);n+=B,a+=B.length,s+=B.length}else I==="B"||I==="X"?(n+=h,a++,s++):I==="D"||I==="N"?(a+=l,s&&(i+=`${s}${o}`),i+=l+I,s=0):I==="I"||I==="S"?(n+=l,s&&(i+=`${s}${o}`),i+=l.length+I,s=0):I==="i"?(s&&(i+=`${s}${o}`),d++,n+=l,s=0):I==="P"?(s&&(i+=`${s}${o}`),i+=`${l}P`):I==="H"&&(s&&(i+=`${s}${o}`),i+=`${l}H`,s=0);else C=t-n.length;return n.length!==t&&(C=t-n.length,n+=g.slice(a-c,a-c+C),s&&o!=="M"&&(i+=`${s}${o}`,s=0),o="M",s+=C),C&&d>0&&(i+=`${d}I`),s&&(i+=`${s}${o}`),i}class ge{constructor(e,t){this.record=e,this._store=t}get name(){return this.record.readName}get start(){return this.record.alignmentStart-1}get end(){var e;return this.start+((e=this.record.lengthOnRef)!==null&&e!==void 0?e:1)}get score(){return this.record.mappingQuality}get flags(){return this.record.flags}get strand(){return this.record.isReverseComplemented()?-1:1}get qual(){return(this.record.qualityScores||[]).join(" ")}get qualRaw(){return this.record.qualityScores}get refName(){return this._store.refIdToName(this.record.sequenceId)}get pair_orientation(){return this.record.isPaired()?this.record.getPairOrientation():void 0}get template_length(){return this.record.templateLength||this.record.templateSize}get next_ref(){return this.record.mate?this._store.refIdToName(this.record.mate.sequenceId):void 0}get next_segment_position(){return this.record.mate?`${this._store.refIdToName(this.record.mate.sequenceId)}:${this.record.mate.alignmentStart}`:void 0}get is_paired(){return!!this.record.mate}get next_pos(){var e;return(e=this.record.mate)===null||e===void 0?void 0:e.alignmentStart}get tags(){var e;const t=(e=this._store.samHeader.readGroups)===null||e===void 0?void 0:e[this.record.readGroupId];return t!==void 0?{...this.record.tags,RG:t}:this.record.tags}get seq(){return this.record.getReadBases()}get CIGAR(){return sr(this.record.readFeatures,this.record.alignmentStart,this.record.readLength,this.record._refRegion)}id(){return`${this._store.id}-${this.record.uniqueId}`}get(e){return e==="mismatches"?this.mismatches:e==="qual"?this.qual:e==="CIGAR"?this.CIGAR:this.fields[e]}parent(){}children(){}get mismatches(){return ir(this.record.readFeatures,this.start,this.qualRaw)}get fields(){return{start:this.start,name:this.name,end:this.end,score:this.score,strand:this.strand,template_length:this.template_length,flags:this.flags,tags:this.tags,refName:this.refName,seq:this.seq,type:"match",pair_orientation:this.pair_orientation,next_ref:this.next_ref,next_pos:this.next_pos,next_segment_position:this.next_segment_position,uniqueId:this.id()}}toJSON(){return{...this.fields,CIGAR:this.CIGAR,qual:this.qual}}}pe(ge,"fields");pe(ge,"CIGAR");pe(ge,"mismatches");class ur extends Pt.BaseFeatureDataAdapter{constructor(){super(...arguments),this.samHeader={},this.ultraLongFeatureCache=new Ut({maxSize:500}),this.seqIdToOriginalRefName=[]}async configurePre(){const e=this.getConf("cramLocation"),t=this.getConf("craiLocation"),A=this.pluginManager,n=new rr({cramFilehandle:Se.openLocation(e,A),index:new nr({filehandle:Se.openLocation(t,A)}),seqFetch:(...s)=>this.seqFetch(...s),checkSequenceMD5:!1});if(!this.getSubAdapter)throw new Error("Error getting subadapter");const i=this.getConf("sequenceAdapter");if(!i)throw new Error("no sequenceAdapter supplied to CramAdapter config");const o=await this.getSubAdapter(i);return{cram:n,sequenceAdapter:o.dataAdapter}}async configure(){return this.configureP||(this.configureP=this.configurePre().catch(e=>{throw this.configureP=void 0,e})),this.configureP}async getHeader(e){const{cram:t}=await this.configure();return t.cram.getHeaderText()}async seqFetch(e,t,A){t-=1;const{sequenceAdapter:n}=await this.configure(),i=this.refIdToOriginalName(e)||this.refIdToName(e);if(!i)throw new Error("unknown");const s=(await Ft(n.getFeatures({refName:i,start:t,end:A,assemblyName:""}).pipe(Mt()))).sort((c,a)=>c.get("start")-a.get("start")).map(c=>{const a=c.get("start"),C=c.get("end"),d=Math.max(t-a,0),u=Math.min(A-a,C-a)-d;return(c.get("seq")||c.get("residues")).slice(d,d+u)}).join(""),g=A-t;if(s.length!==g)throw new Error(`fetching ${i}:${H.toLocale(t-1)}-${H.toLocale(A)} returned ${H.toLocale(s.length)} bases, should have returned ${H.toLocale(g)}`);return s}async setupPre(e){const t=await this.configure(),{cram:A}=t,n=await A.cram.getSamHeader(),i=[],o={};for(const[c,a]of n.filter(C=>C.tag==="SQ").entries()){const C=a.data.find(d=>d.tag==="SN");if(C){const d=C.value;o[d]=c,i[c]=d}}const s=n.filter(c=>c.tag==="RG").map(c=>{var a;return(a=c.data.find(C=>C.tag==="ID"))===null||a===void 0?void 0:a.value}),g={idToName:i,nameToId:o,readGroups:s};return this.samHeader=g,{samHeader:g,...t}}async setupPre2(e){return this.setupP||(this.setupP=this.setupPre(e).catch(t=>{throw this.setupP=void 0,t})),this.setupP}async setup(e){const{statusCallback:t=()=>{}}=e||{};return H.updateStatus("Downloading index",t,()=>this.setupPre2(e))}async getRefNames(e){const{samHeader:t}=await this.setup(e);if(!t.idToName)throw new Error("CRAM file has no header lines");return t.idToName}refNameToId(e){if(this.samHeader.nameToId)return this.samHeader.nameToId[e];if(this.seqIdToRefName)return this.seqIdToRefName.indexOf(e)}refIdToName(e){var t,A;return((t=this.samHeader.idToName)===null||t===void 0?void 0:t[e])||((A=this.seqIdToRefName)===null||A===void 0?void 0:A[e])}refIdToOriginalName(e){return this.seqIdToOriginalRefName[e]}getFeatures(e,t){const{stopToken:A,filterBy:n,statusCallback:i=()=>{}}=t||{},{refName:o,start:s,end:g,originalRefName:c}=e;return Ot.ObservableCreate(async a=>{const{cram:C,samHeader:d}=await this.setup(t),I=this.refNameToId(o);if(I===void 0){console.warn("Unknown refName",o),a.complete();return}c&&(this.seqIdToOriginalRefName[I]=c);const u=await H.updateStatus("Downloading alignments",i,()=>C.getRecordsForRange(I,s,g));qt.checkStopToken(A),await H.updateStatus("Processing alignments",i,()=>{var h;const{flagInclude:l=0,flagExclude:f=0,tagFilter:B,readName:w}=n||{};for(const p of u){if(Lt(p.flags,l,f)||B&&vt(B.tag==="RG"?(h=d.readGroups)===null||h===void 0?void 0:h[p.readGroupId]:p.tags[B.tag],B.value)||w&&p.readName!==w)continue;const m=this.ultraLongFeatureCache.get(`${p.uniqueId}`);if(m)a.next(m);else{const R=this.cramRecordToFeature(p);this.ultraLongFeatureCache.set(`${p.uniqueId}`,R),a.next(R)}}a.complete()})},A)}cramRecordToFeature(e){return new ge(e,this)}async getMultiRegionFeatureDensityStats(e,t){const A=await this.bytesForRegions(e,t),n=this.getConf("fetchSizeLimit");return{bytes:A,fetchSizeLimit:n}}async bytesForRegions(e,t){const{cram:A}=await this.configure();return(await Promise.all(e.map(i=>{const{refName:o,start:s,end:g}=i,c=this.refNameToId(o);return c!==void 0?A.index.getEntriesForRange(c,s,g):[{sliceBytes:0}]}))).flat().reduce((i,o)=>i+o.sliceBytes,0)}}export{ur as default};
//# sourceMappingURL=CramAdapter-BzrXQQOA.js.map
