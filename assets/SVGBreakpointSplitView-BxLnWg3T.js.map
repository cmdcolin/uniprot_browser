{"version":3,"file":"SVGBreakpointSplitView-BxLnWg3T.js","sources":["../../node_modules/@jbrowse/plugin-breakpoint-split-view/esm/BreakpointSplitView/svgcomponents/SVGBackground.js","../../node_modules/@jbrowse/plugin-breakpoint-split-view/esm/BreakpointSplitView/svgcomponents/util.js","../../node_modules/@jbrowse/plugin-breakpoint-split-view/esm/BreakpointSplitView/svgcomponents/SVGBreakpointSplitView.js"],"sourcesContent":["import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { stripAlpha } from '@jbrowse/core/util';\nimport { useTheme } from '@mui/material';\nexport default function SVGBackground({ width, height, shift, }) {\n    const theme = useTheme();\n    return (_jsx(\"rect\", { width: width + shift * 2, height: height, fill: stripAlpha(theme.palette.background.default) }));\n}\n","import { max, measureText } from '@jbrowse/core/util';\nimport { getTrackName } from '@jbrowse/core/util/tracks';\nexport function getTrackNameMaxLen(views, fontSize, session) {\n    return max(views.flatMap(view => view.tracks.map(t => measureText(getTrackName(t.configuration, session), fontSize))), 0);\n}\nexport function getTrackOffsets(view, textOffset, extra = 0) {\n    const offsets = {};\n    let curr = textOffset;\n    for (const track of view.tracks) {\n        offsets[track.configuration.trackId] = curr + extra;\n        curr += track.displays[0].height + textOffset;\n    }\n    return offsets;\n}\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { createJBrowseTheme } from '@jbrowse/core/ui';\nimport { getSession, renderToStaticMarkup, sum } from '@jbrowse/core/util';\nimport { SVGRuler, SVGTracks, totalHeight, } from '@jbrowse/plugin-linear-genome-view';\nimport { ThemeProvider } from '@mui/material';\nimport { when } from 'mobx';\nimport SVGBackground from './SVGBackground';\nimport { getTrackNameMaxLen, getTrackOffsets } from './util';\nimport Overlay from '../components/Overlay';\nexport async function renderToSvg(model, opts) {\n    var _a;\n    const { textHeight = 18, headerHeight = 30, rulerHeight = 30, fontSize = 13, trackLabels = 'offset', Wrapper = ({ children }) => children, themeName = 'default', } = opts;\n    const session = getSession(model);\n    const theme = (_a = session.allThemes) === null || _a === void 0 ? void 0 : _a.call(session)[themeName];\n    const { width, views } = model;\n    const shift = 50;\n    const offset = headerHeight + rulerHeight;\n    const heights = views.map(v => totalHeight(v.tracks, textHeight, trackLabels) + offset);\n    const totalHeightSvg = sum(heights) + 100;\n    const displayResults = await Promise.all(views.map(async (view) => ({\n        view,\n        data: await Promise.all(view.tracks.map(async (track) => {\n            const d = track.displays[0];\n            await when(() => (d.ready !== undefined ? d.ready : true));\n            return { track, result: await d.renderSvg({ ...opts, theme }) };\n        })),\n    })));\n    const trackLabelMaxLen = getTrackNameMaxLen(views, fontSize, session) + 40;\n    const trackLabelOffset = trackLabels === 'left' ? trackLabelMaxLen : 0;\n    const textOffset = trackLabels === 'offset' ? textHeight : 0;\n    const trackOffsets = views.map((view, idx) => getTrackOffsets(view, textOffset, fontSize + (idx > 0 ? heights[idx - 1] : 0) + offset));\n    const w = width + trackLabelOffset;\n    const t = createJBrowseTheme(theme);\n    return renderToStaticMarkup(_jsx(ThemeProvider, { theme: t, children: _jsx(Wrapper, { children: _jsxs(\"svg\", { width: width, height: totalHeightSvg, xmlns: \"http://www.w3.org/2000/svg\", xmlnsXlink: \"http://www.w3.org/1999/xlink\", viewBox: [0, 0, w + shift * 2, totalHeightSvg].toString(), children: [_jsx(SVGBackground, { width: w, height: totalHeightSvg, shift: shift }), views[0] ? (_jsxs(\"g\", { transform: `translate(${shift} ${fontSize})`, children: [_jsxs(\"g\", { transform: `translate(${trackLabelOffset})`, children: [_jsx(\"text\", { x: 0, fontSize: fontSize, fill: t.palette.text.primary, children: views[0].assemblyNames.join(', ') }), _jsx(SVGRuler, { model: displayResults[0].view, fontSize: fontSize })] }), _jsx(\"g\", { transform: `translate(0 ${offset})`, children: _jsx(SVGTracks, { textHeight: textHeight, trackLabels: trackLabels, fontSize: fontSize, model: displayResults[0].view, displayResults: displayResults[0].data, trackLabelOffset: trackLabelOffset }) })] })) : null, views[1] ? (_jsxs(\"g\", { transform: `translate(${shift} ${fontSize + heights[0]})`, children: [_jsxs(\"g\", { transform: `translate(${trackLabelOffset})`, children: [_jsx(\"text\", { x: 0, fontSize: fontSize, fill: t.palette.text.primary, children: views[1].assemblyNames.join(', ') }), _jsx(SVGRuler, { model: displayResults[1].view, fontSize: fontSize })] }), _jsx(\"g\", { transform: `translate(0 ${offset})`, children: _jsx(SVGTracks, { textHeight: textHeight, trackLabels: trackLabels, fontSize: fontSize, model: displayResults[1].view, displayResults: displayResults[1].data, trackLabelOffset: trackLabelOffset }) })] })) : null, _jsx(\"defs\", { children: _jsx(\"clipPath\", { id: \"clip-bsv\", children: _jsx(\"rect\", { x: 0, y: 0, width: width, height: totalHeightSvg }) }) }), _jsx(\"g\", { transform: `translate(${trackLabelOffset + shift})`, clipPath: \"url(#clip-bsv)\", children: model.matchedTracks.map(track => (_jsx(Overlay, { parentRef: { current: null }, model: model, trackId: track.configuration.trackId, getTrackYPosOverride: (id, level) => trackOffsets[level][id] }, track.configuration.trackId))) })] }) }) }));\n}\n"],"names":["SVGBackground","width","height","shift","theme","useTheme","_jsx","stripAlpha","getTrackNameMaxLen","views","fontSize","session","max","view","t","measureText","getTrackName","getTrackOffsets","textOffset","extra","offsets","curr","track","renderToSvg","model","opts","_a","textHeight","headerHeight","rulerHeight","trackLabels","Wrapper","children","themeName","getSession","offset","heights","v","totalHeight","totalHeightSvg","sum","displayResults","d","when","trackLabelMaxLen","trackLabelOffset","trackOffsets","idx","w","createJBrowseTheme","renderToStaticMarkup","ThemeProvider","_jsxs","SVGRuler","SVGTracks","Overlay","id","level"],"mappings":"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","x_google_ignoreList":[0,1,2]}