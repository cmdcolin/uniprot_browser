import{B as y,a as x}from"./bbi-CTt7nUzu.js";import"./remoteFile-8fiGM-ez.js";import{B}from"./index-D3TbvS_u.js";import{by as S,ag as P,u as d}from"./index-DPMJgfAS.js";import{r as N}from"./rxjs-DiVqhxS9.js";import"./browser-DdKr-yeI.js";import"./AbortablePromiseCache-CQdc8xcb.js";import"./Observable-Bj9bI8lR.js";class v extends y{async getView(e,t){const{zoomLevels:s,refsByName:r,uncompressBufSize:n}=await this.getHeader(t),u=1/e,c=s.length-1;for(let i=c;i>=0;i-=1){const o=s[i];if(o&&o.reductionLevel<=2*u)return new x(this.bbi,r,o.indexOffset,n>0,"summary")}return this.getUnzoomedView(t)}}var C=S();class L extends B.BaseFeatureDataAdapter{async setupPre(e){const{statusCallback:t=()=>{}}=e||{},s=this.pluginManager,r=new v({filehandle:P.openLocation(this.getConf("bigWigLocation"),s)});return{bigwig:r,header:await d.updateStatus("Downloading bigwig header",t,()=>r.getHeader(e))}}async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(t=>{throw this.setupP=void 0,t})),this.setupP}async getRefNames(e){const{header:t}=await this.setup(e);return Object.keys(t.refsByName)}async refIdToName(e){var t;const{header:s}=await this.setup();return(t=s.refsByNumber[e])===null||t===void 0?void 0:t.name}async getGlobalStats(e){const{header:t}=await this.setup(e);return C.rectifyStats(t.totalSummary)}getFeatures(e,t={}){const{refName:s,start:r,end:n}=e,{bpPerPx:u=0,resolution:c=1,stopToken:i,statusCallback:o=()=>{}}=t;return N.ObservableCreate(async p=>{const l=this.getConf("source"),m=this.getConf("resolutionMultiplier"),{bigwig:h}=await this.setup(t),b=await d.updateStatus("Downloading bigwig data",o,()=>h.getFeatures(s,r,n,{...t,basesPerSpan:u/c*m}));for(const a of b){l&&(a.source=l);const g=`${l}:${e.refName}:${a.start}-${a.end}`;a.refName=s,a.uniqueId=g,p.next({get:w=>a[w],id:()=>g,toJSON:()=>a})}p.complete()},i)}async getMultiRegionFeatureDensityStats(e){return{featureDensity:0}}}L.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];export{L as default};
//# sourceMappingURL=BigWigAdapter-D5T5y7JV.js.map
