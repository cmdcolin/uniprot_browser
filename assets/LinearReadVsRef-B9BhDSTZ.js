import{m as Y,a as x,a5 as K,u as R,y as T,t as X,j as t,c as Z,D as ee,T as b,i as te,d as ae,e as se,B as I}from"./index-DPMJgfAS.js";const{featurizeSA:ne,getClip:re,getLength:P,getLengthSansClipping:oe,getTag:E}=K,ie=Y()({root:{width:300}});function le({track:o,feature:g,handleClose:v}){const{classes:M}=ie(),[z,V]=x.useState("0"),[j,C]=x.useState(),[m,k]=x.useState(),u=+z;x.useEffect(()=>{(async()=>{C(void 0);try{if(g.get("flags")&2048){const e=(E(g,"SA")||"").split(";")[0],[c,y]=e.split(","),{rpcManager:f}=R.getSession(o),N=T.getConf(o,"adapter"),p=X.getRpcSessionId(o),n=(await f.call(p,"CoreGetFeatures",{adapterConfig:N,sessionId:p,regions:[{refName:c,start:+y-1,end:+y}]})).find(i=>i.get("name")===g.get("name")&&!(i.get("flags")&2048)&&!(i.get("flags")&256));if(n)k(n);else throw new Error("primary feature not found")}else k(g)}catch(r){console.error(r),C(r)}})()},[g,o]);function _(){var r;try{if(!m)return;const e=m,c=R.getSession(o),y=R.getContainingView(o),f=e.get("CIGAR"),N=e.get("flags"),p=e.get("strand"),L=E(e,"SA")||"",n=e.get("name"),i=re(f,1),h=`${n}_assembly_${Date.now()}`,[l]=T.getConf(o,"assemblyNames"),G=[l,h],q=`track-${Date.now()}`,F=`${n}_vs_${l}`,{assemblyManager:B}=c,$=B.get(l);if(!$)throw new Error("assembly not found");const D=ne(L,e.id(),p,n,!0),S=e.toJSON();S.clipPos=i,S.strand=1,S.mate={refName:n,start:i,end:i+oe(f)};const A=N&2048?P(D[0].CIGAR):P(f),d=[S,...D];for(const[a,s]of d.entries())s.refName=$.getCanonicalRefName(s.refName)||s.refName,s.syntenyId=a,s.mate.syntenyId=a,s.mate.uniqueId=`${s.uniqueId}_mate`;d.sort((a,s)=>a.clipPos-s.clipPos);const H=e.get("seq"),O=[...d,...d.map(a=>a.mate)],J=2*u,Q=d.reduce((a,s)=>a+s.end-s.start+J,0),w=`${n}_${Date.now()}`,U=T.getConf($,"sequence"),W=R.gatherOverlaps(d.map(a=>({...a,start:Math.max(0,a.start-u),end:a.end+u,assemblyName:l})));(r=c.addTemporaryAssembly)===null||r===void 0||r.call(c,{name:h,sequence:{type:"ReferenceSequenceTrack",name:"Read sequence",trackId:w,assemblyNames:[h],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:A,seq:H||"",refName:n,uniqueId:`${Math.random()}`}]}}}),c.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:Q/y.width,displayedRegions:W,tracks:[{id:`${Math.random()}`,type:"ReferenceSequenceTrack",assemblyNames:[l],configuration:U.trackId,displays:[{id:`${Math.random()}`,type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:`${w}-LinearReferenceSequenceDisplay`}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:A/y.width,displayedRegions:[{assemblyName:h,start:0,end:A,refName:n}],tracks:[{id:`${Math.random()}`,type:"ReferenceSequenceTrack",configuration:w,displays:[{id:`${Math.random()}`,type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:`${w}-LinearReferenceSequenceDisplay`}]}]}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:G,adapter:{type:"FromConfigAdapter",features:O},trackId:q,name:F}],tracks:[{configuration:q,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:`${q}-LinearSyntenyDisplay`}]}],displayName:`${n} vs ${l}`}),v()}catch(e){console.error(e),C(e)}}return t.jsxs(Z.Dialog,{open:!0,onClose:v,title:"Set window size",children:[t.jsx(ee,{children:j?t.jsx(b,{color:"error",children:`${j}`}):m?t.jsxs("div",{className:M.root,children:[m.get("flags")&256?t.jsx(b,{style:{color:"orange"},children:"Note: You selected a secondary alignment (which generally does not have SA tags or SEQ fields) so do a full reconstruction of the alignment"}):null,t.jsx(b,{children:"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."}),t.jsx(ae,{value:u,onChange:r=>{V(r.target.value)},label:"Set window size"})]}):t.jsxs("div",{children:[t.jsx(b,{children:"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."}),t.jsx(te,{})]})}),t.jsxs(se,{children:[t.jsx(I,{variant:"contained",color:"secondary",onClick:v,children:"Cancel"}),t.jsx(I,{disabled:!m,variant:"contained",color:"primary",onClick:_,children:"Submit"})]})]})}export{le as default};
//# sourceMappingURL=LinearReadVsRef-B9BhDSTZ.js.map
