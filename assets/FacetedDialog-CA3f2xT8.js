import{o as S,m as H,a as M,j as e,ai as I,T as z,aj as N,u as v,al as W,am as y,cm as R,cc as D,cy as T,cx as G,bm as K,cz as L,d as O,cA as A,cl as $,c as F,D as V}from"./index-DPMJgfAS.js";import{S as b}from"./SanitizedHTML-DUNiQOoP.js";import{C as E}from"./Clear-sfBRBqSA.js";import{D as _}from"./DataGrid-BbeQwLC2.js";import{S as B,T as P}from"./HierarchicalTrackSelector-DLreuanE.js";import{G as U}from"./Grid-ZKIycoEu.js";import"./index-BHGTJiUw.js";import"./utils-DSyQ0Yxy.js";import"./getThemeProps-D2Hd2SEb.js";import"./MenuItem-BZgCoK98.js";import"./dividerClasses-CRpWzjDJ.js";import"./Divider-BsNHrm83.js";import"./Badge-HDwRQZRU.js";import"./TableCell-CTZZHzq1.js";import"./Star-BYiOoKvl.js";import"./Menu-CnlpItgw.js";import"./ArrowRight-DkOrl4wJ.js";import"./useThemeProps-64rT6H9Q.js";const q=H()(n=>({facet:{margin:0,marginLeft:n.spacing(2)},select:{marginBottom:n.spacing(2)}}));function J({onClick:n}){return e.jsx(W,{title:"Clear selection on this facet filter",children:e.jsx(y,{onClick:()=>{n()},size:"small",children:e.jsx(E,{})})})}function Q({visible:n,onClick:i}){return e.jsx(W,{title:"Minimize/expand this facet filter",children:e.jsx(y,{onClick:()=>{i()},size:"small",children:n?e.jsx(R,{}):e.jsx(D,{})})})}const X=S(function({column:n,vals:i,model:c}){const{classes:h}=q(),[m,f]=M.useState(!0),{faceted:u}=c,{filters:d}=u,{field:r}=n;return e.jsxs(I,{className:h.facet,fullWidth:!0,children:[e.jsxs("div",{children:[e.jsx(z,{component:"span",children:r}),e.jsx(J,{onClick:()=>{u.setFilter(r,[])}}),e.jsx(Q,{visible:m,onClick:()=>{f(!m)}})]}),m?e.jsx(N,{multiple:!0,native:!0,className:h.select,value:d.get(n.field)||[],onChange:l=>{u.setFilter(n.field,[...l.target.options].filter(p=>p.selected).map(p=>p.value))},children:i.sort((l,p)=>l[0].localeCompare(p[0])).map(([l,p])=>e.jsxs("option",{value:l,children:[v.coarseStripHTML(l)," (",p,")"]},l))}):null]})}),Y=S(function({rows:n,columns:i,model:c}){var h,m;const{faceted:f}=c,{filters:u}=f,d=i.slice(1),r=new Map(i.slice(1).map(s=>[s.field,new Map])),l=f.filters.keys(),p=d.map(s=>s.field),j=new Set;for(const s of l)!((h=u.get(s))===null||h===void 0)&&h.length&&j.add(s);for(const s of p)j.add(s);let o=n;for(const s of j){const a=r.get(s);if(a)for(const t of o){const x=T(s,t),C=a.get(x);x&&(C===void 0?a.set(x,1):a.set(x,C+1))}const g=!((m=u.get(s))===null||m===void 0)&&m.length?new Set(u.get(s)):void 0;o=o.filter(t=>g!==void 0?g.has(T(s,t)):!0)}return e.jsx("div",{children:d.map(s=>e.jsx(X,{vals:[...r.get(s.field)],column:s,model:c},s.field))})}),Z=S(function({model:n,columns:i,shownTrackIds:c,selection:h}){const{pluginManager:m}=v.getEnv(n),{view:f,faceted:u}=n,{rows:d,useShoppingCart:r,showOptions:l,filteredRows:p,filteredNonMetadataKeys:j,filteredMetadataKeys:o,visible:s}=u,[a,g]=M.useState({name:v.measureGridWidth(d.map(t=>t.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(j.filter(t=>s[t]).map(t=>[t,v.measureGridWidth(d.map(x=>x[t]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(o.filter(t=>s[`metadata.${t}`]).map(t=>[`metadata.${t}`,v.measureGridWidth(d.map(x=>x.metadata[t]),{maxWidth:400,stripHTML:!0})]))});return e.jsx(_,{rowHeight:25,columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,rows:p,columnVisibilityModel:s,showToolbar:l,onColumnWidthChange:t=>{g({...a,[t.colDef.field]:t.width})},onColumnVisibilityModelChange:t=>{n.faceted.setVisible(t)},onRowSelectionModelChange:t=>{if(r){const x=K(n),C=m.pluggableConfigSchemaType("track");n.setSelection([...t.ids].map(w=>L(C,x,w)))}else{const x=c,C=t.ids;G(()=>{[...x].filter(w=>!C.has(w)).map(w=>f.hideTrack(w)),[...C].filter(w=>!x.has(w)).map(w=>{f.showTrack(w),n.addToRecentlyUsed(w)})})}},rowSelectionModel:{type:"include",ids:new Set(r?h.map(t=>t.trackId):[...c])},columns:i.map(t=>({...t,width:a[t.field]}))})});function ee({model:n}){const{faceted:i}=n,[c,h]=M.useState(null),{showOptions:m,showFilters:f,showSparse:u,useShoppingCart:d}=i;return e.jsxs(e.Fragment,{children:[e.jsxs(U,{container:!0,spacing:4,alignItems:"center",children:[e.jsx(O,{label:"Search...",value:i.filterText,onChange:r=>{i.setFilterText(r.target.value)},slotProps:{input:{endAdornment:e.jsx(A,{position:"end",children:e.jsx(y,{onClick:()=>{i.setFilterText("")},children:e.jsx(E,{})})})}}}),e.jsx(y,{onClick:r=>{h(r.currentTarget)},children:e.jsx($,{})}),e.jsx(B,{model:n})]}),e.jsx(F.Menu,{anchorEl:c,open:!!c,onClose:()=>{h(null)},onMenuItemClick:(r,l)=>{l(),h(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{i.setUseShoppingCart(!d)},type:"checkbox",checked:d},{label:"Show sparse metadata columns",onClick:()=>{i.setShowSparse(!u)},checked:u,type:"checkbox"},{label:"Show facet filters",onClick:()=>{i.setShowFilters(!f)},checked:f,type:"checkbox"},{label:"Show extra table options",onClick:()=>{i.setShowOptions(!m)},checked:m,type:"checkbox"}]})]})}const te=H()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),k=.75,se=S(function({model:i}){const{classes:c}=te(),{selection:h,shownTrackIds:m,faceted:f}=i,{rows:u,panelWidth:d,showFilters:r,filteredNonMetadataKeys:l,filteredMetadataKeys:p}=f,j=[{field:"name",hideable:!1,renderCell:o=>{const{value:s,row:a}=o,{id:g,conf:t}=a;return e.jsxs("div",{className:c.cell,children:[e.jsx(b,{html:s}),e.jsx(P,{id:g,conf:t,trackId:g,model:i})]})}},...l.map(o=>({field:o,renderCell:s=>{const a=s.value;return a?e.jsx(b,{className:c.cell,html:a}):""}})),...p.map(o=>({field:`metadata.${o}`,headerName:["name",...l].includes(o)?`${o} (from metadata)`:o,valueGetter:(s,a)=>{var g;return`${(g=a.metadata[o])!==null&&g!==void 0?g:""}`},renderCell:s=>{const a=s.value;return a?e.jsx(b,{className:c.cell,html:a}):""}}))];return e.jsxs(e.Fragment,{children:[e.jsx(ee,{model:i}),e.jsxs("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*k,width:window.innerWidth*k},children:[e.jsx("div",{style:{height:window.innerHeight*k,width:window.innerWidth*k-(r?d:0)},children:e.jsx(Z,{model:i,columns:j,shownTrackIds:m,selection:h})}),r?e.jsxs(e.Fragment,{children:[e.jsx(F.ResizeHandle,{vertical:!0,onDrag:o=>f.setPanelWidth(d-o),className:c.resizeHandle}),e.jsx("div",{style:{width:d,overflow:"auto"},children:e.jsx(Y,{model:i,rows:u,columns:j})})]}):null]})]})}),ve=S(function(n){const{handleClose:i}=n;return e.jsx(F.Dialog,{open:!0,onClose:i,maxWidth:"xl",title:"Faceted track selector",children:e.jsx(V,{children:e.jsx(se,{...n})})})});export{ve as default};
//# sourceMappingURL=FacetedDialog-CA3f2xT8.js.map
