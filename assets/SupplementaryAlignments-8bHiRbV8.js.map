{"version":3,"mappings":"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","names":["getSAFeatures","view","feature","_a","assemblyManager","getSession","cigar","origStrand","SA","readName","clipPos","getClip","assembly","suppAlns","featurizeSA","feat","getLengthSansClipping","features","idx","f","a","b","BreakendMultiLevelOptionDialog","lazy","__vitePreload","n","BreakendSingleLevelOptionDialog","LaunchBreakpointSplitViewPanel","model","res","setRes","useState","error","setError","useEffect","feats","SimpleFeature","e","ret","i","_jsxs","_jsx","Typography","ErrorMessage","arg","index","f1","f2","toLocale","TopBottomSplitViewLink","SideBySideViewLink","Link","event","session","handleClose","SupplementaryAlignmentsLocStrings","tag","saRef","saStart","saStrand","saCigar","saLength","getLengthOnRef","extra","start","end","sp","ep","locString","displayStart","displayEnd","displayString","navToLoc","SupplementaryAlignments","props","pluginManager","getEnv","hasBreakendSplitView","BaseCard"],"ignoreList":[0,1,2,3],"sources":["../../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/getSAFeatures.js","../../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/LaunchSupplementaryAlignmentBreakpointSplitViewPanel.js","../../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/SupplementaryAlignmentsLocStrings.js","../../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/SupplementaryAlignments.js"],"sourcesContent":["import { getSession } from '@jbrowse/core/util';\nimport { featurizeSA, getClip, getLengthSansClipping } from '../MismatchParser';\nexport async function getSAFeatures({ view, feature, }) {\n    var _a;\n    const { assemblyManager } = getSession(view);\n    const cigar = feature.get('CIGAR');\n    const origStrand = feature.get('strand');\n    const SA = ((_a = feature.get('tags')) === null || _a === void 0 ? void 0 : _a.SA) || '';\n    const readName = feature.get('name');\n    const clipPos = getClip(cigar, 1);\n    const assembly = await assemblyManager.waitForAssembly(view.assemblyNames[0]);\n    if (!assembly) {\n        throw new Error('assembly not found');\n    }\n    const suppAlns = featurizeSA(SA, feature.id(), origStrand, readName, true);\n    const feat = feature.toJSON();\n    feat.clipPos = clipPos;\n    feat.strand = 1;\n    feat.mate = {\n        refName: readName,\n        start: clipPos,\n        end: clipPos + getLengthSansClipping(cigar),\n    };\n    const features = [feat, ...suppAlns];\n    for (const [idx, f] of features.entries()) {\n        f.refName = assembly.getCanonicalRefName(f.refName) || f.refName;\n        f.syntenyId = idx;\n        f.mate.syntenyId = idx;\n        f.mate.uniqueId = `${f.uniqueId}_mate`;\n    }\n    features.sort((a, b) => a.clipPos - b.clipPos);\n    return features;\n}\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { lazy, useEffect, useState } from 'react';\nimport { ErrorMessage } from '@jbrowse/core/ui';\nimport { SimpleFeature, getSession, toLocale } from '@jbrowse/core/util';\nimport { Link, Typography } from '@mui/material';\nimport { getSAFeatures } from './getSAFeatures';\nconst BreakendMultiLevelOptionDialog = lazy(() => import('./BreakendMultiLevelOptionDialog'));\nconst BreakendSingleLevelOptionDialog = lazy(() => import('./BreakendSingleLevelOptionDialog'));\nexport default function LaunchBreakpointSplitViewPanel({ model, feature, }) {\n    const { view } = model;\n    const [res, setRes] = useState();\n    const [error, setError] = useState();\n    useEffect(() => {\n        ;\n        (async () => {\n            try {\n                const feats = await getSAFeatures({\n                    view,\n                    feature: new SimpleFeature(feature),\n                });\n                setRes(feats);\n            }\n            catch (e) {\n                setError(e);\n                console.error(e);\n            }\n        })();\n    }, [feature, view]);\n    const ret = [];\n    if (res) {\n        for (let i = 0; i < res.length - 1; i++) {\n            ret.push([res[i], res[i + 1]]);\n        }\n    }\n    return ret.length ? (_jsxs(\"div\", { children: [_jsx(Typography, { children: \"Launch split view\" }), error ? _jsx(ErrorMessage, { error: error }) : null, _jsx(\"ul\", { children: ret.map((arg, index) => {\n                    const [f1, f2] = arg;\n                    return (_jsxs(\"li\", { children: [f1.refName, \":\", toLocale(f1.strand === 1 ? f1.end : f1.start), \" ->\", ' ', f2.refName, \":\", toLocale(f2.strand === 1 ? f2.start : f2.end), ' ', _jsx(TopBottomSplitViewLink, { model: model, f1: f1, f2: f2 }), ' ', _jsx(SideBySideViewLink, { model: model, f1: f1, f2: f2 })] }, `${JSON.stringify(arg)}-${index}`));\n                }) })] })) : null;\n}\nfunction TopBottomSplitViewLink({ model, f1, f2, }) {\n    return (_jsx(Link, { href: \"#\", onClick: event => {\n            event.preventDefault();\n            const session = getSession(model);\n            session.queueDialog(handleClose => [\n                BreakendMultiLevelOptionDialog,\n                {\n                    handleClose,\n                    session,\n                    feature: new SimpleFeature({ ...f1, mate: f2 }),\n                    view: model.view,\n                    assemblyName: model.view.displayedRegions[0].assemblyName,\n                },\n            ]);\n        }, children: \"(top/bottom)\" }));\n}\nfunction SideBySideViewLink({ model, f1, f2, }) {\n    return (_jsx(Link, { href: \"#\", onClick: event => {\n            event.preventDefault();\n            const session = getSession(model);\n            session.queueDialog(handleClose => [\n                BreakendSingleLevelOptionDialog,\n                {\n                    handleClose,\n                    session,\n                    feature: new SimpleFeature({ ...f1, mate: f2 }),\n                    view: model.view,\n                    assemblyName: model.view.displayedRegions[0].assemblyName,\n                },\n            ]);\n        }, children: \"(single row)\" }));\n}\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Link, Typography } from '@mui/material';\nimport { getLengthOnRef } from '../MismatchParser';\nimport { navToLoc } from './util';\nexport default function SupplementaryAlignmentsLocStrings({ tag, model, }) {\n    return (_jsxs(\"div\", { children: [_jsx(Typography, { children: \"List of supplementary alignment locations\" }), _jsx(\"ul\", { children: tag\n                    .split(';')\n                    .filter(SA => !!SA)\n                    .map((SA, idx) => {\n                    const [saRef, saStart, saStrand, saCigar] = SA.split(',');\n                    const saLength = getLengthOnRef(saCigar);\n                    const extra = Math.floor(saLength / 5);\n                    const start = +saStart;\n                    const end = +saStart + saLength;\n                    const sp = start - extra;\n                    const ep = end + extra;\n                    const locString = `${saRef}:${Math.max(1, sp)}-${ep}`;\n                    const displayStart = start.toLocaleString('en-US');\n                    const displayEnd = end.toLocaleString('en-US');\n                    const displayString = `${saRef}:${displayStart}-${displayEnd} (${saStrand}) [${saLength}bp]`;\n                    return (_jsx(\"li\", { children: _jsx(Link, { href: \"#\", onClick: async (event) => {\n                                event.preventDefault();\n                                navToLoc(locString, model);\n                            }, children: displayString }) }, `${locString}-${idx}`));\n                }) })] }));\n}\n","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport BaseCard from '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail/BaseCard';\nimport { getEnv, getSession } from '@jbrowse/core/util';\nimport LaunchBreakpointSplitViewPanel from './LaunchSupplementaryAlignmentBreakpointSplitViewPanel';\nimport SupplementaryAlignmentsLocStrings from './SupplementaryAlignmentsLocStrings';\nexport default function SupplementaryAlignments(props) {\n    const { model, tag, feature } = props;\n    const session = getSession(model);\n    const { pluginManager } = getEnv(session);\n    let hasBreakendSplitView = false;\n    try {\n        hasBreakendSplitView = !!pluginManager.getViewType('BreakpointSplitView');\n    }\n    catch (e) {\n    }\n    return (_jsxs(BaseCard, { ...props, title: \"Supplementary alignments\", children: [_jsx(SupplementaryAlignmentsLocStrings, { model: model, tag: tag }), hasBreakendSplitView ? (_jsx(LaunchBreakpointSplitViewPanel, { model: model, feature: feature })) : null] }));\n}\n"],"file":"assets/SupplementaryAlignments-8bHiRbV8.js"}