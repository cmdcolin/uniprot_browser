import{T as w}from"./tabixIndexedFile-asPy8vdj.js";import"./unzip-OY3UkAtn.js";import{B as L}from"./index-CWy9Wmpn.js";import{ah as m,u}from"./index-B3kPj2Rj.js";import{r as k}from"./rxjs-bJg6jVuh.js";import{S as v}from"./index-B6UxCU0Z.js";import{a as E}from"./util-BvfoyAKL.js";import"./AbortablePromiseCache-CQdc8xcb.js";import"./browser-DdKr-yeI.js";import"./remoteFile-DJNFoLH1.js";import"./index-BzItsYpE.js";class I extends L.BaseFeatureDataAdapter{constructor(e,s,o){super(e,s,o);const i=this.getConf("pifGzLocation"),a=this.getConf(["index","indexType"]),n=this.getConf(["index","location"]),t=this.pluginManager;this.pif=new w({filehandle:m.openLocation(i,t),csiFilehandle:a==="CSI"?m.openLocation(n,t):void 0,tbiFilehandle:a!=="CSI"?m.openLocation(n,t):void 0,chunkCacheSize:50*2**20})}async getHeader(e){const{statusCallback:s=()=>{}}=e||{};return u.updateStatus("Downloading header",s,()=>this.pif.getHeader())}getAssemblyNames(){const e=this.getConf("assemblyNames");return e.length===0?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:e}async hasDataForRefName(){return!0}async getRefNames(e={}){var s,o;const i=(o=(s=e.regions)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.assemblyName;if(!i)throw new Error("no assembly name provided");const a=this.getAssemblyNames().indexOf(i),n=await this.pif.getReferenceSequenceNames(e);return a===0?n.filter(t=>t.startsWith("q")).map(t=>t.slice(1)):a===1?n.filter(t=>t.startsWith("t")).map(t=>t.slice(1)):[]}getFeatures(e,s={}){const{statusCallback:o=()=>{}}=s;return k.ObservableCreate(async i=>{const{assemblyName:a}=e,n=this.getAssemblyNames(),c=n.indexOf(a)===0,h=c?"q":"t";await u.updateStatus("Downloading features",o,()=>this.pif.getLines(h+e.refName,e.start,e.end,{lineCallback:(g,l)=>{const r=E(g),y=r.qname.slice(1),b=r.qstart,x=r.qend,N=r.tname,C=r.tstart,A=r.tend,{extra:d,strand:F}=r,{numMatches:p=0,blockLen:f=1,cg:R,...S}=d;i.next(new v({uniqueId:l+a,assemblyName:a,start:b,end:x,type:"match",refName:y,strand:F,...S,CIGAR:d.cg,syntenyId:l,identity:p/f,numMatches:p,blockLen:f,mate:{start:C,end:A,refName:N,assemblyName:n[+c]}}))},stopToken:s.stopToken})),i.complete()})}}I.capabilities=["getFeatures","getRefNames"];export{I as default};
//# sourceMappingURL=PairwiseIndexedPAFAdapter-BmlyjYXL.js.map
