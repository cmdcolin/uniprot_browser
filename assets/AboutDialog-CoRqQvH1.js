import{U as M,cL as D,a as l,u as p,y as d,j as t,c as C,m as E,B as h,aQ as y,o as A,t as N,D as O}from"./index-B3kPj2Rj.js";import{D as R}from"./Dialog-DJdPJHWJ.js";import{B as j}from"./BaseCard-D1jVHuu1.js";var P=D();const b=M(P);function U({config:e}){const[n,s]=l.useState(),[o,c]=l.useState(),r=p.getSession(e),{rpcManager:u}=r;l.useEffect(()=>{(async()=>{try{const i=d.readConfObject(e,"adapter"),f=await u.call(e.trackId,"CoreGetInfo",{adapterConfig:i});c(f)}catch(i){console.error(i),s(i)}})()},[e,u]);const x=typeof o=="string"?{header:`<pre>${o.replaceAll("<","&lt;").replaceAll(">","&gt;")}</pre>`}:o||{};return t.jsx(j,{title:"File info",children:n?t.jsx(C.ErrorMessage,{error:n}):o===void 0?t.jsx(C.LoadingEllipses,{message:"Loading file data"}):t.jsx(b,{attributes:x})})}function v(e,n){for(const s in e)s===n?delete e[s]:typeof e[s]=="object"&&v(e[s],n);return e}function F({config:e,pluginManager:n}){const s=p.getSession(e),o=d.readConfObject(e);return n.evaluateExtensionPoint("Core-customizeAbout",{config:{...o,...d.getConf(s,["formatAbout","config"],{config:o}),...d.readConfObject(e,["formatAbout","config"],{config:o})}},{session:s,config:e})}const I=E()({button:{float:"right"}});function $({conf:e,setShowRefNames:n}){const[s,o]=l.useState(!1),{classes:c}=I();return t.jsxs("span",{className:c.button,children:[t.jsx(h,{variant:"contained",color:"secondary",onClick:()=>{n(!0)},children:"Show ref names"}),t.jsx(h,{variant:"contained",onClick:()=>{const r=v(structuredClone(e),"baseUri");y(JSON.stringify(r,null,2)),o(!0),setTimeout(()=>{o(!1)},1e3)},children:s?"Copied to clipboard!":"Copy config"})]})}const S=1e4,B=E()(e=>({container:{minWidth:800},refNames:{maxHeight:300,overflow:"auto",flexGrow:1,background:e.palette.background.default}})),L=A(function({config:e,onClose:n}){const{classes:s}=B(),[o,c]=l.useState(),[r,u]=l.useState(),[x,i]=l.useState(!1),{rpcManager:f}=p.getSession(e);l.useEffect(()=>{(async()=>{try{const a=await Promise.all([...new Set(N.getConfAssemblyNames(e))].map(async m=>{const w=d.readConfObject(e,"adapter");return[m,await f.call(e.trackId,"CoreGetRefNames",{adapterConfig:w,regions:[{assemblyName:m}]})]}));u(Object.fromEntries(a))}catch(a){console.error(a),c(a)}})()},[e,f]);const g=r?Object.entries(r):[],k=g.flatMap(([a,m])=>[`--- ${a} ---`,...m.slice(0,S),m.length>S?`
Too many refNames to show in browser for ${a}, use "Copy ref names" button to copy to clipboard`:""]).filter(a=>!!a).join(`
`);return t.jsx(C.Dialog,{open:!0,title:"Reference sequence names used in track",onClose:n,maxWidth:"xl",children:t.jsx(O,{className:s.container,children:o?t.jsx(C.ErrorMessage,{error:o}):r===void 0?t.jsx(C.LoadingEllipses,{message:"Loading refNames"}):t.jsxs(t.Fragment,{children:[t.jsx(h,{variant:"contained",onClick:()=>{y(g.flatMap(([a,m])=>[`--- ${a} ---`,...m]).filter(a=>!!a).join(`
`)),i(!0),setTimeout(()=>{i(!1)},1e3)},children:x?"Copied to clipboard!":"Copy ref names"}),t.jsx("pre",{className:s.refNames,children:k})]})})})}),T=E()({content:{minWidth:800}}),W=A(function({config:e}){const n=d.readConfObject(e),s=p.getSession(e),{classes:o}=T(),[c,r]=l.useState(!1),u=d.getConf(s,["formatAbout","hideUris"])||d.readConfObject(e,["formatAbout","hideUris"]),{pluginManager:x}=p.getEnv(s),i=F({config:e,pluginManager:x}),f=x.evaluateExtensionPoint("Core-extraAboutPanel",null,{session:s,config:e}),g=["displays","baseUri","refNames","formatAbout"];return t.jsxs("div",{className:o.content,children:[t.jsxs(j,{title:"Configuration",children:[u?null:t.jsx($,{conf:n,setShowRefNames:r}),t.jsx(b,{attributes:i.config,omit:[...g,"metadata"],hideUris:u})]}),i.config.metadata?t.jsx(j,{title:"Metadata",children:t.jsx(b,{attributes:i.config.metadata,omit:g,hideUris:u})}):null,f?t.jsx(j,{title:f.name,children:t.jsx(f.Component,{config:e})}):null,t.jsx(U,{config:e}),c?t.jsx(L,{config:e,onClose:()=>{r(!1)}}):null]})});function _({config:e,handleClose:n}){const s=p.getSession(e),o=N.getTrackName(e,s),{pluginManager:c}=p.getEnv(s),r=c.evaluateExtensionPoint("Core-replaceAbout",W,{session:s,config:e});return t.jsx(R,{open:!0,onClose:n,title:o,maxWidth:"xl",children:t.jsx(r,{config:e})})}export{_ as default};
//# sourceMappingURL=AboutDialog-CoRqQvH1.js.map
