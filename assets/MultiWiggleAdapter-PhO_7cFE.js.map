{"version":3,"file":"MultiWiggleAdapter-PhO_7cFE.js","sources":["../../node_modules/@jbrowse/plugin-wiggle/esm/MultiWiggleAdapter/MultiWiggleAdapter.js"],"sourcesContent":["import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter';\nimport { SimpleFeature, max, min } from '@jbrowse/core/util';\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs';\nimport { merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\nfunction getFilename(uri) {\n    const filename = uri.slice(uri.lastIndexOf('/') + 1);\n    return filename.slice(0, filename.lastIndexOf('.'));\n}\nclass MultiWiggleAdapter extends BaseFeatureDataAdapter {\n    async getAdapters() {\n        const getSubAdapter = this.getSubAdapter;\n        if (!getSubAdapter) {\n            throw new Error('no getSubAdapter available');\n        }\n        let subConfs = this.getConf('subadapters');\n        if (!(subConfs === null || subConfs === void 0 ? void 0 : subConfs.length)) {\n            const entries = this.getConf('bigWigs');\n            subConfs = entries.map(entry => ({\n                type: 'BigWigAdapter',\n                source: getFilename(entry),\n                bigWigLocation: {\n                    uri: entry,\n                },\n            }));\n        }\n        return Promise.all(subConfs.map(async (conf) => {\n            const dataAdapter = (await getSubAdapter(conf))\n                .dataAdapter;\n            return {\n                source: conf.name || dataAdapter.id,\n                ...conf,\n                dataAdapter,\n            };\n        }));\n    }\n    async getRefNames(opts) {\n        const adapters = await this.getAdapters();\n        const allNames = await Promise.all(adapters.map(a => a.dataAdapter.getRefNames(opts)));\n        return [...new Set(allNames.flat())];\n    }\n    async getGlobalStats(opts) {\n        const adapters = await this.getAdapters();\n        const stats = (await Promise.all(adapters.map(adp => { var _a, _b; return (_b = (_a = adp.dataAdapter).getGlobalStats) === null || _b === void 0 ? void 0 : _b.call(_a, opts); }))).filter(f => !!f);\n        const scoreMin = min(stats.map(s => s.scoreMin));\n        const scoreMax = max(stats.map(s => s.scoreMax));\n        return {\n            scoreMin,\n            scoreMax,\n        };\n    }\n    getFeatures(region, opts = {}) {\n        return ObservableCreate(async (observer) => {\n            const adapters = await this.getAdapters();\n            merge(...adapters.map(adp => adp.dataAdapter.getFeatures(region, opts).pipe(map(p => p.get('source')\n                ? p\n                : new SimpleFeature({\n                    ...p.toJSON(),\n                    uniqueId: `${adp.source}-${p.id()}`,\n                    source: adp.source,\n                }))))).subscribe(observer);\n        }, opts.stopToken);\n    }\n    async getMultiRegionFeatureDensityStats(_regions) {\n        return {\n            featureDensity: 0,\n        };\n    }\n    async getSources(_regions) {\n        const adapters = await this.getAdapters();\n        return adapters.map(({ dataAdapter, source, name, ...rest }) => ({\n            name: source,\n            __name: name,\n            ...rest,\n        }));\n    }\n}\nMultiWiggleAdapter.capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n];\nexport default MultiWiggleAdapter;\n"],"names":["getFilename","uri","filename","MultiWiggleAdapter","BaseFeatureDataAdapter","getSubAdapter","subConfs","entry","conf","dataAdapter","opts","adapters","allNames","a","stats","adp","_a","_b","f","scoreMin","min","s","scoreMax","max","region","ObservableCreate","observer","merge","map","p","SimpleFeature","_regions","source","name","rest"],"mappings":"uMAKA,SAASA,EAAYC,EAAK,CACtB,MAAMC,EAAWD,EAAI,MAAMA,EAAI,YAAY,GAAG,EAAI,CAAC,EACnD,OAAOC,EAAS,MAAM,EAAGA,EAAS,YAAY,GAAG,CAAC,CACtD,CACA,MAAMC,UAA2BC,EAAAA,sBAAuB,CACpD,MAAM,aAAc,CAChB,MAAMC,EAAgB,KAAK,cAC3B,GAAI,CAACA,EACD,MAAM,IAAI,MAAM,4BAA4B,EAEhD,IAAIC,EAAW,KAAK,QAAQ,aAAa,EACzC,OAA0DA,GAAS,SAE/DA,EADgB,KAAK,QAAQ,SAAS,EACnB,IAAIC,IAAU,CAC7B,KAAM,gBACN,OAAQP,EAAYO,CAAK,EACzB,eAAgB,CACZ,IAAKA,CACzB,CACA,EAAc,GAEC,QAAQ,IAAID,EAAS,IAAI,MAAOE,GAAS,CAC5C,MAAMC,GAAe,MAAMJ,EAAcG,CAAI,GACxC,YACL,MAAO,CACH,OAAQA,EAAK,MAAQC,EAAY,GACjC,GAAGD,EACH,YAAAC,CAChB,CACQ,CAAC,CAAC,CACN,CACA,MAAM,YAAYC,EAAM,CACpB,MAAMC,EAAW,MAAM,KAAK,YAAW,EACjCC,EAAW,MAAM,QAAQ,IAAID,EAAS,IAAIE,GAAKA,EAAE,YAAY,YAAYH,CAAI,CAAC,CAAC,EACrF,MAAO,CAAC,GAAG,IAAI,IAAIE,EAAS,KAAI,CAAE,CAAC,CACvC,CACA,MAAM,eAAeF,EAAM,CACvB,MAAMC,EAAW,MAAM,KAAK,YAAW,EACjCG,GAAS,MAAM,QAAQ,IAAIH,EAAS,IAAII,GAAO,CAAE,IAAIC,EAAIC,EAAI,OAAQA,GAAMD,EAAKD,EAAI,aAAa,kBAAoB,MAAQE,IAAO,OAAS,OAASA,EAAG,KAAKD,EAAIN,CAAI,CAAG,CAAC,CAAC,GAAG,OAAOQ,GAAK,CAAC,CAACA,CAAC,EAC7LC,EAAWC,EAAAA,IAAIN,EAAM,IAAIO,GAAKA,EAAE,QAAQ,CAAC,EACzCC,EAAWC,EAAAA,IAAIT,EAAM,IAAIO,GAAKA,EAAE,QAAQ,CAAC,EAC/C,MAAO,CACH,SAAAF,EACA,SAAAG,CACZ,CACI,CACA,YAAYE,EAAQd,EAAO,GAAI,CAC3B,OAAOe,EAAAA,iBAAiB,MAAOC,GAAa,CACxC,MAAMf,EAAW,MAAM,KAAK,YAAW,EACvCgB,EAAM,GAAGhB,EAAS,IAAII,GAAOA,EAAI,YAAY,YAAYS,EAAQd,CAAI,EAAE,KAAKkB,EAAIC,GAAKA,EAAE,IAAI,QAAQ,EAC7FA,EACA,IAAIC,gBAAc,CAChB,GAAGD,EAAE,OAAM,EACX,SAAU,GAAGd,EAAI,MAAM,IAAIc,EAAE,GAAE,CAAE,GACjC,OAAQd,EAAI,MAChC,CAAiB,CAAC,CAAC,CAAC,CAAC,EAAE,UAAUW,CAAQ,CACjC,EAAGhB,EAAK,SAAS,CACrB,CACA,MAAM,kCAAkCqB,EAAU,CAC9C,MAAO,CACH,eAAgB,CAC5B,CACI,CACA,MAAM,WAAWA,EAAU,CAEvB,OADiB,MAAM,KAAK,YAAW,GACvB,IAAI,CAAC,CAAE,YAAAtB,EAAa,OAAAuB,EAAQ,KAAAC,EAAM,GAAGC,MAAY,CAC7D,KAAMF,EACN,OAAQC,EACR,GAAGC,CACf,EAAU,CACN,CACJ,CACA/B,EAAmB,aAAe,CAC9B,gBACA,gBACA,gBACJ","x_google_ignoreList":[0]}