const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SyntenyTooltip-CabDKrsl.js","./index-DPMJgfAS.js","./index-DHgBXOEh.css"])))=>i.map(i=>d[i]);
import{m as j,j as o,u as E,c as F,o as z,a,cx as A,_ as ae}from"./index-DPMJgfAS.js";import{o as oe,b as ie,M as O,g as ce,c as Y}from"./drawSynteny-BTkU0Zz6.js";const ue=j()({blockError:{background:"#f1f1f1",padding:10,color:"red"}});function le({error:e}){const{classes:n}=ue();return o.jsx("div",{className:n.blockError,children:`${e}`})}const fe=j()(e=>{const n=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${n} 5px, ${n} 10px)`,textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:10}}});function ge({messageText:e}){const{classes:n}=fe();return o.jsx("div",{className:n.blockMessage,children:e})}function de({model:e,onClose:n,anchorEl:M}){const c=E.getContainingView(e),{clientX:g,clientY:p,feature:u}=M;return o.jsx(F.Menu,{onMenuItemClick:(s,i)=>{i(s),n()},anchorEl:{nodeType:1,getBoundingClientRect:()=>{const s=g,i=p;return{top:i,left:s,bottom:i,right:s,width:0,height:0,x:s,y:i,toJSON(){}}}},onClose:n,open:!!M,menuItems:[{label:"Center on feature",onClick:()=>{const{f:s}=u,i=s.get("start"),h=s.get("end"),k=s.get("refName"),x=s.get("mate"),b=c.views[e.level],m=c.views[e.level+1],S=b.assemblyNames[0],y=m.assemblyNames[0];b.navToLocString(`${k}:${i}-${h}`).catch(d=>{const l=`${S}:${d}`;console.error(S,l),E.getSession(e).notifyError(l,d)}),m.navToLocString(`${x.refName}:${x.start}-${x.end}`).catch(d=>{const l=`${y}:${d}`;console.error(y,l),E.getSession(e).notifyError(l,d)})}}]})}const pe=a.lazy(()=>ae(()=>import("./SyntenyTooltip-CabDKrsl.js"),__vite__mapDeps([0,1,2]),import.meta.url)),ve=j()({pix:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},rel:{position:"relative"},mouseoverCanvas:{position:"absolute",pointEvents:"none"},mainCanvas:{position:"absolute"}}),xe=z(function({model:e}){const{classes:n}=ve(),{mouseoverId:M,height:c}=e,g=a.useRef(0),p=E.getContainingView(e),u=p.width,s=a.useRef(0),i=a.useRef(!1),h=a.useRef(null),[k,x]=a.useState(),[b,m]=a.useState(""),[S,y]=a.useState(),[d,l]=a.useState(),[X,N]=a.useState(),[V,q]=a.useState(),w=a.useRef(null),G=a.useCallback(t=>{e.setMouseoverCanvasRef(t)},[e,c,u]),J=a.useCallback(t=>{e.setMainCanvasRef(t),w.current=t},[e,c,u]);a.useEffect(()=>{var t;function C(r){if(r.preventDefault(),r.ctrlKey){s.current+=r.deltaY/500;for(const f of p.views)f.setScaleFactor(s.current<0?1-s.current:1/(1+s.current));h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{var f;for(const v of p.views)v.setScaleFactor(1),v.zoomTo(s.current>0?v.bpPerPx*(1+s.current):v.bpPerPx/(1-s.current),r.clientX-(((f=w.current)===null||f===void 0?void 0:f.getBoundingClientRect().left)||0));s.current=0},300)}else Math.abs(r.deltaY)<Math.abs(r.deltaX)&&(g.current+=r.deltaX/2),i.current||(i.current=!0,window.requestAnimationFrame(()=>{A(()=>{for(const f of p.views)f.horizontalScroll(g.current);g.current=0,i.current=!1})}))}return(t=w.current)===null||t===void 0||t.addEventListener("wheel",C),()=>{var r;(r=w.current)===null||r===void 0||r.removeEventListener("wheel",C)}},[e,c,u]);const K=a.useCallback(t=>{e.setClickMapCanvasRef(t)},[e,c,u]),U=a.useCallback(t=>{e.setCigarClickMapCanvasRef(t)},[e,c,u]);return o.jsxs("div",{className:n.rel,children:[o.jsx("canvas",{ref:G,width:u,height:c,className:n.mouseoverCanvas}),o.jsx("canvas",{ref:J,onMouseMove:t=>{var C;if(d!==void 0)g.current+=d-t.clientX,l(t.clientX),i.current||(i.current=!0,window.requestAnimationFrame(()=>{A(()=>{for(const r of p.views)r.horizontalScroll(g.current);g.current=0,i.current=!1})}));else{const r=e.clickMapCanvas,f=e.cigarClickMapCanvas;if(!r||!f)return;const v=r.getBoundingClientRect(),_=r.getContext("2d"),I=f.getContext("2d");if(!_||!I)return;const{clientX:L,clientY:T}=t,D=L-v.left,B=T-v.top;y(L),q(T);const[W,H,Q]=_.getImageData(D,B,1,1).data,[Z,ee,te]=I.getImageData(D,B,1,1).data,ne=Math.floor(O/e.numFeats),R=Y(W,H,Q,ne);if(e.setMouseoverId((C=e.featPositions[R])===null||C===void 0?void 0:C.f.id()),R===-1)m("");else if(e.featPositions[R]){const{f:se,cigar:$}=e.featPositions[R],re=Math.floor(O/$.length),P=Y(Z,ee,te,re);m(ce({feature:se,cigarOp:$[P],cigarOpLen:$[P+1]}))}}},onMouseLeave:()=>{e.setMouseoverId(void 0),N(void 0),l(void 0)},onMouseDown:t=>{l(t.clientX),N(t.clientX)},onMouseUp:t=>{l(void 0),X!==void 0&&Math.abs(t.clientX-X)<5&&ie(t,e)},onContextMenu:t=>{oe(t,e,x)},"data-testid":"synteny_canvas",className:n.mainCanvas,width:u,height:c}),o.jsx("canvas",{ref:K,className:n.pix,width:u,height:c}),o.jsx("canvas",{ref:U,className:n.pix,width:u,height:c}),M&&b&&S&&V?o.jsx(pe,{title:b}):null,k?o.jsx(de,{model:e,anchorEl:k,onClose:()=>{x(void 0)}}):null]})}),Ce=j()(e=>{const n=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${n} 5px, ${n} 10px)`,textAlign:"center"}}});function he({message:e}){const{classes:n}=Ce();return o.jsx("div",{className:n.loading,children:o.jsx(F.LoadingEllipses,{message:e})})}const Me=z(function({model:e}){return e.error?o.jsx(le,{error:e.error}):e.message?o.jsx(ge,{messageText:e.message}):e.features?o.jsx(xe,{model:e}):o.jsx(he,{message:e.loadingStatus})});export{Me as default};
//# sourceMappingURL=Component-CbfHFXkQ.js.map
