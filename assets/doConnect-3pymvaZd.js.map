{"version":3,"file":"doConnect-3pymvaZd.js","sources":["../../node_modules/@jbrowse/plugin-data-management/esm/JB2TrackHubConnection/addRelativeUris.js","../../node_modules/@jbrowse/plugin-data-management/esm/JB2TrackHubConnection/util.js","../../node_modules/@jbrowse/plugin-data-management/esm/JB2TrackHubConnection/doConnect.js"],"sourcesContent":["export function addRelativeUris(config, base) {\n    if (typeof config === 'object' && config !== null) {\n        for (const key of Object.keys(config)) {\n            if (typeof config[key] === 'object' && config[key] !== null) {\n                addRelativeUris(config[key], base);\n            }\n            else if (key === 'uri') {\n                config.baseUri = base.href;\n            }\n        }\n    }\n}\n","import { GenomesFile, TrackDbFile } from '@gmod/ucsc-hub';\nimport { openLocation } from '@jbrowse/core/util/io';\nexport async function fetchGenomesFile(genomesLoc) {\n    const genomesFileText = await openLocation(genomesLoc).readFile('utf8');\n    return new GenomesFile(genomesFileText);\n}\nexport async function fetchTrackDbFile(trackDbLoc) {\n    const text = await openLocation(trackDbLoc).readFile('utf8');\n    return new TrackDbFile(text);\n}\nexport function makeLoc(first, base) {\n    return {\n        uri: new URL(first, new URL(base.uri, base.baseUri)).href,\n        locationType: 'UriLocation',\n    };\n}\nexport function makeLocAlt(first, alt, base) {\n    return first ? makeLoc(first, base) : makeLoc(alt, base);\n}\nexport function makeLoc2(first, alt) {\n    return first\n        ? {\n            uri: first,\n            locationType: 'LocalPath',\n        }\n        : {\n            uri: alt,\n            locationType: 'UriLocation',\n        };\n}\nexport function resolve(uri, baseUri) {\n    return new URL(uri, baseUri).href;\n}\n","import { getConf } from '@jbrowse/core/configuration';\nimport { getSession } from '@jbrowse/core/util';\nimport { openLocation } from '@jbrowse/core/util/io';\nimport { addRelativeUris } from './addRelativeUris';\nimport { resolve } from './util';\nexport async function doConnect(self) {\n    var _a;\n    const session = getSession(self);\n    try {\n        const configJsonLocation = getConf(self, 'configJsonLocation');\n        const configJson = JSON.parse(await openLocation(configJsonLocation).readFile('utf8'));\n        const configUri = resolve(configJsonLocation.uri, configJsonLocation.baseUri);\n        addRelativeUris(configJson, new URL(configUri));\n        if (configJson.assemblies) {\n            for (const assembly of configJson.assemblies) {\n                if (!session.assemblyManager.get(assembly.name)) {\n                    session.addSessionAssembly(assembly);\n                }\n            }\n        }\n        if (configJson.tracks) {\n            self.addTrackConfs(configJson.tracks);\n        }\n        session.notify('Successfully loaded', 'success');\n    }\n    catch (e) {\n        console.error(e);\n        session.notifyError(`${getConf(self, 'name')}: \"${e}\"`, e);\n        (_a = session.breakConnection) === null || _a === void 0 ? void 0 : _a.call(session, self.configuration);\n    }\n}\n"],"names":["addRelativeUris","config","base","key","resolve","uri","baseUri","doConnect","self","_a","session","getSession","configJsonLocation","getConf","configJson","openLocation","configUri","assembly","e"],"mappings":"uDAAO,SAASA,EAAgBC,EAAQC,EAAM,CAC1C,GAAI,OAAOD,GAAW,UAAYA,IAAW,KACzC,UAAWE,KAAO,OAAO,KAAKF,CAAM,EAC5B,OAAOA,EAAOE,CAAG,GAAM,UAAYF,EAAOE,CAAG,IAAM,KACnDH,EAAgBC,EAAOE,CAAG,EAAGD,CAAI,EAE5BC,IAAQ,QACbF,EAAO,QAAUC,EAAK,KAItC,CCmBO,SAASE,EAAQC,EAAKC,EAAS,CAClC,OAAO,IAAI,IAAID,EAAKC,CAAO,EAAE,IACjC,CC3BO,eAAeC,EAAUC,EAAM,CAClC,IAAIC,EACJ,MAAMC,EAAUC,EAAAA,WAAWH,CAAI,EAC/B,GAAI,CACA,MAAMI,EAAqBC,EAAAA,QAAQL,EAAM,oBAAoB,EACvDM,EAAa,KAAK,MAAM,MAAMC,EAAAA,aAAaH,CAAkB,EAAE,SAAS,MAAM,CAAC,EAC/EI,EAAYZ,EAAQQ,EAAmB,IAAKA,EAAmB,OAAO,EAE5E,GADAZ,EAAgBc,EAAY,IAAI,IAAIE,CAAS,CAAC,EAC1CF,EAAW,WACX,UAAWG,KAAYH,EAAW,WACzBJ,EAAQ,gBAAgB,IAAIO,EAAS,IAAI,GAC1CP,EAAQ,mBAAmBO,CAAQ,EAI3CH,EAAW,QACXN,EAAK,cAAcM,EAAW,MAAM,EAExCJ,EAAQ,OAAO,sBAAuB,SAAS,CACnD,OACOQ,EAAG,CACN,QAAQ,MAAMA,CAAC,EACfR,EAAQ,YAAY,GAAGG,EAAAA,QAAQL,EAAM,MAAM,CAAC,MAAMU,CAAC,IAAKA,CAAC,GACxDT,EAAKC,EAAQ,mBAAqB,MAAQD,IAAO,QAAkBA,EAAG,KAAKC,EAASF,EAAK,aAAa,CAC3G,CACJ","x_google_ignoreList":[0,1,2]}