var pt=Object.defineProperty;var yt=(r,e,t)=>e in r?pt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ce=(r,e,t)=>yt(r,typeof e!="symbol"?e+"":e,t);import{c as St}from"./crc32-BNi2TJ31.js";import{bN as xt,bs as me,d$ as Dt,cm as Rt,g2 as bt,cf as _t,eE as we,dU as kt,eF as Nt,eG as Se,am as Ft,an as qt,p as H,dW as Lt,bb as Mt,eH as vt,eI as Ot}from"./index-CT2bM4yV.js";import{r as Pt}from"./___vite-browser-external_commonjs-proxy-CeH3A-PI.js";const b={CRAM_FLAG_PRESERVE_QUAL_SCORES:1,CRAM_FLAG_DETACHED:2,CRAM_FLAG_MATE_DOWNSTREAM:4,CRAM_FLAG_NO_SEQ:8,BAM_FPAIRED:1,BAM_FPROPER_PAIR:2,BAM_FUNMAP:4,BAM_FMUNMAP:8,BAM_FREVERSE:16,BAM_FMREVERSE:32,BAM_FREAD1:64,BAM_FREAD2:128,BAM_FSECONDARY:256,BAM_FQCFAIL:512,BAM_FDUP:1024,BAM_FSUPPLEMENTARY:2048};function Ut(r,e){if(!r.lengthOnRef&&!r.readLength||r.isUnknownBases())return null;const t=r.alignmentStart-e.start;if(!r.readFeatures)return e.seq.slice(t,t+(r.lengthOnRef||0)).toUpperCase();let A="",n=t,s=0;for(;A.length<r.readLength;)if(s<r.readFeatures.length){const o=r.readFeatures[s];if(o.code==="Q"||o.code==="q")s+=1;else if(o.pos===A.length+1)if(s+=1,o.code==="b"){const i=o.data;A+=i,n+=i.length}else o.code==="B"?(A+=o.data[0],n+=1):o.code==="X"?(A+=o.sub,n+=1):o.code==="I"?A+=o.data:o.code==="D"?n+=o.data:o.code==="i"?A+=o.data:o.code==="N"?n+=o.data:o.code==="S"?A+=o.data:o.code==="P"||o.code;else if(s<r.readFeatures.length){const i=e.seq.slice(n,n+o.pos-A.length-1);A+=i,n+=i.length}}else{const o=e.seq.slice(n,n+r.readLength-A.length);A+=o,n+=o.length}return A.toUpperCase()}const Ht={a:0,A:0,c:1,C:1,g:2,G:2,t:3,T:3,n:4,N:4};function Tt(r,e,t,A){const n=A.refPos-e.start,s=e.seq.charAt(n);s&&(A.ref=s);let o=Ht[s];o===void 0&&(o=4);const g=t.substitutionMatrix[o][A.data];g&&(A.sub=g)}const Gt=[[1,"Paired"],[2,"ProperlyPaired"],[4,"SegmentUnmapped"],[8,"MateUnmapped"],[16,"ReverseComplemented"],[32,"MateReverseComplemented"],[64,"Read1"],[128,"Read2"],[256,"Secondary"],[512,"FailedQc"],[1024,"Duplicate"],[2048,"Supplementary"]],Jt=[[1,"PreservingQualityScores"],[2,"Detached"],[4,"WithMateDownstream"],[8,"DecodeSequenceAsStar"]],Yt=[[1,"OnNegativeStrand"],[2,"Unmapped"]];function pe(r){const e={};for(const[t,A]of r)e[`is${A}`]=n=>!!(n&t),e[`set${A}`]=n=>n|t;return e}const le=pe(Gt),$=pe(Jt),xe=pe(Yt);class Kt{constructor({flags:e,cramFlags:t,readLength:A,mappingQuality:n,lengthOnRef:s,qualityScores:o,mateRecordNumber:i,readBases:g,readFeatures:c,mateToUse:a,readGroupId:C,readName:d,sequenceId:l,uniqueId:u,templateSize:h,alignmentStart:I,tags:f}){this.flags=e,this.cramFlags=t,this.readLength=A,this.mappingQuality=n,this.lengthOnRef=s,this.qualityScores=o,g&&(this.readBases=g),this.readGroupId=C,this.readName=d,this.sequenceId=l,this.uniqueId=u,this.templateSize=h,this.alignmentStart=I,this.tags=f,c&&(this.readFeatures=c),a&&(this.mate={flags:a.mateFlags,readName:a.mateReadName,sequenceId:a.mateSequenceId,alignmentStart:a.mateAlignmentStart}),i&&(this.mateRecordNumber=i)}isPaired(){return!!(this.flags&b.BAM_FPAIRED)}isProperlyPaired(){return!!(this.flags&b.BAM_FPROPER_PAIR)}isSegmentUnmapped(){return!!(this.flags&b.BAM_FUNMAP)}isMateUnmapped(){return!!(this.flags&b.BAM_FMUNMAP)}isReverseComplemented(){return!!(this.flags&b.BAM_FREVERSE)}isMateReverseComplemented(){return!!(this.flags&b.BAM_FMREVERSE)}isRead1(){return!!(this.flags&b.BAM_FREAD1)}isRead2(){return!!(this.flags&b.BAM_FREAD2)}isSecondary(){return!!(this.flags&b.BAM_FSECONDARY)}isFailedQc(){return!!(this.flags&b.BAM_FQCFAIL)}isDuplicate(){return!!(this.flags&b.BAM_FDUP)}isSupplementary(){return!!(this.flags&b.BAM_FSUPPLEMENTARY)}isDetached(){return!!(this.cramFlags&b.CRAM_FLAG_DETACHED)}hasMateDownStream(){return!!(this.cramFlags&b.CRAM_FLAG_MATE_DOWNSTREAM)}isPreservingQualityScores(){return!!(this.cramFlags&b.CRAM_FLAG_PRESERVE_QUAL_SCORES)}isUnknownBases(){return!!(this.cramFlags&b.CRAM_FLAG_NO_SEQ)}getReadBases(){if(!this.readBases&&this._refRegion){const e=Ut(this,this._refRegion);e&&(this.readBases=e)}return this.readBases}getPairOrientation(){if(!this.isSegmentUnmapped()&&this.isPaired()&&!this.isMateUnmapped()&&this.mate&&this.sequenceId===this.mate.sequenceId){const e=this.isReverseComplemented()?"R":"F",t=this.isMateReverseComplemented()?"R":"F";let A=" ",n=" ";this.isRead1()?(A="1",n="2"):this.isRead2()&&(A="2",n="1");const s=[];let o=this.templateLength||this.templateSize;if(o===void 0)throw new Error("One of templateSize and templateLength must be set");return this.alignmentStart>this.mate.alignmentStart&&o>0&&(o=-o),o>0?(s[0]=e,s[1]=A,s[2]=t,s[3]=n):(s[2]=e,s[3]=A,s[0]=t,s[1]=n),s.join("")}return null}addReferenceSequence(e,t){this.readFeatures&&this.readFeatures.forEach(A=>{A.code==="X"&&Tt(this,e,t,A)}),!this.readBases&&e.start<=this.alignmentStart&&e.end>=this.alignmentStart+(this.lengthOnRef||this.readLength)-1&&(this._refRegion=e)}toJSON(){const e={};return Object.keys(this).forEach(t=>{t.startsWith("_")||(e[t]=this[t])}),e.readBases=this.getReadBases(),e}}var We={exports:{}};/*!
 * Based on xzwasm (c) Steve Sanderson. License: MIT - https://github.com/SteveSanderson/xzwasm
 * Contains xz-embedded by Lasse Collin and Igor Pavlov. License: Public domain - https://tukaani.org/xz/embedded.html
 * and walloc (c) 2020 Igalia, S.L. License: MIT - https://github.com/wingo/walloc
 */(function(r,e){(function(A,n){r.exports=n(Pt)})(xt,t=>(()=>{var A=[,i=>{i.exports="data:application/wasm;base64,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IgENAAsLIAJCf4UL1RACDH8CfgJAAkAgACgCJEUNACAAKAIAIQIMAQtBACECIABBADoAKCAAQgA3AwAgAEIANwMYIABByABqQQBB5AAQhoCAgAAaIABBrAFqQQw2AgALIAAgASgCBCIDNgIQIABBsAFqIQQgAEHgAGohBSAAQcgAaiEGIABBtgFqIQcgAEGoAWohCCABKAIQIQkCQAJAAkACQANAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAIAIOCgECAAQFBgcICQoPCyABKAIAIQogACgCqAEhAiAAKAKsASELIAEoAgQhDCABKAIIIQ0MAgsgCCAAKAKoASIMakEIaiABKAIAIAEoAgQiAmogASgCCCACayICIAAoAqwBIAxrIgwgAiAMSRsiAhCHgICAABogASABKAIEIAJqNgIEQQAhDCAAQQAgACgCqAEgAmoiAiACIAAoAqwBIgtGGzYCqAEgAiALRw0RIABBATYCAAJAIARBqIiAgABBBhCEgICAAEUNAEEFIQwMEgsgB0ECQQAQjYCAgAAgACgAuAFHDRBBBiEMIActAAANESAAIAAtALcBIgI2AiAgAkEESw0RQQEgAnRBE3FFDRELIAEoAgQiDCABKAIIIg1GDQ4CQCABKAIAIgogDGotAAAiCw0AIAAgDDYCECABIAxBAWo2AgRBBiECDAwLQQAhAiAAQQA2AqgBIABBAjYCACAAIAtBAnRBBGoiCzYCrAEgACALNgJACyAIIAJqQQhqIAogDGogDSAMayIMIAsgAmsiAiAMIAJJGyICEIeAgIAAGiABIAIgASgCBGo2AgRBACEMIABBACAAKAKoASACaiICIAIgACgCrAEiC0YbNgKoASACIAtHDQ8gACACQXxqIgI2AqwBQQchDCAEIAJBABCNgICAACAAIAAoAqwBIgtqQbABaigAAEcNDyAAQQI2AqgBIAAtALEBIgJBP3ENDAJAAkAgAkHAAHFFDQAgACAEIAggCxCRgICAAEEBRw0RIAAgACkDCDcDMCAALQCxASECDAELIABCfzcDMAtCfyEOAkAgAkEYdEEYdUF/Sg0AIAAgBCAIIAAoAqwBEJGAgIAAQQFHDRAgACkDCCEOCyAAIA43AzggACgCrAEiDSAAKAKoASICa0ECSQ0PIAAgAkEBaiIKNgKoASAIIAJqQQhq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IgM2AhAgACAOQQh0IAAoAgwgCWotAAByIg42AgQgAyEJCwJAAkAgDiALQQt2IA8vAQAiCmwiA08iEg0AIAAgAzYCACAKQYAQIAprQQV2aiEKDAELIAAgDiADayIONgIEIAAgCyADayIDNgIAIAogCkEFdmshCkEAIQ0LIA8gCjsBACANIBFzIQ0gBEEBdCASciIEQYACSQ0ACwsgACACQQFqNgIgIAAoAhggAmogBDoAAAJAIAAoAiQgACgCICICTw0AIAAgAjYCJAtBACEDAkAgACgCZCIEQQRJDQACQCAEQQlLDQAgBEF9aiEDDAELIARBemohAwsgACADNgJkDAELIAAgDiADayIONgIEIAAgBCADayIDNgIAIA0gDyAPQQV2azsBACAAIApBAXRqIg9B+ANqIQQCQAJAIANB////B00NACAJIQoMAQsgACADQQh0IgM2AgAgACAJQQFqIgo2AhAgACAOQQh0IAAoAgwgCWotAAByIg42AgQLAkACQCAOIANBC3YgBC8BACINbCIJSQ0AIAAgDiAJayIONgIEIAAgAyAJayIDNgIAIAQgDSANQQV2azsBACAPQZAEaiENAkACQCADQf///wdNDQAgCiEQDAELIAAgA0EIdCIDNgIAIAAgCkEBaiIQNgIQIAAgDkEIdCAAKAIMIApqLQAAciIONgIECwJAAkAgDiADQQt2IA0vAQAiCWwiBE8NACANIAlBgBAgCWtBBXZqOwEAIAxB2ARqIQMCQCAEQf///wdLDQAgACAEQQh0IgQ2AgAgACAQQQFqNgIQIAAgDkEIdCAAKAIMIBBqLQAAciIONgIECwJAIA4gBEELdiADLwEAIg1sIglJDQAgACAOIAlrNgIEIAAgBCAJazYCACADIA0gDUEFdms7AQAMAgsgAyANQYAQIA1rQQV2ajsBACAAIAk2AgAgAEEBNgJoIABBCUELIAAoAmRBB0kbNgJkDAMLIAAgDiAEayIONgIEIA0gCSAJQQV2azsBACAPQagEaiENAkACQCADIARrIgNB////B00NACAQIQoMAQsgACADQQh0IgM2AgAgACAQQQFqIgo2AhAgACAOQQh0IAAoAgwgEGotAAByIg42AgQLAkACQCAOIANBC3YgDS8BACIEbCIJTw0AIAAgCTYCACANIARBgBAgBGtBBXZqOwEAIAAoAlghAwwBCyAAIA4gCWsiDjYCBCANIAQgBEEFdms7AQAgD0HABGohBAJAIAMgCWsiA0H///8HSw0AIAAgA0EIdCIDNgIAIAAgCkEBajYCECAAIA5BCHQgACgCDCAKai0AAHIiDjYCBAsCQAJAIA4gA0ELdiAELwEAIg1sIglPDQAgACAJNgIAIAQgDUGAECANa0EFdmo7AQAgACgCXCEDDAELIAAgDiAJazYCBCAAIAMgCWs2AgAgACgCYCEDIAAgACgCXDYCYCAEIA0gDUEFdms7AQALIAAgACgCWDYCXAsgACAAKAJUNgJYIAAgAzYCVAsgAEEIQQsgACgCZEEHSRs2AmQgACAHIAsQn4CAgAAMAQsgBCANQYAQIA1rQQV2ajsBACAAIAk2AgAgACAAKAJcNgJgIAAgACkCVDcCWCAAQQdBCiAAKAJkQQdJGzYCZCAAIAUgCxCfgICAACAAKAJoIgNBfmpBAyADQQZJGyEKIAAoAgAhA0EBIQ4DQCAAIApBB3RqIA5BAXQiDmpB2AdqIQ0CQAJAIANBgICACEkNACAAKAIEIQQMAQsgACADQQh0IgM2AgAgACAAKAIQIgRBAWo2AhAgACAAKAIEQQh0IAQgACgCDGotAAByIgQ2AgQLAkACQCAEIANBC3YgDS8BACIJbCIPSQ0AIAAgBCAPayIENgIEIAAgAyAPayIDNgIAIA0gCSAJQQV2azsBACAOQQFyIQ4MAQsgACAPNgIAIA0gCUGAECAJa0EFdmo7AQAgDyEDCyAOQcAASQ0ACwJAIA5BQGoiCUEDSw0AIAAgCTYCVAwBCyAAIA5BAXFBAnIiDTYCVCAJQQF2IQ8CQCAJQQ1LDQAgACANIA9Bf2oiDHQiCzYCVEEBIQ0gCCALQQF0akGEC2ohEEE/IA5rIRFBACEPA0AgECARIA1qQQF0aiEOAkACQCADQf///wdNDQAgAyEKDAELIAAgA0EIdCIKNgIAIAAgACgCECIDQQFqNgIQIAAgBEEIdCADIAAoAgxqLQAAciIENgIECwJAAkAgBCAKQQt2IA4vAQAiCWwiA0kNACAAIAQgA2siBDYCBCAAIAogA2siAzYCACAOIAkgCUEFdms7AQAgAEEBIA90IAtqIgs2AlQgDUEBdEEBciENDAELIAAgAzYCACAOIAlBgBAgCWtBBXZqOwEAIA1BAXQhDQsgDCAPQQFqIg9HDQAMAgsLIA9Be2ohDgNAAkAgA0H///8HSw0AIAAgA0EIdCIDNgIAIAAgACgCECIJQQFqNgIQIARBCHQgCSAAKAIMai0AAHIhBAsgACADQQF2IgM2AgAgACAEIANrIgRBH3UiCSANQQF0akEBaiINNgJUIAAgCSADcSAEaiIENgIEIA5Bf2oiDg0ACyAAIA1BBHQiCzYCVEEAIQ9BASEOA0AgACAOQQF0Ig5qQbwNaiENAkACQCADQf///wdNDQAgAyEKDAELIAAgA0EIdCIKNgIAIAAgACgCECIDQQFqNgIQIAAgBEEIdCADIAAoAgxqLQAAciIENgIECwJAAkAgBCAKQQt2IA0vAQAiCWwiA0kNACAAIAQgA2siBDYCBCAAIAogA2siAzYCACANIAkgCUEFdms7AQAgAEEBIA90IAtqIgs2AlQgDkEBciEODAELIAAgAzYCACANIAlBgBAgCWtBBXZqOwEACyAPQQFqIg9BBEcNAAsLAkAgASAGIAAoAlQQnoCAgAANAEEADwsgACgCICECCyACIAAoAihJDQALC0EBIQMCQCAAKAIAIgRB////B0sNACAAIARBCHQ2AgBBASEDIAAgACgCECIEQQFqNgIQIAAgACgCBEEIdCAEIAAoAgxqLQAAcjYCBAsgAwtwAQF/AkBBqN4BEICAgIAAIgJFDQAgAkE0aiABNgIAIAJBPGogADYCAAJAAkACQCAAQX9qDgIAAQILIAIgARCAgICAACIANgIYIAANASACEIKAgIAADAILIAJBADYCGCACQThqQQA2AgALIAIPC0EAC9IBAQJ/QQYhAgJAIAFBJ0sNACAAQTBqIAFBAXFBAnIgAUEBdkELanQiATYCAAJAAkAgAEE8aigCACIDRQ0AQQQhAiABIABBNGooAgBLDQIgAEEsaiABNgIAIANBAkcNACAAQThqIgMoAgAgAU8NACAAIAE2AjggACgCGBCCgICAACAAIAAoAjAQgICAgAAiATYCGCABDQBBAyECDAELQQAhAiAAQQA2AkAgAEHQAGpBAToAACAAQegAakEANgIAIABB5N0BaiEDCyADQQA2AgALIAILIwACQCAAQTxqKAIARQ0AIAAoAhgQgoCAgAALIAAQgoCAgAAL9QEBBH9BACEDAkAgACgCDCACTQ0AIAAoAhggAk0NACABIAEoAgAiBCAAKAIQIAAoAggiBWsiBiAEIAYgBEkbIgRrNgIAIAUgAkF/c2ohAQJAIAUgAksNACAAKAIUIAFqIQELIAAoAgAiAiABai0AACEGQQEhAyAAIAVBAWo2AgggAiAFaiAGOgAAAkAgBEF/aiICRQ0AA0AgACgCACIFQQAgAUEBaiIBIAEgACgCFEYbIgFqLQAAIQQgACAAKAIIIgZBAWo2AgggBSAGaiAEOgAAIAJBf2oiAg0ACwsgACgCDCAAKAIIIgFPDQAgACABNgIMCyADC8gEAQd/AkACQCAAKAIAIgNBgICACEkNACAAKAIEIQQMAQsgACADQQh0IgM2AgAgACAAKAIQIgVBAWo2AhAgACAAKAIEQQh0IAUgACgCDGotAAByIgQ2AgQLAkACQCAEIANBC3YgAS8BACIGbCIFTw0AIAEgBkGAECAGa0EFdmo7AQAgASACQQR0akEEaiEHQQghCEECIQkMAQsgACAEIAVrIgQ2AgQgASAGIAZBBXZrOwEAAkAgAyAFayIDQf///wdLDQAgACADQQh0IgM2AgAgACAAKAIQIgVBAWo2AhAgACAEQQh0IAUgACgCDGotAAByIgQ2AgQLAkAgBCADQQt2IAEvAQIiBmwiBU8NACABIAZBgBAgBmtBBXZqOwECIAEgAkEEdGpBhAJqIQdBCCEIQQohCQwBCyAAIAQgBWsiBDYCBCABIAYgBkEFdms7AQIgAUGEBGohByADIAVrIQVBgAIhCEESIQkLIABB6ABqIAk2AgBBASEBA0AgByABQQF0IgFqIQMCQAJAIAVB////B00NACAFIQIMAQsgACAFQQh0IgI2AgAgACAAKAIQIgVBAWo2AhAgACAEQQh0IAUgACgCDGotAAByIgQ2AgQLAkACQCAEIAJBC3YgAy8BACIGbCIFSQ0AIAAgBCAFayIENgIEIAAgAiAFayIFNgIAIAMgBiAGQQV2azsBACABQQFyIQEMAQsgACAFNgIAIAMgBkGAECAGa0EFdmo7AQALIAEgCEkNAAsgAEHoAGogASAIayAJajYCAAsLNQEAQYAICy4IAAAAEAAAABgAAAAgAAAAKAAAADAAAABAAAAAUAAAAIAAAAAAAQAA/Td6WFoA"},i=>{i.exports=t}],n={};function s(i){var g=n[i];if(g!==void 0)return g.exports;var c=n[i]={exports:{}};return A[i](c,c.exports,s),c.exports}s.d=(i,g)=>{for(var c in g)s.o(g,c)&&!s.o(i,c)&&Object.defineProperty(i,c,{enumerable:!0,get:g[c]})},s.o=(i,g)=>Object.prototype.hasOwnProperty.call(i,g),s.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var o={};return(()=>{s.r(o),s.d(o,{XzReadableStream:()=>d});var i=s(1);const g=globalThis.ReadableStream||s(2).ReadableStream,c=0,a=1;class C{constructor(h){this.exports=h.exports,this.memory=this.exports.memory,this.ptr=this.exports.create_context(),this._refresh(),this.bufSize=this.mem32[0],this.inStart=this.mem32[1]-this.ptr,this.inEnd=this.inStart+this.bufSize,this.outStart=this.mem32[4]-this.ptr}supplyInput(h){this._refresh(),this.mem8.subarray(this.inStart,this.inEnd).set(h,0),this.exports.supply_input(this.ptr,h.byteLength),this._refresh()}getNextOutput(){const h=this.exports.get_next_output(this.ptr);if(this._refresh(),h!==c&&h!==a)throw new Error(`get_next_output failed with error code ${h}`);return{outChunk:this.mem8.slice(this.outStart,this.outStart+this.mem32[5]),finished:h===a}}needsMoreInput(){return this.mem32[2]===this.mem32[3]}outputBufferIsFull(){return this.mem32[5]===this.bufSize}resetOutputBuffer(){this.outPos=this.mem32[5]=0}dispose(){this.exports.destroy_context(this.ptr),this.exports=null}_refresh(){var h;this.memory.buffer!==((h=this.mem8)==null?void 0:h.buffer)&&(this.mem8=new Uint8Array(this.memory.buffer,this.ptr),this.mem32=new Uint32Array(this.memory.buffer,this.ptr))}}const l=class l extends g{static async _getModuleInstance(){const h=i.replace("data:application/wasm;base64,",""),I=Uint8Array.from(atob(h),w=>w.charCodeAt(0)).buffer,f={},B=await WebAssembly.instantiate(I,f);l._moduleInstance=B.instance}constructor(h){let I,f=null;const B=h.getReader();super({async start(w){l._moduleInstance||await(l._moduleInstancePromise||(l._moduleInstancePromise=l._getModuleInstance())),I=new C(l._moduleInstance)},async pull(w){if(I.needsMoreInput()){if(f===null||f.byteLength===0){const{done:R,value:k}=await B.read();R||(f=k)}const m=Math.min(I.bufSize,f.byteLength);I.supplyInput(f.subarray(0,m)),f=f.subarray(m)}const p=I.getNextOutput();w.enqueue(p.outChunk),I.resetOutputBuffer(),p.finished&&(I.dispose(),w.close())},cancel(){return I.dispose(),B.cancel()}})}};Ce(l,"_moduleInstancePromise"),Ce(l,"_moduleInstance");let d=l})(),o})())})(We);var zt=We.exports;class Xe extends Error{}class O extends Error{}class D extends Xe{}class Vt extends Xe{}const De=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],je=new Array(256);for(let r=0;r<256;r++)je[r]=`${De[r>>>4&15]}${De[r&15]}`;function $t(r){let e="";for(let t=0,A=r.length;t<A;t++)e+=je[r[t]];return e}const Re=[0,1,3,7,15,31,63,127,255];class Wt{constructor(e){this.stream=e,this.bitOffset=0,this.curByte=0,this.hasByte=!1}_ensureByte(){this.hasByte||(this.curByte=this.stream.readByte(),this.hasByte=!0)}read(e){let t=0;for(;e>0;){this._ensureByte();const A=8-this.bitOffset;if(e>=A)t<<=A,t|=Re[A]&this.curByte,this.hasByte=!1,this.bitOffset=0,e-=A;else{t<<=e;const n=A-e;t|=(this.curByte&Re[e]<<n)>>n,this.bitOffset+=e,e=0}}return t}seek(e){const t=e%8,A=(e-t)/8;this.bitOffset=t,this.stream.seek(A),this.hasByte=!1}pi(){const e=new Uint8Array(6);for(let t=0;t<e.length;t++)e[t]=this.read(8);return $t(e)}}var Xt=function(){const r=new Uint32Array([0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]);return function(){let t=4294967295;this.getCRC=function(){return~t>>>0},this.updateCRC=function(A){t=t<<8^r[(t>>>24^A)&255]},this.updateCRCRun=function(A,n){for(;n-- >0;)t=t<<8^r[(t>>>24^A)&255]}}}();const jt=me(Xt),Y=function(){};Y.prototype.readByte=function(){throw new Error("abstract method readByte() not implemented")};Y.prototype.read=function(r,e,t){let A=0;for(;A<t;){const n=this.readByte();if(n<0)return A===0?-1:A;r[e++]=n,A++}return A};Y.prototype.seek=function(r){throw new Error("abstract method seek() not implemented")};Y.prototype.writeByte=function(r){throw new Error("abstract method readByte() not implemented")};Y.prototype.write=function(r,e,t){let A;for(A=0;A<t;A++)this.writeByte(r[e++]);return t};Y.prototype.flush=function(){};var Zt=Y;const Ze=me(Zt),te=20,be=258,_e=0,eA=1,tA=2,AA=6,nA=50,rA="314159265359",iA="177245385090",ke=function(r,e){const t=r[e];for(let A=e;A>0;A--)r[A]=r[A-1];return r[0]=t,t},_={LAST_BLOCK:-1,NOT_BZIP_DATA:-2,UNEXPECTED_INPUT_EOF:-3,UNEXPECTED_OUTPUT_EOF:-4,DATA_ERROR:-5,OUT_OF_MEMORY:-6,OBSOLETE_INPUT:-7},P={};P[_.LAST_BLOCK]="Bad file checksum";P[_.NOT_BZIP_DATA]="Not bzip data";P[_.UNEXPECTED_INPUT_EOF]="Unexpected input EOF";P[_.UNEXPECTED_OUTPUT_EOF]="Unexpected output EOF";P[_.DATA_ERROR]="Data error";P[_.OUT_OF_MEMORY]="Out of memory";P[_.OBSOLETE_INPUT]="Obsolete (pre 0.9.5) bzip format not supported.";const N=function(r,e){let t=P[r]||"unknown error";e&&(t+=": "+e);const A=new TypeError(t);throw A.errorCode=r,A};class sA{constructor(e,t){this.writePos=this.writeCurrent=this.writeCount=0,this._start_bunzip(e,t)}_init_block(){return this._get_next_block()?(this.blockCRC=new jt,!0):(this.writeCount=-1,!1)}_start_bunzip(e,t){const A=new Uint8Array(4);(e.read(A,0,4)!==4||String.fromCharCode(A[0],A[1],A[2])!=="BZh")&&N(_.NOT_BZIP_DATA,"bad magic");const n=A[3]-48;(n<1||n>9)&&N(_.NOT_BZIP_DATA,"level out of range"),this.reader=new Wt(e),this.dbufSize=1e5*n,this.nextoutput=0,this.outputStream=t,this.streamCRC=0}_get_next_block(){let e,t,A;const n=this.reader,s=n.pi();if(s===iA)return!1;s!==rA&&N(_.NOT_BZIP_DATA),this.targetBlockCRC=n.read(32)>>>0,this.streamCRC=(this.targetBlockCRC^(this.streamCRC<<1|this.streamCRC>>>31))>>>0,n.read(1)&&N(_.OBSOLETE_INPUT);const o=n.read(24);o>this.dbufSize&&N(_.DATA_ERROR,"initial position out of bounds");let i=n.read(16),g=new Uint8Array(256),c=0;for(e=0;e<16;e++)if(i&1<<15-e){const y=e*16;for(A=n.read(16),t=0;t<16;t++)A&1<<15-t&&(g[c++]=y+t)}const a=n.read(3);(a<tA||a>AA)&&N(_.DATA_ERROR);const C=n.read(15);C===0&&N(_.DATA_ERROR);const d=new Uint8Array(256);for(e=0;e<a;e++)d[e]=e;const l=new Uint8Array(C);for(e=0;e<C;e++){for(t=0;n.read(1);t++)t>=a&&N(_.DATA_ERROR);l[e]=ke(d,t)}let u=c+2,h=[],I;for(t=0;t<a;t++){const y=new Uint8Array(u),S=new Uint16Array(te+1);for(i=n.read(5),e=0;e<u;e++){for(;(i<1||i>te)&&N(_.DATA_ERROR),!!n.read(1);)n.read(1)?i--:i++;y[e]=i}var f,B;for(f=B=y[0],e=1;e<u;e++)y[e]>B?B=y[e]:y[e]<f&&(f=y[e]);I={},h.push(I),I.permute=new Uint16Array(be),I.limit=new Uint32Array(te+2),I.base=new Uint32Array(te+1),I.minLen=f,I.maxLen=B;let q=0;for(e=f;e<=B;e++)for(S[e]=I.limit[e]=0,i=0;i<u;i++)y[i]===e&&(I.permute[q++]=i);for(e=0;e<u;e++)S[y[e]]++;for(q=i=0,e=f;e<B;e++)q+=S[e],I.limit[e]=q-1,q<<=1,i+=S[e],I.base[e+1]=q-i;I.limit[B+1]=Number.MAX_VALUE,I.limit[B]=q+S[B]-1,I.base[f]=0}const w=new Uint32Array(256);for(e=0;e<256;e++)d[e]=e;let p=0,m=0,R=0,k;const F=this.dbuf=new Uint32Array(this.dbufSize);for(u=0;;){for(u--||(u=nA-1,R>=C&&N(_.DATA_ERROR),I=h[l[R++]]),e=I.minLen,t=n.read(e);e>I.maxLen&&N(_.DATA_ERROR),!(t<=I.limit[e]);e++)t=t<<1|n.read(1);t-=I.base[e],(t<0||t>=be)&&N(_.DATA_ERROR);const y=I.permute[t];if(y===_e||y===eA){p||(p=1,i=0),i+=y===_e?p:2*p,p<<=1;continue}if(p)for(p=0,m+i>this.dbufSize&&N(_.DATA_ERROR),k=g[d[0]],w[k]+=i;i--;)F[m++]=k;if(y>c)break;m>=this.dbufSize&&N(_.DATA_ERROR),e=y-1,k=ke(d,e),k=g[k],w[k]++,F[m++]=k}for((o<0||o>=m)&&N(_.DATA_ERROR),t=0,e=0;e<256;e++)A=t+w[e],w[e]=t,t=A;for(e=0;e<m;e++)k=F[e]&255,F[w[k]]|=e<<8,w[k]++;let U=0,v=0,z=0;return m&&(U=F[o],v=U&255,U>>=8,z=-1),this.writePos=U,this.writeCurrent=v,this.writeCount=m,this.writeRun=z,!0}_read_bunzip(e,t){let A,n,s;if(this.writeCount<0)return 0;let o=this.dbuf,i=this.writePos,g=this.writeCurrent,c=this.writeCount;this.outputsize;let a=this.writeRun;for(;c;){for(c--,n=g,i=o[i],g=i&255,i>>=8,a++===3?(A=g,s=n,g=-1):(A=1,s=g),this.blockCRC.updateCRCRun(s,A);A--;)this.outputStream.writeByte(s),this.nextoutput++;g!=n&&(a=0)}return this.writeCount=c,this.blockCRC.getCRC()!==this.targetBlockCRC&&N(_.DATA_ERROR,"Bad block CRC (got "+this.blockCRC.getCRC().toString(16)+" expected "+this.targetBlockCRC.toString(16)+")"),this.nextoutput}}const oA=function(r){if("readByte"in r)return r;const e=new Ze;return e.pos=0,e.readByte=function(){return r[this.pos++]},e.seek=function(t){this.pos=t},e.eof=function(){return this.pos>=r.length},e},aA=function(r){const e=new Ze;return e.buffer=new Uint8Array(16384),e.pos=0,e.writeByte=function(t){if(this.pos>=this.buffer.length){const A=new Uint8Array(this.buffer.length*2);A.set(this.buffer),this.buffer=A}this.buffer[this.pos++]=t},e.getBuffer=function(){if(this.pos!==this.buffer.length){const t=new Uint8Array(this.pos);t.set(this.buffer.slice(0,this.pos)),this.buffer=t}return this.buffer},e._coerced=!0,e};function et(r,e,t){const A=oA(r),n=aA(),s=new sA(A,n);for(;!("eof"in A&&A.eof());)if(s._init_block())s._read_bunzip();else{const o=s.reader.read(32)>>>0;o!==s.streamCRC&&N(_.DATA_ERROR,"Bad stream CRC (got "+s.streamCRC.toString(16)+" expected "+o.toString(16)+")");break}if("getBuffer"in n)return n.getBuffer()}class W{constructor(e){this.low=0,this.range=4294967295,this.code=0,this.FFnum=0,this.carry=0,this.cache=0}RangeStartDecode(e){for(let t=0;t<5;t++)this.code=(this.code<<8)+e.ReadByte();this.code&=4294967295,this.code>>>=0}RangeGetFrequency(e){return this.range=Math.floor(this.range/e),Math.floor(this.code/this.range)}RangeDecode(e,t,A,n){for(this.code-=t*this.range,this.range*=A;this.range<1<<24;)this.range*=256,this.code=this.code*256+e.ReadByte()}RangeShiftLow(e){if(this.low<4278190080|this.carry){for(e.WriteByte(this.cache+this.carry);this.FFnum;)e.WriteByte(this.carry-1),this.FFnum--;this.cache=this.low>>>24,this.carry=0}else this.FFnum++;this.low<<=8,this.low>>>=0}RangeEncode(e,t,A,n){const s=this.low;for(this.range=Math.floor(this.range/n),this.low+=t*this.range,this.low>>>=0,this.range*=A,this.low<s&&(this.carry!=0&&console.log("ERROR: Multiple carry"),this.carry=1);this.range<1<<24;)this.range*=256,this.RangeShiftLow(e)}RangeFinishEncode(e){for(let t=0;t<5;t++)this.RangeShiftLow(e)}}const Ne=65519,Ae=16;class M{constructor(e=256){this.total_freq=e,this.max_sym=e-1,this.S=[],this.F=[];for(let t=0;t<=this.max_sym;t++)this.S[t]=t,this.F[t]=1}ModelDecode(e,t){const A=t.RangeGetFrequency(this.total_freq);let n=0,s=0;for(;n+this.F[s]<=A;)n+=this.F[s++];t.RangeDecode(e,n,this.F[s],this.total_freq),this.F[s]+=Ae,this.total_freq+=Ae,this.total_freq>Ne&&this.ModelRenormalise();const o=this.S[s];if(s>0&&this.F[s]>this.F[s-1]){let i=this.F[s];this.F[s]=this.F[s-1],this.F[s-1]=i,i=this.S[s],this.S[s]=this.S[s-1],this.S[s-1]=i}return o}ModelRenormalise(){this.total_freq=0;for(let e=0;e<=this.max_sym;e++)this.F[e]-=Math.floor(this.F[e]/2),this.total_freq+=this.F[e]}ModelEncode(e,t,o){let n=0;for(var s=0;this.S[s]!=o;s++)n+=this.F[s];t.RangeEncode(e,n,this.F[s],this.total_freq),this.F[s]+=Ae,this.total_freq+=Ae,this.total_freq>Ne&&this.ModelRenormalise();var o=this.S[s];if(s>0&&this.F[s]>this.F[s-1]){let i=this.F[s];this.F[s]=this.F[s-1],this.F[s-1]=i,i=this.S[s],this.S[s]=this.S[s-1],this.S[s-1]=i}}}class L{constructor(e,t=0,A=0){A!==0?(this.buf=new Uint8Array(A),this.length=A):(this.buf=e,this.length=e.length),this.dataView=new DataView(this.buf.buffer),this.pos=t}EOF(){return this.pos>=this.length}ReadData(e){const t=this.buf.slice(this.pos,this.pos+e);return this.pos+=e,t}ReadByte(){const e=this.buf[this.pos];return this.pos++,e}ReadChar(){const e=this.buf[this.pos];return this.pos++,String.fromCharCode(e)}ReadUint16(){let e=this.ReadByte();return e|=this.ReadByte()<<8,e}ReadUint32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}ReadString(){let e="",t;do t=this.buf[this.pos++],t&&(e+=String.fromCharCode(t));while(t);return e}ReadUint7(){let e=0,t;do t=this.ReadByte(),e=e<<7|t&127;while(t&128);return e}ReadITF8(){let e=this.buf[this.pos];return this.pos++,e>=240?(e=(e&15)<<28,e+=(this.buf[this.pos+0]<<20)+(this.buf[this.pos+1]<<12)+(this.buf[this.pos+2]<<4)+(this.buf[this.pos+3]>>4),this.pos+=4):e>=224?(e=(e&15)<<24,e+=(this.buf[this.pos+0]<<16)+(this.buf[this.pos+1]<<8)+(this.buf[this.pos+2]<<0),this.pos+=3):e>=192?(e=(e&31)<<16,e+=(this.buf[this.pos+0]<<8)+(this.buf[this.pos+1]<<0),this.pos+=2):e>=128&&(e=(e&63)<<8,e+=this.buf[this.pos],this.pos++),e}}const cA=1,gA=4,dA=8,CA=16,lA=32,IA=64,Fe=128;class tt{decode(e){return this.stream=new L(e),this.decodeStream(this.stream)}decodeStream(e,t=0){const A=this.stream.ReadByte();A&CA||(t=this.stream.ReadUint7());let n=t;const s=A&cA;if(A&dA)return this.decodeStripe(this.stream,t);if(A&Fe){var o;[o,n]=this.decodePackMeta(this.stream)}if(A&lA)var i=this.decodeCat(this.stream,n);else if(A&gA)var i=this.decodeExt(this.stream,n);else if(A&IA)var i=s?this.decodeRLE1(this.stream,n):this.decodeRLE0(this.stream,n);else var i=s?this.decode1(this.stream,n):this.decode0(this.stream,n);return A&Fe&&(i=this.decodePack(i,o,t)),i}decode0(e,t){const A=new Uint8Array(t);let n=e.ReadByte();n==0&&(n=256);const s=new M(n),o=new W(e);o.RangeStartDecode(e);for(let i=0;i<t;i++)A[i]=s.ModelDecode(e,o);return A}decode1(e,t){const A=new Uint8Array(t);let n=e.ReadByte();n==0&&(n=256);const s=new Array(n);for(var o=0;o<n;o++)s[o]=new M(n);const i=new W(e);i.RangeStartDecode(e);let g=0;for(var o=0;o<t;o++)A[o]=s[g].ModelDecode(e,i),g=A[o];return A}decodeExt(e,t){return et(e.buf.slice(e.pos))}decodeRLE0(e,t){const A=new Uint8Array(t);let n=e.ReadByte();n==0&&(n=256);const s=new M(n),o=new Array(258);for(var g=0;g<=257;g++)o[g]=new M(4);const i=new W(e);i.RangeStartDecode(e);for(var g=0;g<t;){A[g]=s.ModelDecode(e,i);let c=o[A[g]].ModelDecode(e,i),a=c,C=256;for(;c==3;)c=o[C].ModelDecode(e,i),C=257,a+=c;for(let d=1;d<=a;d++)A[g+d]=A[g];g+=a+1}return A}decodeRLE1(e,t){const A=new Uint8Array(t);let n=e.ReadByte();n==0&&(n=256);const s=new Array(n);for(var c=0;c<n;c++)s[c]=new M(n);const o=new Array(258);for(var c=0;c<=257;c++)o[c]=new M(4);const i=new W(e);i.RangeStartDecode(e);let g=0;for(var c=0;c<t;){A[c]=s[g].ModelDecode(e,i),g=A[c];let a=o[A[c]].ModelDecode(e,i),C=a,d=256;for(;a==3;)a=o[d].ModelDecode(e,i),d=257,C+=a;for(let l=1;l<=C;l++)A[c+l]=A[c];c+=C+1}return A}decodePackMeta(e){this.nsym=e.ReadByte();const t=new Array(this.nsym);for(let n=0;n<this.nsym;n++)t[n]=e.ReadByte();const A=e.ReadUint7();return[t,A]}decodePack(e,t,A){const n=new Uint8Array(A);if(this.nsym<=1)for(var s=0;s<A;s++)n[s]=t[0];else if(this.nsym<=2)for(var s=0,o=0;s<A;s++){if(s%8==0)var i=e[o++];n[s]=t[i&1],i>>=1}else if(this.nsym<=4)for(var s=0,o=0;s<A;s++){if(s%4==0)var i=e[o++];n[s]=t[i&3],i>>=2}else if(this.nsym<=16)for(var s=0,o=0;s<A;s++){if(s%2==0)var i=e[o++];n[s]=t[i&15],i>>=4}else return e;return n}packMeta(e){const t=new L("",0,1024),A=new Array(256);for(var n=0;n<e.length;n++)A[e[n]]=1;for(var s=0,n=0;n<256;n++)A[n]&&(A[n]=++s);t.WriteByte(s);for(var n=0;n<256;n++)A[n]&&(t.WriteByte(n),A[n]--);return[t,A,s]}decodeStripe(e,t){const A=e.ReadByte(),n=new Array(A),s=new Array(A);for(var o=0;o<A;o++)n[o]=e.ReadUint7();const i=new Array(A);for(var o=0;o<A;o++)s[o]=Math.floor(t/A)+(t%A>o),i[o]=this.decodeStream(e,s[o]);const g=new Uint8Array(t);for(var o=0;o<A;o++)for(let a=0;a<s[o];a++)g[a*A+o]=i[o][a];return g}decodeCat(e,t){const A=new Uint8Array(t);for(let n=0;n<t;n++)A[n]=e.ReadByte();return A}}function ne(r,e,t){let A=0,n=0,s=-1;const o=new Array(1024);for(;n<t;){const c=r.ReadByte();if(o[A++]=c,n+=c,c==s){let a=r.ReadByte();for(n+=c*a;a--;)o[A++]=c}s=c}let i=0;for(A=0,n=0;n<t;){let c=0;do{var g=o[A++];c+=g}while(g==255);for(;c--;)e[n++]=i;i++}}const At=2,hA=4,fA=8,qe=16,Le=32,Me=64,ve=128,uA=1,BA=2,QA=4;function EA(r,e,t){let A=r.context;return e.qctx=(e.qctx<<r.qshift)+r.qtab[t],A+=(e.qctx&(1<<r.qbits)-1)<<r.qloc,r.do_pos&&(A+=r.ptab[Math.min(e.p,1023)]<<r.ploc),r.do_delta&&(A+=r.dtab[Math.min(e.delta,255)]<<r.dloc,e.delta+=e.prevq!=t?1:0,e.prevq=t),r.do_sel&&(A+=e.s<<r.sloc),e.p--,A&65535}function mA(r){const e={};e.context=r.ReadUint16(),e.pflags=r.ReadByte(),e.do_dedup=e.pflags&At,e.fixed_len=e.pflags&hA,e.do_sel=e.pflags&fA,e.do_qmap=e.pflags&qe,e.do_pos=e.pflags&Le,e.do_delta=e.pflags&Me,e.do_qtab=e.pflags&ve,e.max_sym=r.ReadByte();let t=r.ReadByte();if(e.qbits=t>>4,e.qshift=t&15,t=r.ReadByte(),e.qloc=t>>4,e.sloc=t&15,t=r.ReadByte(),e.ploc=t>>4,e.dloc=t&15,e.qmap=new Array(256),e.pflags&qe)for(var A=0;A<e.max_sym;A++)e.qmap[A]=r.ReadByte();else for(var A=0;A<256;A++)e.qmap[A]=A;if(e.qtab=new Array(1024),e.qbits>0&&e.pflags&ve)ne(r,e.qtab,256);else for(var A=0;A<256;A++)e.qtab[A]=A;return e.ptab=new Array(1024),e.pflags&Le&&ne(r,e.ptab,1024),e.dtab=new Array(256),e.pflags&Me&&ne(r,e.dtab,256),e}function wA(r){const e={max_sym:0};if(r.ReadByte()!=5){console.error("Invalid FQZComp version number");return}const A=r.ReadByte(),n=A&uA?r.ReadByte():1;let s=A.nparam>1?A.nparam-1:0;const o=new Array(256);if(A&BA)s=r.ReadByte(),ne(r,o,256);else{for(var i=0;i<n;i++)o[i]=i;for(;i<256;i++)o[i]=n-1}e.do_rev=A&QA,e.stab=o,e.max_sel=s,e.params=new Array(e.nparam);for(let g=0;g<n;g++)e.params[g]=mA(r),e.max_sym<e.params[g].max_sym&&(e.max_sym=e.params[g].max_sym);return e}function pA(r){const e={};e.qual=new Array(65536);for(var t=0;t<65536;t++)e.qual[t]=new M(r.max_sym+1);e.len=new Array(4);for(var t=0;t<4;t++)e.len[t]=new M(256);return e.rev=new M(2),e.dup=new M(2),r.max_sel>0&&(e.sel=new M(r.max_sel+1)),e}function yA(r,e,t,A,n,s){n.s=t.max_sel>0?A.sel.ModelDecode(r,e):0,n.x=t.stab[n.s];const o=t.params[n.x];if(o.fixed_len>=0){var i=A.len[0].ModelDecode(r,e);i|=A.len[1].ModelDecode(r,e)<<8,i|=A.len[2].ModelDecode(r,e)<<16,i|=A.len[3].ModelDecode(r,e)<<24,o.fixed_len>0&&(o.fixed_len=-i)}else i=-o.fixed_len;n.len=i,t.do_rev&&(s[n.rec]=A.rev.ModelDecode(r,e)),n.is_dup=0,o.pflags&At&&A.dup.ModelDecode(r,e)&&(n.is_dup=1),n.p=i,n.delta=0,n.qctx=0,n.prevq=0,n.rec++}function SA(r,e){const t=r.ReadUint7(),A=wA(r);if(!A)return;var n=A.params;const s=new Array(e.length),o=pA(A),i=new W(r);i.RangeStartDecode(r);const g=new Uint8Array(t),c={qctx:0,prevq:0,delta:0,p:0,s:0,x:0,len:0,is_dup:0,rec:0};let a=0;for(;a<t;){if(c.p==0){if(yA(r,i,A,o,c,s),c.is_dup>0&&o.dup.ModelDecode(r,i)){for(let u=0;u<len;u++)g[a+u]=g[a+u-c.len];a+=c.len,c.p=0;continue}e.push(c.len);var n=A.params[c.x],C=n.context}const d=o.qual[C].ModelDecode(r,i);g[a++]=n.qmap[d],C=EA(n,c,d)}return A.do_rev&&xA(g,t,s,e),g}function xA(r,e,t,A){let n=0,s=0;for(;s<e;){if(t[n]){let o=0,i=A[n]-1;for(;o<i;){const g=r[s+o];r[s+o]=r[s+i],r[s+i]=g,o++,i--}}s+=A[n++]}}function DA(r,e){const t=new L(r);return SA(t,e)}function he(r,e){return r&(1<<e)-1}function RA(r,e){let t=0;for(;e>=r[t+1];)t++;return t}function nt(r,e){const t=1<<e,A=new Array(t);let n=0;for(let s=0;s<t;s++){for(;s>=r[n+1];)n++;A[s]=n}return A}function fe(r,e,t,A){return t*(r>>A)+(r&(1<<A)-1)-e}function ue(r,e){return e<32768&&(e=(e<<16)+r.ReadUint16()),e}function bA(r,e){const t=r.ReadUint7(),A=r.ReadUint7();if(t&1)var n=r.ReadData((t-1)/2);else{const i=r.ReadUint7();var n=r.ReadData(i);n=ye(new L(n),t/2,e)}var n=new L(n);const s=new Array(256);let o=n.ReadByte();o==0&&(o=256);for(let i=0;i<o;i++)s[n.ReadByte()]=1;return[s,n,A]}function _A(r,e,t,A){new L(r);const n=new Uint8Array(A);let s=0;for(let o=0;s<A;o++){const i=r[o];if(e[i]){const g=t.ReadUint7();for(let c=0;c<=g;c++)n[s++]=i}else n[s++]=i}return n}function kA(r){const e=r.ReadByte(),t=new Array(e);for(let n=0;n<e;n++)t[n]=r.ReadByte();const A=r.ReadUint7();return[t,e,A]}function NA(r,e,t,A){const n=new Uint8Array(A);let s=0;if(t<=1)for(var o=0;o<A;o++)n[o]=e[0];else if(t<=2)for(o=0;o<A;o++){if(o%8==0)var i=r[s++];n[o]=e[i&1],i>>=1}else if(t<=4)for(o=0;o<A;o++){if(o%4==0)var i=r[s++];n[o]=e[i&3],i>>=2}else if(t<=16)for(o=0;o<A;o++){if(o%2==0)var i=r[s++];n[o]=e[i&15],i>>=4}return n}function FA(r,e){const t=r.ReadByte(),A=new Array(t),n=new Array(t);for(var s=0;s<t;s++)A[s]=r.ReadUint7();const o=new Array(t);for(var s=0;s<t;s++)n[s]=Math.floor(e/t)+(e%t>s),o[s]=it(r,n[s]);const i=new Uint8Array(e);for(var s=0;s<t;s++)for(let c=0;c<n[s];c++)i[c*t+s]=o[s][c];return i}function rt(r){const e=new L(r);return it(e,0)}function it(r,e){const t=r.ReadByte(),A=t&1,n=t&4,s=t&8,o=t&16,i=t&32,g=t&64,c=t&128,a=n?32:4;if(o||(e=r.ReadUint7()),s)return FA(r,e);if(c)var C=e,[d,l,e]=kA(r);if(g)var u=e,[h,I,e]=bA(r,a);if(i)var f=r.ReadData(e);else if(A==0)var f=ye(r,e,a);else var f=MA(r,e,a);return g&&(f=_A(f,h,I,u)),c&&(f=NA(f,d,l,C)),f}function st(r){const e=new Array(256);for(let s=0;s<256;s++)e[s]=0;let t=0,A=r.ReadByte(),n=A;do e[A]=1,t>0?(t--,A++):(A=r.ReadByte(),A==n+1&&(t=r.ReadByte())),n=A;while(A!=0);return e}function qA(r,e,t){for(var A=0;A<256;A++)e[A]=0;const n=st(r);for(var A=0;A<256;A++)n[A]>0&&(e[A]=r.ReadUint7());ot(e,12),t[0]=0;for(var A=0;A<=255;A++)t[A+1]=t[A]+e[A]}function ye(r,e,t){const A=new Array(256),n=new Array(256);qA(r,A,n);const s=nt(n,12),o=new Array(t);for(var i=0;i<t;i++)o[i]=r.ReadUint32();const g=new Uint8Array(e);for(var i=0;i<e;i++){const a=i&t-1,C=he(o[a],12),d=s[C];g[i]=d,o[a]=fe(o[a],n[d],A[d],12),o[a]=ue(r,o[a])}return g}function ot(r,e){let t=0;for(var A=0;A<256;A++)t+=r[A];if(t==0||t==1<<e)return;let n=0;for(;t<1<<e;)t*=2,n++;for(var A=0;A<256;A++)r[A]<<=n}function LA(r,e,t,A){for(var n=0;n<256;n++){e[n]=new Array(256),t[n]=new Array(256);for(var s=0;s<256;s++)e[n][s]=0}const o=st(r);for(var n=0;n<256;n++){if(!o[n])continue;let g=0;for(var s=0;s<256;s++)o[s]&&(g>0?g--:(e[n][s]=r.ReadUint7(),e[n][s]==0&&(g=r.ReadByte())));ot(e[n],A),t[n][0]=0;for(var s=0;s<256;s++)t[n][s+1]=t[n][s]+e[n][s]}}function MA(r,e,t){var A=r.ReadByte();const n=A>>4;var s=r;if(A&1){const f=r.ReadUint7(),B=r.ReadUint7();var A=new L(r.ReadData(B)),s=new L(ye(A,f,4))}const o=new Array(256),i=new Array(256);LA(s,o,i,n);const g=new Array(256);for(var c=0;c<256;c++)g[c]=nt(i[c],n);const a=new Array(t),C=new Array(t);for(var d=0;d<t;d++)a[d]=r.ReadUint32(),C[d]=0;const l=new Uint8Array(e),u=Math.floor(e/t);for(var c=0;c<u;c++)for(var d=0;d<t;d++){var h=he(a[d],n),I=g[C[d]][h];l[c+d*u]=I,a[d]=fe(a[d],i[C[d]][I],o[C[d]][I],n),a[d]=ue(r,a[d]),C[d]=I}for(c=t*c;c<e;){var h=he(a[t-1],n),I=RA(i[C[t-1]],h);l[c++]=I,a[t-1]=fe(a[t-1],i[C[t-1]][I],o[C[t-1]][I],n),a[t-1]=ue(r,a[t-1]),C[t-1]=I}return l}function vA(r){let e=0;for(const t of r)e+=t.length;return e}function OA(r){const e=new Uint8Array(vA(r));let t=0;for(const A of r)e.set(A,t),t+=A.length;return e}const PA=new tt,re=0,Oe=1,Pe=2,Ue=3,UA=4,HA=5,He=7,Te=8,Ge=9,at=10,TA=12;function GA(r,e,t,A){let n=-1;const s=new Array(256);for(;!r.EOF();){const o=r.ReadByte(),i=o&128,g=o&64,c=o&63;if(i&&(n++,s[n]=new Array(13)),c!=re&&i){const a=new Array(A-1).fill(at);s[n][re]=new L(OA([new Uint8Array(c),a]))}if(g){const a=r.ReadByte(),C=r.ReadByte();s[n][c]=new L(s[a][C].buf)}else{const a=r.ReadUint7(),C=r.ReadData(a);s[n][c]=t?PA.decode(C):rt(C),s[n][c]=new L(s[n][c])}}return s}function Je(r,e){let t=r+"";for(;t.length<e;)t="0"+t;return t}function JA(r,e,t,A){let n=r[0][re].ReadByte();const s=r[0][n].ReadUint32(),o=A-s;if(n==HA)return e[A]=e[o],t[A]=t[o],e[A];let i=1;e[A]="",t[A]=new Array(256);do{switch(n=r[i][re].ReadByte(),n){case Pe:t[A][i]=r[i][Pe].ReadChar();break;case Oe:t[A][i]=r[i][Oe].ReadString();break;case He:t[A][i]=r[i][He].ReadUint32();break;case Ue:var g=r[i][Ue].ReadUint32(),c=r[i][UA].ReadByte();t[A][i]=Je(g,c);break;case Te:t[A][i]=(t[o][i]>>0)+r[i][Te].ReadByte();break;case Ge:var g=(t[o][i]>>0)+r[i][Ge].ReadByte(),c=t[o][i].length;t[A][i]=Je(g,c);break;case at:t[A][i]=t[o][i];break;default:t[A][i]="";break}e[A]+=t[A][i++]}while(n!=TA);return e[A]}function YA(A,e,t){var A=new L(A);A.ReadUint32();const n=A.ReadUint32(),s=A.ReadByte(),o=GA(A,e,s,n),i=new Array(n),g=new Array(n);let c="";for(let a=0;a<n;a++)c+=JA(o,i,g,a)+t;return c}function KA(r){return rt(r)}function zA(r){return new tt().decode(r)}function VA(r){return DA(r,[])}function $A(r){const e=YA(r,0,"\0");return Uint8Array.from(Array.from(e).map(t=>t.charCodeAt(0)))}function ct(r,e,t){if(t)return t;if(r)return new Dt(r);if(e)return new Rt(e);throw new Error("no url, path, or filehandle provided, cannot open")}const x=12,j=1<<x,ie=1<<23;class gt{constructor(){this.F=void 0,this.C=void 0}}class WA{constructor(){this.fc=new Array(256);for(let e=0;e<this.fc.length;e+=1)this.fc[e]=new gt;this.R=null}}class XA{constructor(){this.start=void 0,this.freq=void 0}}function jA(r,e,t){if(!(e<=65536))throw new D("assertion failed: start <= 1<<16");if(!(t<=65536-e))throw new D("assertion failed: freq <= 1<<16");r.start=e,r.freq=t}function dt(r,e,t,A){const n=(1<<A)-1;return t*(r>>A)+(r&n)-e}function ZA(r,e,t){return dt(r,e.start,e.freq,t)}function en(r,e){return r&(1<<e)-1}function tn(r,e,t,A,n){const s=(1<<n)-1;if(r=A*(r>>n)+(r&s)-t,r<ie)do{const o=255&e.get();r=r<<8|o}while(r<ie);return r}function An(r,e,t,A){return tn(r,e,t.start,t.freq,A)}function nn(r,e){if(r<ie)do r=r<<8|255&e.get();while(r<ie);return r}const E={FC:gt,AriDecoder:WA,DecodingSymbol:XA,symbolInit:jA,advanceStep:dt,advanceSymbolStep:ZA,get:en,advanceSymbol:An,renormalize:nn};function rn(r,e,t,A){let n=r.getInt(),s=r.getInt(),o=r.getInt(),i=r.getInt();const g=A.remaining(),c=g&-4;for(let C=0;C<c;C+=4){const d=e.R[E.get(n,x)],l=e.R[E.get(s,x)],u=e.R[E.get(o,x)],h=e.R[E.get(i,x)];A.putAt(C,d),A.putAt(C+1,l),A.putAt(C+2,u),A.putAt(C+3,h),n=E.advanceSymbolStep(n,t[255&d],x),s=E.advanceSymbolStep(s,t[255&l],x),o=E.advanceSymbolStep(o,t[255&u],x),i=E.advanceSymbolStep(i,t[255&h],x),n=E.renormalize(n,r),s=E.renormalize(s,r),o=E.renormalize(o,r),i=E.renormalize(i,r)}A.setPosition(c);let a;switch(g&3){case 0:break;case 1:a=e.R[E.get(n,x)],E.advanceSymbol(n,r,t[255&a],x),A.put(a);break;case 2:a=e.R[E.get(n,x)],E.advanceSymbol(n,r,t[255&a],x),A.put(a),a=e.R[E.get(s,x)],E.advanceSymbol(s,r,t[255&a],x),A.put(a);break;case 3:a=e.R[E.get(n,x)],E.advanceSymbol(n,r,t[255&a],x),A.put(a),a=e.R[E.get(s,x)],E.advanceSymbol(s,r,t[255&a],x),A.put(a),a=e.R[E.get(o,x)],E.advanceSymbol(o,r,t[255&a],x),A.put(a);break;default:throw new D("invalid output size encountered during rANS decoding")}A.setPosition(0)}function sn(r,e,t,A){const n=e.remaining();let s=r.getInt(),o=r.getInt(),i=r.getInt(),g=r.getInt();const c=n>>2;let a=0,C=c,d=2*c,l=3*c,u=0,h=0,I=0,f=0;for(;a<c;a+=1,C+=1,d+=1,l+=1){const B=255&t[u].R[E.get(s,x)],w=255&t[h].R[E.get(o,x)],p=255&t[I].R[E.get(i,x)],m=255&t[f].R[E.get(g,x)];e.putAt(a,B),e.putAt(C,w),e.putAt(d,p),e.putAt(l,m),s=E.advanceSymbolStep(s,A[u][B],x),o=E.advanceSymbolStep(o,A[h][w],x),i=E.advanceSymbolStep(i,A[I][p],x),g=E.advanceSymbolStep(g,A[f][m],x),s=E.renormalize(s,r),o=E.renormalize(o,r),i=E.renormalize(i,r),g=E.renormalize(g,r),u=B,h=w,I=p,f=m}for(;l<n;l+=1){const B=255&t[f].R[E.get(g,x)];e.putAt(l,B),g=E.advanceSymbol(g,r,A[f][B],x),f=B}}function Ct(r){if(!r)throw new D("assertion failed")}function on(r,e,t){let A=0,n=0,s=r.get()&255;do e.fc[s]==null&&(e.fc[s]=new E.FC),e.fc[s].F=r.get()&255,e.fc[s].F>=128&&(e.fc[s].F&=-129,e.fc[s].F=(e.fc[s].F&127)<<8|r.get()&255),e.fc[s].C=n,E.symbolInit(t[s],e.fc[s].C,e.fc[s].F),e.R||(e.R=new Array(j)),e.R.fill(s,n,n+e.fc[s].F),n+=e.fc[s].F,A===0&&s+1===(255&r.getByteAt(r.position()))?(s=r.get()&255,A=r.get()&255):A!==0?(A-=1,s+=1):s=r.get()&255;while(s!==0);Ct(n<j)}function an(r,e,t){let A=0,n=255&r.get();do{let s=0,o=0,i=255&r.get();e[n]==null&&(e[n]=new E.AriDecoder);do e[n].fc[i]==null&&(e[n].fc[i]=new E.FC),e[n].fc[i].F=255&r.get(),e[n].fc[i].F>=128&&(e[n].fc[i].F&=-129,e[n].fc[i].F=(e[n].fc[i].F&127)<<8|255&r.get()),e[n].fc[i].C=o,e[n].fc[i].F===0&&(e[n].fc[i].F=j),t[n][i]==null&&(t[n][i]=new E.RansDecSymbol),E.symbolInit(t[n][i],e[n].fc[i].C,e[n].fc[i].F),e[n].R==null&&(e[n].R=new Array(j)),e[n].R.fill(i,o,o+e[n].fc[i].F),o+=e[n].fc[i].F,Ct(o<=j),s===0&&i+1===(255&r.getByteAt(r.position()))?(i=255&r.get(),s=255&r.get()):s!==0?(s-=1,i+=1):i=255&r.get();while(i!==0);A===0&&n+1===(255&r.getByteAt(r.position()))?(n=255&r.get(),A=255&r.get()):A!==0?(A-=1,n+=1):n=255&r.get()}while(n!==0)}const cn=4;function gn(r,e){const t=new E.AriDecoder,A=new Array(256);for(let n=0;n<A.length;n+=1)A[n]=new E.DecodingSymbol;return on(r,t,A),rn(r,t,A,e),e}function dn(r,e){const t=new Array(256);for(let n=0;n<t.length;n+=1)t[n]=new E.AriDecoder;const A=new Array(256);for(let n=0;n<A.length;n+=1){A[n]=new Array(256);for(let s=0;s<A[n].length;s+=1)A[n][s]=new E.DecodingSymbol}return an(r,t,A),sn(r,e,t,A),e}class Ye{constructor(e,t=0){this._buffer=e,this._dataView=new DataView(e.buffer),this._position=t,this.length=e.length}get(){const e=this._buffer[this._position];return this._position+=1,e}getByte(){return this.get()}getByteAt(e){return this._buffer[e]}position(){return this._position}put(e){return this._buffer[this._position]=e,this._position+=1,e}putAt(e,t){return this._buffer[e]=t,t}setPosition(e){return this._position=e,e}getInt(){const e=this._dataView.getInt32(this._position,!0);return this._position+=4,e}remaining(){return this._buffer.length-this._position}}function Cn(r,e,t=0){if(r.length===0)return e.fill(0),e;const A=new Ye(r,t),n=A.get();if(n!==0&&n!==1)throw new D(`Invalid rANS order ${n}`);if(A.getInt()!==A.remaining()-cn)throw new D("Incorrect input length.");const o=A.getInt(),i=new Ye(e||new Uint8Array(o));if(i.length<o)throw new D(`Output buffer too small to fit ${o} bytes.`);switch(n){case 0:return gn(A,i);case 1:return dn(A,i);default:throw new D(`Invalid rANS order: ${n}`)}}function ln(r){const e=r.split(/\r?\n/),t=[];for(const A of e){const[n,...s]=A.split(/\t/);n&&t.push({tag:n.slice(1),data:s.map(o=>{const i=o.indexOf(":");return i!==-1?{tag:o.slice(0,i),value:o.slice(i+1)}:{tag:o,value:""}})})}return t}function lt(r){return bt.inflate(r)}class ae extends Error{}function G(r,e,t){let A=0;if(e.bytePosition+(7-e.bitPosition+t)/8>r.length)throw new ae("read error during decoding. the file seems to be truncated.");for(let n=t;n;n--)A<<=1,A|=r[e.bytePosition]>>e.bitPosition&1,e.bitPosition-=1,e.bitPosition<0&&(e.bytePosition+=1),e.bitPosition&=7;return A}var It={exports:{}},ht={exports:{}};(function(){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,A){return t<<A|t>>>32-A},rotr:function(t,A){return t<<32-A|t>>>A},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var A=0;A<t.length;A++)t[A]=e.endian(t[A]);return t},randomBytes:function(t){for(var A=[];t>0;t--)A.push(Math.floor(Math.random()*256));return A},bytesToWords:function(t){for(var A=[],n=0,s=0;n<t.length;n++,s+=8)A[s>>>5]|=t[n]<<24-s%32;return A},wordsToBytes:function(t){for(var A=[],n=0;n<t.length*32;n+=8)A.push(t[n>>>5]>>>24-n%32&255);return A},bytesToHex:function(t){for(var A=[],n=0;n<t.length;n++)A.push((t[n]>>>4).toString(16)),A.push((t[n]&15).toString(16));return A.join("")},hexToBytes:function(t){for(var A=[],n=0;n<t.length;n+=2)A.push(parseInt(t.substr(n,2),16));return A},bytesToBase64:function(t){for(var A=[],n=0;n<t.length;n+=3)for(var s=t[n]<<16|t[n+1]<<8|t[n+2],o=0;o<4;o++)n*8+o*6<=t.length*8?A.push(r.charAt(s>>>6*(3-o)&63)):A.push("=");return A.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var A=[],n=0,s=0;n<t.length;s=++n%4)s!=0&&A.push((r.indexOf(t.charAt(n-1))&Math.pow(2,-2*s+8)-1)<<s*2|r.indexOf(t.charAt(n))>>>6-s*2);return A}};ht.exports=e})();var In=ht.exports,Be={utf8:{stringToBytes:function(r){return Be.bin.stringToBytes(unescape(encodeURIComponent(r)))},bytesToString:function(r){return decodeURIComponent(escape(Be.bin.bytesToString(r)))}},bin:{stringToBytes:function(r){for(var e=[],t=0;t<r.length;t++)e.push(r.charCodeAt(t)&255);return e},bytesToString:function(r){for(var e=[],t=0;t<r.length;t++)e.push(String.fromCharCode(r[t]));return e.join("")}}},Ke=Be;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var hn=function(r){return r!=null&&(ft(r)||fn(r)||!!r._isBuffer)};function ft(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function fn(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&ft(r.slice(0,0))}(function(){var r=In,e=Ke.utf8,t=hn,A=Ke.bin,n=function(s,o){s.constructor==String?o&&o.encoding==="binary"?s=A.stringToBytes(s):s=e.stringToBytes(s):t(s)?s=Array.prototype.slice.call(s,0):!Array.isArray(s)&&s.constructor!==Uint8Array&&(s=s.toString());for(var i=r.bytesToWords(s),g=s.length*8,c=1732584193,a=-271733879,C=-1732584194,d=271733878,l=0;l<i.length;l++)i[l]=(i[l]<<8|i[l]>>>24)&16711935|(i[l]<<24|i[l]>>>8)&4278255360;i[g>>>5]|=128<<g%32,i[(g+64>>>9<<4)+14]=g;for(var u=n._ff,h=n._gg,I=n._hh,f=n._ii,l=0;l<i.length;l+=16){var B=c,w=a,p=C,m=d;c=u(c,a,C,d,i[l+0],7,-680876936),d=u(d,c,a,C,i[l+1],12,-389564586),C=u(C,d,c,a,i[l+2],17,606105819),a=u(a,C,d,c,i[l+3],22,-1044525330),c=u(c,a,C,d,i[l+4],7,-176418897),d=u(d,c,a,C,i[l+5],12,1200080426),C=u(C,d,c,a,i[l+6],17,-1473231341),a=u(a,C,d,c,i[l+7],22,-45705983),c=u(c,a,C,d,i[l+8],7,1770035416),d=u(d,c,a,C,i[l+9],12,-1958414417),C=u(C,d,c,a,i[l+10],17,-42063),a=u(a,C,d,c,i[l+11],22,-1990404162),c=u(c,a,C,d,i[l+12],7,1804603682),d=u(d,c,a,C,i[l+13],12,-40341101),C=u(C,d,c,a,i[l+14],17,-1502002290),a=u(a,C,d,c,i[l+15],22,1236535329),c=h(c,a,C,d,i[l+1],5,-165796510),d=h(d,c,a,C,i[l+6],9,-1069501632),C=h(C,d,c,a,i[l+11],14,643717713),a=h(a,C,d,c,i[l+0],20,-373897302),c=h(c,a,C,d,i[l+5],5,-701558691),d=h(d,c,a,C,i[l+10],9,38016083),C=h(C,d,c,a,i[l+15],14,-660478335),a=h(a,C,d,c,i[l+4],20,-405537848),c=h(c,a,C,d,i[l+9],5,568446438),d=h(d,c,a,C,i[l+14],9,-1019803690),C=h(C,d,c,a,i[l+3],14,-187363961),a=h(a,C,d,c,i[l+8],20,1163531501),c=h(c,a,C,d,i[l+13],5,-1444681467),d=h(d,c,a,C,i[l+2],9,-51403784),C=h(C,d,c,a,i[l+7],14,1735328473),a=h(a,C,d,c,i[l+12],20,-1926607734),c=I(c,a,C,d,i[l+5],4,-378558),d=I(d,c,a,C,i[l+8],11,-2022574463),C=I(C,d,c,a,i[l+11],16,1839030562),a=I(a,C,d,c,i[l+14],23,-35309556),c=I(c,a,C,d,i[l+1],4,-1530992060),d=I(d,c,a,C,i[l+4],11,1272893353),C=I(C,d,c,a,i[l+7],16,-155497632),a=I(a,C,d,c,i[l+10],23,-1094730640),c=I(c,a,C,d,i[l+13],4,681279174),d=I(d,c,a,C,i[l+0],11,-358537222),C=I(C,d,c,a,i[l+3],16,-722521979),a=I(a,C,d,c,i[l+6],23,76029189),c=I(c,a,C,d,i[l+9],4,-640364487),d=I(d,c,a,C,i[l+12],11,-421815835),C=I(C,d,c,a,i[l+15],16,530742520),a=I(a,C,d,c,i[l+2],23,-995338651),c=f(c,a,C,d,i[l+0],6,-198630844),d=f(d,c,a,C,i[l+7],10,1126891415),C=f(C,d,c,a,i[l+14],15,-1416354905),a=f(a,C,d,c,i[l+5],21,-57434055),c=f(c,a,C,d,i[l+12],6,1700485571),d=f(d,c,a,C,i[l+3],10,-1894986606),C=f(C,d,c,a,i[l+10],15,-1051523),a=f(a,C,d,c,i[l+1],21,-2054922799),c=f(c,a,C,d,i[l+8],6,1873313359),d=f(d,c,a,C,i[l+15],10,-30611744),C=f(C,d,c,a,i[l+6],15,-1560198380),a=f(a,C,d,c,i[l+13],21,1309151649),c=f(c,a,C,d,i[l+4],6,-145523070),d=f(d,c,a,C,i[l+11],10,-1120210379),C=f(C,d,c,a,i[l+2],15,718787259),a=f(a,C,d,c,i[l+9],21,-343485551),c=c+B>>>0,a=a+w>>>0,C=C+p>>>0,d=d+m>>>0}return r.endian([c,a,C,d])};n._ff=function(s,o,i,g,c,a,C){var d=s+(o&i|~o&g)+(c>>>0)+C;return(d<<a|d>>>32-a)+o},n._gg=function(s,o,i,g,c,a,C){var d=s+(o&g|i&~g)+(c>>>0)+C;return(d<<a|d>>>32-a)+o},n._hh=function(s,o,i,g,c,a,C){var d=s+(o^i^g)+(c>>>0)+C;return(d<<a|d>>>32-a)+o},n._ii=function(s,o,i,g,c,a,C){var d=s+(i^(o|~g))+(c>>>0)+C;return(d<<a|d>>>32-a)+o},n._blocksize=16,n._digestsize=16,It.exports=function(s,o){if(s==null)throw new Error("Illegal argument "+s);var i=r.wordsToBytes(n(s,o));return o&&o.asBytes?i:o&&o.asString?A.bytesToString(i):r.bytesToHex(i)}})();var un=It.exports;const Bn=me(un),ze=65536,V=ze*ze,Qn=1<<24,En=Qn*V;function mn(r){return r&-128?r&-16384?r&-2097152?r&-268435456?5:4:3:2:1}function Q(r,e){let t=e;const A=r[t];let n;return A<128?(n=A,t+=1):A<192?(n=(A&63)<<8|r[t+1],t+=2):A<224?(n=(A&31)<<16|r[t+1]<<8|r[t+2],t+=3):A<240?(n=(A&15)<<24|r[t+1]<<16|r[t+2]<<8|r[t+3],t+=4):(n=(A&15)<<28|r[t+1]<<20|r[t+2]<<12|r[t+3]<<4|r[t+4]&15,t+=5),[n,t-e]}function se(r,e){let t=e;const A=r[t];let n;return A<128?(n=A,t+=1):A<192?(n=(A<<8|r[t+1])&16383,t+=2):A<224?(n=(A&63)<<16|r[t+1]<<8|r[t+2],t+=3):A<240?(n=(A&31)<<24|r[t+1]<<16|r[t+2]<<8|r[t+3],t+=4):A<248?(n=(r[t]&15)*V+(r[t+1]<<24|r[t+2]<<16|r[t+3]<<8|r[t+4]),t+=5):A<252?(n=((r[t]&7)<<8|r[t+1])*V+(r[t+2]<<24|r[t+3]<<16|r[t+4]<<8|r[t+5]),t+=6):A<254?(n=((r[t]&3)<<16|r[t+1]<<8|r[t+2])*V+(r[t+3]<<24|r[t+4]<<16|r[t+5]<<8|r[t+6]),t+=7):A<255?(n=(r[t+1]<<24|r[t+2]<<16|r[t+3]<<8|r[t+4])*V+(r[t+5]<<24|r[t+6]<<16|r[t+7]<<8|r[t+8]),t+=8):(n=r[t+1]*En+(r[t+2]<<24|r[t+3]<<16|r[t+4]<<8|r[t+5])*V+(r[t+6]<<24|r[t+7]<<16|r[t+8]<<8|r[t+9]),t+=9),[n,t-e]}function J(r,e,t=0,A=0){const{offset:n,value:s}=e(r,t);return{...s,_endPosition:n+A,_size:n-t}}function ce(r,e){const t=r.prototype[e],A=`_memo_${e}`;r.prototype[e]=function(){if(!(A in this)){const s=t.call(this);this[A]=s,Promise.resolve(s).catch(()=>{delete this[A]})}return this[A]}}function wn(r){return Bn(r.toUpperCase().replaceAll(/[^\u0021-\u007e]/g,""))}function ut(){return{parser:(r,e=0)=>{const t=new DataView(r.buffer,r.byteOffset,r.length),A=new TextDecoder("utf8");let n=0;const s=A.decode(r.subarray(n,n+4));n+=4;const o=t.getUint8(n);n+=1;const i=t.getUint8(n);n+=1;const g=A.decode(r.subarray(n,n+20)).replaceAll("\0","");return n+=20,{value:{magic:s,majorVersion:o,minorVersion:i,fileId:g},offset:n}},maxLength:26}}function pn(){return{parser:(e,t=0)=>{const A=e,n=new DataView(A.buffer,A.byteOffset,A.length);let s=0;const o=n.getUint8(s),i=["raw","gzip","bzip2","lzma","rans","rans4x16","arith","fqzcomp","tok3"][o];if(!i)throw new Error(`compression method number ${o} not implemented`);s+=1;const g=n.getUint8(s),c=["FILE_HEADER","COMPRESSION_HEADER","MAPPED_SLICE_HEADER","UNMAPPED_SLICE_HEADER","EXTERNAL_DATA","CORE_DATA"][g];if(!c)throw new Error(`invalid block content type id ${g}`);s+=1;const[a,C]=Q(e,s);s+=C;const[d,l]=Q(e,s);s+=l;const[u,h]=Q(e,s);return s+=h,{offset:s,value:{uncompressedSize:u,compressedSize:d,contentId:a,contentType:c,compressionMethod:i}}},maxLength:17}}function yn(){return{parser:(r,e)=>{const t=r,n=new DataView(t.buffer,t.byteOffset,t.length).getUint32(e,!0);return e+=4,{offset:e,value:{crc32:n}}},maxLength:4}}function Ve(r,e,t){const n=new TextDecoder("utf8").decode(r.subarray(e,t)),s=[];for(let o=0;o<n.length;o+=3)s.push(n.slice(o,o+3));return s}function Sn(){return{parser:(r,e)=>{const[t,A]=Q(r,e);e+=A;const n=r.subarray(e,e+t);e+=t;const s=[];let o=0,i=0;for(;i<n.length;i++)n[i]||(s.push(Ve(n,o,i)),o=i+1);return i>o&&s.push(Ve(n,o,i)),{value:{size:t,ents:s},offset:e}}}}function xn(){return{parser:(r,e)=>{const t=r,A=new DataView(t.buffer,t.byteOffset,t.length),[n,s]=Q(r,e);e+=s;const[o,i]=Q(r,e);e+=i;const g=[];for(let c=0;c<o;c++){const a=String.fromCharCode(r[e])+String.fromCharCode(r[e+1]);if(e+=2,a==="MI"||a==="UI"||a==="PI"||a==="RN"||a==="AP"||a==="RR")g.push({key:a,value:!!A.getUint8(e)}),e+=1;else if(a==="SM")g.push({key:a,value:[A.getUint8(e),A.getUint8(e+1),A.getUint8(e+2),A.getUint8(e+3),A.getUint8(e+4)]}),e+=5;else if(a==="TD"){const{offset:C,value:d}=Sn().parser(r,e);g.push({key:a,value:d.ents}),e=C}else throw new Error(`unknown key ${a}`)}return{value:{mapSize:n,mapCount:o,ents:g},offset:e}}}}function Ie(r){const e={};for(const{key:t,value:A}of r.ents)e[t]&&console.warn(`duplicate key ${t} in map`),e[t]=A;return e}function X(r){return typeof r.refSeqId=="number"}function Dn(r){let e=0;return e+=5,e+=9,e+=5*2,e+=16,{parser:(A,n)=>{const[s,o]=Q(A,n);n+=o;let i=0;if(r>=3){const[u,h]=se(A,n);n+=h,i=u}else if(r===2){const[u,h]=Q(A,n);n+=h,i=u}else console.warn("recordCounter=0");const[g,c]=Q(A,n);n+=c;const[a,C]=Q(A,n);n+=C;const d=[];for(let u=0;u<a;u++){const[h,I]=Q(A,n);n+=I,d.push(h)}let l;return r>=2&&(l=[...A.subarray(n,n+16)],n+=16),{value:{recordCounter:i,md5:l,contentIds:d,numContentIds:a,numBlocks:g,numRecords:s},offset:n}},maxLength:A=>e+A*5}}function Rn(r){let e=0;return e+=5*4,e+=9,e+=5*3,e+=16,{parser:(t,A)=>{const[n,s]=Q(t,A);A+=s;const[o,i]=Q(t,A);A+=i;const[g,c]=Q(t,A);A+=c;const[a,C]=Q(t,A);A+=C;let d=0;if(r>=3){const[m,R]=se(t,A);A+=R,d=m}else if(r===2){const[m,R]=Q(t,A);A+=R,d=m}else console.warn("majorVersion is <2, recordCounter set to 0");const[l,u]=Q(t,A);A+=u;const[h,I]=Q(t,A);A+=I;const f=[];for(let m=0;m<h;m++){const[R,k]=Q(t,A);A+=k,f.push(R)}const[B,w]=Q(t,A);A+=w;let p;return r>=2&&(p=[...t.subarray(A,A+16)],A+=16),{value:{md5:p,numBlocks:l,numRecords:a,numContentIds:h,refSeqSpan:g,refSeqId:n,refSeqStart:o,recordCounter:d,refBaseBlockId:B,contentIds:f},offset:A}},maxLength:t=>e+t*5}}function bn(){return{parser:(r,e)=>Z(r,e)}}function Z(r,e){const t=r,A=new DataView(t.buffer,t.byteOffset,t.length),[n,s]=Q(r,e);e+=s;const[o,i]=Q(r,e);e+=i;const g={};if(n!==0)if(n===1){const[c,a]=Q(r,e);g.blockContentId=c,e+=a}else if(n===2){const[c,a]=Q(r,e);g.offset=c,e+=a;const[C,d]=Q(r,e);g.M=C,e+=d}else if(n===3){const c=Q(r,e),a=c[0];e+=c[1];const C=[];for(let h=0;h<a;h++){const I=Q(r,e);C.push(I[0]),e+=I[1]}g.symbols=C;const d=Q(r,e),l=c[0];g.numLengths=l,g.numCodes=a,g.numLengths=l,e+=d[1];const u=[];for(let h=0;h<l;h++){const I=Q(r,e);e+=I[1],u.push(I[0])}g.bitLengths=u}else if(n===4){const{value:c,offset:a}=Z(r,e);g.lengthsEncoding=c,e=a;const{value:C,offset:d}=Z(r,e);g.valuesEncoding=C,e=d}else if(n===5){g.stopByte=A.getUint8(e),e+=1;const[c,a]=Q(r,e);g.blockContentId=c,e+=a}else if(n===6){const[c,a]=Q(r,e);g.offset=c,e+=a;const[C,d]=Q(r,e);g.length=C,e+=d}else if(n===7){const[c,a]=Q(r,e);g.offset=c,e+=a;const[C,d]=Q(r,e);g.K=C,e+=d}else if(n===8){const[c,a]=Q(r,e);g.offset=c,e+=a;const[C,d]=Q(r,e);g.log2m=C,e+=d}else if(n===9){const[c,a]=Q(r,e);g.offset=c,e+=a}else throw new Error(`unknown codecId ${n}`);return{value:{codecId:n,parametersBytes:o,parameters:g},offset:e}}function Bt(){return{parser:(r,e)=>{const[t,A]=Q(r,e);e+=A;const[n,s]=Q(r,e);e+=s;const o=[];for(let i=0;i<n;i++){const g=String.fromCharCode(r[e])+String.fromCharCode(r[e+1]);e+=2;const{value:c,offset:a}=Z(r,e);e=a,o.push({key:g,value:c})}return{value:{mapSize:t,ents:o,mapCount:n},offset:e}}}}function Qt(){return{parser:(r,e)=>{const[t,A]=Q(r,e);e+=A;const[n,s]=Q(r,e);e+=s;const o=[];for(let i=0;i<n;i++){const[g,c]=Q(r,e);e+=c;const a=String.fromCharCode(g>>16&255)+String.fromCharCode(g>>8&255)+String.fromCharCode(g&255),{value:C,offset:d}=Z(r,e);e=d,o.push({key:a,value:C})}return{value:{mapSize:t,ents:o,mapCount:n},offset:e}}}}function _n(){return{parser:(r,e)=>{const{value:t,offset:A}=xn().parser(r,e);e=A;const{value:n,offset:s}=Bt().parser(r,e);e=s;const{value:o,offset:i}=Qt().parser(r,e);return e=i,{value:{dataSeriesEncoding:Ie(n),preservation:Ie(t),tagEncoding:Ie(o)},offset:e}}}}function kn(r){let e=4;return e+=5*4,e+=9,e+=9,e+=10,{maxLength:e,parser:(t,A)=>{const n=t,o=new DataView(n.buffer,n.byteOffset,n.length).getInt32(A,!0);A+=4;const[i,g]=Q(t,A);A+=g;const[c,a]=Q(t,A);A+=a;const[C,d]=Q(t,A);A+=d;const[l,u]=Q(t,A);A+=u;let h=0;if(r>=3){const[m,R]=se(t,A);h=m,A+=R}else if(r===2){const[m,R]=Q(t,A);h=m,A+=R}else console.warn("setting recordCounter=0");let I;if(r>1){const[m,R]=se(t,A);I=m,A+=R}const[f,B]=Q(t,A);A+=B;const[w,p]=Q(t,A);return A+=p,{value:{length:o,refSeqId:i,refSeqStart:c,alignmentSpan:C,numBlocks:f,numLandmarks:w,numBases:I,recordCounter:h,numRecords:l},offset:A}}}}function Nn(r){return{parser:(e,t)=>{const A=e,n=new DataView(A.buffer,A.byteOffset,A.length),[s,o]=Q(e,t);t+=o;const i=[];for(let c=0;c<s;c++){const[a,C]=Q(e,t);t+=C,i.push(a)}let g;return r>=3&&(g=n.getUint32(t,!0),t+=4),{value:{...g===void 0?{}:{crc32:g},numLandmarks:s,landmarks:i},offset:t}},maxLength:e=>5+5*e+4}}function T(r){return{cramFileDefinition:ut(),cramBlockHeader:pn(),cramBlockCrc32:yn(),cramDataSeriesEncodingMap:Bt(),cramTagEncodingMap:Qt(),cramCompressionHeader:_n(),cramEncoding:bn(),cramUnmappedSliceHeader:Dn(r),cramMappedSliceHeader:Rn(r),cramContainerHeader1:kn(r),cramContainerHeader2:Nn(r)}}function oe(r){let e="";for(let t=0;t<r.length&&r[t]!==0;t++)e+=String.fromCharCode(r[t]);return e}function Fn(r){const e=String.fromCharCode(r[0]),n=new DataView(r.buffer).getUint32(1,!0),s=new Array(n);if(r=r.slice(5),e==="c"){const o=new Int8Array(r.buffer);for(let i=0;i<n;i++)s[i]=o[i]}else if(e==="C"){const o=new Uint8Array(r.buffer);for(let i=0;i<n;i++)s[i]=o[i]}else if(e==="s"){const o=new Int16Array(r.buffer);for(let i=0;i<n;i++)s[i]=o[i]}else if(e==="S"){const o=new Uint16Array(r.buffer);for(let i=0;i<n;i++)s[i]=o[i]}else if(e==="i"){const o=new Int32Array(r.buffer);for(let i=0;i<n;i++)s[i]=o[i]}else if(e==="I"){const o=new Uint32Array(r.buffer);for(let i=0;i<n;i++)s[i]=o[i]}else if(e==="f"){const o=new Float32Array(r.buffer);for(let i=0;i<n;i++)s[i]=o[i]}else throw new Error(`unknown type: ${e}`);return s}function qn(r,e){if(r==="Z")return oe(e);if(r==="A")return String.fromCharCode(e[0]);if(r==="I")return new Uint32Array(e.buffer)[0];if(r==="i")return new Int32Array(e.buffer)[0];if(r==="s")return new Int16Array(e.buffer)[0];if(r==="S")return new Uint16Array(e.buffer)[0];if(r==="c")return new Int8Array(e.buffer)[0];if(r==="C")return e[0];if(r==="f")return new Float32Array(e.buffer)[0];if(r==="H")return Number.parseInt(oe(e).replace(/^0x/,""),16);if(r==="B")return Fn(e);throw new D(`Unrecognized tag type ${r}`)}function Ln(r,e,t,A,n){let s=0,o=r-1;const i=new Array(e);function g([c,a]){const C=t(a);if(c==="character")return String.fromCharCode(C);if(c==="string"){let d="";for(let l=0;l<C.byteLength;l++)d+=String.fromCharCode(C[l]);return d}else if(c==="numArray")return Array.from(C);return C}for(let c=0;c<e;c++){const a=String.fromCharCode(t("FC")),C=t("FP"),d={B:["character","BA"],S:["string",n>1?"SC":"IN"],X:["number","BS"],D:["number","DL"],I:["string","IN"],i:["character","BA"],b:["string","BB"],q:["numArray","QQ"],Q:["number","QS"],H:["number","HC"],P:["number","PD"],N:["number","RS"]}[a];if(!d)throw new D(`invalid read feature code "${a}"`);let l=g(d);const u={B:["number","QS"]}[a];u&&(l=[l,g(u)]),s+=C;const h=s;o+=C;const I=o;a==="D"||a==="N"?o+=l:a==="I"||a==="S"?o-=l.length:a==="i"&&(o-=1),i[c]={code:a,pos:h,refPos:I,data:l}}return i}function Mn(r,e,t,A,n,s,o,i,g){let c=e("BF");const a=e("CF");if(!X(A.parsedContent))throw new Error("slice header not mapped");const C=i>1&&A.parsedContent.refSeqId===-2?e("RI"):A.parsedContent.refSeqId,d=e("RL");let l=e("AP");t.APdelta&&(l=l+o.lastAlignmentStart),o.lastAlignmentStart=l;const u=e("RG");let h;t.readNamesIncluded&&(h=oe(e("RN")));let I,f,B;if($.isDetached(a)){const y=e("MF");let S;t.readNamesIncluded||(S=oe(e("RN")),h=S);const q=e("NS"),de=e("NP");(y||q>-1)&&(I={mateFlags:y,mateSequenceId:q,mateAlignmentStart:de,mateReadName:S}),f=e("TS"),xe.isUnmapped(y)&&(c=le.setMateUnmapped(c)),xe.isOnNegativeStrand(y)&&(c=le.setMateReverseComplemented(c))}else $.isWithMateDownstream(a)&&(B=e("NF")+g+1);const w=e("TL");if(w<0)throw new D("invalid TL index");const p={},m=t.getTagNames(w),R=m.length;for(let y=0;y<R;y++){const S=m[y],q=S.slice(0,2),de=S.slice(2,3),ee=t.getCodecForTag(S).decode(r,n,s,o);p[q]=ee===void 0?void 0:typeof ee=="number"?ee:qn(de,ee)}let k,F,U,v,z;if(le.isSegmentUnmapped(c))if($.isDecodeSequenceAsStar(a))z=null,v=null;else{const y=new Array(d);for(let S=0;S<y.length;S++)y[S]=e("BA");if(z=String.fromCharCode(...y),$.isPreservingQualityScores(a)){v=new Array(d);for(let S=0;S<y.length;S++)v[S]=e("QS")}}else{const y=e("FN");if(y&&(k=Ln(l,y,e,t,i)),F=d,k)for(const{code:S,data:q}of k)S==="D"||S==="N"?F+=q:S==="I"||S==="S"?F=F-q.length:S==="i"&&(F=F-1);if(Number.isNaN(F)&&(console.warn(`${h||`${C}:${l}`} record has invalid read features`),F=d),U=e("MQ"),$.isPreservingQualityScores(a)){v=new Array(d);for(let S=0;S<v.length;S++)v[S]=e("QS")}}return{readLength:d,sequenceId:C,cramFlags:a,flags:c,alignmentStart:l,readGroupId:u,readName:h,mateToUse:I,templateSize:f,mateRecordNumber:B,readFeatures:k,lengthOnRef:F,mappingQuality:U,qualityScores:v,readBases:z,tags:p}}function vn(r,e,t){function A(g){const c=[g];if(g.mateRecordNumber!==void 0&&g.mateRecordNumber>=0){const a=r[g.mateRecordNumber];if(!a)throw new D("intra-slice mate record not found, this file seems malformed");c.push(...A(a))}return c}const n=A(t),s=n.map(g=>g.alignmentStart),o=n.map(g=>g.alignmentStart+g.readLength-1),i=Math.max(...o)-Math.min(...s)+1;i>=0&&n.forEach(g=>{if(g.templateLength!==void 0)throw new D("mate pair group has some members that have template lengths already, this file seems malformed");g.templateLength=i})}function On(r,e){const t=Math.min(r.alignmentStart,e.alignmentStart),n=Math.max(r.alignmentStart+r.readLength-1,e.alignmentStart+e.readLength-1)-t+1;r.templateLength=n,e.templateLength=n}function Pn(r,e,t,A){const n=!!(A.mate||A.mateRecordNumber!==void 0&&A.mateRecordNumber!==e);t.readName||(t.readName=String(t.uniqueId),A.readName=t.readName),t.mate={sequenceId:A.sequenceId,alignmentStart:A.alignmentStart,uniqueId:A.uniqueId},A.readName&&(t.mate.readName=A.readName),!A.mate&&A.mateRecordNumber===void 0&&(A.mate={sequenceId:t.sequenceId,alignmentStart:t.alignmentStart,uniqueId:t.uniqueId},t.readName&&(A.mate.readName=t.readName)),t.flags|=b.BAM_FPAIRED,A.flags&b.BAM_FUNMAP&&(t.flags|=b.BAM_FMUNMAP),t.flags&b.BAM_FUNMAP&&(A.flags|=b.BAM_FMUNMAP),A.flags&b.BAM_FREVERSE&&(t.flags|=b.BAM_FMREVERSE),t.flags&b.BAM_FREVERSE&&(A.flags|=b.BAM_FMREVERSE),t.templateLength===void 0&&(n?vn(r,e,t):On(t,A)),t.mateRecordNumber=void 0}class Et{constructor(e,t,A){this.container=e,this.containerPosition=t,this.sliceSize=A,this.file=e.file}async getHeader(){const{majorVersion:e}=await this.file.getDefinition(),t=T(e),A=await this.container.getHeader(),n=await this.file.readBlock(A._endPosition+this.containerPosition);if(n.contentType==="MAPPED_SLICE_HEADER"){const s=J(n.content,t.cramMappedSliceHeader.parser,0,A._endPosition);return{...n,parsedContent:s}}else if(n.contentType==="UNMAPPED_SLICE_HEADER"){const s=J(n.content,t.cramUnmappedSliceHeader.parser,0,A._endPosition);return{...n,parsedContent:s}}else throw new D(`error reading slice header block, invalid content type ${n.contentType}`)}async getBlocks(){const e=await this.getHeader();let t=e._endPosition;const A=new Array(e.parsedContent.numBlocks);for(let n=0;n<A.length;n++){const s=await this.file.readBlock(t);A[n]=s,t=A[n]._endPosition}return A}async getCoreDataBlock(){return(await this.getBlocks())[0]}async _getBlocksContentIdIndex(){const e=await this.getBlocks(),t={};return e.forEach(A=>{A.contentType==="EXTERNAL_DATA"&&(t[A.contentId]=A)}),t}async getBlockByContentId(e){return(await this._getBlocksContentIdIndex())[e]}async getReferenceRegion(){const e=new TextDecoder("utf8"),t=(await this.getHeader()).parsedContent;if(!X(t))throw new Error("slice header not mapped");if(t.refSeqId<0)return;const A=await this.container.getCompressionScheme();if(A===void 0)throw new Error("compression scheme undefined");if(t.refBaseBlockId>=0){const n=await this.getBlockByContentId(t.refBaseBlockId);if(!n)throw new D("embedded reference specified, but reference block does not exist");return{seq:e.decode(n.data),start:t.refSeqStart,end:t.refSeqStart+t.refSeqSpan-1,span:t.refSeqSpan}}if(A.referenceRequired||this.file.fetchReferenceSequenceCallback){if(!this.file.fetchReferenceSequenceCallback)throw new Error("reference sequence not embedded, and seqFetch callback not provided, cannot fetch reference sequence");const n=await this.file.fetchReferenceSequenceCallback(t.refSeqId,t.refSeqStart,t.refSeqStart+t.refSeqSpan-1);if(n.length!==t.refSeqSpan)throw new Vt("seqFetch callback returned a reference sequence of the wrong length");return{seq:n,start:t.refSeqStart,end:t.refSeqStart+t.refSeqSpan-1,span:t.refSeqSpan}}}getAllRecords(){return this.getRecords(()=>!0)}async _fetchRecords(){var c,a;const{majorVersion:e}=await this.file.getDefinition(),t=await this.container.getCompressionScheme();if(t===void 0)throw new Error("compression scheme undefined");const A=await this.getHeader(),n=await this._getBlocksContentIdIndex();if(e>1&&this.file.options.checkSequenceMD5&&X(A.parsedContent)&&A.parsedContent.refSeqId>=0&&((c=A.parsedContent.md5)==null?void 0:c.join(""))!=="0000000000000000"){const C=await this.getReferenceRegion();if(C){const{seq:d,start:l,end:u}=C,h=wn(d),I=(a=A.parsedContent.md5)==null?void 0:a.map(f=>(f<16?"0":"")+f.toString(16)).join("");if(h!==I)throw new D(`MD5 checksum reference mismatch for ref ${A.parsedContent.refSeqId} pos ${l}..${u}. recorded MD5: ${I}, calculated MD5: ${h}`)}}const s=await this.getCoreDataBlock(),o={lastAlignmentStart:X(A.parsedContent)?A.parsedContent.refSeqStart:0,coreBlock:{bitPosition:7,bytePosition:0},externalBlocks:{map:new Map,getCursor(C){let d=this.map.get(C);return d===void 0&&(d={bitPosition:7,bytePosition:0},this.map.set(C,d)),d}}},i=C=>{const d=t.getCodecForDataSeries(C);if(!d)throw new D(`no codec defined for ${C} data series`);return d.decode(this,s,n,o)},g=new Array(A.parsedContent.numRecords);for(let C=0;C<g.length;C+=1)try{const d=Mn(this,i,t,A,s,n,o,e,C);g[C]=new Kt({...d,uniqueId:A.contentPosition+A.parsedContent.recordCounter+C+1})}catch(d){if(d instanceof ae){console.warn("read attempted beyond end of buffer, file seems truncated.");break}else throw d}for(let C=0;C<g.length;C+=1){const d=g[C];if(d){const{mateRecordNumber:l}=d;l!==void 0&&l>=0&&g[l]&&Pn(g,C,d,g[l])}}return g}async getRecords(e){const t=this.container.filePosition+this.containerPosition;let A=this.file.featureCache.get(t.toString());A||(A=this._fetchRecords(),this.file.featureCache.set(t.toString(),A));const s=(await A).filter(e);if(s.length&&this.file.fetchReferenceSequenceCallback){const o=await this.getHeader();if(X(o.parsedContent)&&(o.parsedContent.refSeqId>=0||o.parsedContent.refSeqId===-2)){const i=o.parsedContent.refSeqId>=0?o.parsedContent.refSeqId:void 0,g=await this.container.getCompressionScheme();if(g===void 0)throw new Error("compression scheme undefined");const c={};for(const a of s){const C=i!==void 0?i:a.sequenceId;let d=c[C];d||(d={id:C,start:a.alignmentStart,end:Number.NEGATIVE_INFINITY,seq:null},c[C]=d);const l=a.alignmentStart+(a.lengthOnRef||a.readLength)-1;l>d.end&&(d.end=l),a.alignmentStart<d.start&&(d.start=a.alignmentStart)}await Promise.all(Object.values(c).map(async a=>{a.id!==-1&&a.start<=a.end&&this.file.fetchReferenceSequenceCallback&&(a.seq=await this.file.fetchReferenceSequenceCallback(a.id,a.start,a.end))}));for(const a of s){const C=i!==void 0?i:a.sequenceId,d=c[C];if(d!=null&&d.seq){const l=d.seq;a.addReferenceSequence({...d,seq:l},g)}}}}return s}}"getHeader getBlocks _getBlocksContentIdIndex".split(" ").forEach(r=>{ce(Et,r)});class K{constructor(e,t){this.parameters=e,this.dataType=t}}class Un extends K{constructor(e,t){if(super(e,t),this.dataType!=="int")throw new O(`${this.dataType} decoding not yet implemented by BETA codec`)}decode(e,t,A,n){return G(t.content,n.coreBlock,this.parameters.length)-this.parameters.offset}}let mt=class extends K{constructor(e,t,A){super(e,t),this.instantiateCodec=A}decode(e,t,A,n){const o=this._getLengthCodec().decode(e,t,A,n)||0,i=this._getDataCodec(),g=new Uint8Array(o);for(let c=0;c<o;c+=1)g[c]=i.decode(e,t,A,n)||0;return g}_getLengthCodec(){const e=this.parameters.lengthsEncoding;return this.instantiateCodec(e,"int")}_getDataCodec(){const e=this.parameters.valuesEncoding;return this.instantiateCodec(e,"byte")}};"_getLengthCodec _getDataCodec".split(" ").forEach(r=>{ce(mt,r)});class Hn extends K{decode(e,t,A,n){const{blockContentId:s}=this.parameters,o=A[s];if(!o)throw new D(`no block found with content ID ${s}`);const i=n.externalBlocks.getCursor(s);return this._decodeByteArray(o,i)}_decodeByteArray(e,t){const A=e.content,{stopByte:n}=this.parameters,s=t.bytePosition;let o=t.bytePosition;for(;A[o]!==n&&o<A.length;){if(o===A.length)throw new ae("byteArrayStop reading beyond length of data buffer?");o=o+1}return t.bytePosition=o+1,A.subarray(s,o)}}class Tn extends K{constructor(e,t){if(super(e,t),this.dataType==="int")this._decodeData=this._decodeInt;else if(this.dataType==="byte")this._decodeData=this._decodeByte;else throw new O(`${this.dataType} decoding not yet implemented by EXTERNAL codec`)}decode(e,t,A,n){const{blockContentId:s}=this.parameters,o=A[s],i=n.externalBlocks.getCursor(s);return o?this._decodeData(o,i):void 0}_decodeInt(e,t){const[A,n]=Q(e.content,t.bytePosition);return t.bytePosition=t.bytePosition+n,A}_decodeByte(e,t){if(t.bytePosition>=e.content.length)throw new ae("attempted to read beyond end of block. this file seems truncated.");return e.content[t.bytePosition++]}}class Gn extends K{constructor(e,t){if(super(e,t),this.dataType!=="int")throw new O(`${this.dataType} decoding not yet implemented by GAMMA codec`)}decode(e,t,A,n){let s=1;for(;G(t.content,n.coreBlock,1)===0;)s=s+1;return(G(t.content,n.coreBlock,s-1)|1<<s-1)-this.parameters.offset}}function Jn(r){let e=r-(r>>1)&1431655765;return e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}class Yn extends K{constructor(e,t){if(super(e,t),this.codes={},this.codeBook={},this.sortedCodes=[],this.sortedValuesByBitCode=[],this.sortedBitCodes=[],this.sortedBitLengthsByBitCode=[],this.bitCodeToValue=[],!["byte","int"].includes(this.dataType))throw new TypeError(`${this.dataType} decoding not yet implemented by HUFFMAN_INT codec`);this.buildCodeBook(),this.buildCodes(),this.buildCaches(),this.sortedCodes[0].bitLength===0&&(this._decode=this._decodeZeroLengthCode)}buildCodeBook(){let e=new Array(this.parameters.numCodes);for(let t=0;t<this.parameters.numCodes;t++)e[t]={symbol:this.parameters.symbols[t],bitLength:this.parameters.bitLengths[t]};e=e.sort((t,A)=>t.bitLength-A.bitLength||t.symbol-A.symbol),this.codeBook={},e.forEach(t=>{this.codeBook[t.bitLength]||(this.codeBook[t.bitLength]=[]),this.codeBook[t.bitLength].push(t.symbol)})}buildCodes(){this.codes={};let e=0,t=-1;Object.entries(this.codeBook).forEach(([A,n])=>{const s=Number.parseInt(A,10);n.forEach(o=>{const i={bitLength:s,value:o,bitCode:0};t=t+1;const g=s-e;if(t=t<<g,i.bitCode=t,e=e+g,Jn(t)>s)throw new D("Symbol out of range");this.codes[o]=i})})}buildCaches(){this.sortedCodes=Object.values(this.codes).sort((t,A)=>t.bitLength-A.bitLength||t.bitCode-A.bitCode),this.sortedValuesByBitCode=this.sortedCodes.map(t=>t.value),this.sortedBitCodes=this.sortedCodes.map(t=>t.bitCode),this.sortedBitLengthsByBitCode=this.sortedCodes.map(t=>t.bitLength);const e=Math.max(...this.sortedBitCodes);this.bitCodeToValue=new Array(e+1).fill(-1);for(let t=0;t<this.sortedBitCodes.length;t+=1)this.bitCodeToValue[this.sortedCodes[t].bitCode]=t}decode(e,t,A,n){return this._decode(e,t,n.coreBlock)}_decodeZeroLengthCode(){return this.sortedCodes[0].value}_decode(e,t,A){const n=t.content;let s=0,o=0;for(let i=0;i<this.sortedCodes.length;i+=1){const g=this.sortedCodes[i].bitLength;o<<=g-s,o|=G(n,A,g-s),s=g;{const c=this.bitCodeToValue[o];if(c>-1&&this.sortedBitLengthsByBitCode[c]===g)return this.sortedValuesByBitCode[c];for(let a=i;this.sortedCodes[a+1].bitLength===g&&a<this.sortedCodes.length;a+=1)i+=1}}throw new D("Huffman symbol not found.")}}class Kn extends K{constructor(e,t){if(super(e,t),this.dataType!=="int")throw new O(`${this.dataType} decoding not yet implemented by SUBEXP codec`)}decode(e,t,A,n){let s=0;for(;G(t.content,n.coreBlock,1);)s=s+1;let o,i;if(s===0)o=this.parameters.K,i=G(t.content,n.coreBlock,o);else{o=s+this.parameters.K-1;const g=G(t.content,n.coreBlock,o);i=1<<o|g}return i-this.parameters.offset}}const zn={1:Tn,3:Yn,4:mt,5:Hn,6:Un,7:Kn,9:Gn};function Vn(r){return zn[r]}function Qe(r,e){const t=Vn(e==="ignore"?0:r.codecId);if(!t)throw new O(`no codec implemented for codec ID ${r.codecId}`);return new t(r.parameters,e,Qe)}const $n={BF:"int",CF:"int",RI:"int",RL:"int",AP:"int",RG:"int",MF:"int",NS:"int",NP:"int",TS:"int",NF:"int",TC:"byte",TN:"int",FN:"int",FC:"byte",FP:"int",BS:"byte",IN:"byteArray",SC:"byteArray",DL:"int",BA:"byte",BB:"byteArray",RS:"int",PD:"int",HC:"int",MQ:"int",RN:"byteArray",QS:"byte",QQ:"byteArray",TL:"int"};function Wn(r){const e=new Array(5);for(let t=0;t<5;t+=1)e[t]=new Array(4);return e[0][r[0]>>6&3]="C",e[0][r[0]>>4&3]="G",e[0][r[0]>>2&3]="T",e[0][r[0]>>0&3]="N",e[1][r[1]>>6&3]="A",e[1][r[1]>>4&3]="G",e[1][r[1]>>2&3]="T",e[1][r[1]>>0&3]="N",e[2][r[2]>>6&3]="A",e[2][r[2]>>4&3]="C",e[2][r[2]>>2&3]="T",e[2][r[2]>>0&3]="N",e[3][r[3]>>6&3]="A",e[3][r[3]>>4&3]="C",e[3][r[3]>>2&3]="G",e[3][r[3]>>0&3]="N",e[4][r[4]>>6&3]="A",e[4][r[4]>>4&3]="C",e[4][r[4]>>2&3]="G",e[4][r[4]>>0&3]="T",e}class Xn{constructor(e){this.dataSeriesCodecCache={},this.tagCodecCache={},this.tagEncoding={},this.readNamesIncluded=e.preservation.RN,this.APdelta=e.preservation.AP,this.referenceRequired=!!e.preservation.RR,this.tagIdsDictionary=e.preservation.TD,this.substitutionMatrix=Wn(e.preservation.SM),this.dataSeriesEncoding=e.dataSeriesEncoding,this.tagEncoding=e.tagEncoding}getCodecForTag(e){const t=this.tagCodecCache[e];if(t)return t;{const A=this.tagEncoding[e];if(!A)throw new Error("Error, no tag encoding");const n=Qe(A,"byteArray");return this.tagCodecCache[e]=n,n}}getTagNames(e){return this.tagIdsDictionary[e]}getCodecForDataSeries(e){let t=this.dataSeriesCodecCache[e];if(t===void 0){const A=this.dataSeriesEncoding[e];if(A){const n=$n[e];if(!n)throw new D(`data series name ${e} not defined in file compression header`);t=Qe(A,n),this.dataSeriesCodecCache[e]=t}}return t}toJSON(){const e={};return Object.keys(this).forEach(t=>{t.endsWith("Cache")||(e[t]=this[t])}),e}}class wt{constructor(e,t){this.file=e,this.filePosition=t}getHeader(){return this._readContainerHeader(this.filePosition)}async getCompressionHeaderBlock(){if(!(await this.getHeader()).numRecords)return null;const{majorVersion:t}=await this.file.getDefinition(),A=T(t),n=await this.getFirstBlock();if(n.contentType!=="COMPRESSION_HEADER")throw new D(`invalid content type ${n.contentType} in compression header block`);const s=J(n.content,A.cramCompressionHeader.parser,0,n.contentPosition);return{...n,parsedContent:s}}async getFirstBlock(){const e=await this.getHeader();return this.file.readBlock(e._endPosition)}async getCompressionScheme(){const e=await this.getCompressionHeaderBlock();if(e)return new Xn(e.parsedContent)}getSlice(e,t){return new Et(this,e,t)}async _readContainerHeader(e){const{majorVersion:t}=await this.file.getDefinition(),A=T(t),{cramContainerHeader1:n,cramContainerHeader2:s}=A,o=await this.file.read(n.maxLength,e),i=J(o,n.parser),g=mn(i.numLandmarks),c=await this.file.read(s.maxLength(i.numLandmarks),e+i._size-g),a=J(c,s.parser);return this.file.validateChecksums&&a.crc32!==void 0&&await this.file.checkCrc32(e,i._size+a._size-g-4,a.crc32,`container header beginning at position ${e}`),{...i,...a,_size:i._size+a._size-g,_endPosition:i._size+a._size-g+e}}}"getHeader getCompressionHeaderBlock getCompressionScheme".split(" ").forEach(r=>{ce(wt,r)});function jn(r){return new ReadableStream({start(e){e.enqueue(r),e.close()}})}function Zn(){const r=new Uint32Array([287454020]),e=new Uint8Array(r.buffer);return e[0]===68?0:e[0]===17?1:2}class Ee{constructor(e){if(this.file=ct(e.url,e.path,e.filehandle),this.validateChecksums=!0,this.fetchReferenceSequenceCallback=e.seqFetch,this.options={checkSequenceMD5:e.checkSequenceMD5,cacheSize:e.cacheSize??2e4},this.featureCache=new _t({maxSize:this.options.cacheSize}),Zn()>0)throw new Error("Detected big-endian machine, may be unable to run")}read(e,t){return this.file.read(e,t)}async getDefinition(){const{maxLength:e,parser:t}=ut(),A=await this.file.read(e,0),n=t(A).value;if(n.majorVersion!==2&&n.majorVersion!==3)throw new O(`CRAM version ${n.majorVersion} not supported`);return n}async getSamHeader(){const e=await this.getContainerById(0);if(!e)throw new D("file contains no containers");const A=(await e.getFirstBlock()).content,s=new DataView(A.buffer).getInt32(0,!0),o=4,g=new TextDecoder("utf8").decode(A.subarray(o,o+s));return this.header=g,ln(g)}async getHeaderText(){return await this.getSamHeader(),this.header}async getContainerById(e){const{majorVersion:t}=await this.getDefinition();let n=T(t).cramFileDefinition.maxLength,s;for(let o=0;o<=e;o++){s=this.getContainerAtPosition(n);const i=await s.getHeader();if(o===0){n=i._endPosition;for(let g=0;g<i.numBlocks;g++)n=(await this.readBlock(n))._endPosition}else n+=i._size+i.length}return s}async checkCrc32(e,t,A,n){const s=await this.file.read(t,e),o=St(s)>>>0;if(o!==A)throw new D(`crc mismatch in ${n}: recorded CRC32 = ${A}, but calculated CRC32 = ${o}`)}async containerCount(){const{majorVersion:e}=await this.getDefinition(),t=T(e);let A=0,n=t.cramFileDefinition.maxLength;try{for(;;){const s=await this.getContainerAtPosition(n).getHeader();if(A===0){n=s._endPosition;for(let o=0;o<s.numBlocks;o++)n=(await this.readBlock(n))._endPosition}else n+=s._size+s.length;A+=1}}catch{A--}return A}getContainerAtPosition(e){return new wt(this,e)}async readBlockHeader(e){const{majorVersion:t}=await this.getDefinition(),A=T(t),{cramBlockHeader:n}=A,s=await this.file.read(n.maxLength,e);return J(s,n.parser,0,e)}async _parseSection(e,t,A=e.maxLength,n){const s=n??await this.file.read(A,t),o=J(s,e.parser,0,t);if(o._size!==A)throw new D(`section read error: requested size ${A} does not equal parsed size ${o._size}`);return o}async _uncompressPre(e,t,A){if(e==="gzip"){const n=lt(t);return n[0],n}else{if(e==="bzip2")return et(t);if(e==="lzma"){const n=new Response(new zt.XzReadableStream(jn(t)));return new Uint8Array(await n.arrayBuffer())}else if(e==="rans"){const n=new Uint8Array(A);return Cn(t,n),n}else{if(e==="rans4x16")return KA(t);if(e==="arith")return zA(t);if(e==="fqzcomp")return VA(t);if(e==="tok3")return $A(t);throw new O(`${e} decompression not yet implemented`)}}}async _uncompress(e,t,A){const n=await this._uncompressPre(e,t,A);if(n.length!==A){const s=new Uint8Array(A);return s.set(n,0),s}return n}async readBlock(e){const{majorVersion:t}=await this.getDefinition(),A=T(t),n=await this.readBlockHeader(e),s=n._endPosition,o=await this.file.read(n.compressedSize,s),i=n.compressionMethod!=="raw"?await this._uncompress(n.compressionMethod,o,n.uncompressedSize):o,g={...n,_endPosition:s,contentPosition:s,content:i};if(t>=3){const c=await this._parseSection(A.cramBlockCrc32,s+n.compressedSize);g.crc32=c.crc32,this.validateChecksums&&await this.checkCrc32(e,n._size+n.compressedSize,c.crc32,"block data"),g._endPosition=c._endPosition,g._size=g.compressedSize+A.cramBlockCrc32.maxLength}else g._endPosition=s+g.compressedSize,g._size=g.compressedSize;return g}}"getDefinition getSectionParsers getSamHeader".split(" ").forEach(r=>{ce(Ee,r)});const er=21578050;function $e(r,e){const[t,A,n,s,o,i]=e,g=t;r[g]||(r[g]=[]),r[g].push({start:A,span:n,containerStart:s,sliceStart:o,sliceBytes:i})}function tr(r){return r[0]===31&&r[1]===139?lt(r):r}class Ar{constructor(e){this.filehandle=ct(e.url,e.path,e.filehandle)}async parseIndex(){const e={},t=tr(await this.filehandle.readFile()),A=new DataView(t.buffer);if(t.length>4&&A.getUint32(0,!0)===er)throw new D("invalid .crai index file. note: file appears to be a .bai index. this is technically legal but please open a github issue if you need support");let n=[],s="";for(const o of t)if(o>=48&&o<=57||!s&&o===45)s+=String.fromCharCode(o);else if(o===9)n.push(Number.parseInt(s,10)),s="";else if(o===10)n.push(Number.parseInt(s,10)),s="",$e(e,n),n=[];else if(o!==13&&o!==32)throw new D("invalid .crai index file");return s&&n.push(Number.parseInt(s,10)),n.length===6&&$e(e,n),Object.entries(e).forEach(([o,i])=>{const g=i;e[o]=g.sort((c,a)=>c.start-a.start||c.span-a.span)}),e}getIndex(){return this.parseIndexP||(this.parseIndexP=this.parseIndex().catch(e=>{throw this.parseIndexP=void 0,e})),this.parseIndexP}async hasDataForReferenceSequence(e){return!!(await this.getIndex())[e]}async getEntriesForRange(e,t,A){const n=(await this.getIndex())[e];if(!n)return[];const s=i=>{const g=i.start,c=i.start+i.span;return g>A?-1:c<=t?1:0},o=[];for(const i of n)s(i)===0&&o.push(i);return o}}class nr{constructor(e){if(this.cram=e.cram??new Ee({url:e.cramUrl,path:e.cramPath,filehandle:e.cramFilehandle,seqFetch:e.seqFetch,checkSequenceMD5:e.checkSequenceMD5,cacheSize:e.cacheSize}),!(this.cram instanceof Ee))throw new Error("invalid arguments: no cramfile");this.index=e.index}async getRecordsForRange(e,t,A,n={}){if(n.viewAsPairs=n.viewAsPairs||!1,n.pairAcrossChr=n.pairAcrossChr||!1,n.maxInsertSize=n.maxInsertSize||2e5,typeof e=="string")throw new O("string sequence names not yet supported");const s=e,o=await this.index.getEntriesForRange(s,t,A),i=await Promise.all(o.map(c=>this.getRecordsInSlice(c,a=>a.sequenceId===e&&a.alignmentStart<=A&&a.lengthOnRef!==void 0&&a.alignmentStart+a.lengthOnRef-1>=t)));let g=Array.prototype.concat(...i);if(n.viewAsPairs){const c={},a={};for(const f of g){const B=f.readName;if(B===void 0)throw new Error("readName undefined");const w=f.uniqueId;c[B]||(c[B]=0),c[B]+=1,a[w]=1}const C={};Object.entries(c).forEach(([f,B])=>{B===1&&(C[f]=!0)});const d=[];for(const f of g){const B=f.readName;if(B===void 0)throw new Error("readName undefined");if(C[B]&&f.mate&&(f.mate.sequenceId===s||n.pairAcrossChr)&&Math.abs(f.alignmentStart-f.mate.alignmentStart)<n.maxInsertSize){const w=this.index.getEntriesForRange(f.mate.sequenceId,f.mate.alignmentStart,f.mate.alignmentStart+1);d.push(w)}}const l=await Promise.all(d);let u=[];for(const f of l)u.push(...f);u=u.sort((f,B)=>f.toString().localeCompare(B.toString())).filter((f,B,w)=>!B||f.toString()!==w[B-1].toString());const h=[];for(const f of u){let B=this.cram.featureCache.get(f.toString());B||(B=this.getRecordsInSlice(f,()=>!0),this.cram.featureCache.set(f.toString(),B));const w=B.then(p=>{const m=[];for(const R of p){if(R.readName===void 0)throw new Error("readName undefined");C[R.readName]&&!a[R.uniqueId]&&m.push(R)}return m});h.push(w)}const I=await Promise.all(h);if(I.length){const f=I.reduce((B,w)=>B.concat(w));g=g.concat(f)}}return g}getRecordsInSlice({containerStart:e,sliceStart:t,sliceBytes:A},n){return this.cram.getContainerAtPosition(e).getSlice(t,A).getRecords(n)}hasDataForReferenceSequence(e){return this.index.hasDataForReferenceSequence(e)}}function rr(r,e,t){if(!r)return[];const A=new Array(r.length);let n=0,s=0,o=0,i=0,g=e;for(const{refPos:c,code:a,pos:C,data:d,sub:l,ref:u}of r)if(i=o-g,g=o,i&&s>0&&(A[n++]={start:o,type:"insertion",base:`${s}`,length:0},s=0),o=c-1-e,a==="X")A[n++]={start:o,length:1,base:l,qual:t==null?void 0:t[C-1],altbase:u==null?void 0:u.toUpperCase(),type:"mismatch"};else if(a==="I")A[n++]={start:o,type:"insertion",base:`${d.length}`,length:0};else if(a==="N")A[n++]={type:"skip",length:d,start:o,base:"N"};else if(a==="S"){const h=d.length;A[n++]={start:o,type:"softclip",base:`S${h}`,cliplen:h,length:1}}else if(a!=="P")if(a==="H"){const h=d;A[n++]={start:o,type:"hardclip",base:`H${h}`,cliplen:h,length:1}}else a==="D"?A[n++]={type:"deletion",length:d,start:o,base:"*"}:a==="b"||a==="q"||a==="B"||a==="i"&&s++;return i&&s>0&&(A[n++]={start:o,type:"insertion",base:`${s}`,length:0},s=0),A.slice(0,n)}function ir(r,e,t,A){let n="",s="",o="M",i=0;if(!A)return"";const g=A.seq,c=A.start;let a=e,C=0,d=0;if(r!==void 0)for(const{code:l,refPos:u,sub:h,data:I}of r)if(C=u-a,n+=g.slice(a-c,u-c),a=u,d>0&&C&&(s+=`${d}I`,d=0),i&&o!=="M"&&(s+=`${i}${o}`,i=0),C&&(o="M",i+=C),l==="b"){const f=I.split(","),B=String.fromCharCode(...f);n+=B,a+=B.length,i+=B.length}else l==="B"||l==="X"?(n+=h,a++,i++):l==="D"||l==="N"?(a+=I,i&&(s+=`${i}${o}`),s+=I+l,i=0):l==="I"||l==="S"?(n+=I,i&&(s+=`${i}${o}`),s+=I.length+l,i=0):l==="i"?(i&&(s+=`${i}${o}`),d++,n+=I,i=0):l==="P"?(i&&(s+=`${i}${o}`),s+=`${I}P`):l==="H"&&(i&&(s+=`${i}${o}`),s+=`${I}H`,i=0);else C=t-n.length;return n.length!==t&&(C=t-n.length,n+=g.slice(a-c,a-c+C),i&&o!=="M"&&(s+=`${i}${o}`,i=0),o="M",i+=C),C&&d>0&&(s+=`${d}I`),i&&(s+=`${i}${o}`),s}class ge{constructor(e,t){this.record=e,this._store=t}get name(){return this.record.readName}get start(){return this.record.alignmentStart-1}get end(){var e;return this.start+((e=this.record.lengthOnRef)!==null&&e!==void 0?e:1)}get score(){return this.record.mappingQuality}get flags(){return this.record.flags}get strand(){return this.record.isReverseComplemented()?-1:1}get qual(){return(this.record.qualityScores||[]).join(" ")}get qualRaw(){return this.record.qualityScores}get refName(){return this._store.refIdToName(this.record.sequenceId)}get pair_orientation(){return this.record.isPaired()?this.record.getPairOrientation():void 0}get template_length(){return this.record.templateLength||this.record.templateSize}get next_ref(){return this.record.mate?this._store.refIdToName(this.record.mate.sequenceId):void 0}get next_segment_position(){return this.record.mate?`${this._store.refIdToName(this.record.mate.sequenceId)}:${this.record.mate.alignmentStart}`:void 0}get is_paired(){return!!this.record.mate}get next_pos(){var e;return(e=this.record.mate)===null||e===void 0?void 0:e.alignmentStart}get tags(){var e;const t=(e=this._store.samHeader.readGroups)===null||e===void 0?void 0:e[this.record.readGroupId];return t!==void 0?{...this.record.tags,RG:t}:this.record.tags}get seq(){return this.record.getReadBases()}get CIGAR(){return ir(this.record.readFeatures,this.record.alignmentStart,this.record.readLength,this.record._refRegion)}id(){return`${this._store.id}-${this.record.uniqueId}`}get(e){return e==="mismatches"?this.mismatches:e==="qual"?this.qual:e==="CIGAR"?this.CIGAR:this.fields[e]}parent(){}children(){}get mismatches(){return rr(this.record.readFeatures,this.start,this.qualRaw)}get fields(){return{start:this.start,name:this.name,end:this.end,score:this.score,strand:this.strand,template_length:this.template_length,flags:this.flags,tags:this.tags,refName:this.refName,seq:this.seq,type:"match",pair_orientation:this.pair_orientation,next_ref:this.next_ref,next_pos:this.next_pos,next_segment_position:this.next_segment_position,uniqueId:this.id()}}toJSON(){return{...this.fields,CIGAR:this.CIGAR,qual:this.qual}}}we(ge,"fields");we(ge,"CIGAR");we(ge,"mismatches");class dr extends kt.BaseFeatureDataAdapter{constructor(){super(...arguments),this.samHeader={},this.ultraLongFeatureCache=new Nt({maxSize:500}),this.seqIdToOriginalRefName=[]}async configurePre(){const e=this.getConf("cramLocation"),t=this.getConf("craiLocation"),A=this.pluginManager,n=new nr({cramFilehandle:Se.openLocation(e,A),index:new Ar({filehandle:Se.openLocation(t,A)}),seqFetch:(...i)=>this.seqFetch(...i),checkSequenceMD5:!1});if(!this.getSubAdapter)throw new Error("Error getting subadapter");const s=this.getConf("sequenceAdapter");if(!s)throw new Error("no sequenceAdapter supplied to CramAdapter config");const o=await this.getSubAdapter(s);return{cram:n,sequenceAdapter:o.dataAdapter}}async configure(){return this.configureP||(this.configureP=this.configurePre().catch(e=>{throw this.configureP=void 0,e})),this.configureP}async getHeader(e){const{cram:t}=await this.configure();return t.cram.getHeaderText()}async seqFetch(e,t,A){t-=1;const{sequenceAdapter:n}=await this.configure(),s=this.refIdToOriginalName(e)||this.refIdToName(e);if(!s)throw new Error("unknown");const i=(await Ft.firstValueFrom(n.getFeatures({refName:s,start:t,end:A,assemblyName:""}).pipe(qt.toArray()))).sort((c,a)=>c.get("start")-a.get("start")).map(c=>{const a=c.get("start"),C=c.get("end"),d=Math.max(t-a,0),u=Math.min(A-a,C-a)-d;return(c.get("seq")||c.get("residues")).slice(d,d+u)}).join(""),g=A-t;if(i.length!==g)throw new Error(`fetching ${s}:${H.toLocale(t-1)}-${H.toLocale(A)} returned ${H.toLocale(i.length)} bases, should have returned ${H.toLocale(g)}`);return i}async setupPre(e){const t=await this.configure(),{cram:A}=t,n=await A.cram.getSamHeader(),s=[],o={};for(const[c,a]of n.filter(C=>C.tag==="SQ").entries()){const C=a.data.find(d=>d.tag==="SN");if(C){const d=C.value;o[d]=c,s[c]=d}}const i=n.filter(c=>c.tag==="RG").map(c=>{var a;return(a=c.data.find(C=>C.tag==="ID"))===null||a===void 0?void 0:a.value}),g={idToName:s,nameToId:o,readGroups:i};return this.samHeader=g,{samHeader:g,...t}}async setupPre2(e){return this.setupP||(this.setupP=this.setupPre(e).catch(t=>{throw this.setupP=void 0,t})),this.setupP}async setup(e){const{statusCallback:t=()=>{}}=e||{};return H.updateStatus("Downloading index",t,()=>this.setupPre2(e))}async getRefNames(e){const{samHeader:t}=await this.setup(e);if(!t.idToName)throw new Error("CRAM file has no header lines");return t.idToName}refNameToId(e){if(this.samHeader.nameToId)return this.samHeader.nameToId[e];if(this.seqIdToRefName)return this.seqIdToRefName.indexOf(e)}refIdToName(e){var t,A;return((t=this.samHeader.idToName)===null||t===void 0?void 0:t[e])||((A=this.seqIdToRefName)===null||A===void 0?void 0:A[e])}refIdToOriginalName(e){return this.seqIdToOriginalRefName[e]}getFeatures(e,t){const{stopToken:A,filterBy:n,statusCallback:s=()=>{}}=t||{},{refName:o,start:i,end:g,originalRefName:c}=e;return Lt(async a=>{const{cram:C,samHeader:d}=await this.setup(t),l=this.refNameToId(o);if(l===void 0){console.warn("Unknown refName",o),a.complete();return}c&&(this.seqIdToOriginalRefName[l]=c);const u=await H.updateStatus("Downloading alignments",s,()=>C.getRecordsForRange(l,i,g));Mt(A),await H.updateStatus("Processing alignments",s,()=>{var h;const{flagInclude:I=0,flagExclude:f=0,tagFilter:B,readName:w}=n||{};for(const p of u){if(vt(p.flags,I,f)||B&&Ot(B.tag==="RG"?(h=d.readGroups)===null||h===void 0?void 0:h[p.readGroupId]:p.tags[B.tag],B.value)||w&&p.readName!==w)continue;const m=this.ultraLongFeatureCache.get(`${p.uniqueId}`);if(m)a.next(m);else{const R=this.cramRecordToFeature(p);this.ultraLongFeatureCache.set(`${p.uniqueId}`,R),a.next(R)}}a.complete()})},A)}freeResources(){}cramRecordToFeature(e){return new ge(e,this)}async getMultiRegionFeatureDensityStats(e,t){const A=await this.bytesForRegions(e,t),n=this.getConf("fetchSizeLimit");return{bytes:A,fetchSizeLimit:n}}async bytesForRegions(e,t){const{cram:A}=await this.configure();return(await Promise.all(e.map(s=>{const{refName:o,start:i,end:g}=s,c=this.refNameToId(o);return c!==void 0?A.index.getEntriesForRange(c,i,g):[{sliceBytes:0}]}))).flat().reduce((s,o)=>s+o.sliceBytes,0)}}export{dr as default};
//# sourceMappingURL=CramAdapter-Dh3w4pU1.js.map
