import{u as m}from"./index-B3kPj2Rj.js";function Q({feature:n,ctx:t,offsets:o,level:e,cb:s,height:c,drawCurves:a,oobLimit:l,viewWidth:i,hideTiny:g}){const{p11:r,p12:C,p21:w,p22:h}=n,d=r.offsetPx-o[e],b=C.offsetPx-o[e],f=w.offsetPx-o[e+1],M=h.offsetPx-o[e+1],y=Math.abs(b-d),P=Math.abs(M-f),v=0,u=c,p=(u-v)/2,I=Math.min(f,M),S=Math.max(f,M);m.doesIntersect2(I,S,-l,i+l)&&(y<=1&&P<=1?g||(t.beginPath(),t.moveTo(d,v),a?t.bezierCurveTo(d,p,f,p,f,u):t.lineTo(f,u),t.stroke()):(B(t,d,b,v,M,f,u,p,a),s(t)))}function B(n,t,o,e,s,c,a,l,i){i?ct(n,t,o,e,s,c,a,l):at(n,t,o,e,s,c,a)}function at(n,t,o,e,s,c,a){n.beginPath(),n.moveTo(t,e),n.lineTo(o,e),n.lineTo(s,a),n.lineTo(c,a),n.closePath()}function ct(n,t,o,e,s,c,a,l){const i=Math.abs(t-o),g=Math.abs(t-o);if(i<5&&g<5&&o<t&&Math.abs(t-s)>100){const r=t;t=o,o=r}n.beginPath(),n.moveTo(t,e),n.lineTo(o,e),n.bezierCurveTo(o,l,s,l,s,a),n.lineTo(c,a),n.bezierCurveTo(c,l,t,l,t,e),n.closePath()}function lt(n,t){const o=m.getContainingView(t),e=m.getContainingTrack(t),{featPositions:s,numFeats:c,clickMapCanvas:a,cigarClickMapCanvas:l,level:i}=t;if(!a||!l)return;const g=a.getBoundingClientRect(),r=a.getContext("2d"),C=l.getContext("2d");if(!r||!C)return;const w=n.clientX-g.left,h=n.clientY-g.top,[d,b,f]=r.getImageData(w,h,1,1).data,M=Math.floor(J/c),y=nt(d,b,f,M),P=s[y];if(P){const{f:v}=P;t.setClickId(v.id());const u=m.getSession(t);m.isSessionModelWithWidgets(u)&&u.showWidget(u.addWidget("SyntenyFeatureWidget","syntenyFeature",{view:o,track:e,featureData:v.toJSON(),level:i}))}return P}function gt(n,t,o){n.preventDefault();const e=t.clickMapCanvas,s=t.cigarClickMapCanvas;if(!e||!s)return;const c=e.getBoundingClientRect(),a=e.getContext("2d"),l=s.getContext("2d");if(!a||!l)return;const{clientX:i,clientY:g}=n,r=i-c.left,C=g-c.top,[w,h,d]=a.getImageData(r,C,1,1).data,b=Math.floor(J/t.numFeats),f=nt(w,h,d,b),M=t.featPositions[f];M&&(t.setClickId(M.f.id()),o({clientX:i,clientY:g,feature:M}))}function ht({feature:n,cigarOp:t,cigarOpLen:o}){const e=n.toJSON(),s=e.mate,c=e.end-e.start,a=s.end-s.start,l=e.identity,i=e.name,g=s.name;return[`Loc1: ${m.assembleLocString(e)}`,`Loc2: ${m.assembleLocString(s)}`,`Inverted: ${e.strand===-1}`,`Query len: ${c.toLocaleString("en-US")}`,`Target len: ${a.toLocaleString("en-US")}`,l?`Identity: ${l.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${o}`:"",i?`Name 1: ${i}`:"",g?`Name 2: ${g}`:""].filter(r=>!!r).join("<br/>")}const J=65025*255;function tt(n){const t=Math.floor(n/65025)%255,o=Math.floor(n/255)%255,e=n%255;return`rgb(${t},${o},${e})`}const z={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},j=3,N=1600;function nt(n,t,o,e){return Math.floor((n*255*255+t*255+o-1)/e)}function ut(n,t,o){var e;const s=m.getContainingView(n),c=s.drawCurves,a=s.drawCIGAR,l=s.drawCIGARMatchesOnly,{level:i,height:g,featPositions:r}=n,C=s.width,w=s.views.map(f=>f.bpPerPx);o&&(o.imageSmoothingEnabled=!1),t.beginPath();const h=s.views.map(f=>f.offsetPx),d=Math.floor(J/r.length);t.fillStyle=z.M,t.strokeStyle=z.M;for(const{p11:f,p12:M,p21:y,p22:P}of r){const v=f.offsetPx-h[i],u=M.offsetPx-h[i],p=y.offsetPx-h[i+1],I=P.offsetPx-h[i+1],S=Math.abs(u-v),R=Math.abs(I-p),F=0,A=g,O=(A-F)/2;S<=j&&R<=j&&p<C+N&&p>-N&&(t.moveTo(v,F),c?t.bezierCurveTo(v,O,p,O,p,A):t.lineTo(p,A))}t.stroke(),t.fillStyle=z.M,t.strokeStyle=z.M;for(const{p11:f,p12:M,p21:y,p22:P,f:v,cigar:u}of r){const p=f.offsetPx-h[i],I=M.offsetPx-h[i],S=y.offsetPx-h[i+1],R=P.offsetPx-h[i+1],F=Math.abs(I-p),A=Math.abs(R-S),O=Math.min(S,R),et=Math.max(S,R),D=0,G=g,E=(G-D)/2;if(!(F<=j&&A<=j)&&m.doesIntersect2(O,et,-N,s.width+N)){const _=v.get("strand"),q=_===-1?I:p,H=q<(_===-1?p:I)?1:-1,K=(S<R?1:-1)*_;let k=q,T=_===-1?R:S;if(u.length&&a){let V=!1,$=0,L=0;const ot=Math.floor(J/u.length);for(let W=0;W<u.length;W+=2){const st=W*ot+1,Z=+u[W],X=u[W+1];V||($=k,L=T);const U=Z/w[i],Y=Z/w[i+1];if(X==="M"||X==="="||X==="X"?(k+=U*H,T+=Y*K):X==="D"||X==="N"?k+=U*H:X==="I"&&(T+=Y*K),!(Math.max($,L,k,T)<0||Math.min($,L,k,T)>C)){const it=W<u.length-2;if(Math.abs(k-$)<=1&&Math.abs(T-L)<=1&&it)V=!0;else{const x=V&&U>1||Y>1?X:"M";t.fillStyle=z[x],V=!1,l?x==="M"&&(B(t,$,k,D,T,L,G,E,c),t.fill()):(B(t,$,k,D,T,L,G,E,c),t.fill()),o&&(o.fillStyle=tt(st),B(o,$,k,D,T,L,G,E,c),o.fill())}}}}else B(t,p,I,D,R,S,G,E,c),t.fill()}}const b=(e=n.clickMapCanvas)===null||e===void 0?void 0:e.getContext("2d");if(b){b.imageSmoothingEnabled=!1,b.clearRect(0,0,C,g);for(let f=0;f<r.length;f++){const M=r[f],y=f*d+1;b.fillStyle=tt(y),Q({cb:P=>{P.fill()},feature:M,ctx:b,drawCurves:c,level:i,offsets:h,oobLimit:N,viewWidth:s.width,hideTiny:!0,height:g})}}}function dt(n){var t;const{level:o,clickId:e,mouseoverId:s}=n,c=1,a=m.getContainingView(n),l=a.drawCurves,i=n.height,g=a.width,r=(t=n.mouseoverCanvas)===null||t===void 0?void 0:t.getContext("2d"),C=a.views.map(d=>d.offsetPx);if(!r)return;r.resetTransform(),r.scale(c,c),r.clearRect(0,0,g,i),r.strokeStyle="rgba(0, 0, 0, 0.9)",r.fillStyle="rgba(0, 0, 0, 0.1)";const w=n.featMap[s||""];w&&Q({cb:d=>{d.fill()},feature:w,level:o,ctx:r,oobLimit:N,viewWidth:a.width,drawCurves:l,offsets:C,height:i});const h=n.featMap[e||""];h&&Q({cb:d=>{d.stroke()},feature:h,ctx:r,level:o,oobLimit:N,viewWidth:a.width,drawCurves:l,offsets:C,height:i})}export{J as M,dt as a,lt as b,nt as c,ut as d,ht as g,gt as o};
//# sourceMappingURL=drawSynteny-BqxSdwOA.js.map
