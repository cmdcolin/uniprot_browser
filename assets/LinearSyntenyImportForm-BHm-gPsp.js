import{o as g,m as A,j as e,am as P,cZ as M,B as L,c as x,a as m,P as $,T as z,f as k,u as S,y as V,ak as W,t as _,aj as H,aa as U,an as N,ar as J,c_ as Z}from"./index-B3kPj2Rj.js";import{R as q}from"./RadioGroup-Dc6z2jM9.js";import{G as E}from"./Grid-Gln3XP22.js";import{R as C}from"./Radio-BrcTy3_C.js";import{M as D}from"./MenuItem-D9_xBR9N.js";import{C as K}from"./Container-Dz_A6leC.js";import"./getThemeProps-BbKRYxDH.js";import"./useThemeProps-B1T1idtA.js";import"./dividerClasses-B-wJULXt.js";function Q({radioOption:t,assembly1:n,assembly2:s,fileLocation:a,indexFileLocation:o,bed1Location:r,bed2Location:i}){if(t===".paf")return{type:"PAFAdapter",pafLocation:a,queryAssembly:n,targetAssembly:s};if(t===".out")return{type:"MashMapAdapter",outLocation:a,queryAssembly:n,targetAssembly:s};if(t===".delta")return{type:"DeltaAdapter",deltaLocation:a,queryAssembly:n,targetAssembly:s};if(t===".chain")return{type:"ChainAdapter",chainLocation:a,queryAssembly:n,targetAssembly:s};if(t===".anchors")return{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:a,bed1Location:r,bed2Location:i,assemblyNames:[n,s]};if(t===".anchors.simple")return{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:a,bed1Location:r,bed2Location:i,assemblyNames:[n,s]};if(t===".pif.gz")return{type:"PairwiseIndexedPAFAdapter",pifGzLocation:a,index:{location:o},assemblyNames:[n,s]};throw new Error(`Unknown to detect type ${t} from filename (select radio button to clarify)`)}const R={".paf":"minimap2 target.fa query.fa",".pif.gz":"minimap2 target.fa query.fa",".out":"mashmap target.fa query.fa",".delta":"mummer target.fa query.fa",".chain":"e.g. queryToTarget.chain"},X=A()({row:{display:"flex",gap:20},swap:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,alignItems:"center"}}),F=g(function({assembly1:t,assembly2:n,swap:s,setSwap:a,radioOption:o,helpContent:r,text1:i,text2:c}){const{classes:d}=X();return e.jsxs("div",{children:[e.jsxs("div",{children:["Verify or click swap",e.jsx(P,{title:r||e.jsx("code",{children:R[o]}),children:e.jsx(M,{})})]}),e.jsxs("div",{className:d.row,children:[e.jsxs("div",{className:d.swap,children:[e.jsx("div",{children:e.jsx("i",{children:s?n:t})}),e.jsx("div",{children:i}),e.jsx("div",{children:e.jsx("i",{children:s?t:n})}),e.jsx("div",{children:c})]}),e.jsx(L,{variant:"contained",onClick:()=>{a&&a(!s)},children:"Swap?"})]})]})}),Y=g(function({assembly1:t,assembly2:n,swap:s,setSwap:a,fileLocation:o,setFileLocation:r,radioOption:i}){return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[e.jsx(x.FileSelector,{name:`${i} location`,inline:!0,description:"",location:o,setLocation:r}),e.jsxs("div",{children:[e.jsxs("div",{children:["Verify or click swap",e.jsx(P,{title:e.jsx("code",{children:R[i]}),children:e.jsx(M,{})})]}),e.jsx(F,{swap:s,radioOption:i,assembly1:t,assembly2:n,setSwap:a,text1:"query assembly",text2:"target assembly"})]})]})}),O=g(function({assembly1:t,assembly2:n,swap:s,setSwap:a,fileLocation:o,setFileLocation:r,indexFileLocation:i=void 0,setIndexFileLocation:c=()=>{},radioOption:d}){return e.jsxs("div",{children:[e.jsxs("div",{style:{margin:20},children:["Open the ",d," and .pif.gz and index file (.pif.gz.tbi or .pif.gz.csi) files for created by `jbrowse make-pif`"]}),e.jsxs("div",{style:{maxWidth:400,margin:"0 auto"},children:[e.jsx(x.FileSelector,{name:`${d} location`,inline:!0,description:"",location:o,setLocation:r}),e.jsx(x.FileSelector,{name:`${d} index location`,inline:!0,description:"",location:i,setLocation:c}),e.jsx(F,{swap:s,radioOption:d,assembly1:t,assembly2:n,setSwap:a,text1:"query assembly",text2:"target assembly"})]})]})}),ee=g(function({assembly1:t,assembly2:n,swap:s,setSwap:a,fileLocation:o,setFileLocation:r,bed1Location:i=void 0,setBed1Location:c=()=>{},bed2Location:d=void 0,setBed2Location:p=()=>{},radioOption:l}){return e.jsxs("div",{children:[e.jsxs("div",{style:{margin:20},children:["Open the ",l," and .bed files for both genome assemblies from the MCScan (Python version) pipeline"," ",e.jsx("a",{href:"https://github.com/tanghaibao/jcvi/wiki/MCscan-(Python-version)",children:"(more info)"})]}),e.jsxs("div",{style:{maxWidth:400,margin:"0 auto"},children:[e.jsx(x.FileSelector,{inline:!0,name:l,location:o,setLocation:r}),e.jsx(x.FileSelector,{inline:!0,name:"genome 1 .bed (left column of anchors file)",description:"",location:i,setLocation:c}),e.jsx(x.FileSelector,{inline:!0,name:"genome 2 .bed (right column of anchors file)",description:"",location:d,setLocation:p}),e.jsx(F,{swap:s,radioOption:l,assembly1:t,assembly2:n,setSwap:a,text1:"bed 1 assembly",text2:"bed 2 assembly"})]})]})});function te(t){return t?t.uri||t.localPath||t.name:void 0}function ne(t){return t.endsWith(".gz")?t.slice(0,-3):t}function se(t){return t.split("#")[0].split("?")[0].split("/").pop()}function re(t){const n=t.split(".").pop();return n?`.${n}`:""}const ae=g(function({model:t,assembly1:n,assembly2:s,selectedRow:a}){const[o,r]=m.useState(!1),[i,c]=m.useState(),[d,p]=m.useState(),[l,f]=m.useState(),[h,v]=m.useState(),[u,w]=m.useState(""),[T,I]=m.useState(),b=te(l),j=u||(b?re(ne(b)):"");return m.useEffect(()=>{try{if(l){const y=b?se(b):"MyTrack",B=`${y}-${Date.now()}-sessionTrack`;I(void 0),t.setImportFormSyntenyTrack(a,{type:"userOpened",value:{trackId:B,name:y,assemblyNames:[s,n],type:"SyntenyTrack",adapter:Q({radioOption:j,assembly1:o?s:n,assembly2:o?n:s,fileLocation:l,indexFileLocation:h,bed1Location:d,bed2Location:i})}})}}catch(y){console.error(y),I(y)}},[o,t,a,b,n,s,d,i,l,h,j]),e.jsxs($,{style:{padding:12},children:[T?e.jsx(x.ErrorMessage,{error:T}):null,e.jsx(z,{style:{textAlign:"center"},children:"Add a .paf (minimap2), .delta (Mummer), .chain (UCSC liftover), .anchors or .anchors.simple (MCScan), or .pif.gz (jbrowse CLI make-pif) file to view. These file types can also be gzipped."}),e.jsx(q,{value:j,onChange:y=>{w(y.target.value)},children:e.jsx(E,{container:!0,justifyContent:"center",children:[".paf",".delta",".out",".chain",".anchors",".anchors.simple",".pif.gz"].map(y=>e.jsx(k,{value:y,control:e.jsx(C,{}),label:y},y))})}),e.jsx(E,{container:!0,justifyContent:"center",children:j===".paf"||j===".out"||j===".delta"||j===".chain"?e.jsx(Y,{assembly1:n,assembly2:s,swap:o,setSwap:r,fileLocation:l,setFileLocation:f,radioOption:j}):j===".pif.gz"?e.jsx(O,{assembly1:n,assembly2:s,swap:o,setSwap:r,fileLocation:l,setFileLocation:f,indexFileLocation:h,setIndexFileLocation:v,radioOption:j}):u===".anchors"||u===".anchors.simple"?e.jsx(ee,{assembly1:n,assembly2:s,swap:o,setSwap:r,fileLocation:l,setFileLocation:f,bed1Location:d,setBed1Location:p,bed2Location:i,setBed2Location:c,radioOption:u}):e.jsx(x.FileSelector,{name:u?`${u} location`:"",description:"",location:l,setLocation:y=>{f(y)}})})]})}),oe=g(function({model:t,selectedRow:n,assembly1:s,assembly2:a}){var o;const r=S.getSession(t),{importFormSyntenyTrackSelections:i}=t,{tracks:c=[],sessionTracks:d=[]}=r,l=[...c,...d].filter(u=>{const w=V.readConfObject(u,"assemblyNames");return w.includes(s)&&w.includes(a)&&u.type.includes("Synteny")}),f=((o=l[0])===null||o===void 0?void 0:o.trackId)||"",h=i[n],v=h?.type==="preConfigured"?h.value:void 0;return m.useEffect(()=>{t.setImportFormSyntenyTrack(n,{type:"preConfigured",value:f})},[a,s,f,n,t]),e.jsxs($,{style:{padding:12},children:[e.jsx(z,{children:'Select a track from the select box below, the track will be shown when you hit "Launch".'}),v&&l.map(u=>u.trackId).includes(v)?e.jsx(W,{value:v,onChange:u=>{t.setImportFormSyntenyTrack(n,{type:"preConfigured",value:u.target.value})},children:l.map(u=>e.jsx(D,{value:u.trackId,children:_.getTrackName(u,r)},u.trackId))}):e.jsx(x.ErrorMessage,{error:`No synteny tracks found for ${s},${a}`})]})});function ie({model:t,assembly1:n,assembly2:s,selectedRow:a}){const[o,r]=m.useState("tracklist");return m.useEffect(()=>{o==="none"&&t.setImportFormSyntenyTrack(a,{type:"none"})},[o,t,a]),e.jsxs("div",{children:[e.jsx(H,{children:e.jsxs(q,{row:!0,value:o,"aria-labelledby":"group-label",onChange:i=>{r(i.target.value)},children:[e.jsx(k,{value:"none",control:e.jsx(C,{}),label:"None"}),e.jsx(k,{value:"tracklist",control:e.jsx(C,{}),label:"Existing track"}),e.jsx(k,{value:"custom",control:e.jsx(C,{}),label:"New track"})]})}),o==="custom"?e.jsx(ae,{model:t,selectedRow:a,assembly2:s,assembly1:n}):null,o==="tracklist"?e.jsx(oe,{model:t,selectedRow:a,assembly1:n,assembly2:s}):null]})}const ce=U(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),G=A()(t=>({mb:{marginBottom:10},button:{margin:t.spacing(2)},rel:{position:"relative"},synbutton:{position:"absolute",top:30},bg:{background:t.palette.divider}})),le=g(function({selectedRow:t,selectedAssemblyNames:n,setSelectedRow:s,setSelectedAssemblyNames:a,model:o}){const{classes:r,cx:i}=G(),c=S.getSession(o);return n.map((d,p)=>e.jsxs("div",{className:r.rel,children:[e.jsxs("span",{children:["Row ",p+1,": "]}),e.jsx(N,{disabled:n.length<=2,onClick:()=>{o.importFormRemoveRow(p),a(n.map((l,f)=>f===p?void 0:l).filter(S.notEmpty)),t>=n.length-2&&s(0)},children:e.jsx(J,{})}),e.jsx(x.AssemblySelector,{helperText:"",selected:d,onChange:l=>{a(n.map((f,h)=>h===p?l:f))},session:c}),p!==n.length-1?e.jsx(N,{"data-testid":"synbutton",className:i(r.synbutton,p===t?r.bg:void 0),onClick:()=>{s(p)},children:e.jsx(ce,{})}):null]},`${d}-${p}`))}),de=g(function({model:t,selectedAssemblyNames:n,setSelectedAssemblyNames:s,selectedRow:a,setSelectedRow:o,defaultAssemblyName:r,onLaunch:i}){const{classes:c}=G();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:c.mb,children:"Select assemblies for linear synteny view"}),e.jsx(le,{model:t,selectedAssemblyNames:n,setSelectedAssemblyNames:s,selectedRow:a,setSelectedRow:o}),e.jsxs("div",{children:[e.jsx(L,{className:c.button,variant:"contained",color:"secondary",onClick:()=>{s([...n,r])},children:"Add row"}),e.jsx(L,{className:c.button,onClick:i,variant:"contained",color:"primary",children:"Launch"})]})]})});async function ue({selectedAssemblyNames:t,model:n}){const s=S.getSession(n),{assemblyManager:a}=s,{importFormSyntenyTrackSelections:o}=n;n.setViews(await Promise.all(t.map(async r=>{const i=await a.waitForAssembly(r);if(!i)throw new Error(`Assembly "${r}" failed to load`);return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:i.regions}})));for(const r of n.views)r.setWidth(n.width),r.showAllRegions();S.isSessionWithAddTracks(s)?Z(o).map((r,i)=>{var c;r.type==="userOpened"?(s.addTrackConf(r.value),n.toggleTrack((c=r.value)===null||c===void 0?void 0:c.trackId,i)):r.type==="preConfigured"&&n.showTrack(r.value,i)}):s.notify("Can't add tracks","warning"),n.clearImportFormSyntenyTracks()}const pe=A()(t=>({importFormContainer:{padding:t.spacing(4)},flex:{display:"flex",gap:90},rightPanel:{flexGrow:11},leftPanel:{flexGrow:4,flexShrink:0}})),be=g(function({model:t}){const{classes:n}=pe(),s=S.getSession(t),{assemblyNames:a}=s,o=a[0]||"",[r,i]=m.useState(0),[c,d]=m.useState([o,o]),[p,l]=m.useState(),f=async()=>{try{l(void 0),await ue({selectedAssemblyNames:c,model:t})}catch(h){console.error(h),l(h)}};return e.jsxs(K,{className:n.importFormContainer,children:[p?e.jsx(x.ErrorMessage,{error:p}):null,e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.leftPanel,children:e.jsx(de,{model:t,selectedAssemblyNames:c,setSelectedAssemblyNames:d,selectedRow:r,setSelectedRow:i,defaultAssemblyName:o,onLaunch:()=>{f()}})}),e.jsxs("div",{className:n.rightPanel,children:[e.jsxs("div",{children:["Synteny dataset to display between row ",r+1," and"," ",r+2]}),e.jsx(ie,{model:t,selectedRow:r,assembly1:c[r],assembly2:c[r+1]})]})]})]})});export{be as default};
//# sourceMappingURL=LinearSyntenyImportForm-BHm-gPsp.js.map
