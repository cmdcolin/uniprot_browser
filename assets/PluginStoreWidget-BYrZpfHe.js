const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DeletePluginDialog-NdIrodz1.js","./index-DQP-8m57.js","./index-CEY7u6QK.css","./AddCustomPluginDialog-Diy6reQW.js","./ExpandMore-B1w8xyv_.js","./Collapse-BmqtdRcl.js","./DialogContentText-agbJdpxO.js"])))=>i.map(i=>d[i]);
import{I as _,H as D,a as m,J as k,j as s,K as R,M as B,N as F,aa as p,u,o as g,T as d,m as h,am as I,an as j,cg as $,aS as P,_ as S,aY as U,c as E,B as M,ch as W,a9 as z,d as q,cI as O}from"./index-DQP-8m57.js";import{C as Y}from"./Clear-ydHR15pL.js";import{A as v,a as C,E as y}from"./ExpandMore-B1w8xyv_.js";import{L as H}from"./Lock-BJRiayTD.js";import{L as V}from"./ListItem-CafL8QbE.js";import{C as J,a as K}from"./CardContent-Cm8hZQIC.js";import"./Collapse-BmqtdRcl.js";function G(n){return _("MuiCardActions",n)}D("MuiCardActions",["root","spacing"]);const Q=n=>{const{classes:e,disableSpacing:a}=n;return F({root:["root",!a&&"spacing"]},G,e)},X=R("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:a}=n;return[e.root,!a.disableSpacing&&e.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Z=m.forwardRef(function(e,a){const i=k({props:e,name:"MuiCardActions"}),{disableSpacing:t=!1,className:c,...o}=i,l={...i,disableSpacing:t},r=Q(l);return s.jsx(X,{className:B(r.root,c),ownerState:l,ref:a,...o})}),ss=p(s.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}));function ns(){const[n,e]=m.useState(),[a,i]=m.useState();return m.useEffect(()=>{(async()=>{try{const t=await fetch("https://jbrowse.org/plugin-store/plugins.json");if(!t.ok){const o=await t.text();throw new Error(`HTTP ${t.status} fetching plugins: ${o}`)}const c=await t.json();e(c.plugins)}catch(t){console.error(t),i(t)}})()},[]),{plugins:n,error:a}}function es(n,e){const{pluginManager:a}=u.getEnv(e);return u.isSessionWithSessionPlugins(e)?e.sessionPlugins.some(i=>{var t;return((t=a.pluginMetadata[n.name])===null||t===void 0?void 0:t.url)===i.url}):!1}const ts=m.lazy(()=>S(()=>import("./DeletePluginDialog-NdIrodz1.js"),__vite__mapDeps([0,1,2]),import.meta.url)),b=h()(()=>({iconMargin:{marginRight:"0.5rem"}}));function as(){const{classes:n}=b();return s.jsx(I,{className:n.iconMargin,title:"This plugin was installed by an administrator, you cannot remove it.",children:s.jsx("span",{children:s.jsx(j,{disabled:!0,children:s.jsx(H,{})})})})}const is=g(function({plugin:n,model:e}){const{classes:a}=b(),{pluginManager:i}=u.getEnv(e),t=u.getSession(e),{jbrowse:c,adminMode:o}=t;return s.jsx(I,{className:a.iconMargin,title:"Uninstall plugin",children:s.jsx(j,{"data-testid":`removePlugin-${n.name}`,onClick:()=>{t.queueDialog(l=>[ts,{plugin:n.name,onClose:r=>{if(r){const x=i.pluginMetadata[n.name];o?c.removePlugin(x):P.isSessionWithSessionPlugins(t)&&t.removeSessionPlugin(x)}l()}}])},children:s.jsx($,{})})})}),os=g(function({plugin:n,model:e}){const a=u.getSession(e),{adminMode:i}=a;return s.jsxs(V,{children:[i||es(n,a)?s.jsx(is,{plugin:n,model:e}):s.jsx(as,{}),s.jsx(d,{children:[n.name,n.version?`(v${n.version})`:""].filter(t=>!!t).join(" ")})]},n.name)}),rs=g(function({pluginManager:e,model:a}){const{plugins:i}=e,{filterText:t}=a,c=i.filter(o=>{var l;return!(!((l=e.pluginMetadata[o.name])===null||l===void 0)&&l.isCore)});return s.jsx(U,{children:c.length>0?c.filter(o=>o.name.toLowerCase().includes(t.toLowerCase())).map(o=>s.jsx(os,{plugin:o,model:a},o.name)):s.jsx(d,{children:"No plugins currently installed"})})}),ls=p(s.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),cs=p(s.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),ds=h()({card:{margin:"0.5em"},icon:{marginLeft:"0.5em",marginRight:"0.5em"},bold:{fontWeight:600},dataField:{display:"flex",alignItems:"center"},mr:{marginRight:"0.5em"}}),us=g(function({plugin:e,model:a}){const{classes:i}=ds(),t=u.getSession(a),{pluginManager:c}=u.getEnv(a),{runtimePluginDefinitions:o}=c,l=o.some(f=>"url"in f&&f.url===e.url),[r,x]=m.useState(!1),{adminMode:A,jbrowse:L}=t,{name:w,authors:N,description:T}=e;return s.jsxs(J,{variant:"outlined",className:i.card,children:[s.jsxs(K,{children:[s.jsx(d,{variant:"h5",children:s.jsx(E.ExternalLink,{href:`${e.location}#readme`,children:e.name})}),s.jsxs("div",{className:i.dataField,children:[s.jsx(cs,{className:i.mr}),s.jsx(d,{children:N.join(", ")})]}),s.jsx(d,{className:i.bold,children:"Description:"}),s.jsx(d,{children:T})]}),s.jsx(Z,{children:s.jsx(M,{variant:"contained",disabled:l||r,startIcon:l?s.jsx(ls,{}):s.jsx(W,{}),onClick:()=>{A?L.addPlugin(e):P.isSessionWithSessionPlugins(t)?t.addSessionPlugin(e):t.notify("No way to install plugin"),x(!0)},children:l?"Installed":"Install"})})]},w)}),ms=m.lazy(()=>S(()=>import("./AddCustomPluginDialog-Diy6reQW.js"),__vite__mapDeps([3,1,2,4,5,6]),import.meta.url)),gs=h()(n=>({expandIcon:{color:n.palette.tertiary.contrastText},adminBadge:{borderRadius:3,backgroundColor:n.palette.quaternary.main,padding:"1em",display:"flex",alignContent:"center"},customPluginButton:{margin:"1em auto",display:"flex"},mr:{marginRight:"0.3em"},m:{margin:"1em"}})),ys=g(function({model:n}){const{classes:e}=gs(),{plugins:a,error:i}=ns(),{filterText:t}=n,c=u.getSession(n),{adminMode:o}=c,{pluginManager:l}=z(n);return s.jsxs("div",{children:[o&&s.jsxs(s.Fragment,{children:[!u.isElectron&&s.jsxs("div",{className:e.adminBadge,children:[s.jsx(ss,{className:e.mr}),s.jsxs(d,{children:["You are using the ",s.jsx("code",{children:"admin-server"}),". Any changes you make will be saved to your configuration file. You also have the ability to add custom plugins that are not in the store."]})]}),s.jsx(M,{className:e.customPluginButton,variant:"contained",onClick:()=>{c.queueDialog(r=>[ms,{model:n,onClose:r}])},children:"Add custom plugin"})]}),s.jsx(q,{label:"Filter plugins",value:t,onChange:r=>{n.setFilterText(r.target.value)},fullWidth:!0,slotProps:{input:{endAdornment:s.jsx(O,{position:"end",children:s.jsx(j,{onClick:()=>{n.clearFilterText()},children:s.jsx(Y,{})})})}}}),s.jsxs(v,{defaultExpanded:!0,children:[s.jsx(C,{expandIcon:s.jsx(y,{className:e.expandIcon}),children:s.jsx(d,{variant:"h5",children:"Installed plugins"})}),s.jsx("div",{className:e.m,children:s.jsx(rs,{pluginManager:l,model:n})})]}),s.jsxs(v,{defaultExpanded:!0,children:[s.jsx(C,{expandIcon:s.jsx(y,{className:e.expandIcon}),children:s.jsx(d,{variant:"h5",children:"Available plugins"})}),i?s.jsx(d,{color:"error",children:`${i}`}):a?a.filter(r=>!(u.isElectron&&r.cjsUrl)&&r.name.toLowerCase().includes(t.toLowerCase())).map(r=>s.jsx(us,{plugin:r,model:n},r.name)):s.jsx(E.LoadingEllipses,{})]})]})});export{ys as default};
//# sourceMappingURL=PluginStoreWidget-BYrZpfHe.js.map
