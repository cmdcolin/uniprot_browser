import{u as K,bi as ge,cE as v,o as X,a1 as Fe,h as Y,cF as I,a as H,j as W,cG as q,cH as z,cI as Re}from"./index-DPMJgfAS.js";function Le(t){const e=new Map,s=new Set,n=new Set;for(const r of t.values()){const o=r.get("flags"),a=r.id(),_=K.assembleLocStringFast({refName:r.get("refName"),start:r.get("start"),end:r.get("end")}),i=o&4,d=o&2;if(!s.has(a)&&!n.has(_)&&!d&&!i){const P=r.get("name");let p=e.get(P);p||(p=[],e.set(P,p)),p.push(r)}s.add(r.id()),n.add(_)}return[...e.values()].filter(r=>r.length>1)}function Se(t){var e;const s=new Map,n=new Set;for(const r of t.values()){const o=r.id(),a=r.get("flags")&4,_=!!(!((e=r.get("tags"))===null||e===void 0)&&e.SA);if(!n.has(o)&&!a&&_){const i=r.get("name");let d=s.get(i);d||(d=[],s.set(i,d)),d.push(r)}n.add(r.id())}return[...s.values()].filter(r=>r.length>1)}function we(t){for(const e of t.values())if(e.get("flags")&1)return!0;return!1}function Ne(t,e){const s=t.get("ALT");if(s)return new Map(s.map(n=>ge(n)).filter(K.notEmpty).map(n=>[n.MatePosition,n])).get(`${e.get("refName")}:${e.get("start")+1}`)}function xe(t){const e=new Map,s=new Set;for(const n of t.values()){if(!s.has(n.id())&&n.get("type")==="breakend"){const r=n.get("ALT");if(r)for(const o of r){const a=`${n.get("refName")}:${n.get("start")+1}`,_=ge(o);if(_){const i=e.get(a);i?i.push(n):e.set(_.MatePosition||"none",[n])}}}s.add(n.id())}return[...e.values()].filter(n=>n.length>1)}function Ce(t){const e=[],s=new Set;for(const n of t.values())!s.has(n.id())&&n.get("ALT")[0]==="<TRA>"&&e.push([n]),s.add(n.id());return e}function Ae(t){const e=new Map,s=new Set;for(const n of t.values()){if(!s.has(n.id())&&n.get("type")==="paired_feature"){const r=n.id().replace("-r1",""),o=n.id().replace("-r2","");n.id().endsWith("-r1")?(e.get(r)||e.set(r,[]),e.get(r).push(n)):n.id().endsWith("-r2")&&(e.get(o)||e.set(o,[]),e.get(o).push(n))}s.add(n.id())}return[...e.values()].filter(n=>n.length>1)}const ve={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"}},be={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"},U={color_fwd_strand_not_proper:v("#CA6767",.8),color_rev_strand_not_proper:v("#7272AA",.8),color_fwd_strand:v("#DC2A2A",.8),color_rev_strand:v("#4141BA",.8),color_fwd_missing_mate:v("#921111",.8),color_rev_missing_mate:v("#111192",.8),color_fwd_diff_chr:v("#000000",.8),color_rev_diff_chr:v("#696969",.8),color_pair_lr:v("#8C8C8C",.8),color_pair_rr:v("#00005A",.8),color_pair_rl:v("#005A5A",.8),color_pair_ll:v("#005A00",.8),color_nostrand:v("#8C8C8C",.8),color_interchrom:v("#5A005A",.8),color_longinsert:v("#B30000",.8),color_shortinsert:v("#FF3A5C",.8),color_unknown:v("#555",.8)},Oe=U.color_unknown;function Te(t){const s=ve.fr[t.pair_orientation||""],n=be[s];return s==="LR"?void 0:U[n]}function We(t,e){return t===-1&&e===1?U.color_pair_rr:t===1&&e===-1?U.color_pair_ll:U.color_unknown}function Ee(t,e){return t===-1&&e===1?!0:t===1&&e===-1}function je(t){return ve.fr[t.pair_orientation||""]!=="LR"}function Be(t){return Te(t)||Oe}const[ie,,le]=[0,1,2,3],$e=X(function({model:t,trackId:e,parentRef:s,getTrackYPosOverride:n}){const{interactiveOverlay:r,views:o,showIntraviewLinks:a}=t,_=Fe(),i=K.getSession(t),d=Y(t),{assemblyManager:P}=i,p=o[0],D=p?P.get(p.assemblyNames[0]):void 0;I(d);const h=t.getTrackFeatures(e),u=H.useMemo(()=>we(h),[h]),M=H.useMemo(()=>{const f=t.getMatchedFeaturesInLayout(e,u?Le(h):Se(h));if(!u)for(const F of f)F.sort((l,L)=>l.clipPos-L.clipPos);return f},[h,e,u,t]),[E,y]=H.useState();let m=0;return s.current&&(m=s.current.getBoundingClientRect().top),D?W.jsx("g",{fill:"none","data-testid":M.length?`${e}-loaded`:e,children:M.map(f=>{const F=[];for(let l=0;l<f.length-1;l++){const{layout:L,feature:g,level:c}=f[l],{layout:b,feature:j,level:R}=f[l+1];if(!L||!b)return console.warn("received null layout for a overlay feature"),null;if(!a&&c===R)return null;const S=D.getCanonicalRefName(g.get("refName")),O=D.getCanonicalRefName(j.get("refName"));if(!S||!O)throw new Error(`unable to find ref for ${S||O}`);const N={pair_orientation:g.get("pair_orientation")},T=g.get("strand"),B=j.get("strand"),J=S===O;let w="",x=!1;J&&(u?(w=Be(N),x=je(N)):(w=We(T,B),x=Ee(T,B)));const C=L[T===-1?ie:le],$=B===-1,G=u?b[$?ie:le]:b[$?le:ie],A=q(o[c],S,C),k=q(o[R],O,G),ee=o[c].pxToBp(A).reversed,pe=o[R].pxToBp(k).reversed,he=ee?-1:1,ye=pe?-1:1,te=o.map(Q=>Q.getTrack(e)),ne=z(e,c,o,te,L,n)-m,oe=z(e,R,o,te,b,n)-m,se=c===R&&x,Z=se?te[c].displays[0].height:0,me=u?-1:1,ce=Re(o,e,c,n),_e=["M",A,ne,"C",A+200*g.get("strand")*he,se?Math.min(ce-m+Z,ne+Z):ne,k-200*j.get("strand")*ye*me,se?Math.min(ce-m+Z,oe+Z):oe,k,oe].join(" "),re=`${g.id()}-${j.id()}`;F.push(W.jsx("path",{d:_e,"data-testid":"r1",pointerEvents:r?"auto":void 0,strokeWidth:E===re?5:1,...K.getStrokeProps(w||_.palette.text.disabled),onClick:()=>{var Q,ae;const Me=(Q=i.addWidget)===null||Q===void 0?void 0:Q.call(i,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(h.get(g.id())||{toJSON:()=>{}}).toJSON(),feature2:(h.get(j.id())||{toJSON:()=>{}}).toJSON()}});(ae=i.showWidget)===null||ae===void 0||ae.call(i,Me)},onMouseOver:()=>{y(re)},onMouseOut:()=>{y(void 0)}},re))}return F})}):null}),[ue]=[0,1,2,3],Pe=X(function({model:t,trackId:e,parentRef:s,getTrackYPosOverride:n}){const{interactiveOverlay:r,views:o}=t,a=K.getSession(t),{assemblyManager:_}=a,i=t.getTrackFeatures(e),d=H.useMemo(()=>t.getMatchedFeaturesInLayout(e,xe(i)),[i,e,t]),[P,p]=H.useState(),D=Y(t);I(D);const h=_.get(o[0].assemblyNames[0]);if(!h)return null;let u=0;return s.current&&(u=s.current.getBoundingClientRect().top),W.jsx("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":d.length?`${e}-loaded`:e,children:d.map(M=>{const E=[];for(let y=0;y<M.length-1;y+=1){const{layout:m,feature:f,level:F}=M[y],{layout:l,feature:L,level:g}=M[y+1],c=f.id(),b=Ne(f,L);if(!m||!l)return null;const j=f.get("refName"),R=L.get("refName"),S=h.getCanonicalRefName(j),O=h.getCanonicalRefName(R);if(!S||!O)throw new Error(`unable to find ref for ${S||O}`);const N=q(o[F],S,m[ue]),T=q(o[g],O,l[ue]),B=o[F].pxToBp(N).reversed,V=o[g].pxToBp(T).reversed,J=o.map(C=>C.getTrack(e)),w=z(e,F,o,J,m,n)-u,x=z(e,g,o,J,l,n)-u;if(!b)console.warn("the relevant ALT allele was not found, cannot render");else{const C=["M",N-20*(b.Join==="left"?-1:1)*(B?-1:1),w,"L",N,w,"L",T,x,"L",T-20*(b.MateDirection==="left"?1:-1)*(V?-1:1),x].join(" ");E.push(W.jsx("path",{d:C,"data-testid":"r2",pointerEvents:r?"auto":void 0,strokeWidth:c===P?10:5,onClick:()=>{var $,G,A;const k=($=a.addWidget)===null||$===void 0?void 0:$.call(a,"VariantFeatureWidget","variantFeature",{featureData:(G=i.get(c))===null||G===void 0?void 0:G.toJSON()});(A=a.showWidget)===null||A===void 0||A.call(a,k)},onMouseOver:()=>{p(c)},onMouseOut:()=>{p(void 0)}},JSON.stringify(C)))}}return E})})}),[fe]=[0,1,2,3],De=X(function({model:t,trackId:e,parentRef:s,getTrackYPosOverride:n}){const{interactiveOverlay:r,views:o}=t,a=K.getSession(t),{assemblyManager:_}=a,i=t.getTrackFeatures(e),d=H.useMemo(()=>t.getMatchedFeaturesInLayout(e,Ae(i)),[i,e,t]),[P,p]=H.useState(),D=Y(t);I(D);const h=_.get(o[0].assemblyNames[0]);if(!h)return null;let u=0;return s.current&&(u=s.current.getBoundingClientRect().top),W.jsx("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":d.length?`${e}-loaded`:e,children:d.map(M=>{const E=[];for(let y=0;y<M.length-1;y+=1){const{layout:m,feature:f,level:F}=M[y],{layout:l,feature:L,level:g}=M[y+1],c=f.id();if(!m||!l)return null;const b=f.get("refName"),j=L.get("refName"),R=h.getCanonicalRefName(b),S=h.getCanonicalRefName(j);if(!R||!S)throw new Error(`unable to find ref for ${R||S}`);const O=q(o[F],R,m[fe]),N=q(o[g],S,l[fe]),T=o.map(w=>w.getTrack(e)),B=z(e,F,o,T,m,n)-u,V=z(e,g,o,T,l,n)-u,J=["M",O,B,"L",N,V].join(" ");E.push(W.jsx("path",{d:J,"data-testid":"r2",pointerEvents:r?"auto":void 0,strokeWidth:c===P?10:5,onClick:()=>{var w,x,C;const $=(w=a.addWidget)===null||w===void 0?void 0:w.call(a,"VariantFeatureWidget","variantFeature",{featureData:(x=i.get(c))===null||x===void 0?void 0:x.toJSON()});(C=a.showWidget)===null||C===void 0||C.call(a,$)},onMouseOver:()=>{p(c)},onMouseOut:()=>{p(void 0)}},JSON.stringify(J)))}return E})})}),[Je]=[0,1,2,3];function de(t){return t==="+"?1:t==="-"?-1:0}const ke=X(function({model:t,trackId:e,parentRef:s,getTrackYPosOverride:n}){const{interactiveOverlay:r,views:o}=t,a=K.getSession(t),{assemblyManager:_}=a,i=t.getTrackFeatures(e),d=H.useMemo(()=>t.getMatchedFeaturesInLayout(e,Ce(i)),[i,e,t]),[P,p]=H.useState(),D=Y(t);if(I(D),!_.get(o[0].assemblyNames[0]))return null;let u=0;return s.current&&(u=s.current.getBoundingClientRect().top),o.length<2?null:W.jsx("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":d.length?`${e}-loaded`:e,children:d.map(M=>{var E,y;const m=[];for(const{layout:f,feature:F,level:l}of M){const L=l===0?1:0,g=F.id();if(!f)return null;const c=F.get("INFO"),b=c.CHR2[0],j=c.END[0],R=(y=(E=c.STRANDS)===null||E===void 0?void 0:E[0])===null||y===void 0?void 0:y.split(""),[S,O]=R??[".","."],N=q(o[L],b,j);if(N){const T=[N,0,N+1,0],B=q(o[l],F.get("refName"),f[Je]),V=N,J=o[l].pxToBp(B).reversed,w=o[L].pxToBp(V).reversed,x=o.map(A=>A.getTrack(e)),C=z(e,l,o,x,f,n)-u,$=z(e,L,o,x,T,n)-u,G=["M",B-20*de(S)*(J?-1:1),C,"L",B,C,"L",V,$,"L",V-20*de(O)*(w?-1:1),$].join(" ");m.push(W.jsx("path",{d:G,pointerEvents:r?"auto":void 0,strokeWidth:g===P?10:5,onClick:()=>{var A,k;const ee=(A=a.addWidget)===null||A===void 0?void 0:A.call(a,"VariantFeatureWidget","variantFeature",{featureData:(i.get(g)||{toJSON:()=>{}}).toJSON()});(k=a.showWidget)===null||k===void 0||k.call(a,ee)},onMouseOver:()=>{p(g)},onMouseOut:()=>{p(void 0)}},JSON.stringify(G)))}}return m})})}),Ge=X(function(t){var e;const{model:s,trackId:n}=t,o=(e=s.getMatchedTracks(n)[0])===null||e===void 0?void 0:e.type;return o==="AlignmentsTrack"?W.jsx($e,{...t}):o==="VariantTrack"?s.hasTranslocations(n)?W.jsx(ke,{...t}):s.hasPairedFeatures(n)?W.jsx(De,{...t}):W.jsx(Pe,{...t}):null});export{Ge as O};
//# sourceMappingURL=Overlay-r0LbhaS_.js.map
