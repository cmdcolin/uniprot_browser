import{B as v}from"./index-CWy9Wmpn.js";import{af as F,ag as E,u as r}from"./index-B3kPj2Rj.js";import{r as $}from"./rxjs-bJg6jVuh.js";class B extends v.BaseFeatureDataAdapter{async configure(){var e;const o=await((e=this.getSubAdapter)===null||e===void 0?void 0:e.call(this,this.getConf("sequenceAdapter")));if(!o)throw new Error("Error getting subadapter");return o.dataAdapter}async getRefNames(){return(await this.configure()).getRefNames()}getFeatures(e,o){return $.ObservableCreate(async c=>{var d;const u=await this.configure(),h=1e4,n=e.end+h,i=Math.max(0,e.start-h);if(n<0||i>n){c.complete();return}const l=u.getFeatures({...e,start:i,end:n},o),m=((d=(await F(l.pipe(E())))[0])===null||d===void 0?void 0:d.get("seq"))||"",p=this.getConf("search"),x=this.getConf("searchForward"),w=this.getConf("searchReverse"),A=this.getConf("caseInsensitive"),g=new RegExp(p,`g${A?"i":""}`);if(p){if(x){const f=m.matchAll(g);for(const t of f){const a=i+t.index,s=i+t.index+t[0].length;r.doesIntersect2(a,s,e.start,e.end)&&c.next(new r.SimpleFeature({uniqueId:`${this.id}-${a}-${t[0]}-pos`,refName:e.refName,start:a,end:s,name:t[0],strand:1}))}}if(w){const f=r.revcom(m).matchAll(g);for(const t of f){const a=n-t.index,s=n-t.index-t[0].length;r.doesIntersect2(s,a,e.start,e.end)&&c.next(new r.SimpleFeature({uniqueId:`${this.id}-${s}-${t[0]}-neg`,refName:e.refName,start:s,end:a,name:t[0],strand:-1}))}}}c.complete()})}}export{B as default};
//# sourceMappingURL=SequenceSearchAdapter-BDiBnf6V.js.map
